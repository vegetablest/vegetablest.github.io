<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>leetcode-ä¸‰æ•°ä¹‹å’Œ</title>
    <link href="/2026/02/28/leetcode-%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/"/>
    <url>/2026/02/28/leetcode-%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸‰æ•°ä¹‹å’Œ"><a href="#ä¸‰æ•°ä¹‹å’Œ" class="headerlink" title="ä¸‰æ•°ä¹‹å’Œ"></a><a href="https://leetcode.cn/problems/3sum/description/">ä¸‰æ•°ä¹‹å’Œ</a></h2><blockquote><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ [nums[i], nums[j], nums[k]] æ»¡è¶³ i !&#x3D; jã€i !&#x3D; k ä¸” j !&#x3D; k ï¼ŒåŒæ—¶è¿˜æ»¡è¶³ nums[i] + nums[j] + nums[k] &#x3D;&#x3D; 0 ã€‚è¯·ä½ è¿”å›æ‰€æœ‰å’Œä¸º 0 ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p>æ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><p>è¾“å…¥ï¼šnums &#x3D; [-1,0,1,2,-1,-4]<br>è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]]<br>è§£é‡Šï¼š<br>nums[0] + nums[1] + nums[2] &#x3D; (-1) + 0 + 1 &#x3D; 0 ã€‚<br>nums[1] + nums[2] + nums[4] &#x3D; 0 + 1 + (-1) &#x3D; 0 ã€‚<br>nums[0] + nums[3] + nums[4] &#x3D; (-1) + 2 + (-1) &#x3D; 0 ã€‚<br>ä¸åŒçš„ä¸‰å…ƒç»„æ˜¯ [-1,0,1] å’Œ [-1,-1,2] ã€‚<br>æ³¨æ„ï¼Œè¾“å‡ºçš„é¡ºåºå’Œä¸‰å…ƒç»„çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚<br>ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼šnums &#x3D; [0,1,1]<br>è¾“å‡ºï¼š[]<br>è§£é‡Šï¼šå”¯ä¸€å¯èƒ½çš„ä¸‰å…ƒç»„å’Œä¸ä¸º 0 ã€‚<br>ç¤ºä¾‹ 3ï¼š</p><p>è¾“å…¥ï¼šnums &#x3D; [0,0,0]<br>è¾“å‡ºï¼š[[0,0,0]]<br>è§£é‡Šï¼šå”¯ä¸€å¯èƒ½çš„ä¸‰å…ƒç»„å’Œä¸º 0 ã€‚</p><p>æç¤ºï¼š</p><p>3 &lt;&#x3D; nums.length &lt;&#x3D; 3000<br>-105 &lt;&#x3D; nums[i] &lt;&#x3D; 105</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">threeSum</span>(<span class="hljs-params">self, nums: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">list</span>[<span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>]]:<br>        <span class="hljs-comment"># å…ˆæ’åºnums â†’ O(n log n)</span><br>        nums.sort()<br>        result = []<br><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">2</span>):<br><br>            <span class="hljs-comment"># è·³è¿‡é‡å¤å…ƒç´ é¿å…é‡å¤ç»“æœ</span><br>            <span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> nums[i] == nums[i - <span class="hljs-number">1</span>]:<br>                <span class="hljs-keyword">continue</span><br><br>            <span class="hljs-comment"># å¯¹å‰©ä½™å­æ•°ç»„ä½¿ç”¨ åŒæŒ‡é’ˆ æŸ¥æ‰¾ä¸¤æ•°ä¹‹å’Œ = -nums[i]</span><br>            left, right = i + <span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span><br><br>            <span class="hljs-keyword">while</span> left &lt; right:<br>                total = nums[i] + nums[left] + nums[right]<br><br>                <span class="hljs-keyword">if</span> total &lt; <span class="hljs-number">0</span>:<br>                    left += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">elif</span> total &gt; <span class="hljs-number">0</span>:<br>                    right -= <span class="hljs-number">1</span><br>                <span class="hljs-keyword">else</span>:<br>                    result.append([nums[i], nums[left], nums[right]])<br><br>                    <span class="hljs-comment"># è·³è¿‡é‡å¤å…ƒç´ é¿å…é‡å¤ç»“æœ, å»é‡ left</span><br>                    <span class="hljs-keyword">while</span> left &lt; right <span class="hljs-keyword">and</span> nums[left] == nums[left + <span class="hljs-number">1</span>]:<br>                        left += <span class="hljs-number">1</span><br><br>                    <span class="hljs-comment"># è·³è¿‡é‡å¤å…ƒç´ é¿å…é‡å¤ç»“æœ, å»é‡ right</span><br>                    <span class="hljs-keyword">while</span> left &lt; right <span class="hljs-keyword">and</span> nums[right] == nums[right - <span class="hljs-number">1</span>]:<br>                        right -= <span class="hljs-number">1</span><br><br>                    left += <span class="hljs-number">1</span><br>                    right -= <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">return</span> result<br></code></pre></td></tr></table></figure><h3 id="ä¸€ã€ç¬¬ä¸€æ­¥æ€è·¯æ¢³ç†"><a href="#ä¸€ã€ç¬¬ä¸€æ­¥æ€è·¯æ¢³ç†" class="headerlink" title="ä¸€ã€ç¬¬ä¸€æ­¥æ€è·¯æ¢³ç†"></a>ä¸€ã€ç¬¬ä¸€æ­¥æ€è·¯æ¢³ç†</h3><p>ä¸‰æ•°ä¹‹å’Œæœ¬è´¨å¯ä»¥æ‹†è§£æˆ åŒæŒ‡é’ˆ+æ’åºé—®é¢˜ï¼š</p><p>1ï¸âƒ£ å…ˆ æ’åº nums â†’ O(n log n)<br>2ï¸âƒ£ å›ºå®šç¬¬ä¸€ä¸ªå…ƒç´  nums[i]<br>3ï¸âƒ£ å¯¹å‰©ä½™å­æ•°ç»„ä½¿ç”¨ åŒæŒ‡é’ˆ æŸ¥æ‰¾ä¸¤æ•°ä¹‹å’Œ &#x3D; -nums[i]<br>4ï¸âƒ£ è·³è¿‡é‡å¤å…ƒç´ é¿å…é‡å¤ç»“æœ</p><h3 id="äºŒã€æ ¸å¿ƒé€»è¾‘ï¼ˆåŒæŒ‡é’ˆå¥—è·¯ï¼‰"><a href="#äºŒã€æ ¸å¿ƒé€»è¾‘ï¼ˆåŒæŒ‡é’ˆå¥—è·¯ï¼‰" class="headerlink" title="äºŒã€æ ¸å¿ƒé€»è¾‘ï¼ˆåŒæŒ‡é’ˆå¥—è·¯ï¼‰"></a>äºŒã€æ ¸å¿ƒé€»è¾‘ï¼ˆåŒæŒ‡é’ˆå¥—è·¯ï¼‰</h3><p>å·¦æŒ‡é’ˆ left &#x3D; i+1<br>å³æŒ‡é’ˆ right &#x3D; len(nums)-1</p>]]></content>
    
    
    <categories>
      
      <category>leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>leetcode-ç››æœ€å¤šæ°´çš„å®¹å™¨</title>
    <link href="/2026/02/27/leetcode-%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8/"/>
    <url>/2026/02/27/leetcode-%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="ç››æ°´æœ€å¤šçš„å®¹å™¨"><a href="#ç››æ°´æœ€å¤šçš„å®¹å™¨" class="headerlink" title="ç››æ°´æœ€å¤šçš„å®¹å™¨"></a><a href="https://leetcode.cn/problems/container-with-most-water/description/">ç››æ°´æœ€å¤šçš„å®¹å™¨</a></h2><blockquote><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„ height ã€‚æœ‰ n æ¡å‚çº¿ï¼Œç¬¬ i æ¡çº¿çš„ä¸¤ä¸ªç«¯ç‚¹æ˜¯ (i, 0) å’Œ (i, height[i]) ã€‚<br>æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ x è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚</p><p>è¿”å›å®¹å™¨å¯ä»¥å‚¨å­˜çš„æœ€å¤§æ°´é‡ã€‚</p><p>è¯´æ˜ï¼šä½ ä¸èƒ½å€¾æ–œå®¹å™¨ã€‚</p><p><img src="https://aliyun-lc-upload.oss-cn-hangzhou.aliyuncs.com/aliyun-lc-upload/uploads/2018/07/25/question_11.jpg"></p><p>è¾“å…¥ï¼š[1,8,6,2,5,4,8,3,7]<br>è¾“å‡ºï¼š49<br>è§£é‡Šï¼šå›¾ä¸­å‚ç›´çº¿ä»£è¡¨è¾“å…¥æ•°ç»„ [1,8,6,2,5,4,8,3,7]ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå®¹&gt; å™¨èƒ½å¤Ÿå®¹çº³æ°´ï¼ˆè¡¨ç¤ºä¸ºè“è‰²éƒ¨åˆ†ï¼‰çš„æœ€å¤§å€¼ä¸º 49ã€‚<br>ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼šheight &#x3D; [1,1]<br>è¾“å‡ºï¼š1</p><p>æç¤ºï¼š</p><p>n &#x3D;&#x3D; height.length<br>2 &lt;&#x3D; n &lt;&#x3D; 105<br>0 &lt;&#x3D; height[i] &lt;&#x3D; 104</p></blockquote><p>å› ä¸ºå®¹å™¨çš„é¢ç§¯ç”±ä¸¤ç«¯ä¸­è¾ƒçŸ­çš„é«˜åº¦å†³å®šï¼Œå¦‚æœç§»åŠ¨è¾ƒé•¿çš„ä¸€ä¾§ï¼Œå®½åº¦ä¼šå˜å°ï¼Œè€ŒçŸ­æ¿ä¸ä¼šæ”¹å˜ï¼Œå› æ­¤é¢ç§¯ä¸€å®šä¼šå‡å°ã€‚åªæœ‰ç§»åŠ¨è¾ƒçŸ­çš„ä¸€ä¾§ï¼Œæ‰æœ‰å¯èƒ½æ‰¾åˆ°æ›´é«˜çš„é«˜åº¦ï¼Œä»è€Œçªç ´å½“å‰çŸ­æ¿é™åˆ¶ï¼Œä½¿é¢ç§¯å¯èƒ½å¢å¤§ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">max_area</span>(<span class="hljs-params">nums: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>    left, right = <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(nums) - <span class="hljs-number">1</span><br>    max_area = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">while</span> left &lt; right:<br>        height = <span class="hljs-built_in">min</span>(nums[left], nums[right])<br>        width = right - left<br>        area = height * width<br>        max_area = <span class="hljs-built_in">max</span>(max_area, area)<br><br>        <span class="hljs-keyword">if</span> nums[left] &lt; nums[right]:<br>            left += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            right -= <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> max_area<br></code></pre></td></tr></table></figure><p><strong>åŒæŒ‡é’ˆæ¯ä¸€æ­¥éƒ½æ ¹æ®å½“å‰å±€éƒ¨ä¿¡æ¯åšå‡ºæœ€ä¼˜å†³ç­–ï¼Œä¾‹å¦‚åœ¨â€œç››æ°´æœ€å¤šçš„å®¹å™¨â€ä¸­ï¼Œæˆ‘ä»¬åªç§»åŠ¨è¾ƒçŸ­çš„ä¸€ä¾§ï¼Œå› ä¸ºåªæœ‰è¿™æ ·æ‰æœ‰å¯èƒ½å¢åŠ é¢ç§¯ã€‚è¿™ä¸ªå±€éƒ¨æœ€ä¼˜é€‰æ‹©èƒ½å¤Ÿä¿è¯æœ€ç»ˆå¾—åˆ°å…¨å±€æœ€ä¼˜è§£ï¼Œæ‰€ä»¥æœ¬è´¨ä¸ŠåŒæŒ‡é’ˆæ˜¯ä¸€ç§è´ªå¿ƒç­–ç•¥ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>leetcode-ä¸¤æ•°ä¹‹å’Œ</title>
    <link href="/2026/02/27/leetcode-%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/"/>
    <url>/2026/02/27/leetcode-%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8C/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸¤æ•°ä¹‹å’Œ"><a href="#ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="ä¸¤æ•°ä¹‹å’Œ"></a>ä¸¤æ•°ä¹‹å’Œ</h2><blockquote><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ targetï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º å’Œä¸ºç›®æ ‡å€¼ target  çš„é‚£ ä¸¤ä¸ª æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚<br>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä½¿ç”¨ä¸¤æ¬¡ç›¸åŒçš„å…ƒç´ ã€‚<br>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚<br>ç¤ºä¾‹ 1ï¼š</p><p>è¾“å…¥ï¼šnums &#x3D; [2,7,11,15], target &#x3D; 9<br>è¾“å‡ºï¼š[0,1]<br>è§£é‡Šï¼šå› ä¸º nums[0] + nums[1] &#x3D;&#x3D; 9 ï¼Œè¿”å› [0, 1] ã€‚</p><p>ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼šnums &#x3D; [3,2,4], target &#x3D; 6<br>è¾“å‡ºï¼š[1,2]</p><p>ç¤ºä¾‹ 3ï¼š</p><p>è¾“å…¥ï¼šnums &#x3D; [3,3], target &#x3D; 6<br>è¾“å‡ºï¼š[0,1]</p><p>æç¤ºï¼š</p><p>2 &lt;&#x3D; nums.length &lt;&#x3D; 104<br>-109 &lt;&#x3D; nums[i] &lt;&#x3D; 109<br>-109 &lt;&#x3D; target &lt;&#x3D; 109<br>åªä¼šå­˜åœ¨ä¸€ä¸ªæœ‰æ•ˆç­”æ¡ˆ</p><p>è¿›é˜¶ï¼šä½ å¯ä»¥æƒ³å‡ºä¸€ä¸ªæ—¶é—´å¤æ‚åº¦å°äº O(n2) çš„ç®—æ³•å—ï¼Ÿ</p></blockquote><p>æš´åŠ›æšä¸¾ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨éå†æ•´ä¸ªæ•°ç»„çš„æ–¹å¼å¯»æ‰¾<code>target - x</code>æ—¶ï¼Œéœ€è¦æ³¨æ„åˆ°æ¯ä¸€ä¸ªä½äº x ä¹‹å‰çš„å…ƒç´ éƒ½å·²ç»å’Œ x åŒ¹é…è¿‡ï¼Œå› æ­¤ä¸éœ€è¦å†è¿›è¡ŒåŒ¹é…ã€‚è€Œæ¯ä¸€ä¸ªå…ƒç´ ä¸èƒ½è¢«ä½¿ç”¨ä¸¤æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨ x åé¢çš„å…ƒç´ ä¸­å¯»æ‰¾ <code>target - x</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">twoSum</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], target: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>        n = <span class="hljs-built_in">len</span>(nums)<br>        <span class="hljs-comment"># å¤–å±‚å¾ªç¯æ§åˆ¶æ¯ä¸€ä¸ªå…ƒç´ çš„éå†</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-comment"># å†…å±‚å¾ªç¯æ§åˆ¶iä¹‹åçš„å…ƒç´ å˜é‡ï¼Œiä¹‹å‰çš„å·²ç»éå†è¿‡äº†</span><br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, n):<br>                <span class="hljs-keyword">if</span> nums[i] + nums[j] == target:<br>                    <span class="hljs-keyword">return</span> [i, j]<br>        <br>        <span class="hljs-keyword">return</span> []<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span>[] twoSum(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> target) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> nums.length;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n; ++i) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; n; ++j) &#123;<br>                <span class="hljs-keyword">if</span> (nums[i] + nums[j] == target) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;i, j&#125;;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå¯¹äºæ¯ä¸€ä¸ª xï¼Œæˆ‘ä»¬é¦–å…ˆæŸ¥è¯¢å“ˆå¸Œè¡¨ä¸­æ˜¯å¦å­˜åœ¨ target - xï¼Œç„¶åå°† x æ’å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ï¼Œå³å¯ä¿è¯ä¸ä¼šè®© x å’Œè‡ªå·±åŒ¹é…ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">twoSum</span>(<span class="hljs-params">self, nums: <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>], target: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>        point: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">int</span>] = &#123;&#125;<br>        <span class="hljs-keyword">for</span> index, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(nums):<br>            <span class="hljs-keyword">if</span> (target - value) <span class="hljs-keyword">in</span> point:<br>                <span class="hljs-keyword">return</span> [index, point[target - value]]<br>            point[value] = index<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span>[] twoSum(<span class="hljs-type">int</span>[] nums, <span class="hljs-type">int</span> target) &#123;<br>HashMap&lt;Integer, Integer&gt; point = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;<br><span class="hljs-keyword">if</span> (point.containsKey(target - nums[i])) &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;point.get(target - nums[i]), i&#125;;<br>&#125;<br>point.put(nums[i], i);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç®—æ³•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>VS Code å¼€å‘ç¯å¢ƒé…ç½®æŒ‡å—</title>
    <link href="/2025/08/13/vscode%E9%85%8D%E7%BD%AE/"/>
    <url>/2025/08/13/vscode%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œåˆç†é…ç½® VS Code èƒ½å¤Ÿæ˜¾è‘—æå‡å¼€å‘æ•ˆç‡ã€‚æœ¬æ–‡è®°å½•äº†ä¸€äº›å®ç”¨çš„ VS Code é…ç½®æŠ€å·§ï¼Œå¸®åŠ©ä½ æ‰“é€ æ›´èˆ’é€‚çš„å¼€å‘ç¯å¢ƒã€‚</p><h2 id="ä»£ç†é…ç½®"><a href="#ä»£ç†é…ç½®" class="headerlink" title="ä»£ç†é…ç½®"></a>ä»£ç†é…ç½®</h2><h3 id="åŸºç¡€ä»£ç†è®¾ç½®"><a href="#åŸºç¡€ä»£ç†è®¾ç½®" class="headerlink" title="åŸºç¡€ä»£ç†è®¾ç½®"></a>åŸºç¡€ä»£ç†è®¾ç½®</h3><p>ç”±äºæŸäº›æ‰©å±•æ’ä»¶éœ€è¦è®¿é—®å¤–ç½‘èµ„æºï¼Œæˆ‘ä»¬éœ€è¦ä¸º VS Code é…ç½®ç½‘ç»œä»£ç†ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;http.proxy&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://127.0.0.1:7890&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><strong>ä½¿ç”¨æœ¬åœ°ä»£ç†å°±ä¸éœ€è¦é…ç½®ä»£ç†åœ°å€ï¼Œä¼šä»æœ¬åœ°envç¯å¢ƒä¸­å¯»æ‰¾ä»£ç†åœ°å€</strong>ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;http.useLocalProxyConfiguration&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="ç«¯å£è½¬å‘é…ç½®"><a href="#ç«¯å£è½¬å‘é…ç½®" class="headerlink" title="ç«¯å£è½¬å‘é…ç½®"></a>ç«¯å£è½¬å‘é…ç½®</h2><p>åœ¨è¿›è¡Œå®¹å™¨åŒ–å¼€å‘æ—¶ï¼ŒVS Code çš„è‡ªåŠ¨ç«¯å£è½¬å‘åŠŸèƒ½é»˜è®¤åªç›‘å¬ <code>localhost</code>ã€‚ä¸ºäº†è®©å±€åŸŸç½‘å†…çš„å…¶ä»–è®¾å¤‡ä¹Ÿèƒ½è®¿é—®ï¼Œéœ€è¦è°ƒæ•´ç›‘å¬åœ°å€ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;remote.localPortHost&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;allInterfaces&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·é…ç½®åï¼Œç«¯å£è½¬å‘å°†ç›‘å¬ <code>0.0.0.0</code>ï¼Œå…è®¸å±€åŸŸç½‘å†…çš„ç”¨æˆ·é€šè¿‡ä½ çš„ IP åœ°å€è®¿é—®è½¬å‘çš„ç«¯å£ã€‚</p><h2 id="æ–‡ä»¶åµŒå¥—ä¼˜åŒ–å»ºè®®"><a href="#æ–‡ä»¶åµŒå¥—ä¼˜åŒ–å»ºè®®" class="headerlink" title="æ–‡ä»¶åµŒå¥—ä¼˜åŒ–å»ºè®®"></a>æ–‡ä»¶åµŒå¥—ä¼˜åŒ–å»ºè®®</h2><p>åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œç›¸å…³æ–‡ä»¶å¦‚æœèƒ½ä»¥çˆ¶å­åµŒå¥—çš„æ–¹å¼åœ¨èµ„æºç®¡ç†å™¨ä¸­å±•ç¤ºï¼Œå°†æ˜¾å¾—ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œä¾¿äºç®¡ç†å’ŒæŸ¥æ‰¾ã€‚ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®å¯ç”¨æ–‡ä»¶åµŒå¥—åŠŸèƒ½ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;explorer.fileNesting.enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br></code></pre></td></tr></table></figure><h3 id="æ¨èåµŒå¥—é…ç½®ç¤ºä¾‹"><a href="#æ¨èåµŒå¥—é…ç½®ç¤ºä¾‹" class="headerlink" title="æ¨èåµŒå¥—é…ç½®ç¤ºä¾‹"></a>æ¨èåµŒå¥—é…ç½®ç¤ºä¾‹</h3><table><thead><tr><th>çˆ¶æ–‡ä»¶</th><th>å­æ–‡ä»¶ï¼ˆè‡ªåŠ¨åµŒå¥—æ˜¾ç¤ºï¼‰</th></tr></thead><tbody><tr><td>Pipfile</td><td>Pipfile.lock</td></tr><tr><td>.env</td><td>.env*ï¼ˆå¦‚ .env.localã€.env.dev ç­‰ï¼‰</td></tr><tr><td>pyproject.toml</td><td>uv.lock</td></tr></tbody></table><h4 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h4><ul><li><strong>Pipfile</strong>ï¼šå°† <code>Pipfile.lock</code> ä½œä¸ºå­æ–‡ä»¶åµŒå¥—ï¼Œå¯ä»¥å¿«é€Ÿå®šä½ä¾èµ–åŠå…¶é”å®šæ–‡ä»¶ã€‚</li><li><strong>.env</strong>ï¼šæ‰€æœ‰ä»¥ <code>.env</code> å¼€å¤´çš„ç¯å¢ƒé…ç½®æ–‡ä»¶å‡ä½œä¸º <code>.env</code> çš„å­é¡¹ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ç¯å¢ƒå˜é‡ã€‚</li><li><strong>pyproject.toml</strong>ï¼šå°†ä¾èµ–é”å®šæ–‡ä»¶ <code>uv.lock</code> ä½œä¸ºå­é¡¹å½’ç±»ï¼Œä¿æŒ Python é¡¹ç›®æ ¹ç›®å½•æ•´æ´ã€‚</li></ul><h2 id="ä½¿ç”¨ruffæ ¼å¼åŒ–pythonä»£ç "><a href="#ä½¿ç”¨ruffæ ¼å¼åŒ–pythonä»£ç " class="headerlink" title="ä½¿ç”¨ruffæ ¼å¼åŒ–pythonä»£ç "></a>ä½¿ç”¨ruffæ ¼å¼åŒ–pythonä»£ç </h2><p>Ruff æ˜¯ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„æå¿«é€Ÿçš„ Python ä»£ç æ£€æŸ¥å·¥å…·å’Œæ ¼å¼åŒ–å·¥å…·ï¼Œå¯ä»¥æ›¿ä»£ Flake8ã€Blackã€isort ç­‰å·¥å…·ï¼ŒåŒæ—¶æ‰§è¡Œé€Ÿåº¦æ›´å¿«ã€‚</p><p>1.å®‰è£…ruffæ‰©å±•<br>2.å®‰è£…ruffæœ¬èº«</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install ruff<br></code></pre></td></tr></table></figure><p>3.é…ç½® Ruff</p><p>æŒ‰ä¸‹<code>Cmd+Shift+P</code>ï¼Œæœç´¢<code>Open Settings (JSON)</code>, æ·»åŠ å¦‚ä¸‹é…ç½®</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-comment">// ä»…å¯¹ python æ–‡ä»¶ç”Ÿæ•ˆ</span><br>  <span class="hljs-attr">&quot;[python]&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;editor.formatOnSave&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;editor.defaultFormatter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;charliermarsh.ruff&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;editor.codeActionsOnSave&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;source.fixAll&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;explicit&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;source.organizeImports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;explicit&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-comment">// notebook    </span><br>  <span class="hljs-attr">&quot;notebook.formatOnSave.enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;notebook.codeActionsOnSave&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;notebook.source.fixAll&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;explicit&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;notebook.source.organizeImports&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;explicit&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;ruff.nativeServer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;on&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;ruff.logLevel&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;info&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;ruff.logFile&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/path/to/ruff.log&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;ruff.trace.server&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;messages&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;ruff.lineLength&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">88</span>  <span class="hljs-comment">// è®¾ç½®ä»£ç è¡Œé•¿åº¦ä¸º 88</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="å…¶ä»–å®ç”¨é…ç½®"><a href="#å…¶ä»–å®ç”¨é…ç½®" class="headerlink" title="å…¶ä»–å®ç”¨é…ç½®"></a>å…¶ä»–å®ç”¨é…ç½®</h2><p>TODO: </p><hr><p><strong>ç›¸å…³é“¾æ¥</strong>ï¼š</p><ul><li><a href="https://code.visualstudio.com/docs/getstarted/settings">VS Code å®˜æ–¹é…ç½®æ–‡æ¡£</a></li><li><a href="https://code.visualstudio.com/docs/remote/remote-overview">VS Code è¿œç¨‹å¼€å‘æŒ‡å—</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>IDE</category>
      
      <category>å¼€å‘ç¯å¢ƒ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vscode</tag>
      
      <tag>å¼€å‘å·¥å…·</tag>
      
      <tag>é…ç½®</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>leetcode-hard</title>
    <link href="/2025/06/04/leetcode-hard/"/>
    <url>/2025/06/04/leetcode-hard/</url>
    
    <content type="html"><![CDATA[<p>TODO: Stay tuned</p>]]></content>
    
    
    <categories>
      
      <category>leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç®—æ³•-å›°éš¾</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>leetcode-med</title>
    <link href="/2025/06/04/leetcode-med/"/>
    <url>/2025/06/04/leetcode-med/</url>
    
    <content type="html"><![CDATA[<p>TODO: Stay tuned</p>]]></content>
    
    
    <categories>
      
      <category>leetcode</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç®—æ³•-ä¸­ç­‰</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python ä¸­ yield å…³é”®å­—èµ·ä»€ä¹ˆä½œç”¨ï¼Ÿ</title>
    <link href="/2025/06/03/python-yield/"/>
    <url>/2025/06/03/python-yield/</url>
    
    <content type="html"><![CDATA[<p>è¦ç†è§£<code>yield</code>çš„ä½œç”¨ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ç†è§£ <strong>å¯è¿­ä»£å¯¹è±¡ï¼ˆiterableï¼‰</strong> å’Œ <strong>è¿­ä»£å™¨ï¼ˆiteratorï¼‰</strong> çš„æ¦‚å¿µã€‚åƒä¸‡ä¸è¦æ··æ·†å¯è¿­ä»£å¯¹è±¡ã€è¿­ä»£å™¨å’Œç”Ÿæˆå™¨ï¼</p><h2 id="å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨"><a href="#å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨" class="headerlink" title="å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨"></a>å¯è¿­ä»£å¯¹è±¡ä¸è¿­ä»£å™¨</h2><p>åˆ›å»ºä¸€ä¸ªåˆ—è¡¨åï¼Œæˆ‘ä»¬å¯ä»¥é€ä¸ªè¯»å–å®ƒçš„å…ƒç´ ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>è¿­ä»£</strong>ï¼š</p><figure class="highlight pycon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pycon"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">a = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(i)</span><br>0<br>1<br>2<br></code></pre></td></tr></table></figure><p>æ‰€æœ‰å¯ä»¥ç”¨äº <code>for...in...</code> å¾ªç¯çš„å¯¹è±¡ï¼Œéƒ½æ˜¯<strong>å¯è¿­ä»£å¯¹è±¡</strong>ï¼Œæ¯”å¦‚åˆ—è¡¨ã€å­—ç¬¦ä¸²ã€æ–‡ä»¶ç­‰ã€‚è¿™äº›å¯¹è±¡å†…éƒ¨å®ç°äº† <code>__iter__()</code> æ–¹æ³•ã€‚</p><p>ç„¶è€Œï¼Œå¯è¿­ä»£å¯¹è±¡é€šå¸¸ä¼šæŠŠæ‰€æœ‰å…ƒç´ ä¸€æ¬¡æ€§åŠ è½½è¿›å†…å­˜ã€‚å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ</h2><p><strong>ç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰</strong>æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå®ƒä¸ä¼šä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰å…ƒç´ ï¼Œè€Œæ˜¯<strong>åœ¨éœ€è¦æ—¶åŠ¨æ€ç”Ÿæˆå€¼</strong>ã€‚ç”Ÿæˆå™¨æ˜¯â€œæƒ°æ€§â€çš„ï¼Œå ç”¨å†…å­˜æ›´å°‘ã€‚</p><p>å°†åˆ—è¡¨æ¨å¯¼å¼çš„æ–¹æ‹¬å· <code>[]</code> æ¢æˆåœ†æ‹¬å· <code>()</code>ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªç”Ÿæˆå™¨ï¼š</p><figure class="highlight pycon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pycon"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">a = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>)]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(a)</span><br>&lt;class &#x27;list&#x27;&gt;<br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b = (i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>))</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">type</span>(b)</span><br>&lt;class &#x27;generator&#x27;&gt;<br></code></pre></td></tr></table></figure><h2 id="yieldï¼šåˆ›å»ºç”Ÿæˆå™¨çš„å…³é”®å­—"><a href="#yieldï¼šåˆ›å»ºç”Ÿæˆå™¨çš„å…³é”®å­—" class="headerlink" title="yieldï¼šåˆ›å»ºç”Ÿæˆå™¨çš„å…³é”®å­—"></a>yieldï¼šåˆ›å»ºç”Ÿæˆå™¨çš„å…³é”®å­—</h2><p>ä½¿ç”¨ <code>yield</code> å¯ä»¥å°†æ™®é€šå‡½æ•°å˜æˆä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ã€‚æ¯æ¬¡æ‰§è¡Œåˆ° <code>yield</code>ï¼Œå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶<strong>æš‚åœæ‰§è¡Œ</strong>ï¼Œä¿ç•™å½“å‰çŠ¶æ€ã€‚ä¸‹ä¸€æ¬¡è°ƒç”¨ <code>next()</code> æ—¶ï¼Œä¼šä»ä¸Šä¸€æ¬¡æš‚åœçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚</p><p>æ¥çœ‹ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight pycon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs pycon"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_generator</span>():</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    mylist = <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>)</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> mylist:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">        <span class="hljs-keyword">yield</span> i * i</span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">mygenerator = create_generator()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(mygenerator)</span><br>&lt;generator object create_generator at 0x...&gt;<br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> mygenerator:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(i)</span><br>0<br>1<br>4<br></code></pre></td></tr></table></figure><p>ä½ ä¼šå‘ç°ï¼Œè°ƒç”¨å‡½æ•°æ—¶å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œå®ƒï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ã€‚åªæœ‰åœ¨éå†è¯¥ç”Ÿæˆå™¨æˆ–è°ƒç”¨ <code>next()</code> æ—¶ï¼Œå‡½æ•°æ‰ä¼šé€æ­¥è¿è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_function</span>():<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">yield</span> i<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> some_function():<br>    <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure><h2 id="å’Œæ‰‹åŠ¨å®ç°è¿­ä»£å™¨å¯¹æ¯”"><a href="#å’Œæ‰‹åŠ¨å®ç°è¿­ä»£å™¨å¯¹æ¯”" class="headerlink" title="å’Œæ‰‹åŠ¨å®ç°è¿­ä»£å™¨å¯¹æ¯”"></a>å’Œæ‰‹åŠ¨å®ç°è¿­ä»£å™¨å¯¹æ¯”</h2><p>ä¸ä½¿ç”¨ <code>yield</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨å®ç°ä¸€ä¸ªè¿­ä»£å™¨ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyIterator</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.count = -<span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__next__</span>(<span class="hljs-params">self</span>):<br>        self.count += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> self.count &lt; <span class="hljs-number">4</span>:<br>            <span class="hljs-keyword">return</span> self.count<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">raise</span> StopIteration<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">some_func</span>():<br>    <span class="hljs-keyword">return</span> MyIterator()<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> some_func():<br>    <span class="hljs-built_in">print</span>(i)<br><br></code></pre></td></tr></table></figure><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½¿ç”¨ <code>yield</code> å¯ä»¥è®©æˆ‘ä»¬çœå»å†™ <code>__iter__</code> å’Œ <code>__next__</code> æ–¹æ³•çš„éº»çƒ¦ï¼Œå¿«é€Ÿæ„å»ºä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li><code>yield</code> æ˜¯æ„å»ºç”Ÿæˆå™¨çš„å…³é”®å­—ã€‚</li><li>ç”Ÿæˆå™¨é€šè¿‡ <code>yield</code> åŠ¨æ€ç”Ÿæˆå€¼ï¼Œå…·æœ‰æƒ°æ€§ã€èŠ‚çœå†…å­˜çš„ç‰¹ç‚¹ã€‚</li><li>ç›¸æ¯”æ‰‹åŠ¨å®ç°è¿­ä»£å™¨ï¼Œ<code>yield</code> æä¾›äº†ä¸€ç§æ›´ç®€å•ã€ç›´è§‚çš„æ–¹å¼ã€‚</li></ul><p>å½“ä½ æƒ³é€æ­¥ç”Ÿæˆæ•°æ®ï¼Œæˆ–è€…å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ç”Ÿæˆå™¨å’Œ <code>yield</code>ï¼Œå®ƒä»¬ä¼šè®©ä½ çš„ä»£ç æ›´é«˜æ•ˆã€æ›´ä¼˜é›…ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python Monkey Patching</title>
    <link href="/2025/05/31/python-monkey-patch/"/>
    <url>/2025/05/31/python-monkey-patch/</url>
    
    <content type="html"><![CDATA[<p>Python æ˜¯ä¸€ç§å…¸å‹çš„åŠ¨æ€è„šæœ¬è¯­è¨€ï¼Œä¸ä»…æ”¯æŒåŠ¨æ€ç±»å‹ï¼Œå…¶å¯¹è±¡æ¨¡å‹æœ¬èº«ä¹Ÿæ˜¯åŠ¨æ€çš„ã€‚Python ä¸­çš„ç±»æ˜¯å¯å˜çš„ï¼Œæ–¹æ³•ä¸è¿‡æ˜¯ç±»çš„ä¸€ä¸ªå±æ€§ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹å®ƒä»¬çš„è¡Œä¸ºã€‚è¿™ç§æŠ€å·§è¢«ç§°ä¸º <strong>Monkey Patching</strong>ï¼ˆçŒ´å­è¡¥ä¸ï¼‰ï¼Œè¿™ä¸ªåå­—å¯èƒ½æºäº â€œæ¸¸å‡»è¡¥ä¸â€ï¼ˆGuerrilla patchï¼‰ï¼Œæ„æ€æ˜¯â€œå·å·åœ°ä¿®æ”¹ä»£ç â€ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯-Monkey-Patchingï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-Monkey-Patchingï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ Monkey Patchingï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ Monkey Patchingï¼Ÿ</h2><p>ç®€è€Œè¨€ä¹‹ï¼ŒMonkey Patching å°±æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ›¿æ¢å¯¹è±¡çš„å±æ€§ã€‚åœ¨ Python ä¸­ï¼Œè¿™é€šå¸¸è¡¨ç°ä¸ºå¯¹å‡½æ•°ã€ç±»æˆ–æ¨¡å—çš„åŠ¨æ€ä¿®æ”¹ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># monkey.py</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Me</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">who_am_i</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I am a Monkey&quot;</span>)<br></code></pre></td></tr></table></figure><p>å‡è®¾ä½ ä¸å–œæ¬¢è¿™ä¸ªè¾“å‡ºï¼Œå› ä¸ºä½ æ˜¯ä¸ªäººç±»ï¼Œäºæ˜¯ä½ æ‰“ç®—ä½¿ç”¨ Monkey Patch æ”¹å˜å®ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> monkey<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">i_am_human</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I am human&quot;</span>)<br><br><span class="hljs-comment"># æ›¿æ¢ who_am_i æ–¹æ³•</span><br>monkey.Me.who_am_i = i_am_human<br><br>obj = monkey.Me()<br>obj.who_am_i()  <span class="hljs-comment"># è¾“å‡ºï¼šI am human</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå˜æˆäº†â€œæˆ‘æ˜¯äººç±»â€ï¼Œä¿®æ”¹ç”Ÿæ•ˆäº†ï¼Œè¿™å°±æ˜¯ Monkey Patching çš„æ•ˆæœã€‚</p><h2 id="å¯å˜ä¸ä¸å¯å˜ç±»å‹çš„å…³ç³»"><a href="#å¯å˜ä¸ä¸å¯å˜ç±»å‹çš„å…³ç³»" class="headerlink" title="å¯å˜ä¸ä¸å¯å˜ç±»å‹çš„å…³ç³»"></a>å¯å˜ä¸ä¸å¯å˜ç±»å‹çš„å…³ç³»</h2><p>ç†è§£ Monkey Patchingï¼Œéœ€è¦å…ˆææ¸…æ¥š Python ä¸­ <strong>å¯å˜ç±»å‹</strong> ä¸ <strong>ä¸å¯å˜ç±»å‹</strong> çš„åŒºåˆ«ã€‚</p><p>åœ¨ Python ä¸­ï¼Œå˜é‡æ›´åƒæ˜¯â€œæ ‡ç­¾â€è€Œä¸æ˜¯â€œç›’å­â€ï¼Œå®ƒæŒ‡å‘å®é™…çš„å¯¹è±¡ã€‚å¯¹äºè‡ªå®šä¹‰å¯¹è±¡ï¼ˆå³ç±»çš„å®ä¾‹ï¼‰ï¼Œå®ƒä»¬æ˜¯<strong>å¯å˜</strong>çš„ï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä¿®æ”¹å…¶å±æ€§è€Œä¸å¿…æ–°å»ºå¯¹è±¡ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼š</p><ul><li><strong>ä¸å¯å˜ç±»å‹</strong>ï¼š<code>float</code>ã€<code>decimal</code>ã€<code>complex</code>ã€<code>bool</code>ã€<code>str</code>ã€<code>tuple</code>ã€<code>range</code>ã€<code>frozenset</code>ã€<code>bytes</code> ç­‰ã€‚</li><li><strong>å¯å˜ç±»å‹</strong>ï¼š<code>list</code>ã€<code>dict</code>ã€<code>set</code>ã€<code>bytearray</code>ã€è‡ªå®šä¹‰ç±»ç­‰ã€‚</li></ul><p>Monkey Patching æ­£æ˜¯åˆ©ç”¨äº†è¿™ç§å¯å˜æ€§ã€‚</p><p>å‰é¢çš„ä¾‹å­æ˜¯ä¿®è¡¥äº†ä¸€ä¸ªç±»çš„æ–¹æ³•ï¼Œå› æ­¤è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹éƒ½ä¼šå—åˆ°å½±å“ã€‚ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥<strong>åªä¿®è¡¥æŸä¸ªç‰¹å®šå®ä¾‹</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> types<br><span class="hljs-keyword">import</span> monkey<br><br>monkey1 = monkey.Me()<br>monkey2 = monkey.Me()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">i_am_human</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;I am human&quot;</span>)<br><br>monkey2.who_am_i = types.MethodType(i_am_human, monkey2)<br><br>monkey1.who_am_i()  <span class="hljs-comment"># è¾“å‡ºï¼šI am a Monkey</span><br>monkey2.who_am_i()  <span class="hljs-comment"># è¾“å‡ºï¼šI am human</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡ <code>types.MethodType</code>ï¼Œæˆ‘ä»¬ä»…æ”¹å˜äº† <code>monkey2</code> çš„æ–¹æ³•å®ç°ã€‚</p><h2 id="ä¿®è¡¥æ¨¡å—"><a href="#ä¿®è¡¥æ¨¡å—" class="headerlink" title="ä¿®è¡¥æ¨¡å—"></a>ä¿®è¡¥æ¨¡å—</h2><p>Monkey Patching ä¸ä»…é™äºç±»æˆ–å®ä¾‹ï¼Œä¹Ÿå¯ä»¥åº”ç”¨åˆ°æ¨¡å—çº§åˆ«ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># whoami.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">who_am_i</span>(<span class="hljs-params">monkey_type</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;I am a <span class="hljs-subst">&#123;monkey_type&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># human.py</span><br><span class="hljs-keyword">import</span> whoami<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">who_am_i</span>():<br>    whoami.who_am_i(<span class="hljs-string">&quot;Human&quot;</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># monkey.py</span><br><span class="hljs-keyword">import</span> whoami<br><span class="hljs-keyword">import</span> human<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">i_am_monkey</span>(<span class="hljs-params">monkey_type</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;I am a <span class="hljs-subst">&#123;monkey_type&#125;</span>&quot;</span>)<br><br>whoami.who_am_i = i_am_monkey  <span class="hljs-comment"># ä¿®è¡¥æ¨¡å—å‡½æ•°</span><br><br>human.who_am_i()  <span class="hljs-comment"># è¾“å‡ºï¼šI am a Monkey</span><br></code></pre></td></tr></table></figure><p>çŒ´å­é€šè¿‡çŒ´å­è¡¥ä¸â€œæ”»å‡»â€äº†äººç±»æ¨¡å—ã€‚</p><h2 id="è­¦å‘Š-âš ï¸"><a href="#è­¦å‘Š-âš ï¸" class="headerlink" title="è­¦å‘Š âš ï¸"></a>è­¦å‘Š âš ï¸</h2><p>Monkey Patching è™½ç„¶å¼ºå¤§ï¼Œä½†ä¹Ÿæœ‰é£é™©ã€‚</p><p>å®ƒé€šå¸¸ç”¨äºå¤„ç†é—ç•™ç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹åº“ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨<strong>ä¸ç›´æ¥ä¿®æ”¹æºç </strong>çš„å‰æä¸‹æ”¹å˜è¡Œä¸ºï¼Œä»è€Œé€‚é…æŸäº›ç¯å¢ƒæˆ–ä¿®å¤ bugã€‚ä½†è¿™ç§ä¿®æ”¹æ–¹å¼ä¼šè®©ä»£ç çš„è¡Œä¸ºå˜å¾—éš¾ä»¥è¿½è¸ªï¼Œå®¹æ˜“é€ æˆæ··æ·†å’Œç»´æŠ¤å›°éš¾ã€‚</p><p>æ¯”å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè°æ˜¯çŒ´å­è°æ˜¯äººç±»å°±ä¸é‚£ä¹ˆå®¹æ˜“åˆ†è¾¨äº†ã€‚</p><p>å› æ­¤ï¼Œ<strong>åœ¨å¯è¡Œçš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆé€‰æ‹©æ‰©å±•åº“çš„å…¬å…±æ¥å£</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰“è¡¥ä¸ã€‚</p><h2 id="æµ‹è¯•ä¸­çš„åº”ç”¨"><a href="#æµ‹è¯•ä¸­çš„åº”ç”¨" class="headerlink" title="æµ‹è¯•ä¸­çš„åº”ç”¨"></a>æµ‹è¯•ä¸­çš„åº”ç”¨</h2><p>åœ¨æµ‹è¯•ä¸­ï¼ŒMonkey Patching æ˜¯éå¸¸å®ç”¨çš„ã€‚å®ƒå¯ä»¥ä¸´æ—¶æ›¿æ¢ä¾èµ–é¡¹ï¼Œæ¯”å¦‚æ¨¡æ‹Ÿä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼ï¼Œç”¨äºéªŒè¯ç³»ç»Ÿè¡Œä¸ºï¼Œè€Œæ— éœ€å®é™…è°ƒç”¨å¤–éƒ¨æœåŠ¡ã€‚</p><h2 id="æ¨èåº“ï¼šGorilla-ğŸ¦"><a href="#æ¨èåº“ï¼šGorilla-ğŸ¦" class="headerlink" title="æ¨èåº“ï¼šGorilla ğŸ¦"></a>æ¨èåº“ï¼šGorilla ğŸ¦</h2><p>æˆ‘æ¨èä½¿ç”¨ <a href="https://gorilla.readthedocs.io/en/latest/">Gorilla</a>ï¼Œå®ƒè®© Monkey Patching å˜å¾—æ›´ä¼˜é›…ã€æ¨¡å—åŒ–ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å¯¹å¤§é‡ç±»æˆ–æ–¹æ³•æ‰“è¡¥ä¸çš„åœºæ™¯ä¸­ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gorilla<br><span class="hljs-keyword">import</span> destination<br><br><span class="hljs-meta">@gorilla.patches(<span class="hljs-params">destination.Class</span>)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">method</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Hello&quot;</span>)<br>    <br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">class_method</span>(<span class="hljs-params">cls</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;world!&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç åªæ˜¯å®šä¹‰äº†è¡¥ä¸ï¼Œå°šæœªåº”ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>gorilla.find_patches</code> æ‰«æå¹¶æ‰¹é‡åº”ç”¨è¡¥ä¸ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gorilla<br><span class="hljs-keyword">import</span> mypackage<br><br>patches = gorilla.find_patches([mypackage])<br><span class="hljs-keyword">for</span> patch <span class="hljs-keyword">in</span> patches:<br>    gorilla.apply(patch)<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¸ä»…ç›´è§‚ã€å¹²å‡€ï¼Œè¿˜å¤§å¤§æå‡äº†å¯ç»´æŠ¤æ€§ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Monkey Patching æ˜¯ Python æä¾›çš„ä¸€ç§å¼ºå¤§ä½†å±é™©çš„èƒ½åŠ›ã€‚åˆç†ä½¿ç”¨å®ƒï¼Œå¯ä»¥æå‡çµæ´»æ€§å’Œé€‚é…èƒ½åŠ›ï¼Œå°¤å…¶é€‚ç”¨äºï¼š</p><ul><li>é—ç•™ä»£ç çš„å…¼å®¹æ€§è°ƒæ•´</li><li>å•å…ƒæµ‹è¯•ä¸­çš„æ–¹æ³•æ¨¡æ‹Ÿ</li><li>ç¬¬ä¸‰æ–¹åº“çš„ä¸´æ—¶ä¿®å¤</li></ul><p>ä½†è¯·å§‹ç»ˆä¿æŒè°¨æ…ï¼Œç¡®ä¿è¡¥ä¸è¡Œä¸ºæ˜ç¡®ã€æ–‡æ¡£æ¸…æ™°ï¼Œå¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹è€ƒè™‘æ›´å®‰å…¨çš„æ›¿ä»£æ–¹å¼ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pythonå…ƒç±»</title>
    <link href="/2025/05/29/python%E5%85%83%E7%B1%BB/"/>
    <url>/2025/05/29/python%E5%85%83%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<p>åœ¨ Python ä¸­ï¼Œä¸€åˆ‡çš†å¯¹è±¡ï¼Œç±»ä¹Ÿä¸ä¾‹å¤–ã€‚æˆ‘ä»¬é€šå¸¸è®¤ä¸ºç±»æ˜¯ç”¨æ¥åˆ›å»ºå®ä¾‹çš„â€œæ¨¡ç‰ˆâ€ï¼Œä½†å®é™…ä¸Šï¼Œ<strong>ç±»æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç±»æ˜¯ç”±æŸç§æœºåˆ¶åŠ¨æ€ç”Ÿæˆçš„ï¼Œè¿™ä¸ªæœºåˆ¶å°±æ˜¯ <strong>å…ƒç±»ï¼ˆmetaclassï¼‰</strong>ã€‚</p><h2 id="ä¸€ã€ç±»ä¹Ÿæ˜¯å¯¹è±¡"><a href="#ä¸€ã€ç±»ä¹Ÿæ˜¯å¯¹è±¡" class="headerlink" title="ä¸€ã€ç±»ä¹Ÿæ˜¯å¯¹è±¡"></a>ä¸€ã€ç±»ä¹Ÿæ˜¯å¯¹è±¡</h2><p>å½“ä½ ä½¿ç”¨ <code>class</code> å…³é”®å­—å®šä¹‰ä¸€ä¸ªç±»æ—¶ï¼ŒPython ä¼šæ ¹æ®è¿™ä¸ªç±»çš„æè¿°ä¿¡æ¯ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æœ¬èº«å°±æ˜¯ä¸€ä¸ªâ€œç±»â€ï¼Œä½†å®ƒä¹Ÿæ˜¯æŸä¸ªå…ƒç±»çš„å®ä¾‹ï¼š</p><figure class="highlight pycon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pycon"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectCreator</span>(<span class="hljs-title class_ inherited__">object</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">pass</span></span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">JustAnotherVariable = ObjectCreator</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">ObjectCreator.class_attribute = <span class="hljs-string">&#x27;foo&#x27;</span></span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(ObjectCreator)</span><br>&lt;class &#x27;__main__.ObjectCreator&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(JustAnotherVariable)</span><br>&lt;class &#x27;__main__.ObjectCreator&#x27;&gt;<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œç±» <code>ObjectCreator</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥èµ‹å€¼ç»™å˜é‡ã€æ·»åŠ å±æ€§ç­‰ï¼Œå°±åƒå…¶ä»–å¯¹è±¡ä¸€æ ·ã€‚</p><h2 id="äºŒã€è°åˆ›å»ºäº†ç±»ï¼Ÿ"><a href="#äºŒã€è°åˆ›å»ºäº†ç±»ï¼Ÿ" class="headerlink" title="äºŒã€è°åˆ›å»ºäº†ç±»ï¼Ÿ"></a>äºŒã€è°åˆ›å»ºäº†ç±»ï¼Ÿ</h2><p>æ—¢ç„¶ç±»æœ¬èº«æ˜¯å¯¹è±¡ï¼Œé‚£å®ƒä¹Ÿå¿…é¡»æ˜¯ç”±æŸç§â€œç±»â€åˆ›å»ºçš„ã€‚Python é»˜è®¤ä½¿ç”¨ <a href="https://docs.python.org/3.13/library/functions.html#type">type</a> è¿™ä¸ªå†…å»ºå…ƒç±»æ¥åˆ›å»ºæ‰€æœ‰ç±»ï¼š</p><figure class="highlight pycon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pycon"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-number">1</span>))               <span class="hljs-comment"># &lt;class &#x27;int&#x27;&gt;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(<span class="hljs-string">&quot;1&quot;</span>))             <span class="hljs-comment"># &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(ObjectCreator))   <span class="hljs-comment"># &lt;class &#x27;type&#x27;&gt;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(ObjectCreator())) <span class="hljs-comment"># &lt;class &#x27;__main__.ObjectCreator&#x27;&gt;</span></span><br></code></pre></td></tr></table></figure><p>è¿™è¯´æ˜ï¼š<code>ObjectCreator</code> æ˜¯ç”± <code>type</code> åˆ›å»ºçš„å¯¹è±¡ï¼ˆç±»ï¼‰ï¼Œè€Œ <code>ObjectCreator()</code> æ˜¯è¯¥ç±»åˆ›å»ºçš„å®ä¾‹å¯¹è±¡ã€‚</p><h2 id="ä¸‰ã€ä½¿ç”¨-type-åŠ¨æ€åˆ›å»ºç±»"><a href="#ä¸‰ã€ä½¿ç”¨-type-åŠ¨æ€åˆ›å»ºç±»" class="headerlink" title="ä¸‰ã€ä½¿ç”¨ type åŠ¨æ€åˆ›å»ºç±»"></a>ä¸‰ã€ä½¿ç”¨ <code>type</code> åŠ¨æ€åˆ›å»ºç±»</h2><p><code>type</code> ä¸åªæ˜¯ä¸€ä¸ªç”¨äºæ£€æŸ¥å¯¹è±¡ç±»å‹çš„å‡½æ•°ï¼Œå®ƒè¿˜å¯ä»¥åŠ¨æ€åœ°åˆ›å»ºç±»ã€‚å…¶ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">type</span>(name, bases, attrs)<br><span class="hljs-comment"># name: ç±»å</span><br><span class="hljs-comment"># bases: çˆ¶ç±»çš„å…ƒç»„</span><br><span class="hljs-comment"># attrs: ç±»å±æ€§çš„å­—å…¸</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight pycon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pycon"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">Foo = <span class="hljs-built_in">type</span>(<span class="hljs-string">&#x27;Foo&#x27;</span>, (), &#123;&#125;)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(Foo)</span><br>&lt;class &#x27;__main__.Foo&#x27;&gt;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(Foo())</span><br>&lt;__main__.Foo object at 0x...&gt;<br></code></pre></td></tr></table></figure><p>ä½ è¿˜å¯ä»¥åœ¨åˆ›å»ºç±»æ—¶ç›´æ¥æ·»åŠ æ–¹æ³•ï¼š</p><figure class="highlight pycon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pycon"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">echo_bar</span>(<span class="hljs-params">self</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(self.bar)</span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">FooChild = <span class="hljs-built_in">type</span>(<span class="hljs-string">&#x27;FooChild&#x27;</span>, (Foo,), &#123;<span class="hljs-string">&#x27;echo_bar&#x27;</span>: echo_bar&#125;)</span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">my_foo = FooChild()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">my_foo.bar = <span class="hljs-string">&quot;hello&quot;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">my_foo.echo_bar()</span><br>hello<br></code></pre></td></tr></table></figure><p>å¹¶ä¸”ä½ å¯ä»¥åƒæ™®é€šç±»ä¸€æ ·ï¼ŒåŠ¨æ€æ·»åŠ æ›´å¤šæ–¹æ³•ï¼š</p><figure class="highlight pycon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pycon"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">echo_bar_more</span>(<span class="hljs-params">self</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;yet another method&#x27;</span>)</span><br><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">FooChild.echo_bar_more = echo_bar_more</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">my_foo.echo_bar_more()</span><br>yet another method<br></code></pre></td></tr></table></figure><h2 id="å››ã€ä»€ä¹ˆæ˜¯å…ƒç±»ï¼ˆMetaclassï¼‰ï¼Ÿ"><a href="#å››ã€ä»€ä¹ˆæ˜¯å…ƒç±»ï¼ˆMetaclassï¼‰ï¼Ÿ" class="headerlink" title="å››ã€ä»€ä¹ˆæ˜¯å…ƒç±»ï¼ˆMetaclassï¼‰ï¼Ÿ"></a>å››ã€ä»€ä¹ˆæ˜¯å…ƒç±»ï¼ˆMetaclassï¼‰ï¼Ÿ</h2><blockquote><p>ç®€å•æ¥è¯´ï¼Œ<strong>å…ƒç±»æ˜¯â€œç”¨äºåˆ›å»ºç±»çš„ç±»â€</strong>ã€‚</p></blockquote><p>ç±»æ˜¯å®ä¾‹çš„å·¥å‚ï¼Œè€Œå…ƒç±»å°±æ˜¯ç±»çš„å·¥å‚ã€‚Python ä½¿ç”¨ <code>type</code> ä½œä¸ºé»˜è®¤çš„å…ƒç±»ï¼Œä½†ä½ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è‡ªå·±çš„å…ƒç±»æ¥æ§åˆ¶ç±»çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p><p>å½“ä½ å®šä¹‰ä¸€ä¸ªç±»æ—¶ï¼Œå¦‚æœæŒ‡å®šäº† <code>metaclass=XXX</code>ï¼ŒPython ä¼šä½¿ç”¨ä½ æä¾›çš„å…ƒç±»å»åˆ›å»ºè¿™ä¸ªç±»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MetaClass</span>(<span class="hljs-title class_ inherited__">type</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">cls, name, bases, attrs</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;class name: <span class="hljs-subst">&#123;name&#125;</span>&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Defining class <span class="hljs-subst">&#123;cls&#125;</span>&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Bases: <span class="hljs-subst">&#123;bases&#125;</span>&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Attributes:&#x27;</span>)<br>        <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">in</span> attrs.items():<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;key&#125;</span>: <span class="hljs-subst">&#123;value&#125;</span>&#x27;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span>(<span class="hljs-built_in">object</span>, metaclass=MetaClass):<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-keyword">class</span> name: Foo<br>Defining <span class="hljs-keyword">class</span> &lt;<span class="hljs-keyword">class</span> <span class="hljs-comment">&#x27;__main__.Foo&#x27;&gt;</span><br><span class="hljs-symbol">Bases:</span> (&lt;<span class="hljs-keyword">class</span> <span class="hljs-comment">&#x27;object&#x27;&gt;,)</span><br><span class="hljs-symbol">Attributes:</span><br><span class="hljs-symbol">__module__:</span> <span class="hljs-comment">&#x27;__main__&#x27;</span><br><span class="hljs-symbol">__qualname__:</span> <span class="hljs-comment">&#x27;Foo&#x27;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¿™é‡Œçš„ <code>MetaClass.__init__</code> ä¼šåœ¨ç±»å®šä¹‰æ—¶æ‰§è¡Œï¼Œè€Œä¸æ˜¯ç±»å®ä¾‹åŒ–æ—¶ã€‚</p><h2 id="äº”ã€å…ƒç±»çš„å…¸å‹åº”ç”¨åœºæ™¯"><a href="#äº”ã€å…ƒç±»çš„å…¸å‹åº”ç”¨åœºæ™¯" class="headerlink" title="äº”ã€å…ƒç±»çš„å…¸å‹åº”ç”¨åœºæ™¯"></a>äº”ã€å…ƒç±»çš„å…¸å‹åº”ç”¨åœºæ™¯</h2><p>å…ƒç±»å¸¸ç”¨äºæ„å»ºæ¡†æ¶æˆ–åº“ä¸­ï¼Œä¾‹å¦‚ï¼š</p><ul><li>è‡ªåŠ¨æ³¨å†Œç±»</li><li>ä¸ºæ‰€æœ‰ç±»æ·»åŠ ç»Ÿä¸€æ–¹æ³•æˆ–å±æ€§</li><li>æ§åˆ¶å±æ€§çš„è®¿é—®æˆ–ä¿®æ”¹</li><li>å®ç°ORMå­—æ®µä¸æ•°æ®åº“å­—æ®µçš„æ˜ å°„é€»è¾‘</li></ul><h2 id="å…­ã€ç¤ºä¾‹"><a href="#å…­ã€ç¤ºä¾‹" class="headerlink" title="å…­ã€ç¤ºä¾‹"></a>å…­ã€ç¤ºä¾‹</h2><p>1.è¦æ±‚ä¸€ä¸ªç±»çš„æ‰€æœ‰å±æ€§éƒ½å˜æˆå¤§å†™ã€‚å…ˆç”¨ä¸€ä¸ªå‡½æ•°æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼ˆmetaclassçš„è¾“å…¥å¯ä»¥æ˜¯å‡½æ•°ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">upper_attr</span>(<span class="hljs-params">future_class_name, future_class_parents, future_class_attrs</span>):<br>    uppercase_attrs = &#123;<br>        attr <span class="hljs-keyword">if</span> attr.startswith(<span class="hljs-string">&quot;__&quot;</span>) <span class="hljs-keyword">else</span> attr.upper(): v<br>        <span class="hljs-keyword">for</span> attr, v <span class="hljs-keyword">in</span> future_class_attrs.items()<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">type</span>(future_class_name, future_class_parents, uppercase_attrs)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassC</span>(metaclass=upper_attr):<br>    attrib = <span class="hljs-string">&#x27;some value&#x27;</span><br><br>c1 = ClassC()<br><span class="hljs-comment"># False</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hasattr</span>(c1, <span class="hljs-string">&#x27;attrib&#x27;</span>))<br><span class="hljs-comment"># True</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hasattr</span>(c1, <span class="hljs-string">&#x27;ATTRIB&#x27;</span>))<br><span class="hljs-comment"># </span><br><span class="hljs-built_in">print</span>(c1.ATTRIB)<br></code></pre></td></tr></table></figure><p>2.æ§åˆ¶æˆå‘˜è®¿é—®<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´ç¤ºä¾‹ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ªå…ƒç±»ï¼Œç”¨æ¥æ§åˆ¶å¯¹ç±»å±æ€§çš„è®¿é—®ï¼Œç¦æ­¢å¯¹â€œç§æœ‰å±æ€§â€çš„å†™å…¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MetaMemberControl</span>(<span class="hljs-title class_ inherited__">type</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">mcs, name, bases, attrs</span>):<br>        original_getattr = attrs.get(<span class="hljs-string">&#x27;__getattribute__&#x27;</span>)<br>        original_setattr = attrs.get(<span class="hljs-string">&#x27;__setattr__&#x27;</span>)<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_getattr</span>(<span class="hljs-params">self, item</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> item.startswith(<span class="hljs-string">&#x27;_&#x27;</span>):<br>                alias_name = <span class="hljs-string">&#x27;_&#x27;</span> + item<br>                <span class="hljs-keyword">if</span> alias_name <span class="hljs-keyword">in</span> attrs.get(<span class="hljs-string">&#x27;__slots__&#x27;</span>, ()):<br>                    item = alias_name<br>            <span class="hljs-keyword">if</span> original_getattr:<br>                <span class="hljs-keyword">return</span> original_getattr(self, item)<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>(<span class="hljs-built_in">eval</span>(name), self).__getattribute__(item)<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_setattr</span>(<span class="hljs-params">self, key, value</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> key.startswith(<span class="hljs-string">&#x27;_&#x27;</span>) <span class="hljs-keyword">and</span> (<span class="hljs-string">&#x27;_&#x27;</span> + key) <span class="hljs-keyword">in</span> attrs.get(<span class="hljs-string">&#x27;__slots__&#x27;</span>, ()):<br>                <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">f&quot;you can&#x27;t modify private member: _<span class="hljs-subst">&#123;key&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">if</span> original_setattr:<br>                <span class="hljs-keyword">return</span> original_setattr(self, key, value)<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>(<span class="hljs-built_in">eval</span>(name), self).__setattr__(key, value)<br><br>        attrs[<span class="hljs-string">&#x27;__getattribute__&#x27;</span>] = init_getattr<br>        attrs[<span class="hljs-string">&#x27;__setattr__&#x27;</span>] = init_setattr<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__new__(mcs, name, bases, attrs)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Human</span>(metaclass=MetaMemberControl):<br>    __slots__ = (<span class="hljs-string">&#x27;_age&#x27;</span>, <span class="hljs-string">&#x27;_name&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self._name = name<br>        self._age = age<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_demo</span>():<br>    h = Human(<span class="hljs-string">&#x27;Alice&#x27;</span>, <span class="hljs-number">30</span>)<br>    <span class="hljs-built_in">print</span>(h.age)     <span class="hljs-comment"># å¯ä»¥è®¿é—®ï¼ˆå®é™…ä¸Šè®¿é—®çš„æ˜¯ _ageï¼‰</span><br>    <span class="hljs-built_in">print</span>(h._age)    <span class="hljs-comment"># ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®ï¼ˆPythonä¸é™åˆ¶ï¼‰</span><br>    h.age = <span class="hljs-number">20</span>       <span class="hljs-comment"># æŠ›å‡º AttributeError</span><br></code></pre></td></tr></table></figure><p>å…ƒç±»å¸®æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆäº†ç®€åŒ–çš„è®¿é—®é€»è¾‘ï¼Œæ— éœ€æ‰‹å†™ <code>@property</code>ã€‚</p><h2 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h2><p>å…ƒç±»æ˜¯ Python ä¸­æå…¶å¼ºå¤§çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå¯¹ç±»çš„åˆ›å»ºè¿‡ç¨‹è¿›è¡Œæ§åˆ¶ï¼Œæ˜¯å®ç°é«˜çº§æŠ½è±¡ä¸æ¡†æ¶åŠŸèƒ½çš„æ ¸å¿ƒå·¥å…·ä¹‹ä¸€ã€‚å…¶ä»–å¯ç”¨äºç±»å˜æ›´çš„æ–¹æ³•æ›´ç›´æ¥ï¼Œåº”è¯¥ä¼˜å…ˆè€ƒè™‘ï¼Œæ¯”å¦‚monkeyè¡¥ä¸å’Œç±»è£…é¥°å™¨ã€‚</p><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¯èƒ½å¾ˆå°‘ç›´æ¥ä½¿ç”¨å…ƒç±»ï¼Œä½†ç†è§£å®ƒçš„å·¥ä½œåŸç†å°†æœ‰åŠ©äºæˆ‘ä»¬æ›´æ·±å…¥åœ°æŒæ¡Pythonçš„å¯¹è±¡æ¨¡å‹ï¼Œå°¤å…¶æ˜¯åœ¨é˜…è¯»é«˜çº§æ¡†æ¶å¦‚Djangoã€SQLAlchemyæˆ–Pydanticæ—¶ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¥½å¥‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¦‚ä½•å»ä½¿ç”¨pythonçš„typing.Annotated</title>
    <link href="/2025/05/28/%E5%A6%82%E4%BD%95%E5%8E%BB%E4%BD%BF%E7%94%A8python%E7%9A%84typing-Annotated/"/>
    <url>/2025/05/28/%E5%A6%82%E4%BD%95%E5%8E%BB%E4%BD%BF%E7%94%A8python%E7%9A%84typing-Annotated/</url>
    
    <content type="html"><![CDATA[<p>åœ¨æœ€è¿‘çš„å¼€å‘ä¸­ï¼Œæˆ‘è¶Šæ¥è¶Šå¤šåœ°ä½¿ç”¨ <a href="https://docs.pydantic.dev/">Pydantic</a> æ¥è¿›è¡Œå­—æ®µæ ¡éªŒã€‚è€Œåœ¨ä½¿ç”¨ Pydantic çš„è¿‡ç¨‹ä¸­ï¼Œç±»å‹æ³¨è§£ï¼ˆtype hintï¼‰å‡ ä¹æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å…¶ä¸­ä¸€ä¸ªç»å¸¸å‡ºç°çš„ç±»å‹å·¥å…·å°±æ˜¯ <code>typing.Annotated</code>ã€‚</p><p>èµ·åˆï¼Œæˆ‘åœ¨é˜…è¯» <a href="https://docs.python.org/3/library/typing.html#typing.Annotated">å®˜æ–¹æ–‡æ¡£</a> æ—¶å¯¹å®ƒçš„ç”¨é€”æ„Ÿåˆ°å›°æƒ‘ï¼Œçœ‹äº†åŠå¤©ä¹Ÿæ²¡ææ‡‚å®ƒåˆ°åº•æ˜¯åšä»€ä¹ˆç”¨çš„ã€‚åæ¥åœ¨ç½‘ä¸ŠæŸ¥é˜…äº†ä¸€äº›èµ„æ–™ï¼Œç»ˆäºç†è§£äº†å®ƒçš„åŸºæœ¬ç”¨é€”å’ŒèƒŒåçš„è®¾è®¡ç†å¿µã€‚äºæ˜¯ï¼Œæˆ‘å†³å®šå°†è‡ªå·±çš„ç†è§£æ€»ç»“ä¸‹æ¥ï¼Œè®°å½•åœ¨è¿™ç¯‡åšå®¢ä¸­ï¼Œæ–¹ä¾¿è‡ªå·±å›é¡¾ï¼Œä¹Ÿå¸Œæœ›èƒ½å¸®åˆ°åŒæ ·ç–‘æƒ‘çš„ä½ ã€‚</p><h2 id="Annotated-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Annotated-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Annotated æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Annotated æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>åœ¨ Python ä¸­ï¼Œ<code>Annotated</code> å…è®¸å¼€å‘è€…ä¸ºç±»å‹å£°æ˜é™„åŠ å…ƒæ•°æ®ã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Annotated[T, x] çš„å«ä¹‰æ˜¯ï¼šè¿™ä¸ªå˜é‡æ˜¯ç±»å‹ Tï¼ŒåŒæ—¶é™„å¸¦äº†å…ƒæ•°æ® xã€‚</span><br>var_name: Annotated[T, x]<br></code></pre></td></tr></table></figure><p>æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Annotated, TypedDict, get_type_hints<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):<br>    <span class="hljs-comment"># è¡¨ç¤º name æ˜¯ str ç±»å‹ï¼Œä¸” name[0] åº”è¯¥æ˜¯å¤§å†™å­—æ¯</span><br>    name: Annotated[<span class="hljs-built_in">str</span>, <span class="hljs-string">&quot;first letter is capital&quot;</span>]<br><br>get_type_hints(A)<br><span class="hljs-comment"># è¾“å‡º: &#123;&#x27;name&#x27;: &lt;class &#x27;str&#x27;&gt;&#125;</span><br><br>get_type_hints(A, include_extras=<span class="hljs-literal">True</span>)<br><span class="hljs-comment"># è¾“å‡º: &#123;&#x27;name&#x27;: typing.Annotated[str, &#x27;first letter is capital&#x27;]&#125;</span><br><br>get_type_hints(A, include_extras=<span class="hljs-literal">True</span>)[<span class="hljs-string">&#x27;name&#x27;</span>].__metadata__[<span class="hljs-number">0</span>]<br><span class="hljs-comment"># è¾“å‡º: &#x27;first letter is capital&#x27;</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Annotated</code> æœ¬èº«å¹¶ä¸ä¼šå½±å“ç±»å‹æœ¬èº«çš„è¡Œä¸ºï¼Œå®ƒçš„ä½œç”¨åªæ˜¯é™„åŠ ä¸€äº›å…ƒæ•°æ®ã€‚è¿™äº›å…ƒæ•°æ®å¯ä»¥é€šè¿‡ <code>.__metadata__</code> å±æ€§åœ¨è¿è¡Œæ—¶è·å–ã€‚ä½†è¦çœŸæ­£â€œç”¨èµ·æ¥â€ï¼Œè¿˜éœ€è¦å…¶ä»–å·¥å…·æˆ–æ¡†æ¶æ¥è§£æè¿™äº›å…ƒæ•°æ®å¹¶æ®æ­¤æ‰§è¡ŒæŸäº›é€»è¾‘ã€‚</p><h2 id="Annotated-åœ¨-Pydantic-å’Œ-FastAPI-ä¸­çš„åº”ç”¨"><a href="#Annotated-åœ¨-Pydantic-å’Œ-FastAPI-ä¸­çš„åº”ç”¨" class="headerlink" title="Annotated åœ¨ Pydantic å’Œ FastAPI ä¸­çš„åº”ç”¨"></a>Annotated åœ¨ Pydantic å’Œ FastAPI ä¸­çš„åº”ç”¨</h2><p>åœ¨ä½¿ç”¨ Pydantic çš„æ¡†æ¶ä¸­ï¼Œ<code>Annotated</code> è¢«å¹¿æ³›ç”¨äºè¡¨è¾¾æ ¡éªŒè§„åˆ™ã€‚ä¾‹å¦‚åœ¨ FastAPI ä¸­ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥ä¼ é€’é¢å¤–çš„æ ¡éªŒä¿¡æ¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Annotated<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Header, Query<br><br><span class="hljs-comment"># å‚æ•° q æ˜¯ str ç±»å‹ï¼Œæœ€å¤§é•¿åº¦ä¸º 50ã€‚</span><br><span class="hljs-comment"># è¿™ä¸ªä¿¡æ¯é€šè¿‡ Annotated ä¼ é€’ç»™ FastAPIï¼Œç”¨äºå‚æ•°æ ¡éªŒã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_items</span>(<span class="hljs-params">q: Annotated[<span class="hljs-built_in">str</span>, Query(<span class="hljs-params">max_length=<span class="hljs-number">50</span></span>)]</span>):<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-comment"># ç”¨äºä¾èµ–æ³¨å…¥çš„æƒ…å†µä¹Ÿç±»ä¼¼ï¼š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">UserIdHeader</span>(<span class="hljs-params">alias: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>, **kwargs</span>):<br>    <span class="hljs-keyword">if</span> alias <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        alias = <span class="hljs-string">&quot;X-Forwarded-User&quot;</span><br>    <span class="hljs-keyword">return</span> Header(alias=alias, **kwargs)<br><br>UserIdHeaderDep = Annotated[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>, UserIdHeader()]<br></code></pre></td></tr></table></figure><h2 id="åœ¨-Pydantic-æ¨¡å‹ä¸­å®šä¹‰æ ¡éªŒè§„åˆ™"><a href="#åœ¨-Pydantic-æ¨¡å‹ä¸­å®šä¹‰æ ¡éªŒè§„åˆ™" class="headerlink" title="åœ¨ Pydantic æ¨¡å‹ä¸­å®šä¹‰æ ¡éªŒè§„åˆ™"></a>åœ¨ Pydantic æ¨¡å‹ä¸­å®šä¹‰æ ¡éªŒè§„åˆ™</h2><p>ä½ è¿˜å¯ä»¥åœ¨ Pydantic æ¨¡å‹ä¸­ä½¿ç”¨ Annotated æ¥å®šä¹‰å­—æ®µçš„æ ¡éªŒè§„åˆ™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Annotated<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field, field_validator<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    x: <span class="hljs-built_in">int</span><br><br><span class="hljs-meta">    @field_validator(<span class="hljs-params"><span class="hljs-string">&quot;x&quot;</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">between_2_and_20</span>(<span class="hljs-params">cls, v: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-number">2</span> &lt; v &lt; <span class="hljs-number">20</span>:<br>            <span class="hljs-keyword">return</span> v<br>        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;v&#125;</span> is not between 2 and 20.&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Model2</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    <span class="hljs-comment"># Annotated æä¾›çš„å…ƒæ•°æ® Field å¯ä»¥ç›´æ¥ç”¨äºå­—æ®µéªŒè¯</span><br>    x: Annotated[<span class="hljs-built_in">int</span>, Field(lt=<span class="hljs-number">20</span>, gt=<span class="hljs-number">2</span>)]       <br></code></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸º Pydantic å†…éƒ¨èƒ½å¤Ÿè§£æ <code>Annotated</code> ä¸­çš„ <code>Field</code> å¹¶æ®æ­¤è‡ªåŠ¨ç”ŸæˆéªŒè¯å™¨ï¼Œç®€åŒ–äº†æ‰‹åŠ¨å®šä¹‰æ ¡éªŒé€»è¾‘çš„è¿‡ç¨‹ã€‚</p><h2 id="æ›´é«˜çº§çš„ç”¨æ³•ï¼šå‡½æ•°ä½œä¸ºå…ƒæ•°æ®"><a href="#æ›´é«˜çº§çš„ç”¨æ³•ï¼šå‡½æ•°ä½œä¸ºå…ƒæ•°æ®" class="headerlink" title="æ›´é«˜çº§çš„ç”¨æ³•ï¼šå‡½æ•°ä½œä¸ºå…ƒæ•°æ®"></a>æ›´é«˜çº§çš„ç”¨æ³•ï¼šå‡½æ•°ä½œä¸ºå…ƒæ•°æ®</h2><p><code>Annotated</code> ä¸ä»…å¯ä»¥æ·»åŠ é™æ€ä¿¡æ¯ï¼Œç”šè‡³å¯ä»¥é™„åŠ å‡½æ•°ã€‚æ¯”å¦‚åœ¨ <a href="https://github.com/langchain-ai/langgraph"><code>langgraph</code></a> åº“ä¸­å°±ä½¿ç”¨è¿™ç§æ–¹å¼æ¥å®ç°åŠ¨æ€è¡Œä¸ºã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> Annotated, TypedDict, <span class="hljs-type">Callable</span>, get_type_hints<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reducer</span>(<span class="hljs-params">a: <span class="hljs-built_in">list</span>, b: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">list</span>:<br>    <span class="hljs-keyword">return</span> a + [b]<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):<br>    x: Annotated[<span class="hljs-built_in">list</span>, reducer]<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Graph</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, schema: <span class="hljs-built_in">type</span></span>):<br>        self.metadata = &#123;<br>            name: typ.__metadata__[<span class="hljs-number">0</span>] <br>            <span class="hljs-keyword">for</span> name, typ <span class="hljs-keyword">in</span> get_type_hints(schema, include_extras=<span class="hljs-literal">True</span>).items()<br>        &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_node</span>(<span class="hljs-params">self, func: <span class="hljs-type">Callable</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        self.func = func<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">invoke</span>(<span class="hljs-params">self, input_: <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">float</span>]</span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">list</span>[<span class="hljs-built_in">float</span>]]:<br>        output = &#123;k: [v] <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> input_.items()&#125;<br>        <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> output.items():<br>            processed = self.func(output)<br>            output[k] = self.metadata[k](output[k], processed[k])<br>            <span class="hljs-comment">#                 â†‘ è¿™é‡Œè°ƒç”¨ reducer å‡½æ•°å¤„ç†ç»“æœ</span><br>        <span class="hljs-keyword">return</span> output<br><br>graph = Graph(State)<br>graph.add_node(<span class="hljs-keyword">lambda</span> x: &#123;<span class="hljs-string">&quot;x&quot;</span>: x[<span class="hljs-string">&quot;x&quot;</span>][-<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>&#125;)<br><span class="hljs-built_in">print</span>(graph.invoke(&#123;<span class="hljs-string">&quot;x&quot;</span>: <span class="hljs-number">0.5</span>&#125;))  <span class="hljs-comment"># è¾“å‡º: &#123;&#x27;x&#x27;: [0.5, 1.5]&#125;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªå¼ºå¤§çš„ç”¨æ³•ï¼šå°†å‡½æ•°ä½œä¸ºå…ƒæ•°æ®é™„åŠ åˆ°ç±»å‹ä¸Šï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€å¤„ç†å­—æ®µçš„å€¼ã€‚</p><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>typing.Annotated</code> æ˜¯ Python ç±»å‹ç³»ç»Ÿä¸­ä¸€ä¸ªéå¸¸çµæ´»çš„å·¥å…·ï¼Œå®ƒæœ¬èº«ä¸ä¼šåšä»»ä½•â€œå®äº‹â€ï¼Œä½†æä¾›äº†ä¸€ç§æ ‡å‡†æ–¹å¼æ¥é™„åŠ å…ƒæ•°æ®ã€‚åªè¦é…åˆèƒ½å¤Ÿè§£æå®ƒçš„æ¡†æ¶æˆ–ä»£ç é€»è¾‘ï¼Œå°±èƒ½å®ç°éå¸¸å¼ºå¤§çš„åŠŸèƒ½ã€‚åœ¨ Pydanticã€FastAPIã€LangGraph ç­‰ç°ä»£ Python å·¥å…·é“¾ä¸­ï¼Œå®ƒéƒ½å‘æŒ¥ç€å…³é”®ä½œç”¨ã€‚</p><p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ æ›´å¥½åœ°ç†è§£å¹¶åº”ç”¨ <code>Annotated</code>ï¼Œè®©ä½ çš„ç±»å‹æ³¨è§£æ—¢â€œå¥½çœ‹â€åˆâ€œæœ‰ç”¨â€ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¥½å¥‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç”¨Jdk17çš„é£æ ¼ä¹¦å†™ä»£ç </title>
    <link href="/2023/08/12/%E7%94%A8jdk17%E7%9A%84%E9%A3%8E%E6%A0%BC%E4%B9%A6%E5%86%99%E4%BB%A3%E7%A0%81/"/>
    <url>/2023/08/12/%E7%94%A8jdk17%E7%9A%84%E9%A3%8E%E6%A0%BC%E4%B9%A6%E5%86%99%E4%BB%A3%E7%A0%81/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘æƒ³é€šè¿‡Javaä¸åŒç‰ˆæœ¬çš„ç¼–ç¨‹ç‰¹æ€§å»è§£å†³ä¸€ä¸‹å¼€å‘ä¸­ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œå¸®æˆ‘ä»¬å¿«é€Ÿç†è§£å’Œå­¦ä¹ æ–°ç‰¹æ€§ï¼Œåç»­æˆ‘ä¼šä¸æ–­çš„æ”¶é›†å’Œè¡¥å……è¿™äº›é—®é¢˜ï¼Œç›®å‰æ¯”è¾ƒå¯æƒœçš„æ˜¯æˆ‘è¿˜æ²¡æœ‰å¯¹ä¸åŒçš„jdkç‰ˆæœ¬çš„å•å…ƒæµ‹è¯•ä»£ç è¿›è¡Œbanchmarkâ€¦â€¦</p><h3 id="Q1-åœ¨ç»™å®šçš„å­—ç¬¦ä¸²ä¸­å–å‡ºå‡ºç°æ¬¡æ•°Top3çš„å­—æ¯ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°å¹¶åˆ—æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç»“æœåº”è¯¥æ˜¯-k-char1-chat2-â€¦â€¦-â€¦â€¦"><a href="#Q1-åœ¨ç»™å®šçš„å­—ç¬¦ä¸²ä¸­å–å‡ºå‡ºç°æ¬¡æ•°Top3çš„å­—æ¯ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°å¹¶åˆ—æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç»“æœåº”è¯¥æ˜¯-k-char1-chat2-â€¦â€¦-â€¦â€¦" class="headerlink" title="Q1:åœ¨ç»™å®šçš„å­—ç¬¦ä¸²ä¸­å–å‡ºå‡ºç°æ¬¡æ•°Top3çš„å­—æ¯ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°å¹¶åˆ—æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç»“æœåº”è¯¥æ˜¯[k&#x3D;[char1,chat2,â€¦â€¦],â€¦â€¦]"></a>Q1:åœ¨ç»™å®šçš„å­—ç¬¦ä¸²ä¸­å–å‡ºå‡ºç°æ¬¡æ•°Top3çš„å­—æ¯ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‡ºç°å¹¶åˆ—æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç»“æœåº”è¯¥æ˜¯[k&#x3D;[char1,chat2,â€¦â€¦],â€¦â€¦]</h3><ul><li>A:jdk8ä¹‹å‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCharTopK</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">python</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;                Python is powerful... and fast;\n&quot;</span> +<br>            <span class="hljs-string">&quot;                plays well with others;\n&quot;</span> +<br>            <span class="hljs-string">&quot;                runs everywhere;\n&quot;</span> +<br>            <span class="hljs-string">&quot;                is friendly &amp; easy to learn;\n&quot;</span> +<br>            <span class="hljs-string">&quot;                is Open.&quot;</span>;<br><br>    <span class="hljs-comment">// key:char value:char å‡ºç°æ¬¡æ•°</span><br>    Map&lt;Character, Long&gt; key2count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-type">char</span>[] pythonChars = python.toLowerCase().toCharArray();<br>    <span class="hljs-keyword">for</span> (Character c : pythonChars) &#123;<br>        <span class="hljs-keyword">if</span> (!Character.isAlphabetic(c)) &#123;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> key2count.getOrDefault(c, <span class="hljs-number">0L</span>);<br>        key2count.put(c, count + <span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// key:count value:chars ï¼Œåƒç›´æ–¹å›¾</span><br>    TreeMap&lt;Long, List&lt;Character&gt;&gt; count2chars = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeMap</span>&lt;&gt;((o1, o2) -&gt; Math.toIntExact(o2 - o1));<br><br>    <span class="hljs-keyword">for</span> (Map.Entry&lt;Character, Long&gt; entry : key2count.entrySet()) &#123;<br>        List&lt;Character&gt; chars = count2chars.getOrDefault(entry.getValue(), Lists.newArrayList());<br>        chars.add(entry.getKey());<br>        count2chars.put(entry.getValue(), chars);<br>    &#125;<br><br>    log.info(<span class="hljs-string">&quot;sorted result &#123;&#125;&quot;</span>, count2chars);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>A:jdk8ä¹‹åï¼Œjdk16ä¹‹å‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCharTopK</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">python</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            Python is powerful... and fast;</span><br><span class="hljs-string">            plays well with others;</span><br><span class="hljs-string">            runs everywhere;</span><br><span class="hljs-string">            is friendly &amp; easy to learn;</span><br><span class="hljs-string">            is Open.</span><br><span class="hljs-string">            &quot;&quot;&quot;</span>;<br><br>    <span class="hljs-comment">// key:char value:char å‡ºç°æ¬¡æ•°</span><br>    Map&lt;Character, Long&gt; key2count = python.chars()<br>            .filter(Character::isAlphabetic).mapToObj(i -&gt; (<span class="hljs-type">char</span>) i)<br>            .collect(Collectors.groupingBy(Function.identity(), Collectors.counting()));<br><br>    <span class="hljs-comment">// key:count value:chars ï¼Œåƒç›´æ–¹å›¾</span><br>    Map&lt;Long, List&lt;Character&gt;&gt; count2char = key2count.entrySet().stream().<br>            collect(Collectors.groupingBy(Map.Entry::getValue,<br>                            Collectors.mapping(Map.Entry::getKey, Collectors.toList())<br>                    )<br>            );<br>    <span class="hljs-comment">// å€’æ’</span><br>    List&lt;Map.Entry&lt;Long, List&lt;Character&gt;&gt;&gt; topK = count2char.entrySet().stream()<br>            .sorted(Map.Entry.comparingByKey(Comparator.reverseOrder())).toList();<br><br>    log.info(<span class="hljs-string">&quot;sorted result &#123;&#125;&quot;</span>, topK);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>A:jdk16ä¹‹åï¼Œæ›´é€‚ç”¨äºå¯è¯»æ€§æ›´å¥½çš„ä¸šåŠ¡ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCharTopK</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">python</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">            Python is powerful... and fast;</span><br><span class="hljs-string">            plays well with others;</span><br><span class="hljs-string">            runs everywhere;</span><br><span class="hljs-string">            is friendly &amp; easy to learn;</span><br><span class="hljs-string">            is Open.</span><br><span class="hljs-string">            &quot;&quot;&quot;</span>;<br>    <span class="hljs-keyword">record</span> <span class="hljs-title class_">Letter</span><span class="hljs-params">(<span class="hljs-type">int</span> codePoint)</span> &#123;<br>        Letter(<span class="hljs-type">int</span> codePoint) &#123;<br>            <span class="hljs-built_in">this</span>.codePoint = Character.toLowerCase(codePoint);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">record</span> <span class="hljs-title class_">LetterCount</span><span class="hljs-params">(<span class="hljs-type">long</span> count)</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparable</span>&lt;LetterCount&gt; &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(LetterCount o)</span> &#123;<br>            <span class="hljs-keyword">return</span> Long.compare(<span class="hljs-built_in">this</span>.count, o.count);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">record</span> <span class="hljs-title class_">LetterByCount</span><span class="hljs-params">(Letter letter, LetterCount count)</span> &#123;<br>        LetterByCount(Map.Entry&lt;Letter, LetterCount&gt; entry) &#123;<br>            <span class="hljs-built_in">this</span>(entry.getKey(), entry.getValue());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">record</span> <span class="hljs-title class_">LettersByCount</span><span class="hljs-params">(LetterCount count, List&lt;Letter&gt; letters)</span> &#123;<br>        LettersByCount(Map.Entry&lt;LetterCount, List&lt;Letter&gt;&gt; entry) &#123;<br>            <span class="hljs-built_in">this</span>(entry.getKey(), entry.getValue());<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Comparator&lt;? <span class="hljs-built_in">super</span> LettersByCount&gt; comparingByCount() &#123;<br>            <span class="hljs-keyword">return</span> Comparator.comparing(LettersByCount::count);<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">// key:char value:char å‡ºç°æ¬¡æ•°</span><br>    Map&lt;Letter, LetterCount&gt; letter2count = python.chars()<br>            .filter(Character::isAlphabetic).mapToObj(Letter::<span class="hljs-keyword">new</span>)<br>            .collect(<br>                    Collectors.groupingBy(<br>                            Function.identity(),<br>                            Collectors.collectingAndThen(Collectors.counting(), LetterCount::<span class="hljs-keyword">new</span>)<br>                    )<br>            );<br><br>    <span class="hljs-comment">// key:count value:chars ï¼Œåƒç›´æ–¹å›¾</span><br>    Map&lt;LetterCount, List&lt;Letter&gt;&gt; count2letter = letter2count.entrySet().stream()<br>            .map(LetterByCount::<span class="hljs-keyword">new</span>)<br>            .collect(Collectors.groupingBy(LetterByCount::count, Collectors.mapping(LetterByCount::letter, Collectors.toList())));<br><br>    <span class="hljs-comment">// å€’æ’</span><br>    List&lt;LettersByCount&gt; topK = count2letter.entrySet().stream()<br>            .map(LettersByCount::<span class="hljs-keyword">new</span>)<br>            .sorted(LettersByCount.comparingByCount().reversed())<br>            .toList();<br>    log.info(<span class="hljs-string">&quot;sorted result &#123;&#125;&quot;</span>, topK);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Q2-çŒœæ•°å­—æ¸¸æˆ-ä¸€ä½ç©å®¶æƒ³ä¸€ä¸ªå•è¯ï¼Œå¦ä¸€ä½é€šè¿‡å•è¯é•¿åº¦å°è¯•çŒœè¯¥ç©å®¶æ‰€æƒ³çš„å•è¯ï¼Œå¦‚æœåŒä½ç½®ä¸Šçš„å­—æ¯ç›¸åŒï¼Œåˆ™åœ¨çŒœæµ‹çš„å•è¯ä¸Šè¯¥å­—æ¯å¤§å†™è¿”å›ï¼Œå¦‚æœåŒä½ç½®ä¸Šæ²¡æœ‰ï¼Œä½†æ˜¯å…¶å®ƒä½ç½®æœ‰åˆ™ä¸å˜ï¼ˆåªåŒ¹é…ä¸€æ¬¡ï¼‰ï¼Œå¦‚æœåŒä½ç½®ä¸åŒ¹é…ä¸”å®ƒä½ç½®æœªå‡ºç°åˆ™ç”¨-æ›¿æ¢"><a href="#Q2-çŒœæ•°å­—æ¸¸æˆ-ä¸€ä½ç©å®¶æƒ³ä¸€ä¸ªå•è¯ï¼Œå¦ä¸€ä½é€šè¿‡å•è¯é•¿åº¦å°è¯•çŒœè¯¥ç©å®¶æ‰€æƒ³çš„å•è¯ï¼Œå¦‚æœåŒä½ç½®ä¸Šçš„å­—æ¯ç›¸åŒï¼Œåˆ™åœ¨çŒœæµ‹çš„å•è¯ä¸Šè¯¥å­—æ¯å¤§å†™è¿”å›ï¼Œå¦‚æœåŒä½ç½®ä¸Šæ²¡æœ‰ï¼Œä½†æ˜¯å…¶å®ƒä½ç½®æœ‰åˆ™ä¸å˜ï¼ˆåªåŒ¹é…ä¸€æ¬¡ï¼‰ï¼Œå¦‚æœåŒä½ç½®ä¸åŒ¹é…ä¸”å®ƒä½ç½®æœªå‡ºç°åˆ™ç”¨-æ›¿æ¢" class="headerlink" title="Q2:çŒœæ•°å­—æ¸¸æˆ:ä¸€ä½ç©å®¶æƒ³ä¸€ä¸ªå•è¯ï¼Œå¦ä¸€ä½é€šè¿‡å•è¯é•¿åº¦å°è¯•çŒœè¯¥ç©å®¶æ‰€æƒ³çš„å•è¯ï¼Œå¦‚æœåŒä½ç½®ä¸Šçš„å­—æ¯ç›¸åŒï¼Œåˆ™åœ¨çŒœæµ‹çš„å•è¯ä¸Šè¯¥å­—æ¯å¤§å†™è¿”å›ï¼Œå¦‚æœåŒä½ç½®ä¸Šæ²¡æœ‰ï¼Œä½†æ˜¯å…¶å®ƒä½ç½®æœ‰åˆ™ä¸å˜ï¼ˆåªåŒ¹é…ä¸€æ¬¡ï¼‰ï¼Œå¦‚æœåŒä½ç½®ä¸åŒ¹é…ä¸”å®ƒä½ç½®æœªå‡ºç°åˆ™ç”¨.æ›¿æ¢."></a>Q2:çŒœæ•°å­—æ¸¸æˆ:ä¸€ä½ç©å®¶æƒ³ä¸€ä¸ªå•è¯ï¼Œå¦ä¸€ä½é€šè¿‡å•è¯é•¿åº¦å°è¯•çŒœè¯¥ç©å®¶æ‰€æƒ³çš„å•è¯ï¼Œå¦‚æœåŒä½ç½®ä¸Šçš„å­—æ¯ç›¸åŒï¼Œåˆ™åœ¨çŒœæµ‹çš„å•è¯ä¸Šè¯¥å­—æ¯å¤§å†™è¿”å›ï¼Œå¦‚æœåŒä½ç½®ä¸Šæ²¡æœ‰ï¼Œä½†æ˜¯å…¶å®ƒä½ç½®æœ‰åˆ™ä¸å˜ï¼ˆåªåŒ¹é…ä¸€æ¬¡ï¼‰ï¼Œå¦‚æœåŒä½ç½®ä¸åŒ¹é…ä¸”å®ƒä½ç½®æœªå‡ºç°åˆ™ç”¨.æ›¿æ¢.</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGuess</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">record</span> <span class="hljs-title class_">Wordless</span><span class="hljs-params">(String hidden)</span> &#123;<br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">guess</span><span class="hljs-params">(String guess)</span> &#123;<br>            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>            <span class="hljs-type">boolean</span>[] used = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[hidden.length()];<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; guess.length(); i++) &#123;<br>                <span class="hljs-keyword">if</span> (guess.codePointAt(i) == <span class="hljs-built_in">this</span>.hidden.codePointAt(i)) &#123;<br>                    result.append(Character.toString(guess.codePointAt(i)).toUpperCase());<br>                    used[i] = <span class="hljs-literal">true</span>;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-type">boolean</span> <span class="hljs-variable">found</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; hidden.length(); j++) &#123;<br>                        <span class="hljs-keyword">if</span> (used[j]) &#123;<br>                            <span class="hljs-keyword">continue</span>;<br>                        &#125;<br>                        <span class="hljs-keyword">if</span> (i != j<br>                                &amp;&amp; guess.codePointAt(j) != <span class="hljs-built_in">this</span>.hidden.codePointAt(j)<br>                                &amp;&amp; guess.codePointAt(i) == <span class="hljs-built_in">this</span>.hidden.codePointAt(j)) &#123;<br>                            result.append(Character.toString(guess.codePointAt(i)));<br>                            used[j] = <span class="hljs-literal">true</span>;<br>                            found = <span class="hljs-literal">true</span>;<br>                            <span class="hljs-keyword">break</span>;<br>                        &#125;<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (!found) &#123;<br>                        result.append(<span class="hljs-string">&quot;.&quot;</span>);<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> result.toString();<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">Wordless</span> <span class="hljs-variable">wordless</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Wordless</span>(<span class="hljs-string">&quot;aaaab&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;ccccc&quot;</span>), <span class="hljs-string">&quot;.....&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;ccacc&quot;</span>), <span class="hljs-string">&quot;..A..&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;ccacb&quot;</span>), <span class="hljs-string">&quot;..A.B&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;bbacc&quot;</span>), <span class="hljs-string">&quot;b.A..&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å°è£…é‡æ„ä¹‹å,çœ‹ä¼¼å˜é•¿äº†ï¼Œä½†æ˜¯å¯è¯»æ€§æ›´é«˜äº†<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">Wordless</span><span class="hljs-params">(String hiddenAsStr)</span> &#123;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">guess</span><span class="hljs-params">(String guessAsStr)</span> &#123;<br>        <span class="hljs-type">Guess</span> <span class="hljs-variable">guess</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Guess</span>(guessAsStr);<br>        <span class="hljs-type">Hidden</span> <span class="hljs-variable">hidden</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hidden</span>(hiddenAsStr);<br>        <span class="hljs-keyword">return</span> IntStream.range(<span class="hljs-number">0</span>, guess.length()).mapToObj(i -&gt; &#123;<br>            <span class="hljs-keyword">if</span> (guess.hasALetterAtPosition(i).thatIsWellPlacedIn(hidden)) &#123;<br>                <span class="hljs-keyword">return</span> Character.toString(guess.codePointAt(i)).toUpperCase();<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (guess.hasALetterAtPosition(i).thatIsNotWellPlacedIn(hidden)) &#123;<br>                <span class="hljs-keyword">return</span> Character.toString(guess.codePointAt(i));<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;.&quot;</span>;<br>            &#125;<br>        &#125;).collect(Collectors.joining());<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">record</span> <span class="hljs-title class_">Hidden</span><span class="hljs-params">(String hidden, <span class="hljs-type">boolean</span>[] used)</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Hidden</span><span class="hljs-params">(String hidden)</span> &#123;<br>        <span class="hljs-built_in">this</span>(hidden, <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[hidden.length()]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">codePointAt</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.hidden.codePointAt(i);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">length</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.hidden.length();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">match</span><span class="hljs-params">(GuessWithIndex guessWithIndex, <span class="hljs-type">int</span> guessIndex, <span class="hljs-type">int</span> hiddenIndex)</span> &#123;<br>        <span class="hljs-keyword">if</span> (used[hiddenIndex]) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">match</span> <span class="hljs-operator">=</span> guessWithIndex.guess().codePointAt(guessIndex) == hidden.codePointAt(hiddenIndex);<br>        <span class="hljs-keyword">if</span> (match) &#123;<br>            used[hiddenIndex] = <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> match;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">record</span> <span class="hljs-title class_">Guess</span><span class="hljs-params">(String guess)</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">length</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.guess.length();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> GuessWithIndex <span class="hljs-title function_">hasALetterAtPosition</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GuessWithIndex</span>(<span class="hljs-built_in">this</span>, i);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">codePointAt</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.guess.codePointAt(i);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">record</span> <span class="hljs-title class_">GuessWithIndex</span><span class="hljs-params">(Guess guess, <span class="hljs-type">int</span> index)</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">thatIsWellPlacedIn</span><span class="hljs-params">(Hidden hidden)</span> &#123;<br>        <span class="hljs-keyword">return</span> hidden.match(<span class="hljs-built_in">this</span>, index, index);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">thatIsNotWellPlacedIn</span><span class="hljs-params">(Hidden hidden)</span> &#123;<br>        <span class="hljs-keyword">return</span> IntStream.range(<span class="hljs-number">0</span>, hidden.length())<br>                .filter(i -&gt; index != i)<br>                .filter(i -&gt; guess.codePointAt(i) != hidden.codePointAt(i))<br>                .anyMatch(i -&gt; hidden.match(<span class="hljs-built_in">this</span>, index, i));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGuess</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Wordless</span> <span class="hljs-variable">wordless</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Wordless</span>(<span class="hljs-string">&quot;aaaab&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;ccccc&quot;</span>), <span class="hljs-string">&quot;.....&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;ccacc&quot;</span>), <span class="hljs-string">&quot;..A..&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;ccacb&quot;</span>), <span class="hljs-string">&quot;..A.B&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;bbacc&quot;</span>), <span class="hljs-string">&quot;b.A..&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li>ç»§ç»­é‡æ„ï¼Œå¼•å…¥å¯†é—­ç±»å’Œswitch caseè¡¨è¾¾å¼<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">Wordless</span><span class="hljs-params">(String hiddenAsStr)</span> &#123;<br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">guess</span><span class="hljs-params">(String guessAsStr)</span> &#123;<br>        <span class="hljs-type">Guess</span> <span class="hljs-variable">guess</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Guess</span>(guessAsStr);<br>        <span class="hljs-type">Hidden</span> <span class="hljs-variable">hidden</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hidden</span>(hiddenAsStr);<br>        <span class="hljs-keyword">return</span> IntStream.range(<span class="hljs-number">0</span>, guess.length()).mapToObj(index -&gt; <span class="hljs-keyword">switch</span> (guess.checkCharterAtPosition(index).with(hidden)) &#123;<br>            <span class="hljs-keyword">case</span> WELL_PLACED letter -&gt; Character.toString(letter.codePoint()).toUpperCase();<br>            <span class="hljs-keyword">case</span> NOT_WELL_PLACED letter -&gt; Character.toString(letter.codePoint());<br>            <span class="hljs-keyword">case</span> ABSEND letter -&gt; <span class="hljs-string">&quot;.&quot;</span>;<br>        &#125;).collect(Collectors.joining());<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">record</span> <span class="hljs-title class_">Hidden</span><span class="hljs-params">(String hidden, <span class="hljs-type">boolean</span>[] used)</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Hidden</span><span class="hljs-params">(String hidden)</span> &#123;<br>        <span class="hljs-built_in">this</span>(hidden, <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[hidden.length()]);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">codePointAt</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.hidden.codePointAt(i);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">length</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.hidden.length();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">match</span><span class="hljs-params">(GuessWithIndex guessWithIndex, <span class="hljs-type">int</span> guessIndex, <span class="hljs-type">int</span> hiddenIndex)</span> &#123;<br>        <span class="hljs-keyword">if</span> (used[hiddenIndex]) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">match</span> <span class="hljs-operator">=</span> guessWithIndex.guess().codePointAt(guessIndex) == hidden.codePointAt(hiddenIndex);<br>        <span class="hljs-keyword">if</span> (match) &#123;<br>            used[hiddenIndex] = match;<br>        &#125;<br>        <span class="hljs-keyword">return</span> match;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">record</span> <span class="hljs-title class_">Guess</span><span class="hljs-params">(String guess)</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">length</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.guess.length();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> GuessWithIndex <span class="hljs-title function_">hasALetterAtPosition</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GuessWithIndex</span>(<span class="hljs-built_in">this</span>, i);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">codePointAt</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.guess.codePointAt(i);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> GuessWithIndex <span class="hljs-title function_">checkCharterAtPosition</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GuessWithIndex</span>(<span class="hljs-built_in">this</span>,index);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">record</span> <span class="hljs-title class_">GuessWithIndex</span><span class="hljs-params">(Guess guess, <span class="hljs-type">int</span> index)</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">thatIsWellPlacedIn</span><span class="hljs-params">(Hidden hidden)</span> &#123;<br>        <span class="hljs-keyword">return</span> hidden.match(<span class="hljs-built_in">this</span>, index, index);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">thatIsNotWellPlacedIn</span><span class="hljs-params">(Hidden hidden)</span> &#123;<br>        <span class="hljs-keyword">return</span> IntStream.range(<span class="hljs-number">0</span>, hidden.length()).filter(i -&gt; index != i)<br>                .filter(i -&gt; guess.codePointAt(i) != hidden.codePointAt(i))<br>                .anyMatch(i -&gt; hidden.match(<span class="hljs-built_in">this</span>, index, i));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> Letter <span class="hljs-title function_">with</span><span class="hljs-params">(Hidden hidden)</span> &#123;<br>        <span class="hljs-keyword">if</span> (thatIsWellPlacedIn(hidden)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WELL_PLACED</span>(<span class="hljs-built_in">this</span>.guess.codePointAt(<span class="hljs-built_in">this</span>.index));<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (thatIsNotWellPlacedIn(hidden)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NOT_WELL_PLACED</span>(<span class="hljs-built_in">this</span>.guess.codePointAt(<span class="hljs-built_in">this</span>.index));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ABSEND</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Letter</span> <span class="hljs-keyword">permits</span> WELL_PLACED, NOT_WELL_PLACED, ABSEND &#123;<br>&#125;<br><br><span class="hljs-keyword">record</span> <span class="hljs-title class_">WELL_PLACED</span><span class="hljs-params">(<span class="hljs-type">int</span> codePoint)</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Letter</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">record</span> <span class="hljs-title class_">NOT_WELL_PLACED</span><span class="hljs-params">(<span class="hljs-type">int</span> codePoint)</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Letter</span> &#123;<br>&#125;<br><br><span class="hljs-keyword">record</span> <span class="hljs-title class_">ABSEND</span><span class="hljs-params">()</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Letter</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGuess</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Wordless</span> <span class="hljs-variable">wordless</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Wordless</span>(<span class="hljs-string">&quot;aaaab&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;ccccc&quot;</span>), <span class="hljs-string">&quot;.....&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;ccacc&quot;</span>), <span class="hljs-string">&quot;..A..&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;ccacb&quot;</span>), <span class="hljs-string">&quot;..A.B&quot;</span>);<br>    Assertions.assertEquals(wordless.guess(<span class="hljs-string">&quot;bbacc&quot;</span>), <span class="hljs-string">&quot;b.A..&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç»ƒä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springbootåº”ç”¨é•œåƒæ„å»º</title>
    <link href="/2022/11/20/Efficient-container-images/"/>
    <url>/2022/11/20/Efficient-container-images/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å®¹å™¨ â€”â€”äº‘åŸç”Ÿçš„åŸºçŸ³</p></blockquote><p>ä¸€ä¸ªSpringBootåº”ç”¨çš„ä¸Šäº‘å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å°†æ‰“å‡ºæ¥çš„jaråŒ…æ”¾å…¥ä¸€ä¸ªå¸¦æœ‰jdkç¯å¢ƒçš„DockeråŸºç¡€é•œåƒä¸­è¿è¡Œèµ·æ¥å°±è¡Œã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ·±å…¥æ€è€ƒçœŸçš„æ˜¯è¿™æ ·å—ï¼Ÿç®€å•çš„å¤åˆ¶jaråŒ…åœ¨å®¹å™¨ä¸­è¿è¡Œæ€»æ˜¯ä¼šæ¯”è¿è¡Œè§£å‹ä¹‹åçš„æ–‡ä»¶å¤šä¸€äº›çš„å¼€é”€ï¼Œè€Œåœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸­ï¼Œè¿™ç§å¼€é”€æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒæŠŠåº”ç”¨ç¨‹åºçš„ä»£ç å’Œå®ƒçš„æ‰€æœ‰ä¾èµ–æ”¾åœ¨Dockeré•œåƒçš„ä¸€ä¸ªå±‚ä¸­å¹¶ä¸æ˜¯ä¼˜é›…çš„åšæ³•ï¼Œç”±äºé‡æ–°ç¼–è¯‘ä»£ç çš„é¢‘ç‡ä¸€å®šæ¯”æˆ‘ä»¬å‡çº§æ‰€ä½¿ç”¨çš„ä¾èµ–çš„é¢‘ç‡è¦é«˜å¾ˆå¤šï¼Œæ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹åœ¨DockerFileä¸­æŠŠäº‹æƒ…åˆ†å¼€ä¸€äº›æ¯”è¾ƒå¥½ã€‚ å¦‚æœæŠŠjaræ–‡ä»¶æ”¾åœ¨åº”ç”¨ç±»ä¹‹å‰çš„é‚£ä¸€å±‚ï¼ŒDockeré€šå¸¸åªéœ€è¦æ”¹å˜æœ€åº•å±‚ï¼Œå°±å¯ä»¥ä»å…¶ç¼“å­˜ä¸­è·å–å…¶ä»–æ–‡ä»¶ï¼ˆå……åˆ†åˆ©ç”¨unionFSï¼‰ã€‚</p><p>åŸºäºä¸Šè¿°å‰æï¼Œæˆ‘ä»¬æƒ³è¦åšä¸€ä¸ªé«˜æ•ˆçš„Springboot DockerFileåªéœ€è¦ä¸¤æ­¥ï¼š</p><ol><li>åˆ†å±‚çš„jaråŒ…</li><li>ç¼–å†™Dockerfiles</li></ol><h3 id="åˆ†å±‚çš„jaråŒ…"><a href="#åˆ†å±‚çš„jaråŒ…" class="headerlink" title="åˆ†å±‚çš„jaråŒ…"></a>åˆ†å±‚çš„jaråŒ…</h3><p>ä¸ºäº†æ›´å®¹æ˜“åˆ›å»ºä¼˜åŒ–çš„Dockeré•œåƒï¼ŒSpringBootæ”¯æŒåœ¨jarä¸­æ·»åŠ ä¸€ä¸ªå±‚ç´¢å¼•æ–‡ä»¶ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå±‚çš„åˆ—è¡¨ä»¥åŠjarä¸­åº”åŒ…å«çš„éƒ¨åˆ†ï¼Œç´¢å¼•ä¸­çš„å±‚åˆ—è¡¨æ˜¯æ ¹æ®å±‚åº”è¯¥è¢«æ·»åŠ åˆ°Docker&#x2F;OCIé•œåƒä¸­çš„é¡ºåºæ’åˆ—çš„ï¼š</p><ul><li>dependencies (ç”¨äºå¸¸è§„å‘å¸ƒçš„ä¾èµ–)</li><li>spring-boot-loader (é’ˆå¯¹ org&#x2F;springframework&#x2F;boot&#x2F;loader ä¸‹çš„æ‰€æœ‰å†…å®¹)</li><li>snapshot-dependencies (ç”¨äºsnapshotçš„ä¾èµ–)</li><li>application (ç”¨äºapplication ç±»å’Œèµ„æº)</li></ul><p>è¿™ç§åˆ†å±‚è®¾è®¡æ˜¯ä¸ºäº†æ ¹æ®ä»£ç åœ¨åº”ç”¨ç¨‹åºæ„å»ºä¹‹é—´å˜åŒ–çš„å¯èƒ½æ€§æ¥åˆ†ç¦»ä»£ç ï¼Œdependenciesä»£ç åœ¨ä¸åŒçš„æ„å»ºä¹‹é—´å˜åŒ–çš„å¯èƒ½æ€§è¾ƒå°ï¼Œæ‰€ä»¥å®ƒè¢«æ”¾åœ¨è‡ªå·±çš„å±‚ä¸­ï¼Œä»¥å…è®¸å·¥å…·ä»ç¼“å­˜ä¸­é‡æ–°ä½¿ç”¨è¿™äº›å±‚ã€‚applicationåœ¨ä¸åŒçš„æ„å»ºä¹‹é—´æ›´æœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥å®ƒè¢«éš”ç¦»åœ¨ä¸€ä¸ªå•ç‹¬çš„å±‚ä¸­ã€‚</p><h3 id="ç¼–å†™Dockerfiles"><a href="#ç¼–å†™Dockerfiles" class="headerlink" title="ç¼–å†™Dockerfiles"></a>ç¼–å†™Dockerfiles</h3><p>è™½ç„¶åœ¨Dockerfileä¸­åªéœ€å‡ è¡Œå°±å¯ä»¥å°†SpringBootçš„jarè½¬æ¢æˆdockeré•œåƒï¼Œä½†æˆ‘ä»¬å°†ä½¿ç”¨åˆ†å±‚åŠŸèƒ½å¯ä»¥åˆ›å»ºä¸€ä¸ªä¼˜åŒ–çš„dockeré•œåƒã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«åˆ†å±‚æ–‡ä»¶çš„jaræ—¶ï¼Œspring-boot-jarmode-layertools.jarå°†è¢«ä½œä¸ºä¾èµ–æ·»åŠ åˆ°æˆ‘ä»¬çš„åº”ç”¨jarä¸­(è§£å‹ä¹‹åèƒ½çœ‹åˆ°)ã€‚æœ‰äº†classpathä¸Šçš„è¿™ä¸ªjarï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªç‰¹æ®Šçš„æ¨¡å¼ä¸‹å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªæ¨¡å¼å…è®¸bootstrapä»£ç è¿è¡Œä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå®Œå…¨ä¸åŒçš„ä¸œè¥¿ï¼Œä¾‹å¦‚æå–å±‚é‡Œçš„ä¸œè¥¿ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨jar</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">java -Djarmode=layertools -jar my-app.jar</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è§£å‹jarå¹¶åˆ†ç±»ä¾èµ–ï¼ˆæ„å»ºåˆ†å±‚Dockeré•œåƒçš„æ ¸å¿ƒå·¥å…·ï¼‰</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">java -Djarmode=layertools -jar my-app.jar extract</span><br></code></pre></td></tr></table></figure><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs DOCKERFILE"><span class="hljs-keyword">FROM</span> eclipse-temurin:<span class="hljs-number">17</span>-jre as builder<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> application</span><br><span class="hljs-keyword">ARG</span> JAR_FILE=target/*.jar<br><span class="hljs-keyword">COPY</span><span class="language-bash"> <span class="hljs-variable">$&#123;JAR_FILE&#125;</span> application.jar</span><br><span class="hljs-keyword">RUN</span><span class="language-bash"> java -Djarmode=layertools -jar application.jar extract</span><br><br><span class="hljs-keyword">FROM</span> eclipse-temurin:<span class="hljs-number">17</span>-jre<br><span class="hljs-keyword">WORKDIR</span><span class="language-bash"> application</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder application/dependencies/ ./</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder application/spring-boot-loader/ ./</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder application/snapshot-dependencies/ ./</span><br><span class="hljs-keyword">COPY</span><span class="language-bash"> --from=builder application/application/ ./</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;org.springframework.boot.loader.JarLauncher&quot;</span>]</span><br></code></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-comment"># å¯ä»¥æŒ‡å®šå‚æ•°æ„å»º</span><br>docker <span class="hljs-keyword">build </span>--<span class="hljs-keyword">build-arg </span><span class="hljs-keyword">JAR_FILE=path/to/myapp.jar </span>.<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå¤šé˜¶æ®µçš„dockeræ–‡ä»¶ï¼Œæ„å»ºè€…é˜¶æ®µæå–äº†ä»¥åéœ€è¦çš„ç›®å½•ï¼Œæ¯ä¸ª COPY å‘½ä»¤éƒ½ä¸jarmodeæå–çš„å±‚æœ‰å…³ã€‚<br>å½“ç„¶ï¼Œä¸ä½¿ç”¨jarmodeä¹Ÿå¯ä»¥ç¼–å†™Dockerfileï¼Œ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨unzipå’Œmvçš„ä¸€äº›ç»„åˆæ¥æŠŠä¸œè¥¿ç§»åˆ°æ­£ç¡®çš„å±‚ï¼Œä½†jarmodeç®€åŒ–äº†è¿™ä¸€ç‚¹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cloud native</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythoné­”æ³•æ–¹æ³•</title>
    <link href="/2022/09/17/python%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95/"/>
    <url>/2022/09/17/python%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>é­”æ³•æ–¹æ³•(Magic Methods)æ˜¯Pythonä¸­çš„å†…ç½®å‡½æ•°ï¼Œä¸€èˆ¬ä»¥åŒä¸‹åˆ’çº¿å¼€å¤´å’Œç»“å°¾ï¼Œä¾‹å¦‚__init__ã€__del__ç­‰ã€‚ä¹‹æ‰€ä»¥ç§°ä¹‹ä¸ºé­”æ³•æ–¹æ³•ï¼Œæ˜¯å› ä¸ºè¿™äº›æ–¹æ³•ä¼šåœ¨è¿›è¡Œç‰¹å®šçš„æ“ä½œæ—¶ä¼šè‡ªåŠ¨è¢«è°ƒç”¨ï¼Œé­”æ³•æ–¹æ³•å¤§è‡´åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼šæ„é€ ä¸åˆå§‹åŒ–ã€ç±»çš„è¡¨ç¤ºã€è®¿é—®æ§åˆ¶ã€æ¯”è¾ƒã€è¿ç®—ç­‰æ“ä½œã€å®¹å™¨ç±»æ“ä½œã€å¯è°ƒç”¨å¯¹è±¡ã€åºåˆ—åŒ–ç±»ã€‚åœ¨è¿™é‡Œæˆ‘è®°å½•ä¸€ä¸‹å®ƒçš„å¸¸ç”¨é­”æ³•æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æŸ¥çœ‹é­”æ³•æ–¹æ³•</span><br>magic = <span class="hljs-built_in">dir</span>(<span class="hljs-string">&quot;hello&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: x.startswith(<span class="hljs-string">&quot;__&quot;</span>), magic)))<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">[<span class="hljs-string">&#x27;__add__&#x27;</span>, <span class="hljs-string">&#x27;__class__&#x27;</span>, <span class="hljs-string">&#x27;__contains__&#x27;</span>, <span class="hljs-string">&#x27;__delattr__&#x27;</span>, <span class="hljs-string">&#x27;__dir__&#x27;</span>, <span class="hljs-string">&#x27;__doc__&#x27;</span>, <span class="hljs-string">&#x27;__eq__&#x27;</span>, <span class="hljs-string">&#x27;__format__&#x27;</span>, <span class="hljs-string">&#x27;__ge__&#x27;</span>, <span class="hljs-string">&#x27;__getattribute__&#x27;</span>, <span class="hljs-string">&#x27;__getitem__&#x27;</span>, <span class="hljs-string">&#x27;__getnewargs__&#x27;</span>, <span class="hljs-string">&#x27;__getstate__&#x27;</span>, <span class="hljs-string">&#x27;__gt__&#x27;</span>, <span class="hljs-string">&#x27;__hash__&#x27;</span>, <span class="hljs-string">&#x27;__init__&#x27;</span>, <span class="hljs-string">&#x27;__init_subclass__&#x27;</span>, <span class="hljs-string">&#x27;__iter__&#x27;</span>, <span class="hljs-string">&#x27;__le__&#x27;</span>, <span class="hljs-string">&#x27;__len__&#x27;</span>, <span class="hljs-string">&#x27;__lt__&#x27;</span>, <span class="hljs-string">&#x27;__mod__&#x27;</span>, <span class="hljs-string">&#x27;__mul__&#x27;</span>, <span class="hljs-string">&#x27;__ne__&#x27;</span>, <span class="hljs-string">&#x27;__new__&#x27;</span>, <span class="hljs-string">&#x27;__reduce__&#x27;</span>, <span class="hljs-string">&#x27;__reduce_ex__&#x27;</span>, <span class="hljs-string">&#x27;__repr__&#x27;</span>, <span class="hljs-string">&#x27;__rmod__&#x27;</span>, <span class="hljs-string">&#x27;__rmul__&#x27;</span>, <span class="hljs-string">&#x27;__setattr__&#x27;</span>, <span class="hljs-string">&#x27;__sizeof__&#x27;</span>, <span class="hljs-string">&#x27;__str__&#x27;</span>, <span class="hljs-string">&#x27;__subclasshook__&#x27;</span>]<br></code></pre></td></tr></table></figure><h2 id="æ„é€ åˆå§‹åŒ–ç›¸å…³"><a href="#æ„é€ åˆå§‹åŒ–ç›¸å…³" class="headerlink" title="æ„é€ åˆå§‹åŒ–ç›¸å…³"></a>æ„é€ åˆå§‹åŒ–ç›¸å…³</h2><p>ä¸æ„é€ å’Œåˆå§‹åŒ–ç›¸å…³çš„æ–¹æ³•æœ‰ä¸‰ä¸ª__init__ã€<strong>del__ã€__new</strong></p><ul><li>__new__æ–¹æ³•æ˜¯åˆ›å»ºç±»çš„å®ä¾‹å¹¶è¿”å›ï¼Œå†è¿›å…¥__init__å¯¹å®ä¾‹è¿›è¡Œåˆå§‹åŒ–ï¼Œä½¿ç”¨åœºæ™¯å¦‚å•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ï¼Œä»¥åŠä¸€äº›ä¸å¯å˜å¯¹è±¡çš„ç»§æ‰¿ä¸Š</li><li>__init__é€šè¿‡è°ƒç”¨å±æ€§æ“ä½œç›¸å…³çš„æ–¹æ³•ï¼Œå¯¹å±æ€§è¿›è¡Œåˆå§‹åŒ–</li><li>è€Œ__del__æ–¹æ³•åˆ™æ˜¯å½“å¯¹è±¡è¢«ç³»ç»Ÿå›æ”¶çš„æ—¶å€™è°ƒç”¨çš„é­”æ³•æ–¹æ³•ï¼Œåœ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè°ƒç”¨ç»“æŸæ—¶è°ƒç”¨è¯¥æ–¹æ³•ã€‚Python é‡‡ç”¨è‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼ˆARCï¼‰æ–¹å¼æ¥å›æ”¶å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´</li></ul><ul><li>æ‰§è¡Œé¡ºåºå¦‚ä¸‹<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, *args, **kwargs</span>) -&gt; Self:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ„é€ æ–¹æ³•__new__&quot;</span>)<br>        <span class="hljs-comment"># åˆ›å»ºå®ä¾‹å¹¶è¿”å›,å¦‚æœä¸è¿”å›åˆ™ä¸ä¼šè¿›å…¥åˆ°åˆå§‹åŒ–æ–¹æ³•</span><br>        <span class="hljs-comment"># __new__è¿”å›çš„æ˜¯å…¶å®ƒå®ä¾‹ï¼Œå½“å‰å®ä¾‹çš„__init__ä¹Ÿä¸ä¼šè°ƒç”¨</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">object</span>.__new__(cls)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># selfå°±æ˜¯__new__è¿”å›çš„å¯¹è±¡å®ä¾‹</span><br>        self.name = name<br>        self.age = age<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åˆå§‹åŒ–æ–¹æ³•__init__&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__del__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;delæ–¹æ³•è¢«æ‰§è¡Œ&quot;</span>)<br><br><br>user = User(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-number">23</span>)<br><span class="hljs-keyword">del</span> user  <span class="hljs-comment"># pythonä½¿ç”¨å¼•ç”¨è®¡æ•°æ³•ï¼Œåœ¨æ²¡æœ‰è¢«å¼•ç”¨çš„æ—¶å€™ä¼šè¢«å›æ”¶</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">æ‰§è¡Œé¡ºåºï¼š<br>æ„é€ æ–¹æ³•__new__<br>åˆå§‹åŒ–æ–¹æ³•__init__<br><span class="hljs-keyword">del</span>æ–¹æ³•è¢«æ‰§è¡Œ<br></code></pre></td></tr></table></figure></li><li>å¼•å…¥çˆ¶ç±»ä¹‹åæ‰§è¡Œé¡ºåºå¦‚ä¸‹<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, *args, **kwargs</span>) -&gt; Self:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çˆ¶ç±»æ„é€ æ–¹æ³•__new__&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">object</span>.__new__(cls)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, id_card: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        self.id_card = id_card<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çˆ¶ç±»åˆå§‹åŒ–æ–¹æ³•__init__&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__del__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çˆ¶ç±»çš„delæ–¹æ³•è¢«æ‰§è¡Œ&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">People</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, *args, **kwargs</span>) -&gt; Self:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å­ç±»æ„é€ æ–¹æ³•__new__&quot;</span>)<br>        <span class="hljs-comment"># åˆ›å»ºå®ä¾‹å¹¶è¿”å›,å¦‚æœä¸è¿”å›åˆ™ä¸ä¼šè¿›å…¥åˆ°åˆå§‹åŒ–æ–¹æ³•</span><br>        <span class="hljs-comment"># __new__è¿”å›çš„æ˜¯å…¶å®ƒå®ä¾‹ï¼Œå½“å‰å®ä¾‹çš„__init__ä¹Ÿä¸ä¼šè°ƒç”¨</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__new__(cls, *args, **kwargs)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, id_card: <span class="hljs-built_in">str</span>, name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># selfå°±æ˜¯__new__è¿”å›çš„å¯¹è±¡å®ä¾‹</span><br>        <span class="hljs-built_in">super</span>().__init__(id_card)<br>        self.name = name<br>        self.age = age<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å­ç±»åˆå§‹åŒ–æ–¹æ³•__init__&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__del__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å­ç±»çš„delæ–¹æ³•è¢«æ‰§è¡Œ&quot;</span>)<br><br><br>user = User(<span class="hljs-string">&quot;10010&quot;</span>, <span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-number">23</span>)<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">å­ç±»æ„é€ æ–¹æ³•__new__<br>çˆ¶ç±»æ„é€ æ–¹æ³•__new__<br>çˆ¶ç±»åˆå§‹åŒ–æ–¹æ³•__init__<br>å­ç±»åˆå§‹åŒ–æ–¹æ³•__init__<br>å­ç±»çš„<span class="hljs-keyword">del</span>æ–¹æ³•è¢«æ‰§è¡Œ<br></code></pre></td></tr></table></figure></li><li>é€šè¿‡newæ–¹æ³•å®ç°å•ä¾‹æ¨¡å¼<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Single</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    _instance = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, *args, **kw</span>):<br>        <span class="hljs-keyword">if</span> cls._instance <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            cls._instance = <span class="hljs-built_in">object</span>.__new__(cls, *args, **kw)<br>        <span class="hljs-keyword">return</span> cls._instance<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>single1 = Single()<br>single2 = Single()<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>(single1) == <span class="hljs-built_in">id</span>(single2))<br></code></pre></td></tr></table></figure></li></ul><h2 id="æ§åˆ¶å±æ€§è®¿é—®"><a href="#æ§åˆ¶å±æ€§è®¿é—®" class="headerlink" title="æ§åˆ¶å±æ€§è®¿é—®"></a>æ§åˆ¶å±æ€§è®¿é—®</h2><p>è¿™ç±»é­”æ³•æ–¹æ³•ä¸»è¦å†å¯¹å¯¹è±¡çš„å±æ€§è¿›è¡Œè®¿é—®ã€å®šä¹‰ã€ä¿®æ”¹æ—¶èµ·ä½œç”¨ã€‚ä¸»è¦æœ‰ï¼š</p><ul><li><strong>getattr</strong>(self, name): å®šä¹‰å½“ç”¨æˆ·è¯•å›¾è·å–ä¸€ä¸ªå±æ€§æ—¶çš„è¡Œä¸º</li><li><strong>getattribute</strong>(self, name)ï¼šå®šä¹‰å½“è¯¥ç±»çš„å±æ€§è¢«è®¿é—®æ—¶çš„è¡Œä¸ºï¼ˆå…ˆè°ƒç”¨è¯¥æ–¹æ³•ï¼ŒæŸ¥çœ‹æ˜¯å¦å­˜åœ¨è¯¥å±æ€§ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œæ¥ç€å»è°ƒç”¨__getattr__ï¼‰</li><li><strong>setattr</strong>(self, name, value)ï¼šå®šä¹‰å½“ä¸€ä¸ªå±æ€§è¢«è®¾ç½®æ—¶çš„è¡Œä¸º</li><li><strong>delattr</strong>(self, name)ï¼šå®šä¹‰å½“ä¸€ä¸ªå±æ€§è¢«åˆ é™¤æ—¶çš„è¡Œä¸º<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># ä¼šè°ƒç”¨__setattr__æ–¹æ³•å¤åˆ¶</span><br>        <span class="hljs-comment"># æ¯æ¬¡å¤åˆ¶éƒ½ä¼šæŠŠå±æ€§å†™å…¥dictå­—å…¸ä¸­</span><br>        self.age = age<br>        <span class="hljs-comment"># print(self.__dict__)</span><br>        self.name = name<br>        <span class="hljs-comment"># print(self.__dict__)</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, __name: <span class="hljs-built_in">str</span>, __value: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># ç”±äºæ¯æ¬¡ç±»å®ä¾‹è¿›è¡Œå±æ€§èµ‹å€¼æ—¶éƒ½ä¼šè°ƒç”¨__setattr__()ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥é‡è½½__setattr__()æ–¹æ³•ï¼Œæ¥åŠ¨æ€çš„è§‚å¯Ÿæ¯æ¬¡å®ä¾‹å±æ€§èµ‹å€¼æ—¶__dict__()çš„å˜åŒ–</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;__setattr__è¢«è°ƒç”¨äº†ï¼Œè®¾ç½®å±æ€§<span class="hljs-subst">&#123;__name&#125;</span>å€¼ä¸º<span class="hljs-subst">&#123;__value&#125;</span>&quot;</span>)<br>        <span class="hljs-comment"># self.__dict__ä¼šå»è°ƒç”¨__getattribute__æ–¹æ³•ç¡®è®¤__dict__æ˜¯å¦å­˜åœ¨</span><br>        self.__dict__[__name] = __value<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattribute__</span>(<span class="hljs-params">self, __name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Any</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;__getattribute__æ–¹æ³•è¢«è°ƒç”¨äº†,å±æ€§åç§°<span class="hljs-subst">&#123;__name&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">object</span>.__getattribute__(self, __name)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, __name</span>):<br>        <span class="hljs-comment"># å¦‚æœclassä¸­å®šä¹‰äº†__getattr__()ï¼Œåˆ™__getattr__()ä¸ä¼šè¢«è°ƒç”¨ï¼ˆé™¤éæ˜¾ç¤ºè°ƒç”¨æˆ–å¼•å‘AttributeErrorå¼‚å¸¸ï¼‰</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è°ƒç”¨__getattr__æ–¹æ³•è·å–å±æ€§<span class="hljs-subst">&#123;__name&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> self.__dict__[__name]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delattr__</span>(<span class="hljs-params">self, __name</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è°ƒç”¨äº†__delattr__æ–¹æ³•ï¼Œåˆ é™¤äº†<span class="hljs-subst">&#123;__name&#125;</span>å±æ€§&quot;</span>)<br>        self.__dict__.pop[__name]<br><br>user = User(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-number">23</span>)<br><span class="hljs-built_in">delattr</span>(user, <span class="hljs-string">&quot;name&quot;</span>)<br><span class="hljs-built_in">print</span>(user.name)<br><span class="hljs-built_in">print</span>(user.a)  <span class="hljs-comment"># å› ä¸º__getattribute__æŠ›å‡ºAttributeErrorå¼‚å¸¸ï¼Œè§¦å‘__getattr__</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="å®¹å™¨ç±»æ“ä½œ"><a href="#å®¹å™¨ç±»æ“ä½œ" class="headerlink" title="å®¹å™¨ç±»æ“ä½œ"></a>å®¹å™¨ç±»æ“ä½œ</h2><p>æœ‰ä¸€äº›æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬è‡ªå·±å®šä¹‰è‡ªå·±çš„å®¹å™¨ï¼Œå°±åƒpythonå†…ç½®çš„list,tuple,dictç­‰ç­‰ï¼›å®¹å™¨åˆ†ä¸ºå¯å˜å®¹å™¨å’Œä¸å¯å˜å®¹å™¨,è¿™é‡Œçš„ç»†èŠ‚éœ€è¦å»äº†è§£ç›¸å…³çš„åè®®ã€‚å¦‚æœè‡ªå®šä¹‰ä¸€ä¸ªä¸å¯å˜å®¹å™¨çš„è¯ï¼Œåªèƒ½å®šä¹‰__len__å’Œ__getitem__ï¼›å®šä¹‰ä¸€ä¸ªå¯å˜å®¹å™¨é™¤äº†ä¸å¯å˜å®¹å™¨çš„æ‰€æœ‰é­”æ³•æ–¹æ³•ï¼Œè¿˜éœ€è¦å®šä¹‰__setitem__å’Œ__delitem__ï¼›å¦‚æœå®¹å™¨å¯è¿­ä»£è¿˜éœ€è¦å®šä¹‰__iter__</p><ul><li><strong>len</strong>(self):è¿”å›å®¹å™¨çš„é•¿åº¦</li><li><strong>getitem</strong>(self,key):å½“éœ€è¦æ‰§è¡Œself[key]çš„æ–¹å¼å»è°ƒç”¨å®¹å™¨ä¸­çš„å¯¹è±¡ï¼Œè°ƒç”¨çš„æ—¶è¯¥æ–¹æ³•</li><li><strong>setitem</strong>(self,key,value):å½“éœ€è¦æ‰§è¡Œself[key] &#x3D; valueæ—¶ï¼Œè°ƒç”¨çš„æ˜¯è¯¥æ–¹æ³•ã€‚</li><li><strong>delitem</strong>(self, key):å½“éœ€è¦æ‰§è¡Œ del self[key]æ—¶ï¼Œéœ€è¦è°ƒç”¨è¯¥æ–¹æ³•ï¼›</li><li><strong>iter</strong>(self):å½“å®¹å™¨å¯ä»¥æ‰§è¡Œ for x in container: ï¼Œæˆ–è€…ä½¿ç”¨iter(container)æ—¶ï¼Œéœ€è¦å®šä¹‰è¯¥æ–¹æ³•</li><li><strong>reversed</strong>(self):å®ç°å½“reversed()è¢«è°ƒç”¨æ—¶çš„è¡Œä¸ºã€‚åº”è¯¥è¿”å›åºåˆ—åè½¬åçš„ç‰ˆæœ¬ã€‚ä»…å½“åºåˆ—å¯ä»¥æ˜¯æœ‰åºçš„æ—¶å€™å®ç°å®ƒï¼Œä¾‹å¦‚å¯¹äºåˆ—è¡¨æˆ–è€…å…ƒç»„ã€‚</li><li><strong>contains</strong>(self, item)ï¼šå®šä¹‰äº†è°ƒç”¨inå’Œnot inæ¥æµ‹è¯•æˆå‘˜æ˜¯å¦å­˜åœ¨çš„æ—¶å€™æ‰€äº§ç”Ÿçš„è¡Œä¸ºã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python">Card = collections.namedtuple(<span class="hljs-string">&quot;Card&quot;</span>, [<span class="hljs-string">&quot;rank&quot;</span>, <span class="hljs-string">&quot;suit&quot;</span>])<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FrenchDeck</span>:<br>    ranks = [<span class="hljs-built_in">str</span>(n) <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, <span class="hljs-number">11</span>)] + <span class="hljs-built_in">list</span>(<span class="hljs-string">&quot;JQKA&quot;</span>)<br>    suits = <span class="hljs-string">&quot;spades diamonds clubs hearts&quot;</span>.split()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, cards: <span class="hljs-built_in">list</span>[Card] = <span class="hljs-literal">None</span></span>):<br>        <span class="hljs-keyword">if</span> cards <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            self._cards = cards<br>            <span class="hljs-keyword">return</span><br>        self._cards = [Card(rank, suit) <span class="hljs-keyword">for</span> suit <span class="hljs-keyword">in</span> self.suits <span class="hljs-keyword">for</span> rank <span class="hljs-keyword">in</span> self.ranks]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__len__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># é›†åˆç›¸å…³æ“ä½œï¼Œè¿”å›é›†åˆçš„é•¿åº¦len(FrenchDeck())</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è°ƒç”¨__len__æ–¹æ³•è·å–é›†åˆçš„é•¿åº¦&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">len</span>(self._cards)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, position</span>):<br>        <span class="hljs-comment"># ä»…ä»…å®ç°äº† __getitem__ æ–¹æ³•ï¼Œè¿™ä¸€æ‘ç‰Œå°±å˜æˆå¯è¿­ä»£çš„äº†</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è°ƒç”¨__getitem__æ–¹æ³•è¿”å›æ”¹ç´¢å¼•æˆ–è€…åˆ‡ç‰‡ä½ç½®çš„æ•°æ®&quot;</span>)<br>        <span class="hljs-keyword">return</span> self._cards[position]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setitem__</span>(<span class="hljs-params">self, position, value</span>):<br>        <span class="hljs-comment"># é€šè¿‡obj[key]=valueå»ä¿®æ”¹å®¹å™¨å†…çš„å¯¹è±¡</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è°ƒç”¨__setitem__æ–¹æ³•è®¾ç½®ç´¢å¼•æˆ–è€…åˆ‡ç‰‡ä½ç½®<span class="hljs-subst">&#123;position&#125;</span>çš„æ•°æ®ä¸º<span class="hljs-subst">&#123;value&#125;</span>&quot;</span>)<br>        self._cards[position] = value<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delitem__</span>(<span class="hljs-params">self, position</span>):<br>        <span class="hljs-comment"># é€šè¿‡del obj[key]æ¥åˆ é™¤å®¹å™¨å†…çš„å¯¹è±¡</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è°ƒç”¨__getitem__æ–¹æ³•åˆ é™¤ç´¢å¼•æˆ–è€…åˆ‡ç‰‡ä½ç½®<span class="hljs-subst">&#123;position&#125;</span>çš„æ•°æ®&quot;</span>)<br>        <span class="hljs-keyword">del</span> self._cards[position]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># é€šè¿‡for å¾ªç¯æ¥éå†å®¹å™¨</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è°ƒç”¨__iter__æ–¹æ³•è¿­ä»£æ•°æ®&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">iter</span>(self._cards)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__reversed__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># é€šè¿‡reverse(obj)æ¥åè½¬å®¹å™¨å†…çš„å¯¹è±¡</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è°ƒç”¨___reversed__æ–¹æ³•ç¿»è½¬å†…éƒ¨cards&quot;</span>)<br>        <span class="hljs-keyword">return</span> FrenchDeck(<span class="hljs-built_in">reversed</span>(self._cards))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__contains__</span>(<span class="hljs-params">self, item</span>):  <br>        <span class="hljs-comment"># é€šè¿‡ item in objæ¥åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨å®¹å™¨å†…</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è°ƒç”¨__contains__æ–¹æ³•ç¿»è½¬åˆ¤æ–­æ˜¯å¦åŒ…å«&quot;</span>)<br>        <span class="hljs-keyword">return</span> item <span class="hljs-keyword">in</span> self._cards<br><br><br>frenchDeck = FrenchDeck()<br><span class="hljs-keyword">for</span> card <span class="hljs-keyword">in</span> frenchDeck:<br>    <span class="hljs-built_in">print</span>(card)<br><span class="hljs-built_in">print</span>(frenchDeck[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(frenchDeck[<span class="hljs-number">1</span>::<span class="hljs-number">2</span>])<br>spades2 = Card(rank=<span class="hljs-string">&#x27;12&#x27;</span>, suit=<span class="hljs-string">&#x27;spades&#x27;</span>)<br><span class="hljs-built_in">print</span>(spades2 <span class="hljs-keyword">in</span> frenchDeck)<br></code></pre></td></tr></table></figure></li></ul><h2 id="ç±»çš„è¡¨ç¤º"><a href="#ç±»çš„è¡¨ç¤º" class="headerlink" title="ç±»çš„è¡¨ç¤º"></a>ç±»çš„è¡¨ç¤º</h2><p>ç±»çš„è¡¨ç¤ºç›¸å…³çš„é­”æ³•æ–¹æ³•ä¸»è¦æœ‰__str__ã€<strong>repr__å’Œ__bool</strong></p><ul><li>__str__ä¸»è¦æ˜¯åœ¨æ‰“å°å¯¹è±¡print(obj)æ—¶ï¼Œä¼šéšå¼è°ƒç”¨str(obj)ï¼Œå³è°ƒç”¨ç±»ä¸­çš„__str__æ–¹æ³•ï¼›å®šäº†è¯¥æ–¹æ³•å°±å¯ä»¥é€šè¿‡str(obj)æ¥è°ƒç”¨ï¼›</li><li>__repr__ä¸»è¦å¼åœ¨ç›´æ¥è¾“å‡ºå¯¹è±¡æ—¶çš„æ˜¾ç¤ºï¼Œä¼šè°ƒç”¨__repr__æ–¹æ³•ï¼›å®šä¹‰äº†è¯¥æ–¹æ³•å°±å¯ä»¥é€šè¿‡repr(obj)æ¥è°ƒç”¨ã€‚</li><li>__bool__ä¸»è¦è¡¨ç¤ºå¯¹è±¡ä½œä¸ºåˆ¤æ–­æ¡ä»¶æ—¶å€™åæ˜ çš„ç»“æœ<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        self.name = name<br>        self.age = age<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è°ƒç”¨äº†æ–¹æ³•__str__&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;name=<span class="hljs-subst">&#123;self.name&#125;</span>,age=<span class="hljs-subst">&#123;self.age&#125;</span>&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__repr__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è°ƒç”¨äº†æ–¹æ³•__repr__&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;cls=<span class="hljs-subst">&#123;self.__class__.__name__&#125;</span>,id=<span class="hljs-subst">&#123;<span class="hljs-built_in">id</span>(self)&#125;</span>&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__bool__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">bool</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è°ƒç”¨äº†æ–¹æ³•__bool__&quot;</span>)<br>        <span class="hljs-keyword">if</span> self.name <span class="hljs-keyword">and</span> self.age &gt; <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br>user = User(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-number">23</span>)<br><span class="hljs-built_in">print</span>(user)<br>user<br><span class="hljs-keyword">if</span> user:<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="å¯è°ƒç”¨å¯¹è±¡"><a href="#å¯è°ƒç”¨å¯¹è±¡" class="headerlink" title="å¯è°ƒç”¨å¯¹è±¡"></a>å¯è°ƒç”¨å¯¹è±¡</h2><p>æ–¹æ³•ä¹Ÿæ˜¯ä¸€ç§é«˜ç­‰çš„å¯¹è±¡ã€‚é€šè¿‡å¯¹å¯¹è±¡å®ç°__call__å°±å¯ä»¥å®ç°åƒè°ƒç”¨æ–¹æ³•ä¸€æ ·å»è°ƒç”¨ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        self.name = name<br>        self.age = age<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self, *args: <span class="hljs-type">Any</span>, **kwds: <span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-type">Any</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è°ƒç”¨æ–¹æ³•__call__,args=<span class="hljs-subst">&#123;args&#125;</span>,kwds=<span class="hljs-subst">&#123;kwds&#125;</span>&quot;</span>)<br><br><br>user = User(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-number">23</span>)<br><span class="hljs-comment"># è°ƒç”¨æ–¹æ³•__call__,args=(&#x27;1&#x27;,),kwds=&#123;&#x27;a&#x27;: &#x27;a&#x27;&#125;</span><br>user(<span class="hljs-string">&quot;1&quot;</span>, a=<span class="hljs-string">&quot;a&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨åœºæ™¯ï¼Œé€šè¿‡__call__æ–¹æ³•åšè£…é¥°å™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,func</span>):<br>        self.func=func<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;this is call&#x27;</span>)<br>        <span class="hljs-keyword">return</span> self.func()<br><span class="hljs-comment"># è¯­æ³•ç³–ï¼Œç›¸å½“äºA(f)        </span><br><span class="hljs-meta">@A   </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hhh&#x27;</span>)<br>f()<br><span class="hljs-comment"># this is call</span><br><span class="hljs-comment"># hhh</span><br></code></pre></td></tr></table></figure><h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h2><p>pythonä¸­æœ‰ä¸€ä¸ªpickleæ¨¡å—æ¥å¯¹å®ä¾‹åŒ–å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼›å¦‚pickle.loads(obj),pickle.dumps(obj)ç­‰ï¼›åœ¨åºåˆ—åŒ–çš„æ—¶å€™ä¹Ÿæ˜¯è°ƒç”¨çš„å†…ç½®é­”æ³•æ–¹æ³•ï¼š</p><ul><li><strong>getstate</strong>():ç”¨äºPython å¯¹è±¡çš„åºåˆ—åŒ–,æŒ‡å®šåœ¨åºåˆ—åŒ–æ—¶å°†å“ªäº›ä¿¡æ¯è®°å½•ä¸‹æ¥</li><li><strong>setstate</strong>()ï¼šç”¨äºPython å¯¹è±¡çš„ååºåˆ—åŒ–,æŒ‡å®šåœ¨ååºåˆ—åŒ–æ—¶æŒ‡æ˜å¦‚ä½•åˆ©ç”¨ä¿¡æ¯<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        self.name = name<br>        self.age = age<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getstate__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è°ƒç”¨æ–¹æ³•__getstate__&quot;</span>)<br>        <span class="hljs-comment"># åºåˆ—åŒ–æ—¶è¿”å›çš„ï¼Œå³ä¸ºåœ¨ååºåˆ—åŒ–æ—¶ä¼ å…¥çš„state</span><br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;name&quot;</span>: self.name, <span class="hljs-string">&quot;age&quot;</span>: self.age&#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setstate__</span>(<span class="hljs-params">self, state</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è°ƒç”¨æ–¹æ³•__setstate__&quot;</span>)<br>        self.name = state[<span class="hljs-string">&quot;name&quot;</span>]<br>        self.age = <span class="hljs-number">300</span><br><br>user = User(<span class="hljs-string">&quot;zs&quot;</span>,<span class="hljs-string">&quot;23&quot;</span>)<br><span class="hljs-keyword">import</span> pickle<br>ser = pickle.dumps(user)<br>user1 = pickle.loads(ser)<br><span class="hljs-built_in">print</span>(user1.age)<br></code></pre></td></tr></table></figure></li></ul><h2 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h2><p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶æ€ä¹ˆä½¿ç”¨å†…ç½®åœ¨å‡½æ•°isinstance()å’Œissubclass()æ–¹æ³• åå°„å®šä¹‰é­”æœ¯æ–¹æ³•. è¿™ä¸ªé­”æœ¯æ–¹æ³•æ˜¯:</p><p><strong>instancecheck</strong>(self, instance)<br><strong>subclasscheck</strong>(self, subclass)</p><h2 id="æ¯”è¾ƒè¿ç®—"><a href="#æ¯”è¾ƒè¿ç®—" class="headerlink" title="æ¯”è¾ƒè¿ç®—"></a>æ¯”è¾ƒè¿ç®—</h2><p>é€šè¿‡å®šä¹‰å„ç±»æ¯”è¾ƒã€è¿ç®—ã€ç±»å‹ç›¸å…³çš„é­”æ³•æ–¹æ³•ï¼Œæ¥å®ç°å¯¹è±¡ä¹‹é—´çš„å„ç±»æ¯”è¾ƒã€è¿ç®—ç­‰æ“ä½œã€‚è¿™ç±»é­”æ³•æ–¹æ³•éå¸¸å¤šï¼Œä¸ä¸€ä¸€å±•å¼€ï¼Œæ¯”å¦‚__eq__ é­”æ³•æ–¹æ³•ï¼Œå¦‚æœè‡ªå®šä¹‰çš„å¯¹è±¡è¦å®ç°&#x3D;&#x3D;çš„æ¯”è¾ƒåŠŸèƒ½ï¼Œåˆ™å¿…é¡»åœ¨ç±»ä¸­å®ç°__eq__ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Vector</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, x: <span class="hljs-built_in">str</span>, y: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        self.x = x<br>        self.y = y<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__repr__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Vector(%r, %r)&quot;</span> % (self.x, self.y)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__bool__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">bool</span>(self.x <span class="hljs-keyword">or</span> self.y)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__add__</span>(<span class="hljs-params">self, other: <span class="hljs-string">&quot;Vector&quot;</span></span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŠ æ³•ï¼š__add__&quot;</span>)<br>        <span class="hljs-keyword">return</span> Vector(self.x + other.x, self.y + other.y)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__sub__</span>(<span class="hljs-params">self, other: <span class="hljs-string">&quot;Vector&quot;</span></span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å‡æ³•ï¼š__sub__&quot;</span>)<br>        <span class="hljs-keyword">return</span> Vector(self.x - other.x, self.y - other.y)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__abs__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç»å¯¹å€¼ï¼š__abs__&quot;</span>)<br>        <span class="hljs-keyword">return</span> hypot(self.x, self.y)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__mul__</span>(<span class="hljs-params">self, scalar</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ä¹˜æ³•ï¼š__mul__&quot;</span>)<br>        <span class="hljs-keyword">return</span> Vector(self.x * scalar, self.y * scalar)<br><br><br>v1 = Vector(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)<br>v2 = Vector(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>)<br>v2 - v1<br>v2 + v1<br>v2 * <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç»ƒä¹ </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java Flight Recorder</title>
    <link href="/2022/08/25/JFR/"/>
    <url>/2022/08/25/JFR/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Java Flight Recorder (JFR) æ˜¯ä¸€ç§ç”¨äºæ”¶é›†ã€è¯Šæ–­å’Œåˆ†ææœ‰å…³æ­£åœ¨è¿è¡Œçš„ Java åº”ç”¨ç¨‹åºçš„æ•°æ®çš„å·¥å…·ã€‚å®ƒé›†æˆåˆ°Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­ï¼Œå‡ ä¹ä¸ä¼šé€ æˆæ€§èƒ½å¼€é”€ï¼Œå› æ­¤å³ä½¿åœ¨è´Ÿè½½è¾ƒé‡çš„ç”Ÿäº§ç¯å¢ƒä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ä½¿ç”¨é»˜è®¤è®¾ç½®æ—¶ï¼Œæ€§èƒ½å½±å“ä¸åˆ°ç™¾åˆ†ä¹‹ä¸€ã€‚å¯¹äºæŸäº›åº”ç”¨ç¨‹åºï¼Œå®ƒå¯èƒ½ä¼šä½å¾—å¤šã€‚ä½†æ˜¯ï¼Œå¯¹äºçŸ­æ—¶é—´è¿è¡Œçš„åº”ç”¨ç¨‹åºï¼ˆä¸æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºç±»å‹ï¼‰ï¼Œç›¸å¯¹å¯åŠ¨å’Œé¢„çƒ­æ—¶é—´å¯èƒ½ä¼šæ›´é•¿ï¼Œè¿™å¯èƒ½ä¼šå½±å“æ€§èƒ½è¶…è¿‡ 1%ã€‚JFR æ”¶é›†æœ‰å…³ JVM ä»¥åŠåœ¨å…¶ä¸Šè¿è¡Œçš„ Java åº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚</p></blockquote><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œé»‘åŒ£å­æ˜¯ç”¨äºè®°å½•é£æœºé£è¡Œå’Œæ€§èƒ½å‚æ•°çš„ä»ªå™¨ã€‚åœ¨é£æœºå‡ºé—®é¢˜åï¼Œç”¨äºå®šä½é—®é¢˜åŸå› ã€‚JFR å°±æ˜¯ Java çš„é»‘åŒ£å­ã€‚</p><p>JFR æ˜¯ Java Flight Record ï¼ˆJavaé£è¡Œè®°å½•ï¼‰ çš„ç¼©å†™ï¼Œæ˜¯ JVM å†…ç½®çš„åŸºäºäº‹ä»¶çš„JDKç›‘æ§è®°å½•æ¡†æ¶ã€‚è¿™ä¸ªèµ·åå°±æ˜¯å‚è€ƒäº†é»‘åŒ£å­å¯¹äºé£æœºçš„ä½œç”¨ï¼Œå°†Javaè¿›ç¨‹æ¯”å–»æˆé£æœºé£è¡Œã€‚é¡¾åæ€ä¹‰è¿™ä¸ªè®°å½•ä¸»è¦ç”¨äºé—®é¢˜å®šä½å’ŒæŒç»­ç›‘æ§ã€‚æœ€ä¸»è¦çš„æ˜¯å®ƒä»<code>JDK11</code>å¼€å§‹ä¸å†éœ€è¦å•†ä¸šè®¸å¯ï¼Œåªè¦æ˜¯Hotspotçš„jdkéƒ½å¯ä»¥ä½¿ç”¨ã€‚</p><h3 id="JFRçš„ä¼˜ç‚¹"><a href="#JFRçš„ä¼˜ç‚¹" class="headerlink" title="JFRçš„ä¼˜ç‚¹"></a>JFRçš„ä¼˜ç‚¹</h3><ul><li><p>æä¾›æ›´å¥½çš„æ•°æ®ï¼š JFR ä»è¿è¡Œæ—¶çš„å„ä¸ªéƒ¨åˆ†æ•è·æ•°æ®ï¼Œå¹¶ä»˜å‡ºäº†å·¨å¤§çš„åŠªåŠ›æ¥ç¡®ä¿æ•è·çš„æ•°æ®ä»£è¡¨ç³»ç»Ÿçš„çœŸå®çŠ¶æ€ã€‚è¿™ç§åŠªåŠ›çš„ä¾‹å­åŒ…æ‹¬æœ€å¤§é™åº¦åœ°å‡å°‘è§‚å¯Ÿè€…æ•ˆåº”ï¼Œä»¥åŠèƒ½å¤Ÿåœ¨å®‰å…¨ç‚¹ä¹‹å¤–æ•è·æ ·æœ¬ã€‚</p></li><li><p>æä¾›æ›´å¥½çš„æ•°æ®æ¨¡å‹ï¼šæ•°æ®æ¨¡å‹æ˜¯è‡ªæè¿°çš„ã€‚å½•éŸ³æ— è®ºå¤§å°ï¼Œéƒ½åŒ…å«ç†è§£æ•°æ®æ‰€éœ€çš„ä¸€åˆ‡ã€‚</p></li><li><p>æä¾›æ›´å¥½çš„æ€§èƒ½ï¼šé£è¡Œè®°å½•ä»ªå¼•æ“æœ¬èº«é’ˆå¯¹æ€§èƒ½è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¸ä¼šå¯¹åº”ç”¨çš„æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚ä¸€äº›æ•°æ®å®é™…ä¸Šå¯ä»¥å…è´¹è·å¾—ï¼Œå› ä¸ºå®ƒå·²ç»è¢«è¿è¡Œæ—¶æ•è·ã€‚</p></li><li><p>å…è®¸ç¬¬ä¸‰æ–¹äº‹ä»¶æä¾›ç¨‹åºï¼šä¸€ç»„ API ä½¿ JFR èƒ½å¤Ÿä»ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼ˆåŒ…æ‹¬ WebLogic Server å’Œå…¶ä»– Oracle äº§å“ï¼‰æ•è·æ•°æ®ã€‚</p></li><li><p>é™ä½æ€»ä½“æ‹¥æœ‰æˆæœ¬ï¼š JFR ä½¿æˆ‘ä»¬èƒ½å¤Ÿå‡å°‘è¯Šæ–­å’Œæ’é™¤é—®é¢˜çš„æ—¶é—´ï¼Œå‡å°‘è¿è¥æˆæœ¬å’Œä¸šåŠ¡ä¸­æ–­ï¼Œåœ¨å‡ºç°é—®é¢˜æ—¶æä¾›æ›´å¿«çš„è§£å†³æ—¶é—´ï¼Œå¹¶æé«˜ç³»ç»Ÿæ•ˆç‡ã€‚</p></li></ul><h3 id="JFRåŸç†"><a href="#JFRåŸç†" class="headerlink" title="JFRåŸç†"></a>JFRåŸç†</h3><h4 id="äº‹ä»¶"><a href="#äº‹ä»¶" class="headerlink" title="äº‹ä»¶"></a>äº‹ä»¶</h4><p>Java Flight Recorder æ”¶é›†æœ‰å…³äº‹ä»¶çš„æ•°æ®ã€‚äº‹ä»¶åœ¨ç‰¹å®šæ—¶é—´ç‚¹å‘ç”Ÿåœ¨ JVM æˆ– Java åº”ç”¨ç¨‹åºä¸­ã€‚æ¯ä¸ªäº‹ä»¶éƒ½æœ‰ä¸€ä¸ªåç§°ã€ä¸€ä¸ªæ—¶é—´æˆ³å’Œä¸€ä¸ªå¯é€‰çš„æœ‰æ•ˆè´Ÿè½½ã€‚è´Ÿè½½æ˜¯ä¸äº‹ä»¶ç›¸å…³çš„æ•°æ®ï¼Œä¾‹å¦‚CPUä½¿ç”¨ç‡ã€äº‹ä»¶å‰åçš„Javaå †å¤§å°ã€é”æŒæœ‰è€…çš„çº¿ç¨‹IDç­‰ã€‚</p><p>å¤§å¤šæ•°äº‹ä»¶è¿˜åŒ…å«æœ‰å…³äº‹ä»¶å‘ç”Ÿçš„çº¿ç¨‹ã€äº‹ä»¶å‘ç”Ÿæ—¶çš„å †æ ˆè·Ÿè¸ªä»¥åŠäº‹ä»¶æŒç»­æ—¶é—´çš„ä¿¡æ¯ã€‚ä½¿ç”¨äº‹ä»¶ä¸­å¯ç”¨çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡å»º JVM å’Œ Java åº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶è¯¦ç»†ä¿¡æ¯ã€‚</p><p>JFR æ”¶é›†æœ‰å…³ä¸‰ç±»äº‹ä»¶çš„ä¿¡æ¯ï¼š</p><p>æŒç»­æ—¶é—´äº‹ä»¶éœ€è¦ä¸€äº›æ—¶é—´æ‰èƒ½å‘ç”Ÿï¼Œå¹¶åœ¨å®Œæˆæ—¶è®°å½•ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®æŒç»­æ—¶é—´äº‹ä»¶çš„é˜ˆå€¼ï¼Œä»¥ä¾¿ä»…è®°å½•æŒç»­æ—¶é—´è¶…è¿‡æŒ‡å®šæ—¶é—´æ®µçš„äº‹ä»¶ã€‚è¿™å¯¹äºå…¶ä»–ç±»å‹çš„äº‹ä»¶æ˜¯ä¸å¯èƒ½çš„ã€‚å³æ—¶äº‹ä»¶ç«‹å³å‘ç”Ÿï¼Œå¹¶ç«‹å³è®°å½•ã€‚</p><p>å®šæœŸè®°å½•æ ·æœ¬äº‹ä»¶ï¼ˆä¹Ÿç§°ä¸ºå¯è¯·æ±‚äº‹ä»¶ï¼‰ï¼Œä»¥æä¾›ç³»ç»Ÿæ´»åŠ¨çš„æ ·æœ¬ã€‚æˆ‘ä»¬å¯ä»¥é…ç½®é‡‡æ ·å‘ç”Ÿçš„é¢‘ç‡ã€‚</p><p>JFR ä»¥æé«˜çš„ç»†èŠ‚æ°´å¹³ç›‘æ§è¿è¡Œç³»ç»Ÿã€‚è¿™ä¼šäº§ç”Ÿå¤§é‡æ•°æ®ã€‚ä¸ºäº†ä½¿å¼€é”€å°½å¯èƒ½ä½ï¼Œè¯·å°†è®°å½•äº‹ä»¶çš„ç±»å‹é™åˆ¶ä¸ºæˆ‘ä»¬å®é™…éœ€è¦çš„ç±»å‹ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒæŒç»­æ—¶é—´éå¸¸çŸ­çš„äº‹ä»¶æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› æ­¤å°†è®°å½•é™åˆ¶ä¸ºæŒç»­æ—¶é—´è¶…è¿‡æŸä¸ªæœ‰æ„ä¹‰é˜ˆå€¼çš„äº‹ä»¶ã€‚</p><h4 id="äº‹ä»¶æµï¼ˆk8sç›‘æ§ç‰¹åˆ«é€‚åˆï¼‰"><a href="#äº‹ä»¶æµï¼ˆk8sç›‘æ§ç‰¹åˆ«é€‚åˆï¼‰" class="headerlink" title="äº‹ä»¶æµï¼ˆk8sç›‘æ§ç‰¹åˆ«é€‚åˆï¼‰"></a>äº‹ä»¶æµï¼ˆk8sç›‘æ§ç‰¹åˆ«é€‚åˆï¼‰</h4><p>JFR ä» JVMï¼ˆé€šè¿‡å†…éƒ¨ APIï¼‰å’Œ Java åº”ç”¨ç¨‹åºï¼ˆé€šè¿‡ JFR APIï¼‰æ”¶é›†æ•°æ®ã€‚è¯¥æ•°æ®å­˜å‚¨åœ¨å°å‹çº¿ç¨‹æœ¬åœ°ç¼“å†²åŒºä¸­ï¼Œè¿™äº›ç¼“å†²åŒºä¼šåˆ·æ–°åˆ°å…¨å±€å†…å­˜ç¼“å†²åŒºä¸­ã€‚ç„¶åå…¨å±€å†…å­˜ç¼“å†²åŒºä¸­çš„æ•°æ®è¢«å†™å…¥ç£ç›˜ã€‚ç£ç›˜å†™å…¥æ“ä½œçš„æˆæœ¬å¾ˆé«˜ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥é€šè¿‡ä»”ç»†é€‰æ‹©å¯ç”¨è®°å½•çš„äº‹ä»¶æ•°æ®æ¥å°½é‡å‡å°‘ç£ç›˜å†™å…¥æ“ä½œã€‚äºŒè¿›åˆ¶è®°å½•æ–‡ä»¶çš„æ ¼å¼éå¸¸ç´§å‡‘ï¼Œå¹¶ä¸”å¯¹äºåº”ç”¨ç¨‹åºçš„è¯»å†™æ¥è¯´éå¸¸é«˜æ•ˆã€‚æ¯ä¸ªç¼“å†²åŒºä¹‹é—´æ²¡æœ‰ä¿¡æ¯é‡å ã€‚ç‰¹å®šçš„æ•°æ®å—å¯ä»¥åœ¨å†…å­˜æˆ–ç£ç›˜ä¸Šä½¿ç”¨ï¼Œä½†ä¸èƒ½åŒæ—¶åœ¨ä¸¤ä¸ªåœ°æ–¹ä½¿ç”¨ã€‚è¿™å…·æœ‰ä»¥ä¸‹å«ä¹‰ï¼š<br>å¦‚æœå‘ç”Ÿç”µæºæ•…éšœï¼Œå°šæœªåˆ·æ–°åˆ°ç£ç›˜ç¼“å†²åŒºçš„æ•°æ®å°†ä¸å¯ç”¨ã€‚</p><p>JVM å´©æºƒå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ•°æ®åœ¨æ ¸å¿ƒæ–‡ä»¶ï¼ˆå³å†…å­˜ç¼“å†²åŒºï¼‰ä¸­å¯ç”¨ï¼Œè€Œå¦ä¸€äº›æ•°æ®åˆ™åœ¨ç£ç›˜ç¼“å†²åŒºä¸­å¯ç”¨ã€‚JFR ä¸æä¾›åˆå¹¶æ­¤ç±»ç¼“å†²åŒºçš„åŠŸèƒ½ã€‚</p><p>åœ¨ JFR æ”¶é›†çš„æ•°æ®åœ¨æˆ‘ä»¬ä½¿ç”¨ä¹‹å‰ï¼Œå¯èƒ½ä¼šæœ‰ä¸€å°æ®µå»¶è¿Ÿï¼ˆä¾‹å¦‚ï¼Œå¿…é¡»å°†å…¶ç§»åŠ¨åˆ°ä¸åŒçš„ç¼“å†²åŒºæ‰èƒ½ä½¿å…¶å¯è§ï¼Œè®°å½•æ–‡ä»¶ä¸­çš„æ•°æ®å¯èƒ½ä¸æŒ‰æ—¶é—´é¡ºåºæ’åˆ—ï¼Œå› ä¸ºæ•°æ®æ˜¯ä»å¤šä¸ªçº¿ç¨‹ç¼“å†²åŒºä»¥å—çš„å½¢å¼æ”¶é›†çš„ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒJVM ä¼šåˆ é™¤äº‹ä»¶é¡ºåºä»¥ç¡®ä¿å®ƒä¸ä¼šå´©æºƒã€‚ä»»ä½•æ— æ³•è¶³å¤Ÿå¿«åœ°å†™å…¥ç£ç›˜çš„æ•°æ®éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œè®°å½•æ–‡ä»¶å°†åŒ…å«å—å½±å“æ—¶é—´æ®µçš„ä¿¡æ¯ã€‚æ­¤ä¿¡æ¯è¿˜å°†è®°å½•åˆ° JVM çš„æ—¥å¿—è®°å½•å·¥å…·ä¸­ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°† JFR é…ç½®ä¸ºä¸å°†ä»»ä½•æ•°æ®å†™å…¥ç£ç›˜ã€‚åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œå…¨å±€ç¼“å†²åŒºå……å½“å¾ªç¯ç¼“å†²åŒºï¼Œå½“ç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œæœ€æ—§çš„æ•°æ®å°†è¢«ä¸¢å¼ƒã€‚è¿™ç§å¼€é”€éå¸¸ä½çš„æ“ä½œæ¨¡å¼ä»ç„¶å¯ä»¥æ”¶é›†æ ¹æœ¬åŸå› é—®é¢˜åˆ†ææ‰€éœ€çš„æ‰€æœ‰é‡è¦æ•°æ®ã€‚ç”±äºæœ€æ–°æ•°æ®å§‹ç»ˆåœ¨å…¨å±€ç¼“å†²åŒºä¸­å¯ç”¨ï¼Œå› æ­¤åªè¦æ“ä½œæˆ–ç›‘è§†ç³»ç»Ÿæ£€æµ‹åˆ°é—®é¢˜ï¼Œå°±å¯ä»¥æŒ‰éœ€å°†å…¶å†™å…¥ç£ç›˜ã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œåªæœ‰æœ€åå‡ åˆ†é’Ÿçš„æ•°æ®å¯ç”¨ï¼Œå› æ­¤å®ƒåªåŒ…å«æœ€è¿‘çš„äº‹ä»¶ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦è·å–é•¿æ—¶é—´å†…çš„å®Œæ•´æ“ä½œå†å²è®°å½•ï¼Œåœ¨å®šæœŸå°†äº‹ä»¶å†™å…¥ç£ç›˜æ—¶ä½¿ç”¨é»˜è®¤æ¨¡å¼ã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>æˆ‘ä»¬ä½¿ç”¨å®ƒå¯ä»¥åœ¨å¯åŠ¨çš„æ—¶å€™é€šè¿‡jvmå‚æ•°æŒ‡å®šï¼Œä¹Ÿå¯ä»¥å¯¹å·²ç»å¯åŠ¨çš„åº”ç”¨é€šè¿‡jcmdå¯åŠ¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡jmcçš„é¡µé¢é…ç½®</p><h4 id="jvm-å‚æ•°æŒ‡å®š"><a href="#jvm-å‚æ•°æŒ‡å®š" class="headerlink" title="jvm å‚æ•°æŒ‡å®š"></a>jvm å‚æ•°æŒ‡å®š</h4><ul><li><p>idea å¯åŠ¨æ—¶å€™æˆ‘ä»¬å¢åŠ å¦‚ä¸‹å‚æ•°<br>-XX:+FlightRecorder å¯åŠ¨jfr<br>-XX:StartFlightRecording&#x3D;delay&#x3D;20s,duration&#x3D;60s,filename&#x3D;my.jfr è¡¨ç¤ºå¯åŠ¨åº”ç”¨ä¹‹åå»¶è¿Ÿ20sï¼Œå¼€å§‹è®°å½•JFRä¿¡æ¯60ç§’ï¼Œæ•°æ®ä¿å­˜åœ¨my.jfrä¸­</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">-<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:+FlightRecorder</span> -<span class="hljs-variable constant_">XX</span><span class="hljs-symbol">:StartFlightRecording=delay=</span>20s,duration=60s,filename=my.jfr<br></code></pre></td></tr></table></figure></li><li><p>å¸¸ç”¨å‚æ•°ï¼š<br>name&#x3D;name æŒ‡å®šè®°å½•çš„åç§°<br>dumponexit&#x3D;true&#x2F;false JVMæ¨å‡ºæ—¶æ˜¯å¦è®°å½•äº‹ä»¶ï¼Œé»˜è®¤ä¸º false<br>settings&#x3D;path JFR é…ç½®æ–‡ä»¶çš„è·¯å¾„<br>delay&#x3D;time å¼€å§‹è®°å½•å‰çš„å»¶æ—¶<br>duration&#x3D;time è®°å½•æŒç»­æ—¶é—´<br>filename&#x3D;path ä¿å­˜è®°å½•äº‹ä»¶çš„æ–‡ä»¶è·¯å¾„<br>compress&#x3D;true&#x2F;false æ˜¯å¦ä½¿ç”¨ gzip å‹ç¼©è®°å½•æ•°æ®ï¼Œé»˜è®¤ä¸º false<br>maxage&#x3D;time ç¯å½¢ç¼“å­˜ä¸­ä¿å­˜è®°å½•çš„æ•°æ®çš„æœ€é•¿æ—¶é—´<br>maxsize&#x3D;size ç¯å½¢ç¼“å­˜å ç”¨çš„æœ€å¤§ç©ºé—´</p></li><li><p>ideaæ§åˆ¶å°å¯åŠ¨æ—¶å€™è¾“å‡ºå¦‚ä¸‹æ—¥å¿—ï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs inform7"><span class="hljs-comment">[0.198s]</span><span class="hljs-comment">[info]</span><span class="hljs-comment">[jfr,startup]</span> Started recording 1. The result will be written to:<br><span class="hljs-comment">[0.198s]</span><span class="hljs-comment">[info]</span><span class="hljs-comment">[jfr,startup]</span> <br><span class="hljs-comment">[0.198s]</span><span class="hljs-comment">[info]</span><span class="hljs-comment">[jfr,startup]</span> /Users/suaofeng/IdeaProjects/spring-boot-starter/my.jfr<br></code></pre></td></tr></table></figure></li></ul><h4 id="jcmdå¯åŠ¨"><a href="#jcmdå¯åŠ¨" class="headerlink" title="jcmdå¯åŠ¨"></a>jcmdå¯åŠ¨</h4><p>è¿™ç§æ˜¯å¯ä»¥åœ¨ä»»æ„æƒ…å†µä¸‹ä½¿ç”¨çš„ï¼Œå³ä½¿ä½ å¿˜è®°äº†å¯åŠ¨æ—¶å¯åŠ¨jfrï¼Œé€šè¿‡å®ƒä¾æ—§å¯ä»¥ç»™è¿›ç¨‹æ·»åŠ ä¸€ä¸ªè®°å½•å™¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">âœ  spring-boot-starter git:(master) âœ— jps -l<br>57122 org.jetbrains.jps.cmdline.Launcher<br>57123 sample.mybatis.web.SampleWebApplication<br>94082 <br>55349 <br>56230 org.jetbrains.idea.maven.server.RemoteMavenServer36<br>57133 jdk.jcmd/sun.tools.jps.Jps<br>âœ  spring-boot-starter git:(master) âœ— jcmd 57123 JFR.start name=jfr-test1 disk=true dumponexit=true filename=my2.jfr maxage=2m maxsize=128M <br>57123:<br>Started recording 2.<br><br>Use jcmd 57123 JFR.dump name=jfr-test1 to copy recording data to file.<br>âœ  spring-boot-starter git:(master) âœ— jcmd 57123 JFR.check                                                                                  <br>57123:<br>Recording 2: name=jfr-test1 maxsize=128.0MB maxage=2m (running)<br>âœ  spring-boot-starter git:(master) âœ— jcmd 57123 JFR.stop name=jfr-test1                                                                    <br>57123:<br>Stopped recording &quot;jfr-test1&quot;.<br></code></pre></td></tr></table></figure><h4 id="jmcå¯åŠ¨"><a href="#jmcå¯åŠ¨" class="headerlink" title="jmcå¯åŠ¨"></a>jmcå¯åŠ¨</h4><h4 id="Java-Mission-Controlåˆ†æ"><a href="#Java-Mission-Controlåˆ†æ" class="headerlink" title="Java Mission Controlåˆ†æ"></a><a href="https://jdk.java.net/jmc/8/">Java Mission Controlåˆ†æ</a></h4><h3 id="æ‰©å±•JFRäº‹ä»¶"><a href="#æ‰©å±•JFRäº‹ä»¶" class="headerlink" title="æ‰©å±•JFRäº‹ä»¶"></a>æ‰©å±•JFRäº‹ä»¶</h3><p>ç»§æ‰¿jdk.jfr.Eventè‡ªå®šä¹‰äº‹ä»¶:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> &#123;<br><br>  <span class="hljs-meta">@Label(&quot;Hello World&quot;)</span><br>  <span class="hljs-meta">@Description(&quot;Helps programmer getting started&quot;)</span><br>  <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Event</span> &#123;<br>      <span class="hljs-meta">@Label(&quot;Message&quot;)</span><br>      String message;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String... args)</span> &#123;<br>      <span class="hljs-type">HelloWorld</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HelloWorld</span>();<br>      event.message = <span class="hljs-string">&quot;hello, world!&quot;</span>;<br>      event.commit();<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥é€šè¿‡jfrå‘½ä»¤é…ç½®äº‹ä»¶ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
      <category>æ€§èƒ½åˆ†æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>jvm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä»£ç ç¾å­¦</title>
    <link href="/2022/08/13/code_aesthetics/"/>
    <url>/2022/08/13/code_aesthetics/</url>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æˆ‘å†™çš„ä»£ç è¢«åŒäº‹code reviewæ—¶ä¸€ç›´è¢«åæ§½ï¼Œè€Œæˆ‘å‘ç°ç¡®å®å­˜åœ¨å„ç§å„æ ·çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—æŠŠè¿™äº›éƒ½ç»™è®°å½•ä¸‹æ¥ï¼Œä»¥åä¸æ–­æ”¹è¿›</p><h3 id="1-æ­£ç¡®çš„å‘½å"><a href="#1-æ­£ç¡®çš„å‘½å" class="headerlink" title="1.æ­£ç¡®çš„å‘½å"></a>1.æ­£ç¡®çš„å‘½å</h3><blockquote><p>æœ‰ä¸€å¥è€è¯è¯´çš„å¥½ï¼šè®¡ç®—æœºç§‘å­¦æœ‰ä¸¤ä»¶éš¾äº‹ï¼Œä¸€æ˜¯ç¼“å­˜å¤±æ•ˆï¼ŒäºŒæ˜¯å–åã€‚æˆ‘å¯¹ç¬¬äºŒç‚¹æ·±æœ‰ä½“ä¼šï¼Œæ‰€ä»¥æˆ‘è®°å½•äº†ä¸€ä¸‹å–åçš„ä¸€äº›è§„èŒƒ</p></blockquote><ul><li>å°½é‡é¿å…ä½¿ç”¨å•ä¸ªå­—æ¯å»ç»™å˜é‡å‘½åï¼Œè¿™ä¼šä½¿å˜é‡å¤±å»ç›¸å…³ä¿¡æ¯<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span> <span class="hljs-keyword">permits</span> Student, Teacher &#123;<br>    <span class="hljs-comment">// before</span><br>    <span class="hljs-keyword">private</span> String n;<br>    <span class="hljs-keyword">private</span> String p;<br>    <span class="hljs-keyword">private</span> Integer a;<br>    <span class="hljs-comment">//after</span><br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-keyword">private</span> String passWord;<br>    <span class="hljs-keyword">private</span> Integer age;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>ç»å¯¹ä¸è¦ä½¿ç”¨ç¼©å†™ï¼Œå› ä¸ºç¼©å†™çš„å«ä¹‰ä¾èµ–äºä¸Šä¸‹æ–‡ï¼Œå°½é‡é¿å…è®©åˆ«äººè¯»ä»£ç æ—¶å€™ä¾èµ–ä¸Šä¸‹æ–‡<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> price_count_reader;    <span class="hljs-comment">// æ— ç¼©å†™</span><br><span class="hljs-type">int</span> num_errors;            <span class="hljs-comment">// &quot;num&quot; æ˜¯ä¸€ä¸ªå¸¸è§çš„å†™æ³•</span><br><span class="hljs-type">int</span> num_dns_connections;   <span class="hljs-comment">// äººäººéƒ½çŸ¥é“ &quot;DNS&quot; æ˜¯ä»€ä¹ˆ</span><br><br><span class="hljs-type">int</span> n;                     <span class="hljs-comment">// æ¯«æ— æ„ä¹‰.</span><br><span class="hljs-type">int</span> nerr;                  <span class="hljs-comment">// å«ç³Šä¸æ¸…çš„ç¼©å†™.</span><br><span class="hljs-type">int</span> n_comp_conns;          <span class="hljs-comment">// å«ç³Šä¸æ¸…çš„ç¼©å†™.</span><br><span class="hljs-type">int</span> wgc_connections;       <span class="hljs-comment">// åªæœ‰è´µå›¢é˜ŸçŸ¥é“æ˜¯ä»€ä¹ˆæ„æ€.</span><br><span class="hljs-type">int</span> pc_reader;             <span class="hljs-comment">// &quot;pc&quot; æœ‰å¤ªå¤šå¯èƒ½çš„è§£é‡Šäº†.</span><br><span class="hljs-type">int</span> cstmr_id;              <span class="hljs-comment">// åˆ å‡äº†è‹¥å¹²å­—æ¯.</span><br></code></pre></td></tr></table></figure></li><li>ä¸è¦åœ¨å‘½åä¸­å‚æ‚å˜é‡ç±»å‹ä¿¡æ¯ï¼Œæ¯”å¦‚passWordStrã€userNameStr<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span> <span class="hljs-keyword">permits</span> Student, Teacher &#123;<br>    <span class="hljs-comment">// å‰é¢éƒ½å·²ç»ç±»å‹çº¦æŸäº†ä¸ºä»€ä¹ˆè¿˜è¦å†™xxxxStrï¼Ÿ</span><br>    <span class="hljs-keyword">private</span> String userNameStr;<br>    <span class="hljs-keyword">private</span> String passWordStr;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>é€‚å½“çš„ç»™å‚æ•°åŠ ä¸Šå•ä½ï¼Œæ¯”å¦‚ä¸‹è¾¹ä¸¤ä¸ªå“ªä¸ªæ›´å¥½ç†è§£ï¼Ÿ<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executor</span><span class="hljs-params">(<span class="hljs-type">int</span> delay)</span>&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">executor</span><span class="hljs-params">(<span class="hljs-type">int</span> delaySeconds)</span>&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li>ä¸è¦åœ¨åŸºç±»çš„å–åä¸Šä½¿ç”¨BaseXXXï¼Œè¿™æ ·çš„åå­—å¹¶ä¸å¥½<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseTruck</span> &#123;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Truck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTruck</span> &#123;<br>    <span class="hljs-comment">// Truckæ€»æ˜¯è®©äººä¸€å¤´é›¾æ°´</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Truck</span> &#123;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TrailerTruck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Truck</span> &#123;<br>    <span class="hljs-comment">// æ›´åŠ çš„å…·ä½“</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-å‹¿å†™æ³¨é‡Š-ä¸æ˜¯æŒ‡æ¥å£æ–‡æ¡£ã€æ–¹æ³•æ–‡æ¡£ç­‰å„ç§æ–‡æ¡£å“¦"><a href="#2-å‹¿å†™æ³¨é‡Š-ä¸æ˜¯æŒ‡æ¥å£æ–‡æ¡£ã€æ–¹æ³•æ–‡æ¡£ç­‰å„ç§æ–‡æ¡£å“¦" class="headerlink" title="2.å‹¿å†™æ³¨é‡Š(ä¸æ˜¯æŒ‡æ¥å£æ–‡æ¡£ã€æ–¹æ³•æ–‡æ¡£ç­‰å„ç§æ–‡æ¡£å“¦)"></a>2.å‹¿å†™æ³¨é‡Š(ä¸æ˜¯æŒ‡æ¥å£æ–‡æ¡£ã€æ–¹æ³•æ–‡æ¡£ç­‰å„ç§æ–‡æ¡£å“¦)</h3><p>è¿™æ˜¯ä¸€ä¸ªå……æ»¡äº‰è®®çš„é—®é¢˜ï¼Œå…¶å®å¤§éƒ¨åˆ†æ—¶é—´æˆ‘æ›´åŠ è®¤ä¸ºæ³¨é‡Šæ˜¯å‘Šè¯‰æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦è¿™æ ·åšè€Œä¸æ˜¯è§£é‡Šè¿™ä¹ˆåšä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Œå…¶å®æˆ‘ä»¬æŒ‰ç…§ä¸Šè¾¹å‘½åçº¦æŸåšå¥½å‘½åä¹‹åå°±å¯ä»¥é€šè¿‡åç§°è§£é‡Šå¤§éƒ¨åˆ†ä»£ç äº†ã€‚æœ€ä¸»è¦çš„æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ›´æ”¹ä»£ç ï¼Œä½†æ˜¯ä¼šå‘ç”Ÿä»£ç æ›´æ”¹äº†æ³¨é‡Šæ²¡æ›´æ”¹çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸€æ—¦å‘ç”Ÿä¼šè®©è¯»ä»£ç çš„äººå¾ˆå¤´ç–¼çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¦‚æœçŠ¶æ€æ˜¯5ä»£è¡¨æ¶ˆæ¯å·²ç»å‘é€</span><br><span class="hljs-keyword">if</span> (status == <span class="hljs-number">5</span>) &#123;<br>    message.markSend();<br>&#125;<br><br><span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MESSAGE_SEND</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br><span class="hljs-keyword">if</span> (status == MESSAGE_SEND) &#123;  <span class="hljs-comment">// è¿™å¥ä»£ç è¯»èµ·æ¥å°±åƒæ³¨é‡Š</span><br>    message.markSend();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¦‚æœæ¶ˆæ¯å‘é€è€…æ˜¯å½“å‰ç”¨æˆ·ï¼ŒåŒæ—¶æ¶ˆæ¯æ˜¯äº”åˆ†é’Ÿå†…å‘é€çš„ï¼Œæˆ–è€…å½“å‰ç”¨æˆ·æ˜¯ç®¡ç†å‘˜å°±å¯ä»¥æ›´æ–°æ¶ˆæ¯</span><br><span class="hljs-keyword">if</span> ((message.user.id == current_user.id &amp;&amp; ((System.currentTimeMillis() - message.delivered_time()) &lt; <span class="hljs-number">300000</span> )) or current_user.role == Role.Admin) &#123;<br>    message.update_text(text);<br>&#125;<br><br><span class="hljs-comment">// after</span><br><span class="hljs-type">boolean</span> <span class="hljs-variable">user_is_author</span> <span class="hljs-operator">=</span> message.user.id == current_user.id;<br><span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">FIVE_MINUTES</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;<br><span class="hljs-type">boolean</span> <span class="hljs-variable">is_recent</span> <span class="hljs-operator">=</span> (System.currentTimeMillis() - message.delivered_time()) &lt; FIVE_MINUTES;<br><span class="hljs-keyword">if</span> ((user_is_author &amp;&amp; is_recent) || (current_user.role == Role.Admin)) &#123;<br>    message.update_text(text);<br>&#125;<br><br><span class="hljs-comment">// final</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">can_edit_message</span><span class="hljs-params">(Message message, User current_user)</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">user_is_author</span> <span class="hljs-operator">=</span> message.user.id == current_user.id;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">FIVE_MINUTES</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">is_recent</span> <span class="hljs-operator">=</span> (System.currentTimeMillis() - message.delivered_time()) &gt; FIVE_MINUTES;<br>    <span class="hljs-keyword">return</span> (user_is_author &amp;&amp; is_recent) || current_user.role == Role.Admin;<br>&#125;<br><br><span class="hljs-keyword">if</span> (can_edit_message(message, current_user)) &#123;<br>    message.update_text(text);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-ä¸è¦è¿‡åº¦åµŒå¥—"><a href="#3-ä¸è¦è¿‡åº¦åµŒå¥—" class="headerlink" title="3.ä¸è¦è¿‡åº¦åµŒå¥—"></a>3.ä¸è¦è¿‡åº¦åµŒå¥—</h3><p>if elseä½œä¸ºæ¯ç§ç¼–ç¨‹è¯­è¨€éƒ½ä¸å¯æˆ–ç¼ºçš„æ¡ä»¶è¯­å¥ï¼Œæˆ‘ä»¬åœ¨ç¼–ç¨‹æ—¶ä¼šå¤§é‡çš„ç”¨åˆ°ã€‚ä½†if elseä¸€èˆ¬ä¸å»ºè®®åµŒå¥—è¶…è¿‡ä¸‰å±‚ï¼Œå¦‚æœä¸€æ®µä»£ç å­˜åœ¨è¿‡å¤šçš„if elseåµŒå¥—ï¼Œä»£ç çš„å¯è¯»æ€§å°±ä¼šæ€¥é€Ÿä¸‹é™ï¼ŒåæœŸç»´æŠ¤éš¾åº¦ä¹Ÿå¤§å¤§æé«˜ã€‚æ‰€ä»¥ï¼Œä¸è¦è¶…è¿‡ä¸‰å±‚ï¼ä¸è¦è¶…è¿‡ä¸‰å±‚ï¼ï¼ä¸è¦è¶…è¿‡ä¸‰å±‚ï¼ï¼ï¼<br>å‡å°‘ä»£ç åµŒå¥—çš„æ‰‹æ®µä¸€èˆ¬æ˜¯æŠ½å–å’Œåè½¬ï¼Œåè½¬æ˜¯æŒ‡æå‰è¿”å›ï¼ŒæŠ½å–å¾€å¾€æŒ‡æç‚¼æ–¹æ³•ã€‚</p><ul><li>åè½¬æ¡ä»¶ï¼Œå°†è´Ÿé¢æ¡ä»¶ç§»åˆ°å‰é¢ï¼Œä½¿æ–¹æ³•å°½æ—©è¿”å›<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(<span class="hljs-type">int</span> top, <span class="hljs-type">int</span> bottom)</span> &#123;<br>    <span class="hljs-keyword">if</span> (top &gt; bottom) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> bottom; number &lt;= top; number++) &#123;<br>            sum += number;<br>        &#125;<br>        <span class="hljs-keyword">return</span> sum;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">(<span class="hljs-type">int</span> top, <span class="hljs-type">int</span> bottom)</span> &#123;<br>    <span class="hljs-keyword">if</span> (top &lt; bottom) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> bottom; number &lt;= top; number++) &#123;<br>        sum += number;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sum;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerUser</span><span class="hljs-params">(String user)</span> &#123;<br>    String[] parts = user.split(<span class="hljs-string">&quot;:&quot;</span>);<br>    <span class="hljs-keyword">if</span> (parts.length == <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> Integer.parseInt(parts[<span class="hljs-number">0</span>]);<br>        <span class="hljs-keyword">if</span> (userId &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> parts[<span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">if</span> (users.containsKey(userId)) &#123;<br>                users.get(userId).setUserName(userName);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                users.put(userId, <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(userName));<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Invalid userId : &quot;</span> + userId);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Invalid user string: &quot;</span> + user);<br>    &#125;<br>&#125;<br><span class="hljs-comment">// åè½¬æ¡ä»¶ï¼Œæ­£ç¡®çš„åˆ†æ”¯éƒ½ä¸‹æ²‰ï¼Œå¼‚å¸¸çš„åˆ†æ”¯éƒ½ä¸Šæµ®</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerUser</span><span class="hljs-params">(String user)</span> &#123;<br>    String[] parts = user.split(<span class="hljs-string">&quot;:&quot;</span>);<br>    <span class="hljs-keyword">if</span> (parts.length != <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Invalid user string: &quot;</span> + user);<br>    &#125;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> Integer.parseInt(parts[<span class="hljs-number">0</span>]);<br>    <span class="hljs-keyword">if</span> (userId &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Invalid userId : &quot;</span> + userId);<br>    &#125;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">userName</span> <span class="hljs-operator">=</span> parts[<span class="hljs-number">1</span>];<br>    <span class="hljs-keyword">if</span> (users.containsKey(userId)) &#123;<br>        users.get(userId).setUserName(userName);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        users.put(userId, <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(userName));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>æŠ½å–æ–¹æ³•ï¼Œåˆç†ä½¿ç”¨è®¾è®¡æ¨¡å¼,ä»¥ä¸€ä¸ªåˆ†äº«åŠŸèƒ½ä¸ºä¾‹<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆ†äº«ç±»å‹</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShareType</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">TYPE_LINK</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">TYPE_IMAGE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">TYPE_TEXT</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">TYPE_IMAGE_TEXT</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>&#125;<br><span class="hljs-comment">// åˆ†äº«å…ƒç´ </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ShareItem</span> &#123;<br>    <span class="hljs-type">int</span> type;<br>    String title;<br>    String content;<br>    String imagePath;<br>    String link;<br>&#125;<br><span class="hljs-comment">// åˆ†äº«å›è°ƒ</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ShareListener</span> &#123;<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">STATE_SUCC</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">STATE_FAIL</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCallback</span><span class="hljs-params">(<span class="hljs-type">int</span> state, String msg)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Share</span> &#123;<br>    <span class="hljs-comment">// åˆ†äº«</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">share</span> <span class="hljs-params">(ShareItem item, ShareListener listener)</span> &#123;<br>        <span class="hljs-keyword">if</span> (item != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (item.type == ShareType.TYPE_LINK) &#123;<br>                <span class="hljs-comment">// åˆ†äº«é“¾æ¥</span><br>                <span class="hljs-keyword">if</span> (Strings.isNotBlank(item.link) &amp;&amp; Strings.isNotBlank(item.content)) &#123;<br>                    doShareLink(item.link, item.title, item.content, listener);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                        listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;åˆ†äº«ä¿¡æ¯ä¸å®Œæ•´&quot;</span>);<br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type == ShareType.TYPE_IMAGE) &#123;<br>                <span class="hljs-comment">// åˆ†äº«å›¾ç‰‡</span><br>                <span class="hljs-keyword">if</span> (Strings.isNotBlank(item.imagePath)) &#123;<br>                    doShareImage(item.imagePath, listener);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                        listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;åˆ†äº«ä¿¡æ¯ä¸å®Œæ•´&quot;</span>);<br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type == ShareType.TYPE_TEXT) &#123;<br>                <span class="hljs-comment">// åˆ†äº«æ–‡æœ¬</span><br>                <span class="hljs-keyword">if</span> (Strings.isNotBlank(item.content)) &#123;<br>                    doShareText(item.content, listener);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                        listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;åˆ†äº«ä¿¡æ¯ä¸å®Œæ•´&quot;</span>);<br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type == ShareType.TYPE_IMAGE_TEXT) &#123;<br>                <span class="hljs-comment">// åˆ†äº«å›¾æ–‡</span><br>                <span class="hljs-keyword">if</span> (Strings.isNotBlank(item.imagePath) &amp;&amp; Strings.isNotBlank(item.content)) &#123;<br>                    doShareImageAndText(item.imagePath, item.content, listener);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                        listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;åˆ†äº«ä¿¡æ¯ä¸å®Œæ•´&quot;</span>);<br>                    &#125;<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                    listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;ä¸æ”¯æŒçš„åˆ†äº«ç±»å‹&quot;</span>);<br>                &#125;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;ShareItem ä¸èƒ½ä¸º null&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// å…·ä½“åˆ†äº«åŠŸèƒ½å®ç°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doShareImageAndText</span><span class="hljs-params">(String imagePath, String content, ShareListener listener)</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doShareText</span><span class="hljs-params">(String content, ShareListener listener)</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doShareImage</span><span class="hljs-params">(String imagePath, ShareListener listener)</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doShareLink</span><span class="hljs-params">(String link, String title, String content, ShareListener listener)</span> &#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>ç¬¬ä¸€æ­¥ï¼šæ¥å£åˆ†å±‚ï¼ŒæŠŠæ¥å£åˆ†ä¸ºå¤–éƒ¨å’Œå†…éƒ¨æ¥å£ï¼Œæ‰€æœ‰ç©ºå€¼åˆ¤æ–­æ”¾åœ¨å¤–éƒ¨æ¥å£å®Œæˆï¼Œåªå¤„ç†ä¸€æ¬¡ï¼›è€Œå†…éƒ¨æ¥å£ä¼ å…¥çš„å˜é‡ç”±å¤–éƒ¨æ¥å£ä¿è¯ä¸ä¸ºç©ºï¼Œä»è€Œå‡å°‘ç©ºå€¼åˆ¤æ–­<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">share</span> <span class="hljs-params">(ShareItem item, ShareListener listener)</span> &#123;<br>    <span class="hljs-keyword">if</span> (item == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>            listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;ShareItem ä¸èƒ½ä¸º null&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (listener == <span class="hljs-literal">null</span>) &#123;<br>        listener = (state, msg) -&gt; log.debug(<span class="hljs-string">&quot;ShareListener is null&quot;</span>);<br>    &#125;<br>    shareImpl(item, listener);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shareImpl</span><span class="hljs-params">(ShareItem item, ShareListener listener)</span> &#123;<br>    <span class="hljs-keyword">if</span> (item.type == ShareType.TYPE_LINK) &#123;<br>        <span class="hljs-comment">// åˆ†äº«é“¾æ¥</span><br>        <span class="hljs-keyword">if</span> (Strings.isNotBlank(item.link) &amp;&amp; Strings.isNotBlank(item.content)) &#123;<br>            doShareLink(item.link, item.title, item.content, listener);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;åˆ†äº«ä¿¡æ¯ä¸å®Œæ•´&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type == ShareType.TYPE_IMAGE) &#123;<br>        <span class="hljs-comment">// åˆ†äº«å›¾ç‰‡</span><br>        <span class="hljs-keyword">if</span> (Strings.isNotBlank(item.imagePath)) &#123;<br>            doShareImage(item.imagePath, listener);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;åˆ†äº«ä¿¡æ¯ä¸å®Œæ•´&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type == ShareType.TYPE_TEXT) &#123;<br>        <span class="hljs-comment">// åˆ†äº«æ–‡æœ¬</span><br>        <span class="hljs-keyword">if</span> (Strings.isNotBlank(item.content)) &#123;<br>            doShareText(item.content, listener);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;åˆ†äº«ä¿¡æ¯ä¸å®Œæ•´&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (item.type == ShareType.TYPE_IMAGE_TEXT) &#123;<br>        <span class="hljs-comment">// åˆ†äº«å›¾æ–‡</span><br>        <span class="hljs-keyword">if</span> (Strings.isNotBlank(item.imagePath) &amp;&amp; Strings.isNotBlank(item.content)) &#123;<br>            doShareImageAndText(item.imagePath, item.content, listener);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>                listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;åˆ†äº«ä¿¡æ¯ä¸å®Œæ•´&quot;</span>);<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>            listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;ä¸æ”¯æŒçš„åˆ†äº«ç±»å‹&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>ç¬¬äºŒæ­¥åˆ©ç”¨å¤šæ€ï¼Œæ¯ç§ä¸šåŠ¡å•ç‹¬å¤„ç†ï¼Œåœ¨æ¥å£ä¸å†åšä»»ä½•ä¸šåŠ¡åˆ¤æ–­ã€‚æŠŠShareItemæŠ½è±¡å‡ºæ¥ï¼Œä½œä¸ºåŸºç¡€ç±»ï¼Œç„¶åé’ˆå¯¹æ¯ç§ä¸šåŠ¡å„è‡ªå®ç°å…¶å­ç±»ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShareItem</span> &#123;<br>    <span class="hljs-type">int</span> type;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ShareItem</span><span class="hljs-params">(<span class="hljs-type">int</span> type)</span> &#123;<br>        <span class="hljs-built_in">this</span>.type = type;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doShare</span><span class="hljs-params">(ShareListener listener)</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LinkShareItem</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ShareItem</span> &#123;<br>    String title;<br>    String content;<br>    String link;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LinkShareItem</span><span class="hljs-params">(String link, String title, String content)</span> &#123;<br>        <span class="hljs-built_in">super</span>(ShareType.TYPE_LINK);<br>        <span class="hljs-built_in">this</span>.title = Strings.isNotBlank(title) ? title : <span class="hljs-string">&quot;default&quot;</span>;<br>        <span class="hljs-built_in">this</span>.content = Strings.isNotBlank(content) ? content : <span class="hljs-string">&quot;default&quot;</span>;<br>        <span class="hljs-built_in">this</span>.link = Strings.isNotBlank(link) ? link : <span class="hljs-string">&quot;default&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doShare</span><span class="hljs-params">(ShareListener listener)</span> &#123;<br>        <span class="hljs-comment">// do share</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageShareItem</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ShareItem</span> &#123;<br>    String imagePath;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ImageShareItem</span><span class="hljs-params">(String imagePath)</span> &#123;<br>        <span class="hljs-built_in">super</span>(ShareType.TYPE_IMAGE);<br>        <span class="hljs-built_in">this</span>.imagePath = Strings.isNotBlank(imagePath) ? imagePath : <span class="hljs-string">&quot;default&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doShare</span><span class="hljs-params">(ShareListener listener)</span> &#123;<br>        <span class="hljs-comment">// do share</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextShareItem</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ShareItem</span> &#123;<br>    String content;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TextShareItem</span><span class="hljs-params">(String content)</span> &#123;<br>        <span class="hljs-built_in">super</span>(ShareType.TYPE_TEXT);<br>        <span class="hljs-built_in">this</span>.content = Strings.isNotBlank(content) ? content : <span class="hljs-string">&quot;default&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doShare</span><span class="hljs-params">(ShareListener listener)</span> &#123;<br>        <span class="hljs-comment">// do share</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageTextShareItem</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ShareItem</span> &#123;<br>    String content;<br>    String imagePath;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ImageTextShareItem</span><span class="hljs-params">(String imagePath, String content)</span> &#123;<br>        <span class="hljs-built_in">super</span>(ShareType.TYPE_IMAGE_TEXT);<br>        <span class="hljs-built_in">this</span>.imagePath = Strings.isNotBlank(imagePath) ? imagePath : <span class="hljs-string">&quot;default&quot;</span>;<br>        <span class="hljs-built_in">this</span>.content = Strings.isNotBlank(content) ? content : <span class="hljs-string">&quot;default&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doShare</span><span class="hljs-params">(ShareListener listener)</span> &#123;<br>        <span class="hljs-comment">// do share</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">share</span> <span class="hljs-params">(ShareItem item, ShareListener listener)</span> &#123;<br>    <span class="hljs-keyword">if</span> (item == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">if</span> (listener != <span class="hljs-literal">null</span>) &#123;<br>            listener.onCallback(ShareListener.STATE_FAIL, <span class="hljs-string">&quot;ShareItem ä¸èƒ½ä¸º null&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (listener == <span class="hljs-literal">null</span>) &#123;<br>        listener = (state, msg) -&gt; log.debug(<span class="hljs-string">&quot;ShareListener is null&quot;</span>);<br>    &#125;<br>    item.doShare(listener);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="4-ç»„åˆä¼˜äºç»§æ‰¿"><a href="#4-ç»„åˆä¼˜äºç»§æ‰¿" class="headerlink" title="4.ç»„åˆä¼˜äºç»§æ‰¿"></a>4.ç»„åˆä¼˜äºç»§æ‰¿</h3><blockquote><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œæœ‰ä¸€æ¡éå¸¸ç»å…¸çš„è®¾è®¡åŸåˆ™ï¼Œé‚£å°±æ˜¯ï¼šç»„åˆä¼˜äºç»§æ‰¿ï¼Œå¤šç”¨ç»„åˆå°‘ç”¨ç»§æ‰¿ã€‚åŒæ ·åœ°ï¼Œåœ¨ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹ä¸­æœ‰ä¸€æ¡è§„å®šï¼šè°¨æ…ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼è¿›è¡Œæ‰©å±•ï¼Œä¼˜å…ˆä½¿ç”¨ç»„åˆçš„æ–¹å¼å®ç°ã€‚</p></blockquote><p>æ¯ä¸ªäººåœ¨åˆšåˆšå­¦ä¹ é¢å‘å¯¹è±¡ç¼–ç¨‹æ—¶éƒ½ä¼šè§‰å¾—ï¼šç»§æ‰¿ï¼ˆç”¨æ¥è¡¨ç¤ºç±»ä¹‹é—´çš„is-aå…³ç³»ï¼‰å¯ä»¥å®ç°ç±»çš„å¤ç”¨ã€‚æ‰€ä»¥ï¼Œå¾ˆå¤šå¼€å‘äººå‘˜åœ¨éœ€è¦å¤ç”¨ä¸€äº›ä»£ç çš„æ—¶å€™ä¼šå¾ˆè‡ªç„¶çš„ä½¿ç”¨ç±»çš„ç»§æ‰¿çš„æ–¹å¼ï¼Œå› ä¸ºä¹¦ä¸Šå°±æ˜¯è¿™ä¹ˆå†™çš„ï¼Œå®˜æ–¹æ˜¯è¿™ä¹ˆæ•™çš„ï¼Œæ‰€ä»¥ä½œä¸ºé¢å‘å¯¹è±¡å››å¤§ç‰¹æ€§ä¹‹ä¸€çš„ç»§æ‰¿ï¼Œè¢«æˆ‘ä»¬ä½œä¸ºè§£å†³ä»£ç å¤ç”¨çš„ä¸»è¦æ‰‹æ®µä¹‹ä¸€ã€‚è™½ç„¶ç»§æ‰¿æœ‰è¯¸å¤šä½œç”¨ï¼Œä½†ç»§æ‰¿å±‚æ¬¡è¿‡æ·±ã€è¿‡å¤æ‚ï¼Œä¹Ÿä¼šå½±å“åˆ°ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚ä¸‹è¾¹æˆ‘ä»¬å°±ç”¨ä¸€ä¸ªæµ‹è¯•æ¥è¡¨ç°å®ƒå¸¦æ¥çš„å¼Šç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Getter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RecodeHashSet</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HashSet</span>&lt;E&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">addCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> &#123;<br>        addCount += <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.add(e);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> &#123;<br>        addCount += c.size();<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.addAll(c);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testRecodeSet</span><span class="hljs-params">()</span> &#123;<br>    RecodeHashSet&lt;String&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecodeHashSet</span>&lt;&gt;();<br>    set.addAll(List.of(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-string">&quot;ls&quot;</span>));<br>    <span class="hljs-keyword">assert</span> set.getAddCount() == <span class="hljs-number">2</span>;  <span class="hljs-comment">// å¤±è´¥äº†ï¼ŒaddCount == 4?</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä¼šå¤±è´¥ï¼Ÿè®©äººå¾ˆè¿·æƒ‘ï¼Œæ¢ç©¶æºç ä¹‹åæˆ‘ä»¬å‘ç°addAll()ä¼šè°ƒç”¨add()æ–¹æ³•ï¼Œå› ä¸ºä¼šå…ˆè°ƒç”¨è‡ªå·±çš„add()æ–¹æ³•æ‰€ä»¥å‘ç”Ÿäº†é‡å¤è®¡æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠaddAll()æ–¹æ³•çš„è®¡ç®—ç»™åˆ é™¤å°±å¥½äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">modified</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">for</span> (E e : c)<br>        <span class="hljs-keyword">if</span> (add(e))<br>            modified = <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">return</span> modified;<br>&#125;<br></code></pre></td></tr></table></figure><p>è™½ç„¶åˆ é™¤ä¹‹åé—®é¢˜è§£å†³äº†ä½†æ˜¯è¿™æ ·çœŸçš„åˆé€‚å—ï¼Œæ˜¯ä¸æ˜¯éœ€è¦åœ¨æˆ‘ä»¬æåº¦ç†Ÿæ‚‰çˆ¶ç±»æºç çš„æƒ…å†µä¸‹æ‰èƒ½å‘ç°é—®é¢˜ï¼Œå¦‚æœæœ‰ä¸€å¤©HashSetçš„add()æ–¹æ³•ä¸å†è°ƒç”¨add()æ–¹æ³•æˆ‘ä»¬çš„RecodeSetæ˜¯ä¸æ˜¯åˆä¼šå‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥ä¸ºäº†é¿å…çˆ¶ç±»çš„æ–¹æ³•å…·ä½“å®ç°å¯¹æˆ‘ä»¬å¸¦æ¥å½±å“æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForwardingSet</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Set</span>&lt;E&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;E&gt; set;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> set.size();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isEmpty</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> set.isEmpty();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-keyword">return</span> set.contains(o);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Iterator&lt;E&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> set.iterator();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object[] toArray() &#123;<br>        <span class="hljs-keyword">return</span> set.toArray();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;<br>        <span class="hljs-keyword">return</span> set.toArray(a);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> &#123;<br>        <span class="hljs-keyword">return</span> set.add(e);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">remove</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-keyword">return</span> set.remove(o);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsAll</span><span class="hljs-params">(Collection&lt;?&gt; c)</span> &#123;<br>        <span class="hljs-keyword">return</span> set.containsAll(c);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> &#123;<br>        <span class="hljs-keyword">return</span> set.addAll(c);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">retainAll</span><span class="hljs-params">(Collection&lt;?&gt; c)</span> &#123;<br>        <span class="hljs-keyword">return</span> set.retainAll(c);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeAll</span><span class="hljs-params">(Collection&lt;?&gt; c)</span> &#123;<br>        <span class="hljs-keyword">return</span> set.removeAll(c);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> &#123;<br>        set.clear();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Getter</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RecodeHashSet</span>&lt;E&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ForwardingSet</span>&lt;E&gt; &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">addCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecodeHashSet</span><span class="hljs-params">(Set&lt;E&gt; set)</span> &#123;<br>        <span class="hljs-built_in">super</span>(set);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">add</span><span class="hljs-params">(E e)</span> &#123;<br>        addCount += <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.add(e);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(Collection&lt;? extends E&gt; c)</span> &#123;<br>        addCount += c.size();<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.addAll(c);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testRecodeSet</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ä¸å…‰èƒ½ä¼ å…¥hashsetï¼Œè¿˜èƒ½ä¼ å…¥ä»»ä½•setç±»å‹ï¼Œå¹¶ä¸ä¼šè®©çˆ¶ç±»çš„è¡Œä¸ºå½±å“æˆ‘ä»¬</span><br>    RecodeHashSet&lt;String&gt; set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecodeHashSet</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;());<br>    set.addAll(List.of(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-string">&quot;ls&quot;</span>));<br>    <span class="hljs-keyword">assert</span> set.getAddCount() == <span class="hljs-number">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-ä¸è¦è¿‡åº¦æŠ½è±¡"><a href="#5-ä¸è¦è¿‡åº¦æŠ½è±¡" class="headerlink" title="5.ä¸è¦è¿‡åº¦æŠ½è±¡"></a>5.ä¸è¦è¿‡åº¦æŠ½è±¡</h3><blockquote><p>æˆ‘ä»¬æé«˜ä»£ç å¤ç”¨å¸¸ç”¨çš„ä¸€ä¸ªå¥—è·¯å°±æ˜¯è¯†åˆ«é‡å¤çš„ä»£ç è¿›è¡ŒæŠ½è±¡ï¼Œç„¶åç»§æ‰¿ï¼Œæˆ‘ä»¬å®¹æ˜“è¯¯å…¥çš„ä¸€ä¸ªæ€ªåœˆå°±æ˜¯æŠ½è±¡è¶Šå¤šè¶Šå¥½ï¼Œä½†æ˜¯è¿‡åº¦æŠ½è±¡å¸¦ç»™æˆ‘ä»¬çš„å°±æ˜¯è€¦åˆï¼Œæˆ‘ä»¬å†å»æ¸…ç†å¯¹è±¡å…³ç³»çš„æ—¶å€™åªèƒ½çœ‹åˆ°é”™ç»¼å¤æ‚çš„å…³ç³»ç½‘ï¼Œå¦‚æœæˆ‘ä»¬ä¸€ç›´ä¸æŠ½è±¡é‚£ä¹ˆå°±ä¼šç»™æˆ‘ä»¬å¸¦æ¥ä¸€å†™é‡å¤ä»£ç ï¼Œæ‰€ä»¥æŠŠæˆ‘æŠ½è±¡çš„ç¨‹åº¦å¾ˆé‡è¦</p></blockquote><p>æ¯”å¦‚æˆ‘ç°åœ¨æœ‰ä¸€ä¸ªæ¸¸æˆç³»ç»Ÿï¼Œæˆ‘æƒ³æŠŠç”¨æˆ·æ‰€æœ‰çš„æ•°æ®ä¿å­˜åˆ°XMLæ–‡ä»¶ä¸­ï¼Œæˆ‘å°±ä¼šå†™è¿™æ ·çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveGameData</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String fileName;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SaveGameData</span><span class="hljs-params">(String fileName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.fileName = fileName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(GameStat stat)</span> &#123;<br>        <span class="hljs-comment">// 1.ç”Ÿæˆä¸€ä¸ªæ ¼å¼åŒ–è½¬åŒ–å·¥å…·ï¼Œå°†statè½¬xml</span><br>        <span class="hljs-comment">// 2.å°†xmlè½¬æˆå­—èŠ‚æµ</span><br>        <span class="hljs-comment">// 3.å†™å…¥æ–‡ä»¶</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> GameStat <span class="hljs-title function_">load</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 1.è¯»å–æ–‡ä»¶</span><br>        <span class="hljs-comment">// 2.å°†å­—èŠ‚æµè½¬æˆxml</span><br>        <span class="hljs-comment">// 3.å°†xmlè½¬æˆGameStat</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘éœ€è¦å¢åŠ å¯¹jsonæ ¼å¼çš„æ”¯æŒï¼Œæ€ä¹ˆåŠï¼Ÿæ”¹é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveGameData</span> &#123;<br><br>    <span class="hljs-keyword">private</span> SaveMode saveMode;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SaveMode</span> &#123;<br>        XML,<br>        JSON;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SaveGameData</span><span class="hljs-params">(SaveMode saveMode)</span> &#123;<br>        <span class="hljs-built_in">this</span>.saveMode = saveMode;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(GameStat stat, String fileName)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.saveMode == SaveMode.XML) &#123;<br>            <span class="hljs-type">SaveXml</span> <span class="hljs-variable">saveXml</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaveXml</span>(fileName);<br>            saveXml.save();<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.saveMode == SaveMode.JSON) &#123;<br>            <span class="hljs-type">SaveJson</span> <span class="hljs-variable">saveJson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaveJson</span>(fileName);<br>            saveJson.save();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> GameStat <span class="hljs-title function_">load</span><span class="hljs-params">(String fileName)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.saveMode == SaveMode.XML) &#123;<br>            <span class="hljs-type">SaveXml</span> <span class="hljs-variable">saveXml</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaveXml</span>(fileName);<br>            <span class="hljs-keyword">return</span> saveXml.load();<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.saveMode == SaveMode.JSON) &#123;<br>            <span class="hljs-type">SaveJson</span> <span class="hljs-variable">saveJson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaveJson</span>(fileName);<br>            <span class="hljs-keyword">return</span> saveJson.load();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GameStat</span> &#123;<br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; userData;<br>&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveXml</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SaveXml</span><span class="hljs-params">(String fileName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.fileName = fileName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-keyword">public</span> GameStat <span class="hljs-title function_">load</span><span class="hljs-params">()</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveJson</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SaveJson</span><span class="hljs-params">(String fileName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.fileName = fileName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-keyword">public</span> GameStat <span class="hljs-title function_">load</span><span class="hljs-params">()</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬æ”¹å®Œä¹‹åæˆ‘ä»¬ç¼–è¯‘å™¨å‘Šè¯‰æˆ‘ä»¬æœ‰å¤§é‡åˆ¤æ–­ä»£ç æ˜¯é‡å¤ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¼€å§‹æ€è€ƒæ˜¯å¦éœ€è¦æŠ½è±¡ï¼Ÿç„¶åå¼€å§‹æŠ½è±¡å¾—åˆ°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveGameData</span> &#123;<br><br>    <span class="hljs-keyword">private</span> SaveMode saveMode;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SaveMode</span> &#123;<br>        XML,<br>        JSON;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SaveGameData</span><span class="hljs-params">(SaveMode saveMode)</span> &#123;<br>        <span class="hljs-built_in">this</span>.saveMode = saveMode;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(GameStat stat, String fileName)</span> &#123;<br>        <span class="hljs-type">FileSave</span> <span class="hljs-variable">save</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.saveMode == SaveMode.XML) &#123;<br>            save = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaveXml</span>(fileName);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.saveMode == SaveMode.JSON) &#123;<br>            save = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaveJson</span>(fileName);<br>        &#125;<br>        save.save(stat);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> GameStat <span class="hljs-title function_">load</span><span class="hljs-params">(String fileName)</span> &#123;<br>        <span class="hljs-type">FileSave</span> <span class="hljs-variable">load</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.saveMode == SaveMode.XML) &#123;<br>            load = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaveXml</span>(fileName);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.saveMode == SaveMode.JSON) &#123;<br>            load = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaveJson</span>(fileName);<br>        &#125;<br>        <span class="hljs-keyword">return</span> load.load();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GameStat</span> &#123;<br>    <span class="hljs-keyword">private</span> Map&lt;String, String&gt; userData;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileSave</span> &#123;<br>    <span class="hljs-keyword">private</span> String fileName;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FileSave</span><span class="hljs-params">(String fileName)</span> &#123;<br>        <span class="hljs-built_in">this</span>.fileName = fileName;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(GameStat stat)</span> &#123;&#125;<br><br>    <span class="hljs-keyword">public</span> GameStat <span class="hljs-title function_">load</span><span class="hljs-params">()</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveXml</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FileSave</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SaveXml</span><span class="hljs-params">(String fileName)</span> &#123;<br>        <span class="hljs-built_in">super</span>(fileName);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(GameStat stat)</span> &#123;&#125;<br><br>    <span class="hljs-keyword">public</span> GameStat <span class="hljs-title function_">load</span><span class="hljs-params">()</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SaveJson</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FileSave</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SaveJson</span><span class="hljs-params">(String fileName)</span> &#123;<br>        <span class="hljs-built_in">super</span>(fileName);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">save</span><span class="hljs-params">(GameStat stat)</span> &#123;&#125;<br><br>    <span class="hljs-keyword">public</span> GameStat <span class="hljs-title function_">load</span><span class="hljs-params">()</span> &#123;<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>çœ‹ä¸Šå»å¾ˆå®Œç¾ï¼Œä½†æ˜¯å…¶å®ç›¸æ¯”è¾ƒå†™ä¸¤ä¸ªSaveXmlå’ŒSaveJsonä¸ç»§æ‰¿FileSaveåªæ˜¯å°‘å†™äº†ä¸€è¡Œprivate String fileName;è€Œå·²ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°å¼ºè¡ŒæŠ½è±¡ä¹‹åå…¶å®å®ƒå·²ç»å’Œæ–‡ä»¶æœ‰äº†å¼ºè€¦åˆï¼Œå¦‚æœä¹‹åæˆ‘ä»¬æƒ³ä¿å­˜åˆ°æ•°æ®åº“æˆ–è€…S3æˆ–è€…è¿œç¨‹æœåŠ¡å™¨å‘¢ï¼Ÿè€Œä¸”æˆ‘ä»¬çš„saveæ–¹æ³•ä¸GameStatä¹Ÿç»‘å®šäº†ï¼Œæ‰€ä»¥è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æŠ½è±¡ï¼Œä¹Ÿä¸æ˜¯æˆ‘ä»¬çœŸæ­£éœ€è¦çš„æŠ½è±¡ï¼Œæˆ–è®¸å½“æˆ‘ä»¬éœ€è¦ä¿å­˜æ›´å¤šä»‹è´¨æ›´å¤šä¿å­˜çš„ç±»å‹æ›´å¤šçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥æŠ½è±¡å‡ºæ¥ä¸¤ä¸ªé¡¶çº§æ¥å£ï¼Œè€Œä¸æ˜¯ç°åœ¨å°±ææ—©æŠ½è±¡äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Others</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è§„èŒƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¥½ç”¨ä½†ä¸ä¸ºäººçŸ¥çš„API</title>
    <link href="/2022/08/12/%E5%A5%BD%E7%94%A8%E4%BD%86%E4%B8%8D%E4%B8%BA%E4%BA%BA%E7%9F%A5%E7%9A%84API/"/>
    <url>/2022/08/12/%E5%A5%BD%E7%94%A8%E4%BD%86%E4%B8%8D%E4%B8%BA%E4%BA%BA%E7%9F%A5%E7%9A%84API/</url>
    
    <content type="html"><![CDATA[<h3 id="1-å¥½ç”¨çš„é›†åˆå·¥å‚æ–¹æ³•"><a href="#1-å¥½ç”¨çš„é›†åˆå·¥å‚æ–¹æ³•" class="headerlink" title="1.å¥½ç”¨çš„é›†åˆå·¥å‚æ–¹æ³•"></a>1.å¥½ç”¨çš„é›†åˆå·¥å‚æ–¹æ³•</h3><ul><li>Collection.of()<br>è¿™äº›é›†åˆçš„ofæ–¹æ³•è®©æˆ‘ä»¬ä»£ç å˜å¾—ç®€å•ï¼Œå½“æˆ‘ä»¬åªæƒ³å±•ç¤ºæˆ‘ä»¬æƒ³è¦å±•ç¤ºçš„åˆ—è¡¨æˆ–è€…ä¸œè¥¿ä¸æ˜¯å¾ˆå¤šçš„åœºæ™¯ä¸­ä½¿ç”¨ï¼Œè¿™äº›apiéƒ½æ˜¯ä¸å¯å˜çš„ï¼Œæˆ‘ä»¬çŸ¥é“é›†åˆå·¥å…·ç±»å·²ç»å¸®æˆ‘ä»¬æä¾›äº†è½¬æ¢æˆä¸å¯å˜çš„é›†åˆçš„æ–¹æ³•unmodifiableXXXï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦List.ofï¼Ÿå› ä¸ºå®ƒæ€»æ˜¯ä¼šcopyåŸæ¥çš„liståˆ°æ–°çš„listï¼Œå®ƒä¸æ˜¯å¾ˆæœ‰æ•ˆç‡ï¼Œ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCollectionOf</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// è¿”å›ä¸å¯å˜çš„é›†åˆï¼Œä¸”ä¸èƒ½åŒ…å«nullï¼Œæ‰€ä»¥æˆ‘ä»¬éå†ä½¿ç”¨çš„æ—¶å€™ä¸ç”¨åˆ¤æ–­ç©ºå€¼</span><br>    List&lt;String&gt; names = List.of(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-string">&quot;ls&quot;</span>, <span class="hljs-string">&quot;ww&quot;</span>);<br>    <span class="hljs-comment">// names.add(&quot;zl&quot;); error</span><br>    Set&lt;String&gt; of = Set.of(<span class="hljs-string">&quot;zl&quot;</span>, <span class="hljs-string">&quot;zq&quot;</span>);<br>    Map&lt;String, Integer&gt; users = Map.of(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-number">23</span>, <span class="hljs-string">&quot;ls&quot;</span>, <span class="hljs-number">24</span>);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testList</span><span class="hljs-params">()</span> &#123;<br>    ArrayList&lt;String&gt; nameList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;() &#123;&#123;<br>        add(<span class="hljs-string">&quot;zs&quot;</span>);<br>        add(<span class="hljs-string">&quot;ls&quot;</span>);<br>        add(<span class="hljs-string">&quot;ww&quot;</span>);<br>    &#125;&#125;;<br>    <span class="hljs-comment">// è½¬æˆä¸å¯ä¿®æ”¹list</span><br>    List&lt;String&gt; unmodifiableList = Collections.unmodifiableList(nameList);<br>    <span class="hljs-comment">// ä¸å¯ä¿®æ”¹</span><br>    <span class="hljs-comment">// unmodifiableList.add(&quot;zl&quot;);</span><br>    List&lt;String&gt; names = List.of(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-string">&quot;ls&quot;</span>, <span class="hljs-string">&quot;ww&quot;</span>);<br>    <span class="hljs-comment">// ä¸å¯ä¿®æ”¹</span><br>    <span class="hljs-comment">// names.add(&quot;zl&quot;);</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>Stream.toList()<br>å¸®æˆ‘ä»¬è¿”å›ä¸€ä¸ªä¸å¯å˜çš„listï¼Œä½†å®ƒç»å¯¹ä¸æ˜¯collect(Collectors.toList())çš„æ›¿æ¢ï¼Œå®ƒæœ‰æ¯”collect(Collectors.toList())æ›´å¥½çš„ä¼˜åŒ–ï¼Œé»˜è®¤è¿”å›ä¸€ä¸ªä¸å¯å˜çš„listï¼Œè€Œå‰è€…è¿”å›çš„æ˜¯ä¸€ä¸ªarraylist</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@SneakyThrows</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testList</span><span class="hljs-params">()</span> &#123;<br>    List&lt;String&gt; names = List.of(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-string">&quot;ls&quot;</span>, <span class="hljs-string">&quot;ww&quot;</span>);<br>    List&lt;String&gt; collectList = names.stream().collect(Collectors.toList());<br>    collectList.add(<span class="hljs-string">&quot;zl&quot;</span>);<br>    List&lt;String&gt; toList = names.stream().toList();<br>    <span class="hljs-comment">// toList.add(&quot;zl&quot;);</span><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">default</span> List&lt;T&gt; <span class="hljs-title function_">toList</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> (List&lt;T&gt;) Collections.unmodifiableList(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="hljs-built_in">this</span>.toArray())));<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>List.copyOf()<br>è¿”å›ä¸€ä¸ªä¸å¯å˜çš„é›†åˆå‰¯æœ¬ï¼Œå¹¶ä¸”ä¸èƒ½æ¥å—é›†åˆä¸­çš„ç©ºå€¼<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@SneakyThrows</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCopy</span><span class="hljs-params">()</span>&#123;<br>    List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-string">&quot;ls&quot;</span>, <span class="hljs-string">&quot;ww&quot;</span>);<br>    List&lt;String&gt; names_bak = List.copyOf(names);<br>    <span class="hljs-comment">// names_bak.add(&quot;aaa&quot;);</span><br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-HTTPclient"><a href="#2-HTTPclient" class="headerlink" title="2.HTTPclient"></a>2.HTTPclient</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åšä¸€ä¸ªå°é¡¹ç›®ï¼Œä¸ºäº†å°½é‡å‡å°é¡¹ç›®çš„ä½“é‡å’Œé¿å…å¤–éƒ¨ä¾èµ–çš„ä¾µå…¥æ€§æˆ‘ä»¬å¯ä»¥ç”¨è¿‡å†…ç½®çš„apiè¿›è¡Œæ¥å£è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testHttpClient</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">HttpClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> HttpClient.newBuilder()<br>            .connectTimeout(Duration.ofSeconds(<span class="hljs-number">3</span>))<br>            .followRedirects(HttpClient.Redirect.ALWAYS)<br>            .build();<br>    <span class="hljs-type">HttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> HttpRequest.newBuilder()<br>            .GET().uri(URI.create(<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>))<br>            .build();<br>    HttpResponse&lt;String&gt; response = client.send(request, HttpResponse.BodyHandlers.ofString());<br>    <span class="hljs-keyword">if</span> (response.statusCode() == <span class="hljs-number">200</span>) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">body</span> <span class="hljs-operator">=</span> response.body();<br>        log.info(<span class="hljs-string">&quot;response: &#123;&#125;&quot;</span>, body);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        log.warn(<span class="hljs-string">&quot;request error, status code &#123;&#125;&quot;</span>, response.statusCode());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-null-in-java"><a href="#3-null-in-java" class="headerlink" title="3.null in java"></a>3.null in java</h3><blockquote><p>javaçš„nullå˜é‡æ˜¯å¯ä»¥éšè—åœ¨ä»»ä½•ç±»å‹èƒŒåçš„ï¼Œè€ŒNullPointExceptionæ˜¯æˆ‘ä»¬æœ€è®¨åŒçš„æŠ¥é”™ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºä¸­èŠ±è´¹å¤§é‡çš„æ—¶é—´å»è¿›è¡Œnullçš„åˆ¤æ–­ï¼Œå½“æ–¹æ³•è¿”å›nullçš„æ—¶å€™æˆ‘ä»¬éƒ½éœ€è¦èŠ±è´¹å¤§é‡çš„ç²¾åŠ›å»åˆ¤æ–­è¿™æ˜¯æœ‰æ„çš„ç¼ºå¤±è¿˜æ˜¯æ•…éšœçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å–„ç”¨jdkå¸®æˆ‘ä»¬æä¾›çš„apiã€‚</p></blockquote><ul><li><p>åˆ¤æ–­å˜é‡æ˜¯å¦æ˜¯nullæˆ–è€…ä¸æ˜¯null</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testNull</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">if</span> (Objects.isNull(obj))&#123;<br>        log.warn(<span class="hljs-string">&quot;variable obj is null&quot;</span>);<br>    &#125;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;hello&quot;</span>;<br>    <span class="hljs-keyword">if</span> (Objects.nonNull(str))&#123;<br>        log.info(<span class="hljs-string">&quot;variable str not null&quot;</span>);<br>    &#125;<br>    Objects.requireNonNull(obj); <span class="hljs-comment">// throw  NullPointerException</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å½“æˆ‘ä»¬è‡ªå·±çš„æ–¹æ³•æœ‰å¯èƒ½è¿”å›nullå€¼çš„æ—¶å€™æˆ‘ä»¬åº”è¯¥ä½¿ç”¨Optionalè¿›è¡Œå°è£…ï¼Œè¿™æ ·åœ¨è¯­ä¹‰ä¸Šå°±èƒ½ç«‹åˆ»çŸ¥é“å®ƒæœ‰å¯èƒ½å­˜åœ¨nullçš„æƒ…å†µ</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testOptional</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-comment">// åˆ›å»º</span><br>    Optional&lt;String&gt; aaa = Optional.of(<span class="hljs-string">&quot;aaa&quot;</span>);<br>    Optional&lt;String&gt; bbb = Optional.ofNullable(obj);<br>    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦æœ‰å€¼</span><br>    <span class="hljs-keyword">if</span> (aaa.isPresent()) &#123;<br>        log.info(<span class="hljs-string">&quot;aaa not null, value is &#123;&#125;&quot;</span>, aaa.get());<br>    &#125;<br>    <span class="hljs-comment">// è·å–ï¼Œå¦‚æœæ˜¯nullè¿”å›default</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Optional.ofNullable(obj).orElse(<span class="hljs-string">&quot;bbb&quot;</span>);<br>    log.info(<span class="hljs-string">&quot;default value is &#123;&#125;&quot;</span>, result);<br>    <span class="hljs-comment">// è·å–ï¼Œå¦‚æœæ˜¯nullæŠ›å‡ºæŒ‡å®šå¼‚å¸¸</span><br>    result = bbb.orElseThrow(IllegalArgumentException::<span class="hljs-keyword">new</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-Stringç±»æ–°æ–¹æ³•"><a href="#4-Stringç±»æ–°æ–¹æ³•" class="headerlink" title="4.Stringç±»æ–°æ–¹æ³•"></a>4.Stringç±»æ–°æ–¹æ³•</h3><p>Java11ä¹‹å‰æˆ‘ä»¬æƒ³è¦å¯¹Stringè¿›è¡Œä¸€äº›åˆ¤ç©ºæ“ä½œçš„æ—¶å€™å¾€å¾€ä¼šå¼•å…¥Commons-lang3åŒ…ï¼Œå› ä¸ºè‡ªå¸¦çš„Stringæ–¹æ³•å®åœ¨å¤ªå°‘äº†ï¼Œè€ŒJava11ä¹‹åStringæœ‰æ–°å¢ä¸€äº›æ¯”è¾ƒå®ç”¨çš„æ–¹æ³•</p><ul><li>isBlank():å¦‚æœå­—ç¬¦ä¸²ä¸ºç©ºæˆ–ä»…åŒ…å«ç©ºæ ¼ä»£ç ç‚¹ï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›trueã€‚</li><li>lines():æ­¤æ–¹æ³•è¿”å›ä»å­—ç¬¦ä¸²ä¸­æå–çš„è¡Œæµï¼Œå¹¶ç”¨\ nï¼Œ\ rç­‰è¡Œç»ˆæ­¢ç¬¦åˆ†éš”ã€‚</li><li>strip()ï¼ŒstripLeading()ï¼ŒstripTrailing() ï¼šè¿™äº›æ–¹æ³•ç”¨äºä»å­—ç¬¦ä¸²ä¸­å»é™¤ç©ºæ ¼ã€‚ é¡¾åæ€ä¹‰ï¼Œ strip()å°†åˆ é™¤å‰å¯¼å’Œå°¾éšç©ºæ ¼ã€‚ ä½†æ˜¯ï¼Œ stripLeading()å°†ä»…åˆ é™¤å‰å¯¼ç©ºæ ¼ï¼Œè€ŒstripTrailing()å°†ä»…åˆ é™¤å°¾éšç©ºæ ¼</li><li>repeatï¼ˆint nï¼‰ ï¼šæ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²çš„å€¼æ˜¯è¯¥å­—ç¬¦ä¸²çš„é‡å¤næ¬¡çš„ä¸²è”<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testStr</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">blank</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;    &quot;</span>;<br>    <span class="hljs-keyword">assert</span> blank.isBlank();<br>    <span class="hljs-type">var</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot; hello world &quot;</span>;<br>    <span class="hljs-keyword">assert</span> Objects.equals(str.strip(), <span class="hljs-string">&quot;hello world&quot;</span>);<br>    <span class="hljs-keyword">assert</span> Objects.equals(str.stripLeading(), <span class="hljs-string">&quot;hello world &quot;</span>);<br>    <span class="hljs-keyword">assert</span> Objects.equals(str.stripTrailing(), <span class="hljs-string">&quot; hello world&quot;</span>);<br>    <span class="hljs-keyword">assert</span> Objects.equals(str.repeat(<span class="hljs-number">2</span>), <span class="hljs-string">&quot; hello world  hello world &quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="4-javaåŸºäºå€¼ç±»å‹-Value-Types"><a href="#4-javaåŸºäºå€¼ç±»å‹-Value-Types" class="headerlink" title="4.javaåŸºäºå€¼ç±»å‹ (Value Types)"></a>4.javaåŸºäºå€¼ç±»å‹ (Value Types)</h3><p>åœ¨Java11ä¸­æ˜ç¡®å®šä¹‰äº†åŸºäºå€¼çš„ç±»å‹ï¼Œå€¼ç±»å‹æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œæ—¨åœ¨æŒ‰å€¼ä¼ å…¥å’Œä¼ å‡ºæ–¹æ³•ï¼Œå¹¶æŒ‰å€¼å­˜å‚¨åœ¨æ•°æ®ç»“æ„ä¸­ã€‚<br>åŸºäºå€¼çš„ç±»æ˜¯Containerç±»ï¼Œæ˜¯åŸºäºå€¼çš„ç±»å‹çš„åŒ…è£…å™¨ï¼Œå…¶ä¸­åŸºäºå€¼çš„ç±»çš„å®ä¾‹éµå¾ªä»¥ä¸‹åŸåˆ™ï¼ˆæ¥è‡ªJavaæ–‡æ¡£ï¼‰ï¼š</p><ul><li>è¯¥ç±»æ˜¯finalçš„ï¼ˆå°½ç®¡å¯èƒ½åŒ…å«å¯¹å¯å˜å¯¹è±¡çš„å¼•ç”¨ï¼‰ï¼Œå¹¶ä¸”åªå®šä¹‰finalå­—æ®µï¼Œå¹¶ä¸”ä¸å­˜åœ¨ç»§æ‰¿æˆ–è€…å®ç°</li><li>å…·æœ‰equalsï¼ŒhashCodeå’ŒtoStringçš„å®ç°ï¼Œè¿™äº›å®ç°ä»…æ ¹æ®å®ä¾‹çš„çŠ¶æ€è€Œä¸æ˜¯æ ¹æ®å…¶æ ‡è¯†æˆ–ä»»ä½•å…¶ä»–å¯¹è±¡æˆ–å˜é‡çš„çŠ¶æ€è¿›è¡Œè®¡ç®—</li><li>æ²¡æœ‰å¯è®¿é—®çš„æ„é€ å‡½æ•°ï¼ˆæˆ–è€…æ˜ç¡®è¯¥æ„é€ ä»¥åä¼šåˆ é™¤ï¼Œæ‰€ä»¥Stringä¸æ»¡è¶³è¯¥æ¡ä»¶ï¼‰ï¼Œè€Œæ˜¯é€šè¿‡å·¥å‚æ–¹æ³•å®ä¾‹åŒ–çš„ï¼Œè¿™äº›æ–¹æ³•ä¸æ‰¿è¯ºè¿”å›å®ä¾‹çš„èº«ä»½</li><li>ä¸ä½¿ç”¨èº«ä»½æ•æ„Ÿçš„æ“ä½œï¼Œä¾‹å¦‚å®ä¾‹ä¹‹é—´çš„å¼•ç”¨ç›¸ç­‰ï¼ˆ&#x3D;&#x3D;ï¼‰ï¼Œè€Œæ˜¯åŸºäºequalsè¢«è§†ä¸ºç›¸ç­‰ï¼Œå› ä¸ºä¸Šè¾¹ä¸ä¿è¯ç”Ÿæˆç›¸åŒæˆ–è€…ä¸åŒçš„å®ä¾‹</li><li>åœ¨ç›¸ç­‰æ—¶å¯ä»¥è‡ªç”±æ›¿æ¢ï¼Œè¿™æ„å‘³ç€åœ¨ä»»ä½•è®¡ç®—æˆ–æ–¹æ³•è°ƒç”¨ä¸­äº’æ¢ç­‰äºequalsï¼ˆï¼‰çš„ä»»æ„ä¸¤ä¸ªå®ä¾‹xå’Œyéƒ½ä¸ä¼šåœ¨è¡Œä¸ºä¸Šäº§ç”Ÿä»»ä½•å¯è§çš„å˜åŒ–ã€‚</li><li>é€šè¿‡å·¥å‚æ–¹æ³•è·å–çš„å®ä¾‹ä¸ä¿è¯æ¯æ¬¡éƒ½æ˜¯ä¸åŒçš„å®ä¾‹ï¼ˆintegerå°±å­˜åœ¨ç¼“å­˜-128-127ä¹‹é—´åªç”Ÿæˆä¸€ä»½ï¼‰</li></ul><p>æ˜¾è€Œæ˜“è§Javaè¯­è¨€ç›´æ¥æ”¯æŒçš„å”¯ä¸€å€¼ç±»å‹æ˜¯å…«ç§åŸå§‹ç±»å‹å’ŒOptional</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Deprecated(since=&quot;9&quot;, forRemoval = true)</span><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Integer</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> &#123;<br>    <span class="hljs-built_in">this</span>.value = value;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title function_">valueOf</span><span class="hljs-params">(String s)</span> <span class="hljs-keyword">throws</span> NumberFormatException &#123;<br>    <span class="hljs-keyword">return</span> Integer.valueOf(parseInt(s, <span class="hljs-number">10</span>));<br>&#125;<br><br><span class="hljs-meta">@IntrinsicCandidate</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title function_">valueOf</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>    <span class="hljs-keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)<br>        <span class="hljs-keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(i);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-AutoCloseable"><a href="#5-AutoCloseable" class="headerlink" title="5.AutoCloseable"></a>5.AutoCloseable</h3><p>æˆ‘ä»¬éƒ½çŸ¥é“Javaçš„Objectå¯¹è±¡æœ‰ä¸€ä¸ªfinalizeæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šå­˜åœ¨è¯¥æ–¹æ³•å¹¶ä¸”æˆ‘ä»¬å¯ä»¥é‡å†™å®ƒ(ç»§æ‰¿å¸¦æ¥çš„å¼Šç«¯)ã€‚è¯¥æ–¹æ³•ä¼šå¯¹è±¡ä¸å­˜åœ¨å¼•ç”¨çš„æ—¶å€™è¿›è¡Œåƒåœ¾å›æ”¶æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šå®ç°è¯¥æ–¹æ³•åœ¨è¯¥æ–¹æ³•ä¸­é‡Šæ”¾IOæˆ–è€…é“¾æ¥æˆ–è€…èµ„æºï¼Œä½†æ˜¯å®ƒä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œè€Œä¸”æˆ‘ä»¬æ°¸è¿œä¹Ÿä¸çŸ¥é“å®ƒä»€ä¹ˆæ—¶å€™ä¼šè¢«è°ƒç”¨(å‡è®¾åœ¨æ²¡æœ‰å¼•ç”¨ä¹‹å‰å®ƒå…ˆæ™‹å‡åˆ°äº†è€å¹´ä»£ï¼Œé‚£ä¹ˆèµ„æºå°±æŒ‚åœ¨äº†è€å¹´ä»£ï¼Œå¾ˆææ€–çš„äº‹æƒ…)ï¼Œå®ƒä¹Ÿä¼šç»™åƒåœ¾å›æ”¶å™¨å¸¦æ¥è´Ÿæ‹…ï¼Œå› ä¸ºå¤„ç†å®ƒä¼šå¢åŠ æ—¶é—´ï¼Œä¹Ÿä¸èƒ½ä¿è¯è°ƒç”¨å®ƒçš„æ—¶å€™ä¼šä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸€ä¸ªå¯¹è±¡å®ƒæœ‰ä¸€ä¸ªArrayListå­—æ®µï¼Œæˆ‘ä»¬æƒ³è¦åœ¨å¯¹è±¡åƒåœ¾å›æ”¶çš„æ—¶å€™é‡Šæ”¾listï¼Œæˆ‘ä»¬éƒ½çŸ¥é“é‡Šæ”¾listéœ€è¦è°ƒç”¨listçš„clearæ–¹æ³•ï¼Œå…¶å®æˆ‘ä»¬éƒ½çŸ¥é“ArrayListä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é›†åˆï¼Œå¦‚æœçœŸçš„è¿™æ ·åšå¾ˆå¯èƒ½ä¼šå‡ºç°å¹¶å‘ä¿®æ”¹çš„å¼‚å¸¸ï¼Œè€Œä¸”å› ä¸ºæ˜¯é‡å†™äº†finalizeæ–¹æ³•æ‰€ä»¥æˆ‘ä»¬ä¸å¯èƒ½å¯¹æ–¹æ³•åŠ é”ï¼Œæ‰€ä»¥jdkå®˜æ–¹ä¹Ÿè®¤è¯†åˆ°äº†è¿™ä¸€ç‚¹åœ¨jdk9ç‰ˆæœ¬å°†è¯¥æ–¹æ³•è®¾ç½®ä¸ºè¿‡æ—¶çš„æ–¹æ³•äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°AutoCloseableæ¥å£é€šè¿‡try withè¯­æ³•å»æ“ä½œèµ„æºå¹¶ä¿è¯èµ„æºé‡Šæ”¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataSourceConnection</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AutoCloseable</span>&#123;<br><br>    <span class="hljs-keyword">private</span> String url;<br>    <span class="hljs-keyword">private</span> String connection;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataSourceConnection</span><span class="hljs-params">(String url)</span> &#123;<br>        <span class="hljs-built_in">this</span>.url = url;<br>        <span class="hljs-built_in">this</span>.connection = url + <span class="hljs-string">&quot;conn&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// TODOï¼š</span><br>        log.info(<span class="hljs-string">&quot;å…³é—­é“¾æ¥ï¼Œé‡Šæ”¾èµ„æº====&gt;&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testClose</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-keyword">try</span> (<span class="hljs-type">DataSourceConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceConnection</span>(<span class="hljs-string">&quot;rul&quot;</span>)) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> connection.getConnection();<br>        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span></span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-break-label"><a href="#6-break-label" class="headerlink" title="6.break label"></a>6.break label</h3><p>å…¶å®è¿™ä¸ªä¹Ÿä¸ç®—æ˜¯apiäº†ï¼Œå®ƒåªèƒ½ç®—æ˜¯ä¸€ä¸ªå¤§å®¶éƒ½æ²¡æ³¨æ„çš„è¯­æ³•ç‰¹æ€§ï¼ŒJavaæ²¡æœ‰åƒcä¸­çš„gotoè¯­å¥ï¼Œæƒ³è¦å®ç°ä»»æ„çš„å¾ªç¯è·³è½¬å°±è¦ä½¿ç”¨label<br>æˆ‘ä»¬éƒ½çŸ¥é“breakå’Œcontinueåˆ†åˆ«æ˜¯ç»“æŸå½“ä¸”å¾ªç¯å’Œç»“æŸè¿™ä¸€è½®å¾ªç¯ï¼Œå¦‚æœæ˜¯å¤šå±‚forå¾ªç¯åµŒå¥—çš„è¯å°±ä¸èƒ½ç›´æ¥é€€å‡ºåˆ°æŒ‡å®šçš„å¾ªç¯å±‚çº§ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå€ŸåŠ©lableå®ç°è¯¥åŠŸèƒ½</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">5</span>; j++) &#123;<br>        <span class="hljs-keyword">if</span> (j == <span class="hljs-number">3</span>) &#123;<br>            <span class="hljs-keyword">break</span>;  <span class="hljs-comment">// continue;</span><br>        &#125;<br>        System.out.print(<span class="hljs-string">&quot;&quot;</span> + i + j + <span class="hljs-string">&quot; &quot;</span>);<br>    &#125;<br>    System.out.println();<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;This is end&quot;</span>);<br><span class="hljs-comment">//00 01 02</span><br><span class="hljs-comment">//10 11 12</span><br><span class="hljs-comment">//20 21 22</span><br><span class="hljs-comment">//30 31 32</span><br><span class="hljs-comment">//40 41 42</span><br><span class="hljs-comment">//This is end</span><br><br><span class="hljs-comment">//00 01 02 04</span><br><span class="hljs-comment">//10 11 12 14</span><br><span class="hljs-comment">//20 21 22 24</span><br><span class="hljs-comment">//30 31 32 34</span><br><span class="hljs-comment">//40 41 42 44</span><br><span class="hljs-comment">//This is end</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>    Label_inner:    <span class="hljs-comment">// å…¶å®é»˜è®¤breakå’Œcontinueå°±æ˜¯åœ¨è¿™å±‚ï¼Œæ‰€ä»¥å†™ä¸å†™éƒ½ä¸€æ ·</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">5</span>; j++) &#123;<br>        <span class="hljs-keyword">if</span> (j == <span class="hljs-number">3</span>) &#123;<br>            <span class="hljs-comment">//break Label_inner;</span><br>            <span class="hljs-keyword">continue</span> Label_inner;<br>        &#125;<br>        System.out.print(<span class="hljs-string">&quot;&quot;</span> + i + j + <span class="hljs-string">&quot; &quot;</span>);<br>    &#125;<br>    System.out.println();<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;This is end&quot;</span>);<br><br><span class="hljs-comment">//00 01 02</span><br><span class="hljs-comment">//10 11 12</span><br><span class="hljs-comment">//20 21 22</span><br><span class="hljs-comment">//30 31 32</span><br><span class="hljs-comment">//40 41 42</span><br><span class="hljs-comment">//This is end</span><br><br><span class="hljs-comment">//00 01 02 04</span><br><span class="hljs-comment">//10 11 12 14</span><br><span class="hljs-comment">//20 21 22 24</span><br><span class="hljs-comment">//30 31 32 34</span><br><span class="hljs-comment">//40 41 42 44</span><br><span class="hljs-comment">//This is endinner</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">Label_outer:<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">5</span>; j++) &#123;<br>        <span class="hljs-keyword">if</span> (j == <span class="hljs-number">3</span>) &#123;<br>            <span class="hljs-keyword">break</span> Label_outer;<br>            <span class="hljs-comment">//continue Label_outer;</span><br>        &#125;<br>        System.out.print(<span class="hljs-string">&quot;&quot;</span> + i + j + <span class="hljs-string">&quot; &quot;</span>);<br>    &#125;<br>    System.out.println();<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;This is end&quot;</span>);<br><br><span class="hljs-comment">// 00 01 02 This is end</span><br><span class="hljs-comment">// 00 01 02 10 11 12 20 21 22 30 31 32 40 41 42 This is end</span><br></code></pre></td></tr></table></figure><h3 id="7-Predicateæ–­è¨€å‹å‡½æ•°æ¥å£"><a href="#7-Predicateæ–­è¨€å‹å‡½æ•°æ¥å£" class="headerlink" title="7.Predicateæ–­è¨€å‹å‡½æ•°æ¥å£"></a>7.Predicateæ–­è¨€å‹å‡½æ•°æ¥å£</h3><p>Predicateæˆ‘ä»¬ä¼šç»å¸¸ä½¿ç”¨ï¼Œå› ä¸ºJava8åªä»æœ‰äº†streamæµä¹‹åæˆ‘ä»¬ç»å¸¸ä½¿ç”¨filteræ–¹æ³•è¿›è¡Œé›†åˆçš„è¿‡æ»¤ç­›é€‰ï¼Œæœ‰å¾ˆå¤šå†…ç½®apiå¸®æˆ‘ä»¬æä¾›äº†æ–¹æ³•å¼•ç”¨ç¬¦åˆæˆ‘ä»¬ä½¿ç”¨åœºæ™¯çš„æ—¶å€™åªéœ€å¼•ç”¨å°±è¡Œï¼Œä½†æ˜¯å› ä¸ºæ˜¯æ–¹æ³•å¼•ç”¨æ‰€ä»¥å®ƒä¸æ”¯æŒéï¼ˆæ“ä½œï¼‰æˆ–è€…ç»„åˆæ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨Predicateå†…ç½®çš„æ–¹æ³•å¸®æˆ‘ä»¬è¿›è¡Œå¢å¼ºäº†ï¼Œå¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPredicate</span><span class="hljs-params">()</span> &#123;<br>    List&lt;List&lt;?&gt;&gt; list1 = List.of(List.of(<span class="hljs-string">&quot;zz&quot;</span>), Collections.emptyList());<br>    <span class="hljs-comment">// æˆ‘ä»¬æƒ³è¦è¿‡æ»¤listå†…éƒ¨ä¸ä¸ºç©ºçš„é›†åˆ</span><br>    List&lt;List&lt;?&gt;&gt; list2 = list1.stream().filter(Predicate.not(List::isEmpty)).toList();<br>    System.out.println(list2);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPredicate</span><span class="hljs-params">()</span> &#123;<br>    List&lt;String&gt; names = List.of(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-string">&quot;ls&quot;</span>, <span class="hljs-string">&quot;ww&quot;</span>, <span class="hljs-string">&quot;lxy&quot;</span>, <span class="hljs-string">&quot;ywj&quot;</span>, <span class="hljs-string">&quot;suaf&quot;</span>);<br>    <span class="hljs-comment">//    è¿‡æ»¤åå­—é•¿åº¦å°äºç­‰äº3ï¼Œä¸”ä¸ä»¥Wå¼€å¤´çš„</span><br>    List&lt;String&gt; names2 = names.stream().filter(s -&gt; &#123;<br>        <span class="hljs-keyword">if</span> (!s.isBlank() &amp;&amp; s.length() &lt;= <span class="hljs-number">3</span> &amp;&amp; !s.startsWith(<span class="hljs-string">&quot;w&quot;</span>)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;).toList();<br>    Predicate&lt;String&gt; isNotStartsWith = s -&gt; !s.startsWith(<span class="hljs-string">&quot;w&quot;</span>);<br>    Predicate&lt;String&gt; shorterThan4 = s -&gt; s.length() &lt;= <span class="hljs-number">3</span>;<br>    List&lt;String&gt; names3 = names.stream().filter(Predicate.not(String::isBlank).and(isNotStartsWith).and(shorterThan4)).toList();<br>    <span class="hljs-keyword">assert</span> names3.equals(names2);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="8-Comparatoræ¯”è¾ƒå™¨"><a href="#8-Comparatoræ¯”è¾ƒå™¨" class="headerlink" title="8.Comparatoræ¯”è¾ƒå™¨"></a>8.Comparatoræ¯”è¾ƒå™¨</h3><p>Comparatoræ¯”è¾ƒå™¨æˆ‘ä»¬ä¼šç»å¸¸ä½¿ç”¨ï¼Œå› ä¸ºJava8è‡ªä»æœ‰äº†streamæµä¹‹åæˆ‘ä»¬ç»å¸¸ä½¿ç”¨sortæ–¹æ³•è¿›è¡Œé›†åˆçš„æ’åºï¼Œæœ‰å¾ˆå¤šå†…ç½®apiå¸®æˆ‘ä»¬æä¾›äº†é»˜è®¤çš„æ¯”è¾ƒæ–¹æ³•ï¼Œåœ¨ç¬¦åˆæˆ‘ä»¬ä½¿ç”¨åœºæ™¯çš„æ—¶å€™åªéœ€ä½¿ç”¨æ–¹æ³•å¼•ç”¨å°±è¡Œï¼Œä½†æ˜¯å› ä¸ºæ˜¯æ–¹æ³•å¼•ç”¨æ‰€ä»¥å®ƒä¸æ”¯æŒå€’åºæˆ–è€…å¤šå€¼æ¯”è¾ƒä»€ä¹ˆçš„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testComparable</span><span class="hljs-params">()</span> &#123;<br>    List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;lisi&quot;</span>, <span class="hljs-string">&quot;wangwu&quot;</span>, <span class="hljs-string">&quot;zhaoliu&quot;</span>, <span class="hljs-string">&quot;zhouqi&quot;</span>);<br>    <span class="hljs-comment">// æˆ‘ä¸è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•ï¼Œä¹Ÿè®¸æœ‰ä¸€ä¸ªä¸æ¥å—ä»»ä½•å‚æ•°çš„é‡è½½æ–¹æ³•æ›´å¥½</span><br>    <span class="hljs-comment">// å¦‚æœæŒ‡å®šçš„æ¯”è¾ƒå™¨æ˜¯ null ï¼Œåˆ™æ­¤åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¿…é¡»å®ç°æ¥å£Comparableå¹¶ä¸”åº”ä½¿ç”¨å…ƒç´ çš„è‡ªç„¶é¡ºåºï¼Œstringæ­£å¥½å®ç°äº†Comparable</span><br>    names.sort(<span class="hljs-literal">null</span>);<br>    names.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testComparator</span><span class="hljs-params">()</span> &#123;<br>    List&lt;String&gt; names = Arrays.asList(<span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;lisi&quot;</span>, <span class="hljs-string">&quot;wangwu&quot;</span>, <span class="hljs-string">&quot;zhaoliu&quot;</span>, <span class="hljs-string">&quot;zhouqi&quot;</span>);<br>    <span class="hljs-comment">// æŒ‰ç…§å­—ç¬¦ä¸²é•¿åº¦æ’åº</span><br>    <span class="hljs-comment">// ä¹¦å†™æ³•åˆ™ï¼šif o1 &gt; o2 then (o1, o2) &gt; 0</span><br>    <span class="hljs-comment">// ä¹¦å†™æ³•åˆ™ï¼šif o1 &lt; o2 then (o1, o2) &lt; 0</span><br>    <span class="hljs-comment">// ä¹¦å†™æ³•åˆ™ï¼šif o1 = o2 then (o1, o2) = 0</span><br>    <span class="hljs-comment">// Comparator&lt;String&gt; comparator = ((o1, o2) -&gt; o1.length() - o2.length();</span><br>    Comparator&lt;String&gt; comparator = Comparator.comparingInt(String::length);<br>    names.sort(comparator);<br>    names.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testComparator</span><span class="hljs-params">()</span> &#123;<br>    List&lt;Integer&gt; numbers = List.of(<span class="hljs-number">123</span>, <span class="hljs-number">21</span>, <span class="hljs-number">32</span>, <span class="hljs-number">125</span>, <span class="hljs-number">1</span>, <span class="hljs-number">321</span>);<br>    <span class="hljs-comment">// å‡åº</span><br>    List&lt;Integer&gt; list = numbers.stream().sorted(Integer::compare).toList();<br>    System.out.println(<span class="hljs-string">&quot;list = &quot;</span> + list);<br>    <span class="hljs-comment">// é™åº</span><br>    Comparator&lt;Integer&gt; comparator = Integer::compare;<br>    List&lt;Integer&gt; list2 = numbers.stream().sorted(comparator.reversed()).toList();<br>    System.out.println(<span class="hljs-string">&quot;list2 = &quot;</span> + list2);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testComparator</span><span class="hljs-params">()</span> &#123;<br>    List&lt;String&gt; names = List.of(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-string">&quot;ls&quot;</span>, <span class="hljs-string">&quot;ww&quot;</span>, <span class="hljs-string">&quot;lxy&quot;</span>, <span class="hljs-string">&quot;ywj&quot;</span>, <span class="hljs-string">&quot;suaf&quot;</span>);<br>    <span class="hljs-comment">//  æŒ‰ç…§åå­—å­—ç¬¦é•¿çŸ­æ’åº</span><br>    Comparator&lt;String&gt; comparing = Comparator.comparing(String::length);<br>    List&lt;String&gt; list1 = names.stream().sorted(comparing).toList();<br>    List&lt;String&gt; list2 = names.stream().sorted(comparing.reversed()).toList();<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> &#123;<br>    <span class="hljs-keyword">private</span> String userName;<br>    <span class="hljs-keyword">private</span> Integer age;<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testComparator23</span><span class="hljs-params">()</span> &#123;<br>    ArrayList&lt;User&gt; users = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;() &#123;&#123;<br>        add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;zs&quot;</span>, <span class="hljs-number">23</span>));<br>        add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;ls&quot;</span>, <span class="hljs-number">24</span>));<br>        add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;ww&quot;</span>, <span class="hljs-number">25</span>));<br>        add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;zl&quot;</span>, <span class="hljs-number">26</span>));<br>        add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;zqq&quot;</span>, <span class="hljs-number">26</span>));<br>        add(<span class="hljs-literal">null</span>);<br>    &#125;&#125;;<br>    Comparator&lt;User&gt; comparatorByAge = Comparator.comparing(User::getAge);<br>    Comparator&lt;User&gt; comparatorByName = Comparator.comparing(User::getUserName);<br>    <span class="hljs-comment">// å…ˆæŒ‰ç…§ageæ’åºã€‚å†æŒ‰ç…§nameæ’åº</span><br>    List&lt;User&gt; list1 = users.stream().sorted(Comparator.nullsLast(comparatorByAge.thenComparing(comparatorByName))).toList();<br>    List&lt;User&gt; list2 = users.stream().sorted(Comparator.nullsFirst(comparatorByAge.thenComparing(comparatorByName).reversed())).toList();<br>    System.out.println(<span class="hljs-string">&quot;list1 = &quot;</span> + list1);<br>    System.out.println(<span class="hljs-string">&quot;list2 = &quot;</span> + list2);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="9-Java-shebang"><a href="#9-Java-shebang" class="headerlink" title="9.Java shebang"></a>9.Java shebang</h3><p>æˆ‘ä»¬ä¸€ç›´ç¾¡æ…•pythonä½œä¸ºè„šæœ¬è¯­è¨€çš„æ—¶å€™èƒ½ç›´æ¥æ‰§è¡Œï¼Œè€Œä¸€ä¸ªJavaä»£ç ä½ éœ€è¦å…ˆä½¿ç”¨Javacç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œç„¶åå†ä½¿ç”¨Javaå‘½ä»¤è¿è¡Œï¼Œè¿™æ˜¯ä¸€ä¸ªç®€å•Javaè„šæœ¬æœ€ç¹ççš„åœ°æ–¹ï¼Œå¥½åœ¨Javaæ¨å‡ºäº†shebangè¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"># !/path/you java path     --source <span class="hljs-number">17</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloWorld</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Hello World!&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">./HelloWorld<br></code></pre></td></tr></table></figure><h3 id="10-stringç›¸å…³"><a href="#10-stringç›¸å…³" class="headerlink" title="10.stringç›¸å…³"></a>10.stringç›¸å…³</h3><p>å­—ç¬¦ä¸²jdkä¹Ÿä¸€ç›´åœ¨ä¼˜åŒ–ï¼Œæ›¾ç»ä¸åŒç‰ˆæœ¬çš„å­—ç¬¦ä¸²å¯èƒ½ä¼šæœ‰ç‚¹æ€§èƒ½å·®å¼‚ï¼Œä½†æ˜¯ç°åœ¨ç»è¿‡ä¼˜åŒ–ä¹‹åå¥½äº†å¾ˆå¤šä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯åº”è¯¥æ³¨æ„ä½¿ç”¨çš„æ—¶å€™æŒ‰ç…§è§„èŒƒä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testStringJoin</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    List&lt;String&gt; string = List.of(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-string">&quot;c&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">join</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span> (String s : string) &#123;<br>        <span class="hljs-comment">// æ°¸è¿œä¸è¦åœ¨å¾ªç¯å†…è¿›è¡Œè¿™æ ·çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¼šéšå£«çš„åˆ›å»ºå¾ˆå¤šStringBuilderå¯¹è±¡</span><br>        join += s;<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;join = &quot;</span> + join);<br>    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>    <span class="hljs-keyword">for</span> (String s : string) &#123;<br>        sb.append(s);<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;sb.toString() = &quot;</span> + sb);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testNumber2Str</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-type">Integer</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">num_str</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span> + <span class="hljs-string">&quot;&quot;</span>;  <span class="hljs-comment">// æ°¸è¿œä¸è¦è¿™æ ·ï¼Œè™½ç„¶java8ä¹‹å‰è¿™æ ·æ˜¯æœ€å¿«çš„</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">num_str2</span> <span class="hljs-operator">=</span> num2.toString();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">num_str1</span> <span class="hljs-operator">=</span> Integer.toString(num);<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jdk8ä¹‹åå„ç‰ˆæœ¬å¸¸ç”¨æ–°ç‰¹æ€§</title>
    <link href="/2022/08/11/jdk8%E4%B9%8B%E5%90%8E%E5%90%84%E7%89%88%E6%9C%AC%E5%B8%B8%E7%94%A8%E6%96%B0%E7%89%B9%E6%80%A7/"/>
    <url>/2022/08/11/jdk8%E4%B9%8B%E5%90%8E%E5%90%84%E7%89%88%E6%9C%AC%E5%B8%B8%E7%94%A8%E6%96%B0%E7%89%B9%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h2 id="JDK10-var-å…³é”®å­—"><a href="#JDK10-var-å…³é”®å­—" class="headerlink" title="JDK10 var å…³é”®å­—"></a>JDK10 var å…³é”®å­—</h2><blockquote><p><a href="https://openjdk.org/jeps/286">REP-286</a> å¢å¼º Java è¯­è¨€ï¼Œå°†ç±»å‹æ¨æ–­æ‰©å±•åˆ°å¸¦æœ‰åˆå§‹å€¼è®¾å®šé¡¹çš„å±€éƒ¨å˜é‡å£°æ˜ã€‚æˆ‘ä»¬å¯»æ±‚é€šè¿‡å‡å°‘ä¸ç¼–å†™ Java ä»£ç ç›¸å…³çš„ä»ªå¼æ”¹å–„å¼€å‘äººå‘˜çš„ä½“éªŒï¼ŒåŒæ—¶é€šè¿‡å…è®¸å¼€å‘äººå‘˜çœç•¥é€šå¸¸ä¸å¿…è¦çš„å±€éƒ¨å˜é‡ç±»å‹çš„æ¸…å•å£°æ˜æ¥ä¿æŒ Java å¯¹é™æ€ç±»å‹å®‰å…¨çš„æ‰¿è¯ºâ€‹æŸ¥è¯¢è¯¦æƒ…</p></blockquote><p>å±€éƒ¨å˜é‡æ¨æ–­ç±»å‹ï¼Œä½œç”¨åœ¨å±€éƒ¨ä»£ç å—ä¸­ï¼Œé€šè¿‡ç¼–è¯‘å™¨çš„ç±»å‹æ¨æ–­æ¥é¿å…é¢‘ç¹çš„å®šä¹‰ä¸€äº›ç±»å‹ï¼Œå…¶ç›®æ ‡æ˜¯ä½œç”¨åœ¨å±€éƒ¨å˜é‡ã€lambdaè¡¨è¾¾å¼ã€forå¾ªç¯ä¸­å£°æ˜é™ä½ Java ä»£ç ç¼–å†™å’Œé˜…çš„ç¹çç¨‹åº¦(ä¸ç”¨å·¦å³å¤åˆ¶å˜é‡çš„ç±»å‹ä¿¡æ¯çœŸçš„å¾ˆçˆ½)ï¼Œä½†æ˜¯varå…³é”®å­—ä½¿ç”¨ä¸å½“ä¹Ÿä¼šé™ä½å…¶ä»£ç çš„å¯è¯»æ€§ï¼Œæ‰€ä»¥è¿˜æ˜¯è°¨æ…ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@SneakyThrows</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testVar</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ç«‹å³å£°æ˜ä¸”åˆå§‹è¯çš„æ—¶å€™æ‰èƒ½ä½¿ç”¨varå˜é‡</span><br>    <span class="hljs-type">var</span> <span class="hljs-variable">users</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">assert</span> users <span class="hljs-keyword">instanceof</span> List;<br>    users.add(<span class="hljs-string">&quot;zs&quot;</span>);<br>    users.add(<span class="hljs-string">&quot;ls&quot;</span>);<br>    users.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h2><p>switch-caseè¯­æ³•ä¸€ç›´éƒ½æœ‰ï¼Œä½†æ˜¯è¿‡å»çš„switchä¸èƒ½åˆ¤æ–­åŸºæœ¬æ•°æ®ç±»å‹ã€æšä¸¾ã€nullï¼Œåˆ†æ”¯ä¹‹åä¹Ÿä¸æ”¯æŒä»£ç å—ï¼Œä½†æ˜¯ä»JDK12å¼€å§‹å¯¹å…¶è¿›è¡Œäº†å¤§çš„å¢å¼ºï¼Œä¸€ç›´å»¶ç»­åˆ°ç°åœ¨è¿˜æ²¡æœ‰åœæ­¢ï¼Œæœ¬æ–‡ä½¿ç”¨ç¯å¢ƒä¸ºJDK17ï¼Œæ‰€ä»¥è¿˜æœ‰19ä¸Šæ–°å¢åŠ çš„caseç±»å‹åˆ¤æ–­æ²¡æœ‰æµ‹è¯•</p><ul><li><p>åŸºæœ¬æ•°æ®ç±»å‹çš„æ”¯æŒå’Œyieldå…³é”®å­—çš„ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSwitch</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (number) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">yield</span>  <span class="hljs-string">&quot;zero&quot;</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;one&quot;</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;two&quot;</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;three&quot;</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;æœªçŸ¥&quot;</span>;<br>    &#125;;<br>    log.info(<span class="hljs-string">&quot;The English representation of &#123;&#125; is &#123;&#125;&quot;</span>, number, result);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æšä¸¾çš„æ”¯æŒä¸caseå¤šå€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æšä¸¾</span><br><span class="hljs-keyword">enum</span> <span class="hljs-title class_">DAYS</span> &#123;<br>    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSwitch2</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">day</span> <span class="hljs-operator">=</span> DAYS.SUNDAY;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (day) &#123;<br>        <span class="hljs-keyword">case</span> MONDAY:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekday&quot;</span>;<br>        <span class="hljs-keyword">case</span> TUESDAY:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekday&quot;</span>;<br>        <span class="hljs-keyword">case</span> WEDNESDAY:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekday&quot;</span>;<br>        <span class="hljs-keyword">case</span> THURSDAY:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekday&quot;</span>;<br>        <span class="hljs-keyword">case</span> FRIDAY:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekday&quot;</span>;<br>        <span class="hljs-keyword">case</span> SATURDAY:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekend&quot;</span>;<br>        <span class="hljs-keyword">case</span> SUNDAY:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekend&quot;</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Unknown&quot;</span>;<br>    &#125;;<br>    log.info(<span class="hljs-string">&quot;&#123;&#125; is &#123;&#125;&quot;</span>, day, type);<br>&#125;<br><br><span class="hljs-comment">// new </span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSwitch3</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">day</span> <span class="hljs-operator">=</span> DAYS.MONDAY;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (day) &#123;<br>        <span class="hljs-comment">// case å¤šå€¼</span><br>        <span class="hljs-keyword">case</span> MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekday&quot;</span>;<br>        <span class="hljs-keyword">case</span> SATURDAY, SUNDAY:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekend&quot;</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Unknown&quot;</span>;<br>    &#125;;<br>    log.info(<span class="hljs-string">&quot;&#123;&#125; is &#123;&#125;&quot;</span>, day, type);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>lambdaè¡¨è¾¾å¼(ä»£ç å—)æ”¯æŒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSwitch4</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">day</span> <span class="hljs-operator">=</span> DAYS.MONDAY;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> (day) &#123;<br>        <span class="hljs-keyword">case</span> MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY -&gt; &#123;<br>            log.info(<span class="hljs-string">&quot;Weekday!!!&quot;</span>);<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekday&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">case</span> SATURDAY, SUNDAY -&gt; &#123;<br>            log.info(<span class="hljs-string">&quot;Weekend!!!&quot;</span>);<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Weekend&quot;</span>;<br>        &#125;<br>        <span class="hljs-keyword">default</span> -&gt; &#123;<br>            log.info(<span class="hljs-string">&quot;Unknown!!!&quot;</span>);<br>            <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;Unknown&quot;</span>;<br>        &#125;<br>    &#125;;<br>    log.info(<span class="hljs-string">&quot;&#123;&#125; is &#123;&#125;&quot;</span>, day, type);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="JDK15-text-block"><a href="#JDK15-text-block" class="headerlink" title="JDK15 text block"></a>JDK15 text block</h2><blockquote><p><a href="https://openjdk.org/jeps/378">JEP 378</a> å°†æ–‡æœ¬å—æ·»åŠ åˆ° Java è¯­è¨€ä¸­ã€‚æ–‡æœ¬å—æ˜¯å¤šè¡Œå­—ç¬¦ä¸²æ–‡å­—ï¼Œå®ƒä¸éœ€è¦å¤§å¤šæ•°è½¬ä¹‰åºåˆ—ï¼Œä»¥å¯é¢„æµ‹çš„æ–¹å¼è‡ªåŠ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œå¹¶è®©å¼€å‘äººå‘˜åœ¨éœ€è¦æ—¶æ§åˆ¶æ ¼å¼ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTextBlock</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">var</span> <span class="hljs-variable">html</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&lt;html&gt;\n&quot;</span> +<br>            <span class="hljs-string">&quot;    &lt;body&gt;\n&quot;</span> +<br>            <span class="hljs-string">&quot;        &lt;p&gt;%s&lt;/p&gt;\n&quot;</span> +<br>            <span class="hljs-string">&quot;    &lt;/body&gt;\n&quot;</span> +<br>            <span class="hljs-string">&quot;&lt;/html&gt;\n&quot;</span>;<br>    log.info(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, html);<br>    log.info(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, html.formatted(<span class="hljs-string">&quot;hello world!&quot;</span>));<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="JDK16-instanceof"><a href="#JDK16-instanceof" class="headerlink" title="JDK16 instanceof"></a>JDK16 instanceof</h2><blockquote><p><a href="https://openjdk.org/jeps/394">JEP 394</a>é€šè¿‡instanceof è¿ç®—ç¬¦çš„æ¨¡å¼åŒ¹é…å¢å¼ºJava ç¼–ç¨‹è¯­è¨€ã€‚æ¨¡å¼åŒ¹é…å…è®¸æ›´ç®€æ´ã€æ›´å®‰å…¨åœ°è¡¨è¾¾ç¨‹åºä¸­çš„é€šç”¨é€»è¾‘ï¼Œå³ä»å¯¹è±¡ä¸­æ¡ä»¶æå–ç»„ä»¶ã€‚</p></blockquote><p>ç»å¸¸ä¼šé‡åˆ°æˆ‘å¾—åˆ°äº†ä¸€ä¸ªObjectå¯¹è±¡ï¼Œä½†æ˜¯æˆ‘çŸ¥é“å®é™…ä¸Šå®ƒæ˜¯ä¸€ä¸ªStringå¯¹è±¡ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœæˆ‘æƒ³ä½¿ç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•é‚£æˆ‘å°±å¿…é¡»ä½¿ç”¨å¼ºåˆ¶è½¬æ¢ï¼Œä½†æ˜¯å¼ºåˆ¶è½¬æ¢ä¹‹å‰æˆ‘ä¸€èˆ¬éƒ½ä¼šè¿›è¡Œä¸€æ¬¡instanceofæ£€æŸ¥å®ƒçš„æ­£ç¡®ç±»å‹é¿å…å¼ºåˆ¶ç±»å‹è½¬æ¢æŠ¥é”™ï¼Œå°±åƒä¸‹è¾¹è¿™æ ·ï¼Œè¿™æ ·çœ‹ä¸Šå»å°±åƒæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ä¸¤æ¬¡å®ƒæ˜¯Stringç±»å‹ï¼Œçœ‹èµ·æ¥å°±å¾ˆæ„šè ¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String) &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> (String) obj;    <span class="hljs-comment">// grr...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿˜å¥½åœ¨JDK16å¼•å…¥äº†å…¨æ–°çš„instanceofå†™æ³•ï¼Œå¸®æˆ‘ä»¬è§£å†³äº†è¿™ä¸ªæ„šè ¢çš„é—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@SneakyThrows</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testInstanceOf</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">names</span> <span class="hljs-operator">=</span> List.of(<span class="hljs-string">&quot;zs&quot;</span>);<br>    <span class="hljs-keyword">if</span> (names <span class="hljs-keyword">instanceof</span> List list) &#123;<br>        list.forEach(System.out::println);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="JDK16-recode-å…³é”®å­—"><a href="#JDK16-recode-å…³é”®å­—" class="headerlink" title="JDK16 recode å…³é”®å­—"></a>JDK16 recode å…³é”®å­—</h2><blockquote><p> <a href="https://openjdk.org/jeps/395">JEP 395</a>ä½¿ç”¨recodeå¢å¼º Java ç¼–ç¨‹è¯­è¨€ï¼Œè®°å½•æ˜¯å……å½“ä¸å¯å˜æ•°æ®çš„é€æ˜è½½ä½“çš„ç±»ã€‚è®°å½•å¯ä»¥è¢«è®¤ä¸ºæ˜¯åä¹‰å…ƒç»„ã€‚<br>äººä»¬ä¸€ç›´è®¤ä¸ºJavaæ˜¯ä¸€é—¨æ¯”è¾ƒç¹æ‚çš„è¯­è¨€ï¼Œæœ‰æ—¶å€™ä»…ä»…æ˜¯æƒ³åˆ›å»ºä¸€ä¸ªéœ€è¦è¿”å›ç»™å‰ç«¯çš„VOéƒ½è¦å†™å¾ˆé•¿çš„ä»£ç ï¼Œåœ¨Lombokå‡ºç°ä¹‹åæå¤§äº†å‡å°‘äº†å¿…é¡»ç”±æˆ‘ä»¬æ‰€å†™çš„é‡å¤çš„ä»£ç ã€‚åœ¨recodeå‡ºç°ä¹‹åè¿™ç±»æƒ…å†µå¤§æœ‰æ”¹å–„ã€‚æˆ‘ä»¬ä»¥ä¸€ä¸ªå…·æœ‰æ¨ªçºµåæ ‡çš„Ponitä¸ºä¾‹çœ‹ä¸‹recodeç©¶ç«Ÿå¸®æˆ‘ä»¬å‡è½»äº†å¤šå°‘è´Ÿæ‹…</p></blockquote><ul><li><p>before</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> x;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> y;<br><br>    Point(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y) &#123;<br>        <span class="hljs-built_in">this</span>.x = x;<br>        <span class="hljs-built_in">this</span>.y = y;<br>    &#125;<br><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">x</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> x; &#125;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">y</span><span class="hljs-params">()</span> &#123; <span class="hljs-keyword">return</span> y; &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!(o <span class="hljs-keyword">instanceof</span> Point)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-type">Point</span> <span class="hljs-variable">other</span> <span class="hljs-operator">=</span> (Point) o;<br>        <span class="hljs-keyword">return</span> other.x == x &amp;&amp; other.y == y;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Objects.hash(x, y);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">&quot;Point[x=%d, y=%d]&quot;</span>, x, y);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>now</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">record</span> <span class="hljs-title class_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123; &#125;<br><br><span class="hljs-comment">// æŸ¥çœ‹ç¼–è¯‘åçš„æ–‡ä»¶å¯ä»¥å‘ç°å…¶å®ç¼–è¯‘å™¨å¸®æˆ‘è‡ªåŠ¨ç”Ÿæˆäº†è§„èŒƒçš„æ„é€ æ–¹æ³•ï¼Œå¦‚ä¸‹</span><br><span class="hljs-comment">// å› ä¸ºå®ƒä»£è¡¨æ˜¯ä¸€ä¸ªæ•°æ®è½½ä½“ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰setæ–¹æ³•</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>        <span class="hljs-built_in">this</span>.x = x;<br>        <span class="hljs-built_in">this</span>.y = y;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">x</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.x;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">y</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.y;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç„¶æˆ‘ä»¬å¦‚æœæƒ³éªŒè¯ä»–çš„ä¸€äº›å­—æ®µä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªâ€œç´§å‡‘çš„è§„èŒƒæ„é€ å‡½æ•°â€ï¼Œç”¨äºéªŒè¯å…¶éšå¼å½¢å¼å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>    <span class="hljs-keyword">public</span> Point &#123;<br>        <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span> || y &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;å‚æ•° &#x27;x&#x27; &#x27;y&#x27; ä¸èƒ½å°äº0&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">// ç¼–è¯‘ä¹‹åå¾—åˆ°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>        <span class="hljs-keyword">if</span> (x &gt;= <span class="hljs-number">0</span> &amp;&amp; y &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-built_in">this</span>.x = x;<br>            <span class="hljs-built_in">this</span>.y = y;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;å‚æ•° &#x27;x&#x27; &#x27;y&#x27; ä¸èƒ½å°äº0&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">x</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.x;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">y</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.y;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½é‡å†™å®ƒçš„getæ–¹æ³•åœ¨è·å–çš„æ—¶å€™éªŒè¯å…¶å‚æ•°æ˜¯å¦åˆæ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">record</span> <span class="hljs-title class_">Point</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>    <span class="hljs-keyword">public</span> Point &#123;<br>        <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span> || y &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;å‚æ•° &#x27;x&#x27; &#x27;y&#x27; ä¸èƒ½å°äº0&quot;</span>);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">x</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Math.max(x, <span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">y</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> Math.max(y, <span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h2 id="JDK15å¯†å°ç±»"><a href="#JDK15å¯†å°ç±»" class="headerlink" title="JDK15å¯†å°ç±»"></a>JDK15å¯†å°ç±»</h2><blockquote><p>åœ¨Java 15ä¹‹å‰ï¼ŒJavaè®¤ä¸ºâ€ä»£ç é‡ç”¨â€å§‹ç»ˆæ˜¯ä¸€ä¸ªç»ˆæç›®æ ‡ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ªç±»å’Œæ¥å£éƒ½å¯ä»¥è¢«ä»»æ„çš„ç±»å®ç°æˆ–ç»§æ‰¿ã€‚ä½†æ˜¯ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸­ï¼Œè¿™æ ·åšæ˜¯å®¹æ˜“é€ æˆé”™è¯¯çš„ï¼Œè€Œä¸”ä¹Ÿä¸ç¬¦åˆç‰©ç†ä¸–ç•Œçš„çœŸå®è§„å¾‹ã€‚è€Œå¯†å°ç±»ï¼ˆSealed Classesï¼‰æ˜¯ä¸€ç§é™åˆ¶ç»§æ‰¿çš„æ–°æœºåˆ¶ï¼Œé€šè¿‡ä½¿ç”¨å…³é”®å­—sealedä¿®é¥°ç±»ï¼Œå¯ä»¥å°†ä¸€ä¸ªç±»é™åˆ¶ä¸ºåªèƒ½è¢«ç‰¹å®šçš„ä¸€äº›ç±»ç»§æ‰¿ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å®šä¹‰äº†ä¸€ä¸ªå¯†é—­ç±»Peopleï¼Œå®ƒè§„å®šåªèƒ½è¢«Studentå’ŒTeacherä¸¤ä¸ªç±»ç»§æ‰¿</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span> <span class="hljs-keyword">permits</span> Student, Teacher &#123;<br>&#125;<br><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">People</span> &#123;<br><br>&#125;<br><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">People</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å®šä¹‰äº†ä¸€ä¸ªå¯†é—­æ¥å£Serviceï¼Œå®ƒè§„å®šåªèƒ½è¢«StudentServiceå’ŒTeacherServiceä¸¤ä¸ªç±»å®ç°</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Service</span> <span class="hljs-keyword">permits</span> StudentService,TeacherService &#123;<br>&#125;<br><br><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Service</span> &#123;<br><br>&#125;<br><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TeacherService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Service</span> &#123;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springé…ç½®æ–‡ä»¶åŠ å¯†</title>
    <link href="/2022/08/10/spring%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86/"/>
    <url>/2022/08/10/spring%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86/</url>
    
    <content type="html"><![CDATA[<blockquote><p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¾€å¾€ä¼šæœ‰å¯†ç ï¼Œä¾‹å¦‚mysqlï¼Œredisç­‰ã€‚å¦‚æœç›´æ¥å°†å¯†ç å’Œurlä»¥æ˜æ–‡çš„å½¢å¼å†™åœ¨é¡¹ç›®ä¸­ï¼Œå°±ä¼šæœ‰æ³„éœ²çš„é£é™©ã€‚æ‰€ä»¥è¿™é‡Œä½¿ç”¨jasyptï¼Œç”¨äºé…ç½®æ–‡ä»¶å¯†ã€‚</p></blockquote><h2 id="1-å¼•å…¥ä¾èµ–-gradle-maven"><a href="#1-å¼•å…¥ä¾èµ–-gradle-maven" class="headerlink" title="1.å¼•å…¥ä¾èµ–(gradle|maven)"></a>1.å¼•å…¥ä¾èµ–(gradle|maven)</h2><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">implementation <span class="hljs-string">&#x27;com.github.ulisesbocchio:jasypt-spring-boot-starter:2.1.0&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jasypt-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2-é…ç½®å¯†é’¥-äºŒé€‰ä¸€ï¼Œä½†æ˜¯æ›´å»ºè®®é€šè¿‡å‚æ•°-å› ä¸ºå‚æ•°èƒ½å–ç¯å¢ƒå˜é‡ä¸­çš„å€¼ï¼Œè¿™æ ·åªèƒ½è´¦æˆ·çš„æ‹¥æœ‰è€…èƒ½çœ‹åˆ°å¯†é’¥ï¼Œæ›´åŠ å®‰å…¨"><a href="#2-é…ç½®å¯†é’¥-äºŒé€‰ä¸€ï¼Œä½†æ˜¯æ›´å»ºè®®é€šè¿‡å‚æ•°-å› ä¸ºå‚æ•°èƒ½å–ç¯å¢ƒå˜é‡ä¸­çš„å€¼ï¼Œè¿™æ ·åªèƒ½è´¦æˆ·çš„æ‹¥æœ‰è€…èƒ½çœ‹åˆ°å¯†é’¥ï¼Œæ›´åŠ å®‰å…¨" class="headerlink" title="2.é…ç½®å¯†é’¥(äºŒé€‰ä¸€ï¼Œä½†æ˜¯æ›´å»ºè®®é€šè¿‡å‚æ•°,å› ä¸ºå‚æ•°èƒ½å–ç¯å¢ƒå˜é‡ä¸­çš„å€¼ï¼Œè¿™æ ·åªèƒ½è´¦æˆ·çš„æ‹¥æœ‰è€…èƒ½çœ‹åˆ°å¯†é’¥ï¼Œæ›´åŠ å®‰å…¨)"></a>2.é…ç½®å¯†é’¥(äºŒé€‰ä¸€ï¼Œä½†æ˜¯æ›´å»ºè®®é€šè¿‡å‚æ•°,å› ä¸ºå‚æ•°èƒ½å–ç¯å¢ƒå˜é‡ä¸­çš„å€¼ï¼Œè¿™æ ·åªèƒ½è´¦æˆ·çš„æ‹¥æœ‰è€…èƒ½çœ‹åˆ°å¯†é’¥ï¼Œæ›´åŠ å®‰å…¨)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># java å¯åŠ¨æ—¶é€šè¿‡æ·»åŠ å‚æ•°æ–¹å¼æŒ‡å®š</span><br>-Djasypt.encryptor.password=vegetablest<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># spring bootä¸­é…ç½®</span><br><span class="hljs-attr">jasypt:</span><br>  <span class="hljs-attr">encryptor:</span><br>    <span class="hljs-comment"># æŒ‡å®šåŠ å¯†å¯†é’¥ï¼Œç”Ÿäº§ç¯å¢ƒè¯·æ”¾åˆ°å¯åŠ¨å‚æ•°é‡Œé¢</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">vegetablest</span><br>    <span class="hljs-comment"># æŒ‡å®šè§£å¯†ç®—æ³•ï¼Œéœ€è¦å’ŒåŠ å¯†æ—¶ä½¿ç”¨çš„ç®—æ³•ä¸€è‡´</span><br>    <span class="hljs-comment"># algorithm: PBEWithMD5AndDES</span><br>    <span class="hljs-comment"># æŒ‡å®šinitialization vectorç±»å‹</span><br>    <span class="hljs-comment"># iv-generator-classname: org.jasypt.iv.NoIvGenerator</span><br></code></pre></td></tr></table></figure><h2 id="3-æ•°æ®åŠ å¯†"><a href="#3-æ•°æ®åŠ å¯†" class="headerlink" title="3.æ•°æ®åŠ å¯†"></a>3.æ•°æ®åŠ å¯†</h2><ul><li>å‘½ä»¤å¼<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"># cd  ~/.gradle/caches/modules-<span class="hljs-number">2</span>/files-<span class="hljs-number">2.1</span>/org.jasypt/jasypt/<span class="hljs-number">1.9</span><span class="hljs-number">.2</span>/<br># java -cp ./jasypt-<span class="hljs-number">1.9</span><span class="hljs-number">.2</span>.jar org.jasypt.intf.cli.JasyptPBEStringEncryptionCLI algorithm=PBEWithMD5AndDES password=<span class="hljs-string">&quot;vegetablest&quot;</span> input=your password<br></code></pre></td></tr></table></figure></li><li>æ’ä»¶å¼<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"># å¦‚æœå¯¹å¼€å‘è€…å¯ä¿¡ï¼Œå¯ä»¥é€šè¿‡Mavenæ’ä»¶è¿›è¡Œ<br> <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jasypt-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">path</span>&gt;</span>file:src/main/resources/application.yml<span class="hljs-tag">&lt;/<span class="hljs-name">path</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br># ç”¨DEC()åŒ…è£¹éœ€è¦åŠ å¯†çš„å­—ç¬¦<br># mvn jasypt:encrypt -Djasypt.encryptor.password=&quot;password&quot;<br></code></pre></td></tr></table></figure></li><li>ç¼–ç¨‹å¼<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PasswdTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseTest</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StringEncryptor encryptor;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contextLoads</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">esHost</span> <span class="hljs-operator">=</span> encryptor.encrypt(<span class="hljs-string">&quot;https://192.168.2.10:9200&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;esHost = &quot;</span> + <span class="hljs-string">&quot;ENC(&quot;</span> + esHost + <span class="hljs-string">&quot;)&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul><h2 id="4-ä½¿ç”¨"><a href="#4-ä½¿ç”¨" class="headerlink" title="4.ä½¿ç”¨"></a>4.ä½¿ç”¨</h2><p>åœ¨spring booté…ç½®æ–‡ä»¶ä¸­å°±èƒ½é€šè¿‡ENC()åŒ…æ‹¬èµ·æ¥çš„å½¢å¼é…ç½®è‡ªå·±çš„æ•æ„Ÿé…ç½®äº†,å°±åƒä¸‹è¾¹é‚£æ ·</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">map:</span><br>  <span class="hljs-attr">service:</span><br>    <span class="hljs-attr">key:</span> <span class="hljs-string">ENC(iLB3vWEUOXOfEUjyCfCO9LVUaHShs3I1pWA22TBahY+s3LR2KHqXS+8wP+32336u)</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">https://restapi.amap.com/v3/geocode/regeo?key=&#123;key&#125;&amp;location=&#123;location&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>spring</category>
      
      <category>jasypt</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MavençŸ¥è¯†è®°å½•</title>
    <link href="/2022/08/03/Maven%E7%9F%A5%E8%AF%86%E8%AE%B0%E5%BD%95/"/>
    <url>/2022/08/03/Maven%E7%9F%A5%E8%AF%86%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ï¼‰åˆè¯†Mavenç§æœ"><a href="#ä¸€ï¼‰åˆè¯†Mavenç§æœ" class="headerlink" title="ä¸€ï¼‰åˆè¯†Mavenç§æœ"></a>ä¸€ï¼‰åˆè¯†Mavenç§æœ</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><blockquote><p>ç§æœå³ç§æœ‰çš„ä»“åº“ã€‚mavenæŠŠå­˜æ”¾æ–‡ä»¶çš„åœ°æ–¹å«åšä»“åº“ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£æˆæˆ‘é—¨å®¶ä¸­çš„å‚¨ç‰©é—´ã€‚è€ŒmavenæŠŠå­˜æ”¾æ–‡ä»¶çš„å…·ä½“ä½ç½®å«åšåæ ‡ã€‚æˆ‘ä»¬é¡¹ç›®ä¸­pom.xmlæ–‡ä»¶é‡Œå¼•å…¥çš„jaræ–‡ä»¶å°±å­˜æ”¾åœ¨äº†mavenä»“åº“ä¸­ã€‚</p></blockquote><p><strong>mavençš„ä»“åº“åˆ†ä¸¤ç§ï¼š</strong></p><p><strong>1.æœ¬åœ°ä»“åº“</strong></p><p>æˆ‘ä»¬ä¸ªäººç”µè„‘ä¸­å®‰è£…mavenæ—¶åˆ†é…çš„ä»“åº“ã€‚ç”¨äºå­˜æ”¾æˆ‘ä»¬æ‰€æœ‰é¡¹ç›®ä¸­æ‰€éœ€çš„èµ„æºæ–‡ä»¶ï¼ˆå¤šä¸ºjaræ–‡ä»¶ï¼‰ã€‚éœ€è¦è¯´æ˜çš„æ˜¯åˆæ¬¡å®‰è£…mavenæ—¶æˆ‘ä»¬çš„æœ¬åœ°ä»“åº“æ˜¯æ²¡æœ‰ä»»ä½•æ–‡ä»¶çš„ï¼Œåªæœ‰æˆ‘ä»¬åœ¨å¯¹åº”çš„é¡¹ç›®é‡Œè¿è¡Œmavenå‘½ä»¤æ—¶æ‰ä¼šåœ¨æœ¬åœ°ä»“åº“ç”Ÿæˆæ–‡ä»¶ã€‚å¦‚æœæœ¬åœ°ä»“åº“æ²¡æœ‰ï¼Œä¼šé¦–å…ˆå°è¯•ä»è¿œç¨‹ä»“åº“ä¸‹è½½æ„ä»¶è‡³æœ¬åœ°ä»“åº“ï¼Œç„¶åå†ä½¿ç”¨æœ¬åœ°ä»“åº“çš„æ„ä»¶ã€‚<br>é»˜è®¤çš„ä»“åº“åœ°å€${user.home}&#x2F;.m2&#x2F;repositoryé€šè¿‡æ‰‹åŠ¨æ›´æ”¹é…ç½®æ–‡ä»¶å³å¯æ”¹å˜æœ¬åœ°ä»“åº“å­˜æ”¾ä½ç½®ã€‚é…ç½®æ–‡ä»¶settings.xmlå­˜æ”¾åœ¨ å®‰è£…mavenè·¯å¾„\confä¸‹ï¼ˆä¾‹å¦‚ï¼šD:\apache-maven-3.0.5\conf\settings.xmlï¼‰ æœç´¢localRepositoryå³å¯ä¿®æ”¹ã€‚</p><p><strong>2.è¿œç¨‹ä»“åº“</strong></p><p>ç®€å•çš„ç†è§£ä¸ºé€šè¿‡ç½‘ç»œè®¿é—®çš„ä»“åº“è¢«ç§°ä¸ºmavençš„è¿œç¨‹ä»“åº“ã€‚ç»¼åˆæ¥è®²å¯åˆ†ä¸ºä¸‰ç±»ï¼š</p><p><strong>ä¸­å¤®ä»“åº“</strong> ä¸­å¤®ä»“åº“æ˜¯ç”± Maven ç¤¾åŒºæä¾›çš„ä»“åº“ï¼Œå…¶ä¸­åŒ…å«äº†å¤§é‡å¸¸ç”¨çš„åº“ã€‚è¯¥ä»“åº“ç”±mavenå®˜æ–¹æ¥ç»´æŠ¤ï¼Œæœ¬åœ°é»˜è®¤å®‰è£…çš„mavenæ— éœ€é…ç½®ã€‚å®˜æ–¹æä¾›æµè§ˆå™¨è®¿é—®åœ°å€ï¼šÂ <a href="https://search.maven.org/#browse%E9%A1%B9%E7%9B%AE%E4%B8%AD%E9%85%8D%E7%BD%AE%E7%9A%84%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80%EF%BC%9A">https://search.maven.org/#browseé¡¹ç›®ä¸­é…ç½®çš„ä»“åº“åœ°å€ï¼š</a>Â <a href="https://repo1.maven.org/maven2/">https://repo1.maven.org/maven2/</a></p><p><strong>ä¸‰æ–¹ä»“åº“ï¼š</strong> å¯ä»¥ç†è§£ä¸ºæ°‘é—´ç»„ç»‡éå®˜æ–¹çš„ä»“åº“ã€‚è¾ƒä¸ºå¸¸ç”¨çš„å½“å±å›½å†…çš„é˜¿é‡Œäº‘ä»“åº“ã€‚ä¹‹æ‰€ä»¥æœ‰è¿™äº›ç¬¬ä¸‰æ–¹ä»“åº“çš„å­˜åœ¨ã€‚æ˜¯ä¸ºäº†å¼¥è¡¥å®˜æ–¹ä»“åº“çš„ä¸€äº›ä¸è¶³ã€‚ä¾‹å¦‚ï¼šé¡¹ç›®æ‰€éœ€jaræ–‡ä»¶åœ¨å®˜æ–¹ä»“åº“æ‰¾ä¸åˆ°ã€å›½å†…è®¿é—®å®˜æ–¹ä»“åº“çš„ç½‘ç»œé€Ÿåº¦è¿‡æ…¢ç­‰ç­‰åŸå› ã€‚</p><p><strong>ç§æœ‰ä»“åº“</strong>ï¼šå‰é¢è¯´äº†è¿™ä¹ˆå¤šç»ˆäºç»•åˆ°äº†ä»Šå¤©çš„ä¸»é¢˜â€”ç§æœã€‚å…¶å®æˆ‘ä»¬æ‰€è¯´çš„ç§æœå°±æ˜¯è¿œç¨‹ä»“åº“å…¶ä¸­çš„ä¸€ç§ã€‚å‡†ç¡®çš„è¯´æ˜¯åªç»™è‡ªå·±å…¬å¸ä½¿ç”¨çš„mavenä»“åº“ã€‚æ¯”èµ·ä¸Šé¢ä¸¤ç§ç±»å‹çš„ä»“åº“ï¼Œç§æœé™¤äº†å¯ä»¥èŠ‚çœç½‘ç»œå¸¦å®½ä»¥å¤–ï¼Œæ›´å¤šçš„æ˜¯æä¾›å…¬å¸å†…éƒ¨ä½¿ç”¨çš„jaråŒ…ã€‚ä¾‹å¦‚ï¼šå…¬å¸é€šè¿‡ä¸šåŠ¡ç§¯ç´¯å°è£…å‡ºä¸€å¥—å¾ˆæœ‰ä»·å€¼çš„åŸºç¡€é¡¹ç›®ï¼Œå…¬å¸å¸Œæœ›è¿™ä¸ªåŸºç¡€é¡¹ç›®åªè¢«å…¬å¸å†…è¢«ä½¿ç”¨ã€‚è¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥å°†æ­¤åŸºç¡€æœåŠ¡é¡¹ç›®æ‰“æˆjaråŒ…ä¸Šä¼ åˆ°æˆ‘ä»¬çš„ç§æœ‰ä»“åº“é‡Œã€‚å…¶ä»–çš„é¡¹ç›®å°±å¯ä»¥é€šè¿‡mavenå¼•å…¥jaråŒ…çš„æ–¹å¼å»ä½¿ç”¨ã€‚å› æ­¤å…¬å¸æ­å»ºè‡ªå·±çš„mavenç§æœæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p><p><strong>å¸¸ç”¨è¿œç¨‹ä»“åº“ï¼š</strong></p><ul><li>é˜¿é‡Œäº‘Mavenä»“åº“:(Â <a href="http://maven.aliyun.com/nexus/content/groups/public/">http://maven.aliyun.com/nexus/content/groups/public/</a>)</li><li>ç½‘æ˜“163Mavenä»“åº“:(Â <a href="http://mirrors.163.com/maven/repository/maven-public/">http://mirrors.163.com/maven/repository/maven-public/</a>)</li><li>JBossçš„ä»“åº“:(Â <a href="http://repository.jboss.org/nexus/content/groups/public">http://repository.jboss.org/nexus/content/groups/public</a>)</li><li>Mavençš„1å·ä»“åº“:(Â <a href="https://repo1.maven.org/maven2/">https://repo1.maven.org/maven2/</a>)<br>è°·æ­ŒMavenä»“åº“:(Â <a href="https://maven.google.com/">https://maven.google.com</a>)</li></ul><h3 id="æ­å»ºMavenç§æœçš„è½¯ä»¶æœ‰å“ªäº›"><a href="#æ­å»ºMavenç§æœçš„è½¯ä»¶æœ‰å“ªäº›" class="headerlink" title="æ­å»ºMavenç§æœçš„è½¯ä»¶æœ‰å“ªäº›"></a>æ­å»ºMavenç§æœçš„è½¯ä»¶æœ‰å“ªäº›</h3><ol><li>Archiva</li></ol><p>å®˜ç½‘åœ°å€ï¼šÂ <a href="http://archiva.apache.org/%E7%AE%80%E4%BB%8B%EF%BC%9AApache">http://archiva.apache.org/ç®€ä»‹ï¼šApache</a> Archivaâ„¢æ˜¯å¯æ‰©å±•çš„å­˜å‚¨åº“ç®¡ç†è½¯ä»¶ï¼Œå¯å¸®åŠ©æ‚¨ç»´æŠ¤è‡ªå·±çš„ä¸ªäººæˆ–ä¼ä¸šèŒƒå›´ å†…çš„æ„å»ºå·¥ä»¶å­˜å‚¨åº“ã€‚å®ƒæ˜¯Mavenï¼ŒÂ Continuumå’ŒANTç­‰æ„å»ºå·¥å…·çš„å®Œç¾ä¼´ä¾£ã€‚Archivaæ ä¾›äº†å¤šç§åŠŸèƒ½ï¼Œå…¶ä¸­åŒ…æ‹¬è¿œç¨‹å­˜å‚¨åº“ä»£ç†ï¼Œå®‰å…¨è®¿é—®ç®¡ç†ï¼Œæ„å»ºå·¥ä»¶å­˜å‚¨ï¼Œäº¤ä»˜ï¼Œæµè§ˆï¼Œç´¢ å¼•å’Œä½¿ç”¨æƒ…å†µæŠ¥å‘Šï¼Œå¯æ‰©å±•çš„æ‰«æåŠŸèƒ½â€¦â€¦ç­‰ç­‰ï¼</p><ol start="2"><li>Artifactory</li></ol><p>å®˜ç½‘åœ°å€ï¼šÂ <a href="https://www.jfrogchina.com/artifactory%E7%AE%80%E4%BB%8B%EF%BC%9A%E7%AE%A1%E7%90%86%E5%88%B6%E5%93%81%E8%80%8C%E4%B8%8D%E6%98%AF%E6%BA%90%E4%BB%A3%E7%A0%81%E6%8C%81%E7%BB%AD%E3%80%81%E8%87%AA%E5%8A%A8%E5%9C%B0%E6%9B%B4%E6%96%B0%E4%BF%A1%E6%81%AF%E5%B7%B2%E7%BB%8F%E6%88%90%E4%B8%BA%E4%B8%80%E5%88%87%E6%88%90%E5%8A%9F%E8%BF%90%E7%BB%B4%E7%9A%84%E5%85%B3%E9%94%AE%E5%9B%A0%E7%B4%A0.JFrog">https://www.jfrogchina.com/artifactoryç®€ä»‹ï¼šç®¡ç†åˆ¶å“è€Œä¸æ˜¯æºä»£ç æŒç»­ã€è‡ªåŠ¨åœ°æ›´æ–°ä¿¡æ¯å·²ç»æˆä¸ºä¸€åˆ‡æˆåŠŸè¿ç»´çš„å…³é”®å› ç´ .JFrog</a> é€šè¿‡æŒç»­æ›´æ–°çš„å®è·µå½»åº•æ”¹å˜äº†è½¯ä»¶ä¸–ç•Œ, å…¶é€Ÿåº¦å’Œè¿ç»­æ€§æ°¸è¿œæ”¹å˜äº†ç»„ç»‡ç®¡ç†å’Œå‘å¸ƒè½¯ä»¶çš„ æ–¹å¼.</p><ol start="3"><li>Nexus</li></ol><p>å®˜ç½‘åœ°å€ï¼šÂ <a href="https://www.sonatype.com/download-oss-sonatype%E7%AE%80%E4%BB%8B%EF%BC%9A%E6%AD%A3%E5%A6%82%E5%AE%98%E7%BD%91%E7%9A%84%E6%8F%8F%E8%BF%B0%E9%82%A3%E8%BF%99%E6%A0%B7">https://www.sonatype.com/download-oss-sonatypeç®€ä»‹ï¼šæ­£å¦‚å®˜ç½‘çš„æè¿°é‚£è¿™æ ·</a> The worldâ€™s first and only universal artifact repository thatâ€™s FREE to use.(ä¸–ç•Œä¸Šç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€çš„å…è´¹ä½¿ç”¨çš„é€šç”¨å·¥ä»¶å­˜å‚¨åº“ã€‚)ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤nexusæ˜¯ç›®å‰å¸‚é¢ä¸Šä½¿ç”¨æœ€å¤šçš„mavenç§æœæ­å»ºè½¯ä»¶ã€‚<br>å› æ­¤ï¼Œè¿™é‡Œä½¿ç”¨nexusæ¥åšæ­å»ºç§æœçš„æ¼”ç¤ºã€‚ä¸Šé¢çš„å®˜ç½‘åœ°å€ä¸‹è½½è½¯ä»¶è¾ƒæ…¢ï¼Œæˆ‘è¿™é‡Œæä¾›äº†ç½‘ç›˜ä¸‹è½½åœ°å€å¦‚ä¸‹ï¼š<br>ç½‘ç›˜ä¸‹è½½åœ°å€ï¼šÂ <a href="https://pan.baidu.com/s/1saLf5Z0FwWRkjHY6eSzZLg">https://pan.baidu.com/s/1saLf5Z0FwWRkjHY6eSzZLg</a> æå–ç ï¼šqz5z</p><h2 id="äºŒï¼‰ä½¿ç”¨Nexusæ­å»ºMavenç§æœ"><a href="#äºŒï¼‰ä½¿ç”¨Nexusæ­å»ºMavenç§æœ" class="headerlink" title="äºŒï¼‰ä½¿ç”¨Nexusæ­å»ºMavenç§æœ"></a>äºŒï¼‰ä½¿ç”¨Nexusæ­å»ºMavenç§æœ</h2><h3 id="Linuxç¯å¢ƒä¸‹å®‰è£…Nexus"><a href="#Linuxç¯å¢ƒä¸‹å®‰è£…Nexus" class="headerlink" title="Linuxç¯å¢ƒä¸‹å®‰è£…Nexus"></a>Linuxç¯å¢ƒä¸‹å®‰è£…Nexus</h3><p>æœ‰ä¸€ç‚¹éœ€è¦è¯´æ˜çš„æ˜¯æ­å»ºnexusæ—¶å°½é‡ä¸è¦ä½¿ç”¨rootç”¨æˆ·ç›´æ¥å®‰è£…è¿è¡Œï¼Œå®˜æ–¹åº”è¯¥æ˜¯å¤„äºå®‰å…¨è€ƒè™‘ç»™å‡ºçš„å»ºè®®ï¼Œæ‰€ä»¥æˆ‘è¿™é‡Œåˆ›å»ºäº†nexusç”¨æˆ·ä½œä¸ºæ—¥åç»´æŠ¤ç§æœå¸å·ã€‚</p><h4 id="1-ä½¿ç”¨rootåˆ›å»ºnexusç”¨æˆ·"><a href="#1-ä½¿ç”¨rootåˆ›å»ºnexusç”¨æˆ·" class="headerlink" title="1.ä½¿ç”¨rootåˆ›å»ºnexusç”¨æˆ·"></a>1.ä½¿ç”¨rootåˆ›å»ºnexusç”¨æˆ·</h4><p>æˆ‘è¿™é‡Œå¯†ç è®¾ç½®çš„æ˜¯123456ï¼Œå› æ­¤æç¤ºè¿‡äºç®€å•ã€‚å®é™…ä½¿ç”¨ç¯å¢ƒä¸­è¿™ä¸ªå¯†ç è¦è®¾ç½®çš„å¤æ‚äº›ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@linux ~]# useradd nexus<br>[root@linux ~]# passwd nexus<br>æ›´æ”¹ç”¨æˆ· nexus çš„å¯†ç  ã€‚<br>æ–°çš„ å¯†ç ï¼š<br>æ— æ•ˆçš„å¯†ç ï¼š è¿‡äºç®€å•åŒ–/ç³»ç»ŸåŒ–<br>æ— æ•ˆçš„å¯†ç ï¼š è¿‡äºç®€å•<br>é‡æ–°è¾“å…¥æ–°çš„ å¯†ç ï¼š<br>passwdï¼š æ‰€æœ‰çš„èº«ä»½éªŒè¯ä»¤ç‰Œå·²ç»æˆåŠŸæ›´æ–°ã€‚<br>[root@linux ~]#<br></code></pre></td></tr></table></figure><h4 id="2-éªŒè¯ç”¨æˆ·æ˜¯å¦åˆ›å»ºæˆåŠŸã€å¯†ç æ˜¯å¦è®¾ç½®æˆåŠŸ"><a href="#2-éªŒè¯ç”¨æˆ·æ˜¯å¦åˆ›å»ºæˆåŠŸã€å¯†ç æ˜¯å¦è®¾ç½®æˆåŠŸ" class="headerlink" title="2. éªŒè¯ç”¨æˆ·æ˜¯å¦åˆ›å»ºæˆåŠŸã€å¯†ç æ˜¯å¦è®¾ç½®æˆåŠŸ"></a>2. éªŒè¯ç”¨æˆ·æ˜¯å¦åˆ›å»ºæˆåŠŸã€å¯†ç æ˜¯å¦è®¾ç½®æˆåŠŸ</h4><p>ç”¨æˆ·åˆ›å»ºæˆåŠŸã€å¯†ç è®¾ç½®æˆåŠŸåã€‚ä¸‹é¢åˆ‡æ¢åˆ°nexusç”¨æˆ·ã€‚æˆ‘è¿™é‡Œä¸ºäº†éªŒè¯nexusçš„å¯†ç æ‰€ä»¥é¢„å…ˆåˆ‡æ¢åˆ°äº†å¦å¤–ä¸€ä¸ªæ™®é€šç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@linux ~]# su wangwu<br>[wangwu@linux root]$ <br>[wangwu@linux root]$ <br>[wangwu@linux root]$ su nexus<br>å¯†ç ï¼š<br>[nexus@linux root]$<br></code></pre></td></tr></table></figure><p>å¦‚ä¸Šå‡ºç°nexus@linux è¡¨ç¤ºåˆ›å»ºçš„nexusç”¨æˆ·æˆåŠŸå¹¶ä¸”è®¾ç½®å¯†ç ç”Ÿæ•ˆã€‚</p><h4 id="3-ä¸Šä¼ nexuså®‰è£…åŒ…"><a href="#3-ä¸Šä¼ nexuså®‰è£…åŒ…" class="headerlink" title="3. ä¸Šä¼ nexuså®‰è£…åŒ…"></a>3. ä¸Šä¼ nexuså®‰è£…åŒ…</h4><p>ä½¿ç”¨cd ~åˆ‡æ¢åˆ°nexusç”¨æˆ·çš„å®¶ç›®å½•ã€‚æ‰“å¼€FTPä¸Šä¼ æ–‡ä»¶å·¥å…·æŠŠnexusä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">[nexus@linux ~]$ ll<br>æ€»ç”¨é‡ 132256<br>-rw-r--r--. 1 root root 135426386 7æœˆ  20 00:27 nexus-3.19.1-01-unix.tar.gz<br>[nexus@linux ~]$<br></code></pre></td></tr></table></figure><h4 id="4-è§£å‹nexuså®‰è£…åŒ…"><a href="#4-è§£å‹nexuså®‰è£…åŒ…" class="headerlink" title="4. è§£å‹nexuså®‰è£…åŒ…"></a>4. è§£å‹nexuså®‰è£…åŒ…</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">[nexus@linux ~]$ tar -zxvf nexus-3.19.1-01-unix.tar.gz<br>[nexus@linux ~]$ ls<br>nexus-3.19.1-01  nexus-3.19.1-01-unix.tar.gz  sonatype-work<br></code></pre></td></tr></table></figure><h4 id="5-å¯åŠ¨nexusæœåŠ¡"><a href="#5-å¯åŠ¨nexusæœåŠ¡" class="headerlink" title="5. å¯åŠ¨nexusæœåŠ¡"></a>5. å¯åŠ¨nexusæœåŠ¡</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell">[nexus@linux ~]$ cd nexus-3.19.1-01/bin/<br>[nexus@linux bin]$ sh nexus start<br>Starting nexus<br>[nexus@linux bin]$ sh nexus status<br>nexus is running<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¯´æ˜ä¸€ä¸‹nexuså‘½ä»¤</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨ï¼š sh nexus start ï¼ˆåå°è¿è¡Œï¼‰ sh nexus runï¼ˆè¾“å‡ºä¿¡æ¯è¿è¡Œï¼‰</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åœæ­¢ï¼šsh nexus-3.19.1-01/bin/nexus stop</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">çŠ¶æ€ï¼šsh nexus-3.19.1-01/bin/nexus status</span><br></code></pre></td></tr></table></figure><h4 id="6-éªŒè¯nexuså®‰è£…æ˜¯å¦æˆåŠŸ"><a href="#6-éªŒè¯nexuså®‰è£…æ˜¯å¦æˆåŠŸ" class="headerlink" title="6. éªŒè¯nexuså®‰è£…æ˜¯å¦æˆåŠŸ"></a>6. éªŒè¯nexuså®‰è£…æ˜¯å¦æˆåŠŸ</h4><p>æµè§ˆå™¨ä¸­è¾“å…¥ip:8081ï¼Œå‡ºç°å¦‚ä¸‹ç”»é¢ï¼Œè¯´æ˜å®‰è£…æˆåŠŸã€‚ è¿™é‡Œéœ€è¦åˆ°æç¤ºçš„è·¯å¾„ä¸­è·å–nexusé»˜è®¤ç™»å½•å¯†ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">[nexus@linux bin]$ cat /home/nexus/sonatype-work/nexus3/admin.password<br>ba7fe33c-cd30-4a2b-aba6-d399f8ed34e3[nexus@linux bin]$ <br>[nexus@linux bin]$<br><span class="hljs-meta prompt_">#</span><span class="language-bash">ba7fe33c-cd30-4a2b-aba6-d399f8ed34e3 ä¸ºæˆ‘çš„åˆå§‹ç™»å½•å¯†ç ï¼Œ</span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¾“å…¥æ­¤å¯†ç ç™»å½•æˆåŠŸåæŒ‰æ­¥éª¤éœ€è¦é‡æ–°è®¾ç½®ä¸€ä¸ªæ–°çš„å¯†ç ï¼ŒæŒ‰æ­¥éª¤æ“ä½œå³å¯,è¿™é‡Œä¸åšæ¼”ç¤ºäº†ã€‚</span><br></code></pre></td></tr></table></figure><h4 id="7-è®¾ç½®nexuså¼€æœºå¯åŠ¨"><a href="#7-è®¾ç½®nexuså¼€æœºå¯åŠ¨" class="headerlink" title="7. è®¾ç½®nexuså¼€æœºå¯åŠ¨"></a>7. è®¾ç½®nexuså¼€æœºå¯åŠ¨</h4><p>å®é™…ç¯å¢ƒä¸­éœ€è¦è®¾ç½®ä¸‹å¼€æœºnexusè‡ªå¯åŠ¨ï¼Œè¿™é‡Œå› ä¸ºnexusæƒé™çš„åŸå› éœ€è¦åˆ‡æ¢å›rootç”¨æˆ·ä¸‹è¿›è¡Œæ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">[nexus@linux bin]$ su root<br>å¯†ç ï¼š<br>[root@linux bin]# <br>[root@linux bin]# ln -s /home/nexus/nexus-3.19.1-01/bin/nexus /etc/init.d/nexus3<br>[root@linux bin]# chkconfig --add nexus3<br>[root@linux bin]# chkconfig nexus3 on<br>[root@linux bin]#<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ï¼‰é¡¹ç›®ä¸­ä½¿ç”¨mavenç§æœ"><a href="#ä¸‰ï¼‰é¡¹ç›®ä¸­ä½¿ç”¨mavenç§æœ" class="headerlink" title="ä¸‰ï¼‰é¡¹ç›®ä¸­ä½¿ç”¨mavenç§æœ"></a>ä¸‰ï¼‰é¡¹ç›®ä¸­ä½¿ç”¨mavenç§æœ</h2><p>è®¿é—®æœåŠ¡å™¨åœ°å€éªŒè¯æˆåŠŸï¼Œåœ¨æˆ‘ä»¬é¡¹ç›®é‡Œå¼€å§‹ä½¿ç”¨ç§æœä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹mavenä¾èµ–é¡ºåºï¼Œä¹Ÿå°±æ˜¯mavneä¸‹è½½æ–‡ä»¶è®¿é—®ä»“åº“çš„é¡ºåºã€‚<br>1.æœ¬åœ°ä»“åº“æŸ¥æ‰¾ï¼Œæ‰¾å¾—åˆ°å¼•å…¥åˆ°é¡¹ç›®ï¼Œæ‰¾ä¸åˆ°æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚<br>2.æœªè®¾ç½®è¿œç¨‹ä»“åº“æ—¶ï¼Œè¿›è¡Œä¸­å¤®ä»“åº“æœç´¢ï¼ˆmavenå®˜æ–¹æä¾›çš„ä¸€å·ä»“åº“ï¼‰æ‰¾å¾—åˆ°ä¸‹è½½åˆ°æœ¬åœ°ä»“åº“åå¼•å…¥åˆ°é¡¹ç›®ï¼Œæ‰¾ä¸åˆ°ç»™å‡ºé”™è¯¯ä¿¡æ¯ã€‚<br>3.è‹¥è®¾ç½®äº†è¿œç¨‹ä»“åº“åˆ™æŒ‰é…ç½®è¿œç¨‹ä»“åº“åœ°å€çš„é¡ºåºä¸‹è½½åˆ°æœ¬åœ°åå¼•å…¥åˆ°é¡¹ç›®ï¼ŒåŒæ ·æ‰¾ä¸åˆ°ç»™å‡ºé”™è¯¯ä¿¡æ¯ã€‚<br>ä¸Šé¢ç¬¬ä¸‰æ¡æåˆ°æŒ‰é…ç½®è¿œç¨‹ä»“åº“åœ°å€çš„é¡ºåºè¿›è¡Œæœç´¢ä¸‹è½½ã€‚ä¸‹é¢ç®€è¦è¯´æ˜ä¸‹ï¼š</p><ul><li>settings_mirror çš„ä¼˜å…ˆçº§é«˜äºcentral</li><li>settings_profile_repo ä¼˜å…ˆçº§é«˜äº settings_mirror</li><li>settings_profile_repo ä¼˜å…ˆçº§é«˜äº pom_repositories</li><li>settings_profile_repo ä¼˜å…ˆçº§é«˜äº pom_profile_repo</li><li>pom_profile_repo ä¼˜å…ˆçº§é«˜äº pom_repositories</li><li>pom_repositories ä¼˜å…ˆçº§é«˜äº settings_mirror</li></ul><p><strong>æœ€åæœç´ é¡ºåºå¦‚ä¸‹ï¼š</strong><br>local_repo &gt; settings_profile_repo &gt; pom_profile_repo &gt; pom_repositories &gt; settings_mirror &gt; central</p><h4 id="ä¸€ã€mavenç§æœé…ç½®ä¿¡æ¯"><a href="#ä¸€ã€mavenç§æœé…ç½®ä¿¡æ¯" class="headerlink" title="ä¸€ã€mavenç§æœé…ç½®ä¿¡æ¯"></a>ä¸€ã€mavenç§æœé…ç½®ä¿¡æ¯</h4><p>åœ°å€ï¼šÂ <a href="http://ip:8081(æ­å»ºmavenç§æœçš„åœ°å€)">http://ip:8081(æ­å»ºmavenç§æœçš„åœ°å€)</a><br>ç®¡ç†å¸å·ï¼šadmin ç®¡ç†å¯†ç ï¼š123456 ï¼ˆç™»å½•ç§æœçš„è´¦å·ã€å¯†ç ï¼‰<br>å‘åŒ…å¸å·ï¼šmaven å‘åŒ…å¯†ç ï¼š123456 ï¼ˆä¸ºäº†å®‰å…¨èµ·è§ï¼Œä½¿ç”¨ç®¡ç†è´¦å·å•ç‹¬åˆ›å»ºçš„è´¦å·å¯†ç ç”¨äºå‘åŒ…ä½¿ç”¨ï¼‰</p><h4 id="äºŒã€mavenç§æœä½¿ç”¨"><a href="#äºŒã€mavenç§æœä½¿ç”¨" class="headerlink" title="äºŒã€mavenç§æœä½¿ç”¨"></a>äºŒã€mavenç§æœä½¿ç”¨</h4><p>æ™®é€šé¡¹ç›®æˆå‘˜å³ä¸éœ€è¦å‘ç§æœå‘å¸ƒåŒ…çš„ï¼Œåªéœ€è¦åœ¨ pom æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹é…ç½®å³å¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span>   <br>    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>      <br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>maven-public<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>      <br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>maven-public<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://ip:8081/repository/maven-public/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>     <br>        <span class="hljs-tag">&lt;<span class="hljs-name">releases</span>&gt;</span>          <br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span>      <br>       <span class="hljs-tag">&lt;/<span class="hljs-name">releases</span>&gt;</span>     <br>       <span class="hljs-tag">&lt;<span class="hljs-name">snapshots</span>&gt;</span>        <br>            <span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">snapshots</span>&gt;</span>   <br>   <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®è¯´æ˜ï¼š<br>å…¶ä¸­ id è¦å’Œä½ çš„ä»“åº“åç§°ä¸€è‡´ï¼Œurl å°±æ˜¯ç§æœçš„ä»“åº“åœ°å€ï¼Œå°±æ˜¯type ä¸º group çš„é‚£ä¸ªï¼Œå®ƒç»„åˆäº†ä¸€ä¸ª proxy ç±»å‹çš„å’Œä¸¤ä¸ª hosted ç±»å‹çš„ä»“åº“ã€‚è®¾ç½® snapshots çš„ enabled ä¸ºtureï¼Œè¡¨ç¤ºå…è®¸ä¸‹è½½ snapshots ç‰ˆæœ¬çš„åŒ…ã€‚</p><h4 id="ä¸‰ã€å‘å¸ƒå…¬å…±èµ„æºåŒ…åˆ°mavenç§æœï¼š"><a href="#ä¸‰ã€å‘å¸ƒå…¬å…±èµ„æºåŒ…åˆ°mavenç§æœï¼š" class="headerlink" title="ä¸‰ã€å‘å¸ƒå…¬å…±èµ„æºåŒ…åˆ°mavenç§æœï¼š"></a>ä¸‰ã€å‘å¸ƒå…¬å…±èµ„æºåŒ…åˆ°mavenç§æœï¼š</h4><p>å‘ç§æœä»“åº“ä¸­å‘å¸ƒåŒ…ï¼Œé¦–å…ˆéœ€è¦å¯¹ä»“åº“æœ‰æƒé™æ‰å¯ä»¥ï¼Œæ²¡æœ‰æƒé™çš„ç”¨æˆ·æ˜¯æ²¡åŠæ³•å‘å¸ƒçš„ã€‚<br>æ‰“å¼€ maven çš„é…ç½®æ–‡ä»¶ setting.xml ï¼Œæ‰¾åˆ° servers èŠ‚ç‚¹åœ¨å…¶ä¸­æ·»åŠ  server èŠ‚ç‚¹ï¼Œç”¨æˆ·åå’Œå¯†ç ä¹Ÿå¯ä»¥æ˜¯ç®¡ç†å‘˜åˆ›å»ºçš„è´¦å·ï¼Œä½†æ˜¯éœ€è¦å¯¹ä»“åº“æœ‰æ·»åŠ æƒé™ã€‚<br>é…ç½®æœ¬åœ°maven settings.xml  æç¤ºï¼šä¸¤ç§é…ç½®æ–¹æ³•<br><strong>1.ç›´æ¥é…ç½®mavenç›®å½•ä¸‹çš„confä¸‹çš„settings.xmlæ–‡ä»¶ã€‚</strong><br>å¤åˆ¶è¯¥æ–‡ä»¶åˆ°ç”¨æˆ·ç›®å½•ä¸‹çš„.m2ç›®å½•ï¼Œä¸¤ç§æ–¹æ³•é…ç½®æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œçœ‹ä¸ªäººå–œå¥½äº†ï¼ŒåŠ è½½é¡ºåºæ˜¯.m2ä¸‹çš„settings.xmlç›®å½•æ¥ç€æ˜¯maven configç›®å½•ä¸‹çš„settings.xmlã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">servers</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">server</span>&gt;</span>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>releases<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>maven<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>123456<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">server</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">server</span>&gt;</span>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>snapshots<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">username</span>&gt;</span>maven<span class="hljs-tag">&lt;/<span class="hljs-name">username</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span>123456<span class="hljs-tag">&lt;/<span class="hljs-name">password</span>&gt;</span>    <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">server</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">servers</span>&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">mirrors</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>&gt;</span>    <br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>nexus<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>  <br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>internal nexus repository<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>       <br>        <span class="hljs-comment">&lt;!--é•œåƒé‡‡ç”¨é…ç½®å¥½çš„ç»„çš„åœ°å€--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://ip:8081/repository/maven-public/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mirrorOf</span>&gt;</span>!internal.repo,*<span class="hljs-tag">&lt;/<span class="hljs-name">mirrorOf</span>&gt;</span>  <br>    <span class="hljs-tag">&lt;/<span class="hljs-name">mirror</span>&gt;</span>  <br><span class="hljs-tag">&lt;/<span class="hljs-name">mirrors</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®éœ€è¦ä¸Šä¼ åˆ°ç§æœä¸Šçš„é¡¹ç›®pom.xmlé…ç½®ä¿¡æ¯</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">distributionManagement</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--é…ç½®çº¿ä¸Šreleasesä»“åº“åœ°å€ï¼Œåªè¦æ˜¯æ­£å¼ç‰ˆæœ¬éƒ½ä¼šä¸Šä¼ åˆ°è¯¥åœ°å€</span><br><span class="hljs-comment">    ï¼ˆæ³¨æ„è¦å’Œsettings.xmlæ–‡ä»¶é‡Œé¢çš„é…ç½®åç§°ç›¸åŒï¼‰--&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>releases<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Releases<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://ip:8081/repository/maven-releases/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span><br><span class="hljs-comment">&lt;!--é…ç½®çº¿ä¸Šsnapshotsä»“åº“åœ°å€ï¼Œåªè¦æ˜¯å¿«ç…§ç‰ˆæœ¬éƒ½ä¼šä¸Šä¼ åˆ°è¯¥åœ°å€</span><br><span class="hljs-comment">ï¼ˆæ³¨æ„è¦å’Œsettings.xmlæ–‡ä»¶é‡Œé¢çš„é…ç½®åç§°ç›¸åŒï¼‰--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">snapshotRepository</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>snapshots<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>Snapshot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>http://ip:8081//repository/maven-snapshots/<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">snapshotRepository</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">distributionManagement</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>ç‰¹åˆ«è¯´æ˜ï¼š</strong>å½“pom.xmlä¸­åŒæ—¶é…ç½®äº†releasesä»“åº“å’Œsnapshotsä»“åº“æ—¶ã€‚<br>pom.xmlæ–‡ä»¶å¼€å¤´çš„ç‰ˆæœ¬é…ç½®1.0.0-SNAPSHOTä¸ºbuildåˆ°snapshotsåº“ï¼Œ<br>pom.xmlæ–‡ä»¶å¼€å¤´çš„ç‰ˆæœ¬é…ç½®1.0.0 (ä¸å¸¦-SNAPSHOT) çš„ä¼šbuildåˆ°releasesåº“ï¼Œ<br>å¦‚æœåªé…ç½®äº†releasesåº“è€Œç‰ˆæœ¬å·å†™çš„æ˜¯å¸¦-SNAPSHOTçš„ï¼Œbuildåˆ°æœ€åä¸€æ­¥ä¼šæŠ¥400é”™è¯¯ï¼Œå› ä¸ºå®ƒæ‰¾ä¸åˆ°å¯¹åº”çš„åº“ã€‚</p><h4 id="å››ã€mavenæ‰“åŒ…å‘½ä»¤"><a href="#å››ã€mavenæ‰“åŒ…å‘½ä»¤" class="headerlink" title="å››ã€mavenæ‰“åŒ…å‘½ä»¤:"></a>å››ã€mavenæ‰“åŒ…å‘½ä»¤:</h4><p>å…¬å…±èµ„æºjaråŒ…å‘å¸ƒåˆ°mavenç§æœå‘½ä»¤å¦‚ä¸‹ï¼š<br>mvn clean deploy</p><h4 id="æ‰©å±•çŸ¥è¯†ç‚¹ï¼š"><a href="#æ‰©å±•çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="æ‰©å±•çŸ¥è¯†ç‚¹ï¼š"></a>æ‰©å±•çŸ¥è¯†ç‚¹ï¼š</h4><p>packageå‘½ä»¤å®Œæˆäº†é¡¹ç›®ç¼–è¯‘ã€å•å…ƒæµ‹è¯•ã€æ‰“åŒ…åŠŸèƒ½ï¼Œä½†æ²¡æœ‰æŠŠæ‰“å¥½çš„å¯æ‰§è¡ŒjaråŒ…ï¼ˆwaråŒ…æˆ–å…¶å®ƒå½¢å¼çš„åŒ…ï¼‰å¸ƒç½²åˆ°æœ¬åœ°mavenä»“åº“å’Œè¿œç¨‹mavenç§æœä»“åº“<br>installå‘½ä»¤å®Œæˆäº†é¡¹ç›®ç¼–è¯‘ã€å•å…ƒæµ‹è¯•ã€æ‰“åŒ…åŠŸèƒ½ï¼ŒåŒæ—¶æŠŠæ‰“å¥½çš„å¯æ‰§è¡ŒjaråŒ…ï¼ˆwaråŒ…æˆ–å…¶å®ƒå½¢å¼çš„åŒ…ï¼‰å¸ƒç½²åˆ°æœ¬åœ°mavenä»“åº“ï¼Œä½†æ²¡æœ‰å¸ƒç½²åˆ°è¿œç¨‹mavenç§æœä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">mvn install:install-file -DgroupId=org.xl.brave  <br>-DartifactId=brave-axis2 -Dversion=0.0.1  <br>-Dfile=C:\Users\sy\Desktop\brave-axis2-0.0.1-SNAPSHOT.jar    <br>-Dpackaging=jar<br></code></pre></td></tr></table></figure><p>deployå‘½ä»¤å®Œæˆäº†é¡¹ç›®ç¼–è¯‘ã€å•å…ƒæµ‹è¯•ã€æ‰“åŒ…åŠŸèƒ½ï¼ŒåŒæ—¶æŠŠæ‰“å¥½çš„å¯æ‰§è¡ŒjaråŒ…ï¼ˆwaråŒ…æˆ–å…¶å®ƒå½¢å¼çš„åŒ…ï¼‰å¸ƒç½²åˆ°æœ¬åœ°mavenä»“åº“å’Œè¿œç¨‹mavenç§æœä»“åº“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">mvn deploy:deploy-file -Dmaven.test.skip=true \<br>-Dfile=D:\workspace\com.xxx.test-1.0.0.jar \<br>-DgroupId=com.xxx -DartifactId=test -Dversion=1.0.0-SNAPSHOT -Dpackaging=jar<br>-DrepositoryId=snapshots<br>-Durl=http://ip:8081/repository/maven-releases/<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml">å‘½ä»¤è§£é‡Šï¼š<br>mvn deploy:deploy-file å®‰è£…åˆ°è¿œç¨‹ä»“åº“çš„mavenå‘½ä»¤<br>-Dfile=jaråŒ…çš„ä½ç½®<br>-DgroupId=groupIdï¼Œè‡ªå®šä¹‰<br>-DartifactId=artifactIdï¼Œè‡ªå®šä¹‰<br>-Dversion=versionï¼Œè‡ªå®šä¹‰<br>-Durl=ç§æœä»“åº“åœ°å€<br>-Dpackaging=jar<br>-DrepositoryId=ä»“åº“id<br></code></pre></td></tr></table></figure><h2 id="å››ï¼‰mavenå‡ ç§æ‰“åŒ…æ’ä»¶ä»‹ç»"><a href="#å››ï¼‰mavenå‡ ç§æ‰“åŒ…æ’ä»¶ä»‹ç»" class="headerlink" title="å››ï¼‰mavenå‡ ç§æ‰“åŒ…æ’ä»¶ä»‹ç»"></a>å››ï¼‰mavenå‡ ç§æ‰“åŒ…æ’ä»¶ä»‹ç»</h2><h4 id="1-spring-boot-maven-plugin"><a href="#1-spring-boot-maven-plugin" class="headerlink" title="1.spring-boot-maven-plugin"></a>1.spring-boot-maven-plugin</h4><blockquote><p>spring-boot-maven-pluginï¼šspringbooté¡¹ç›®é»˜è®¤çš„æ‰“åŒ…å·¥å…·ï¼Œé»˜è®¤æƒ…å†µä¸‹åªä¼šå°†é¡¹ç›®æºç ç¼–è¯‘ç”Ÿæˆçš„classæ–‡ä»¶å’Œèµ„æºæ–‡ä»¶ä¾èµ–jaråŒ…éƒ½æ‰“è¿›æ¥ï¼Œå³æ‰“åŒ…è‡ªå·±é¡¹ç›®çš„classæ–‡ä»¶+ç¯å¢ƒå˜é‡+é™æ€èµ„æºæ–‡ä»¶+ä¾èµ–jarï¼ˆä¸ä¼šæŠŠä¾èµ–jaråç¼–è¯‘ä¸ºclassæ–‡ä»¶æ‰“å…¥ï¼‰ã€‚ä½¿ç”¨2.2.1.RELEASEç‰ˆæœ¬éœ€è¦mavenç‰ˆæœ¬åœ¨2.0åŠä»¥ä¸Šï¼ŒJDKåœ¨1.8åŠä»¥ä¸Šã€‚</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="2-maven-shade-plugin"><a href="#2-maven-shade-plugin" class="headerlink" title="2.maven-shade-plugin"></a>2.maven-shade-plugin</h4><blockquote><p>å®ƒå¾ˆèªæ˜åœ°å°†ä¾èµ–çš„JARæ–‡ä»¶å…¨éƒ¨è§£å‹åï¼Œå†å°†å¾—åˆ°çš„.classæ–‡ä»¶è¿åŒå½“å‰é¡¹ç›®çš„.classæ–‡ä»¶ä¸€èµ·åˆå¹¶åˆ°æœ€ç»ˆçš„CLIåŒ…(å¯ä»¥ç›´æ¥è¿è¡Œçš„jaråŒ…)ä¸­ï¼Œè¿™æ ·ï¼Œåœ¨æ‰§è¡ŒCLI JARæ–‡ä»¶çš„æ—¶å€™ï¼Œæ‰€æœ‰éœ€è¦çš„ç±»å°±éƒ½åœ¨Classpathä¸­äº†ã€‚</p></blockquote><p>maven-shade-pluginæä¾›äº†ä¸¤å¤§åŸºæœ¬åŠŸèƒ½ï¼š<br>å°†ä¾èµ–çš„jaråŒ…æ‰“åŒ…åˆ°å½“å‰jaråŒ…ï¼ˆå¸¸è§„æ‰“åŒ…æ˜¯ä¸ä¼šå°†æ‰€ä¾èµ–jaråŒ…æ‰“è¿›æ¥çš„ï¼‰ï¼›<br>å¯¹ä¾èµ–çš„jaråŒ…è¿›è¡Œé‡å‘½åï¼ˆç”¨äºç±»çš„éš”ç¦»ï¼‰ï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-shade-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- put your configurations here --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>shade<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="3-maven-assembly-plugin"><a href="#3-maven-assembly-plugin" class="headerlink" title="3.maven-assembly-plugin"></a>3.maven-assembly-plugin</h4><blockquote><p>åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œæ˜¯mavenä¸­é’ˆå¯¹æ‰“åŒ…ä»»åŠ¡è€Œæä¾›çš„æ ‡å‡†æ’ä»¶ã€‚å®ƒæ˜¯Mavenæœ€å¼ºå¤§çš„æ‰“åŒ…æ’ä»¶ï¼Œå®ƒæ”¯æŒå„ç§æ‰“åŒ…æ–‡ä»¶æ ¼å¼ï¼ŒåŒ…æ‹¬zipã€tar.gzã€tar.bz2ç­‰ç­‰ï¼Œé€šè¿‡ä¸€ä¸ªæ‰“åŒ…æè¿°æ–‡ä»¶è®¾ç½®ï¼ˆsrc&#x2F;main&#x2F;assembly.xmlï¼‰ï¼Œå®ƒèƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·é€‰æ‹©å…·ä½“æ‰“åŒ…å“ªäº›èµ„æºæ–‡ä»¶é›†åˆã€ä¾èµ–ã€æ¨¡å—ï¼Œç”šè‡³æœ¬åœ°ä»“åº“æ–‡ä»¶ï¼Œæ¯ä¸ªé¡¹çš„å…·ä½“æ‰“åŒ…è·¯å¾„ç”¨æˆ·ä¹Ÿèƒ½è‡ªç”±æ§åˆ¶ã€‚</p></blockquote><p>å®ƒä¸æ˜¯æŠŠä¾èµ–çš„jarç›´æ¥æ‰“è¿›å»ï¼Œè€Œæ˜¯æŠŠä¾èµ–çš„jarç¼–è¯‘æˆclassæ–‡ä»¶æ‰“å…¥jarä¸­ç›®å½•</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.demo.DemoApplication<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRefs</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRef</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">descriptorRefs</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>     <span class="hljs-comment">&lt;!--ä¸‹é¢æ˜¯ä¸ºäº†ä½¿ç”¨ mvn packageå‘½ä»¤ï¼Œå¦‚æœä¸åŠ åˆ™ä½¿ç”¨mvn assembly--&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>         <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>make-assemble<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>             <span class="hljs-comment">&lt;!-- ç»‘å®šåˆ°packageç”Ÿå‘½å‘¨æœŸ --&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>             <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>                 <span class="hljs-comment">&lt;!-- åªè¿è¡Œä¸€æ¬¡ --&gt;</span><br>                 <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>single<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>             <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>         <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>     <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="4-maven-jar-plugin"><a href="#4-maven-jar-plugin" class="headerlink" title="4.maven-jar-plugin"></a>4.maven-jar-plugin</h4><blockquote><p>é»˜è®¤çš„æ‰“åŒ…æ–¹å¼ï¼Œç”¨æ¥æ‰“æ™®é€šçš„project JARåŒ…</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-jar-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--è¦ä½¿ç”¨çš„æ‰“åŒ…é…ç½®.--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">archive</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- åˆ›å»ºçš„å½’æ¡£æ–‡ä»¶æ˜¯å¦åŒ…å«ä»¥ä¸‹pom.xml å’Œpom.properties Maven æ–‡ä»¶,é»˜è®¤æ˜¯true --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">addMavenDescriptor</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">addMavenDescriptor</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- ç”ŸæˆMANIFEST.MFçš„è®¾ç½® --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">manifest</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- ä¸ºä¾èµ–åŒ…æ·»åŠ è·¯å¾„, è¿™äº›è·¯å¾„ä¼šå†™åœ¨MANIFESTæ–‡ä»¶çš„Class-Pathä¸‹ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">addClasspath</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">addClasspath</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- è¿™ä¸ªjaræ‰€ä¾èµ–çš„jaråŒ…æ·»åŠ classPathçš„æ—¶å€™çš„å‰ç¼€ï¼Œå¦‚æœè¿™ä¸ªjaræœ¬èº«å’Œä¾èµ–åŒ…åœ¨åŒä¸€çº§ç›®å½•ï¼Œåˆ™ä¸éœ€è¦æ·»åŠ  --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">classpathPrefix</span>&gt;</span>lib/<span class="hljs-tag">&lt;/<span class="hljs-name">classpathPrefix</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- jarå¯åŠ¨å…¥å£ç±» --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">mainClass</span>&gt;</span>com.example.demo.DemoApplication<span class="hljs-tag">&lt;/<span class="hljs-name">mainClass</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">manifest</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">manifestEntries</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- åœ¨Class-Pathä¸‹æ·»åŠ é…ç½®æ–‡ä»¶çš„è·¯å¾„ --&gt;</span><br>                <span class="hljs-comment">&lt;!--&lt;Class-Path&gt;../config/&lt;/Class-Path&gt;--&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">manifestEntries</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">archive</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- jaråŒ…çš„ä½ç½®ï¼Œå…¶ä¸­$&#123;project.build.directory&#125;é»˜è®¤ä¸º target/ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--è¿‡æ»¤æ‰ä¸å¸Œæœ›åŒ…å«åœ¨jarä¸­çš„æ–‡ä»¶--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">excludes</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclude</span>&gt;</span>$&#123;project.basedir&#125;/xml/*<span class="hljs-tag">&lt;/<span class="hljs-name">exclude</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">excludes</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--è¦åŒ…å«çš„æ–‡ä»¶åˆ—è¡¨--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">includes</span>&gt;</span><br>            <span class="hljs-comment">&lt;!-- æ‰“jaråŒ…æ—¶ï¼Œæ‰“åŒ…classæ–‡ä»¶å’Œconfigç›®å½•ä¸‹é¢çš„ propertiesæ–‡ä»¶ --&gt;</span><br>            <span class="hljs-comment">&lt;!-- æœ‰æ—¶å€™å¯èƒ½éœ€è¦ä¸€äº›å…¶ä»–æ–‡ä»¶ï¼Œè¿™è¾¹å¯ä»¥é…ç½®ï¼ŒåŒ…æ‹¬å‰”é™¤çš„æ–‡ä»¶ç­‰ç­‰ --&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.class<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>**/*.properties<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">includes</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="-1"><a href="#-1" class="headerlink" title=""></a></h4><p>5.maven-dependency-plugin</p><blockquote><p>maven-dependency-pluginæ˜¯å¤„ç†ä¸ä¾èµ–ç›¸å…³çš„æ’ä»¶ã€‚å®ƒæœ‰å¾ˆå¤šå¯ç”¨çš„goalï¼Œå¤§éƒ¨åˆ†æ˜¯å’Œä¾èµ–æ„å»ºã€åˆ†æå’Œè§£å†³ç›¸å…³çš„goalï¼Œè¿™éƒ¨åˆ†goalå¯ä»¥ç›´æ¥ç”¨mavençš„å‘½ä»¤æ“ä½œï¼Œ<br>ä¾‹å¦‚ï¼šmvn dependency:treeã€mvn dependency:analyze<br>ä½†æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„æ˜¯dependency:copydependency:copy-dependenciesã€dependency:unpackã€dependency:unpack-dependenciesè¿™å››ä¸ªã€‚</p></blockquote><p>maven-dependency-pluginæœ€å¤§çš„ç”¨é€”æ˜¯å¸®åŠ©åˆ†æé¡¹ç›®ä¾èµ–ï¼Œdependency:listèƒ½å¤Ÿåˆ—å‡ºé¡¹ç›®æœ€ç»ˆè§£æåˆ°çš„ä¾èµ–åˆ—è¡¨ï¼Œdependency:treeèƒ½è¿›ä¸€æ­¥çš„æç»˜é¡¹ç›®ä¾èµ–æ ‘ï¼Œdependency:analyzeå¯ä»¥å‘Šè¯‰ä½ é¡¹ç›®ä¾èµ–æ½œåœ¨çš„é—®é¢˜ï¼Œå¦‚æœä½ æœ‰ç›´æ¥ä½¿ç”¨åˆ°çš„å´æœªå£°æ˜çš„ä¾èµ–ï¼Œè¯¥ç›®æ ‡å°±ä¼šå‘å‡ºè­¦å‘Šã€‚<br>maven-dependency-pluginè¿˜æœ‰å¾ˆå¤šç›®æ ‡å¸®åŠ©ä½ æ“ä½œä¾èµ–æ–‡ä»¶ï¼Œä¾‹å¦‚dependency:copy-dependenciesèƒ½å°†é¡¹ç›®ä¾èµ–ä»æœ¬åœ°Mavenä»“åº“å¤åˆ¶åˆ°æŸä¸ªç‰¹å®šçš„æ–‡ä»¶å¤¹ä¸‹é¢ã€‚<br>é»˜è®¤çš„ä¸»èµ„æºæ–‡ä»¶ç›®å½•æ˜¯src&#x2F;main&#x2F;resourcesï¼Œå¾ˆå¤šç”¨æˆ·ä¼šéœ€è¦æ·»åŠ é¢å¤–çš„èµ„æºæ–‡ä»¶ç›®å½•ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡é…ç½®maven-resources-pluginæ¥å®ç°ã€‚<br>æ­¤å¤–ï¼Œèµ„æºæ–‡ä»¶è¿‡æ»¤ä¹Ÿæ˜¯Mavençš„ä¸€å¤§ç‰¹æ€§ï¼Œä½ å¯ä»¥åœ¨èµ„æºæ–‡ä»¶ä¸­ä½¿ç”¨_${propertyName}_å½¢å¼çš„Mavenå±æ€§ï¼Œç„¶åé…ç½®maven-resources-pluginå¼€å¯å¯¹èµ„æºæ–‡ä»¶çš„è¿‡æ»¤ï¼Œä¹‹åå°±å¯ä»¥é’ˆå¯¹ä¸åŒç¯å¢ƒé€šè¿‡å‘½ä»¤è¡Œæˆ–è€…Profileä¼ å…¥å±æ€§çš„å€¼ï¼Œä»¥å®ç°æ›´ä¸ºçµæ´»çš„æ„å»ºã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--åœ¨æ‰“åŒ…é˜¶æ®µå°†ä¾èµ–çš„jaråŒ…å¯¼å‡ºåˆ°libç›®å½•ä¸‹--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>           <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">includeTypes</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">includeTypes</span>&gt;</span><br>               <span class="hljs-comment">&lt;!--é¡¹ç›®æ„ä»¶è¾“å‡ºç›®å½•ï¼Œå…¶ä¸­$&#123;project.build.directory&#125;é»˜è®¤ä¸º target/--&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">overWriteReleases</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">overWriteReleases</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">overWriteSnapshots</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">overWriteSnapshots</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">overWriteIfNewer</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">overWriteIfNewer</span>&gt;</span><br>           <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="6-maven-resources-plugin"><a href="#6-maven-resources-plugin" class="headerlink" title="6.maven-resources-plugin"></a>6.maven-resources-plugin</h4><blockquote><p>ä¸ºäº†ä½¿é¡¹ç›®ç»“æ„æ›´ä¸ºæ¸…æ™°ï¼ŒMavenåŒºåˆ«å¯¹å¾…Javaä»£ç æ–‡ä»¶å’Œèµ„æºæ–‡ä»¶ï¼Œmaven-compiler-pluginç”¨æ¥ç¼–è¯‘Javaä»£ç ï¼Œmaven-resources-pluginåˆ™ç”¨æ¥å¤„ç†èµ„æºæ–‡ä»¶ã€‚<br>é»˜è®¤çš„ä¸»èµ„æºæ–‡ä»¶ç›®å½•æ˜¯src&#x2F;main&#x2F;resourcesï¼Œå¾ˆå¤šç”¨æˆ·ä¼šéœ€è¦æ·»åŠ é¢å¤–çš„èµ„æºæ–‡ä»¶ç›®å½•ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡é…ç½®maven-resources-pluginæ¥å®ç°ã€‚<br>æ­¤å¤–ï¼Œèµ„æºæ–‡ä»¶è¿‡æ»¤ä¹Ÿæ˜¯Mavençš„ä¸€å¤§ç‰¹æ€§ï¼Œä½ å¯ä»¥åœ¨èµ„æºæ–‡ä»¶ä¸­ä½¿ç”¨_${propertyName}_å½¢å¼çš„Mavenå±æ€§ï¼Œç„¶åé…ç½®maven-resources-pluginå¼€å¯å¯¹èµ„æºæ–‡ä»¶çš„è¿‡æ»¤ï¼Œä¹‹åå°±å¯ä»¥é’ˆå¯¹ä¸åŒç¯å¢ƒé€šè¿‡å‘½ä»¤è¡Œæˆ–è€…Profileä¼ å…¥å±æ€§çš„å€¼ï¼Œä»¥å®ç°æ›´ä¸ºçµæ´»çš„æ„å»ºã€‚</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-resources-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span><br>       <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-resources<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><br>           <span class="hljs-comment">&lt;!--ç»‘å®šåˆ°packageç”Ÿå‘½å‘¨æœŸ--&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-resources<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span><br>           <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span><br>           <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>target/conf<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">useDefaultDelimiters</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">useDefaultDelimiters</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">includeEmptyDirs</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">includeEmptyDirs</span>&gt;</span><br>               <span class="hljs-comment">&lt;!--è®¾ç½®è‡ªå®šä¹‰åˆ†éš”ç¬¦--&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">delimiters</span>&gt;</span><br>                   <span class="hljs-tag">&lt;<span class="hljs-name">delimiter</span>&gt;</span>#<span class="hljs-tag">&lt;/<span class="hljs-name">delimiter</span>&gt;</span><br>               <span class="hljs-tag">&lt;/<span class="hljs-name">delimiters</span>&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>                   <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>                       <span class="hljs-comment">&lt;!--ä»æ­¤ç›®å½•ä¸‹è¯»å–å…¨éƒ¨ä»¥.propertieså’Œ.xmlå¼€å¤´çš„æ–‡ä»¶--&gt;</span><br>                       <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>src/main/resources/<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>                       <span class="hljs-comment">&lt;!--ç”¨æ¥æŒ‡å®šéœ€è¦æ‰“å…¥å“ªäº›åç¼€ç±»å‹çš„æ–‡ä»¶--&gt;</span><br>                       <span class="hljs-comment">&lt;!--&lt;includes&gt;</span><br><span class="hljs-comment">                           &lt;include&gt;**/*.properties&lt;/include&gt;</span><br><span class="hljs-comment">                           &lt;include&gt;**/*.xml&lt;/include&gt;</span><br><span class="hljs-comment">                       &lt;/includes&gt;--&gt;</span><br>                   <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>               <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br>               <span class="hljs-comment">&lt;!-- è¿‡æ»¤åç¼€ä¸ºcrtå’Œjksçš„æ–‡ä»¶ --&gt;</span><br>               <span class="hljs-tag">&lt;<span class="hljs-name">nonFilteredFileExtensions</span>&gt;</span><br>                   <span class="hljs-tag">&lt;<span class="hljs-name">nonFilteredFileExtension</span>&gt;</span>crt<span class="hljs-tag">&lt;/<span class="hljs-name">nonFilteredFileExtension</span>&gt;</span><br>                   <span class="hljs-tag">&lt;<span class="hljs-name">nonFilteredFileExtension</span>&gt;</span>jks<span class="hljs-tag">&lt;/<span class="hljs-name">nonFilteredFileExtension</span>&gt;</span><br>               <span class="hljs-tag">&lt;/<span class="hljs-name">nonFilteredFileExtensions</span>&gt;</span><br>           <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span><br>   <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="-2"><a href="#-2" class="headerlink" title=""></a></h4><p>7.maven-compiler-plugin</p><blockquote><p>ä½œç”¨: 1. æŒ‡ç¤ºmavenç”¨ä»€ä¹ˆç‰ˆæœ¬çš„jdkç¼–è¯‘; 2. æŒ‡ç¤ºIntelliJ IDEAæŠŠé¡¹ç›®è¯†åˆ«æˆä»€ä¹ˆjdk</p></blockquote><p>maven æ˜¯ä¸ªç®¡ç†å·¥å…·ï¼Œå¦‚æœæˆ‘ä»¬ä¸å‘Šè¯‰å®ƒæˆ‘ä»¬çš„ä»£ç è¦ä½¿ç”¨ä»€ä¹ˆæ ·çš„ jdk ç‰ˆæœ¬ç¼–è¯‘çš„è¯ï¼Œå®ƒå°±ä¼šç”¨ maven-compiler-plugin é»˜è®¤çš„ jdk ç‰ˆæœ¬æ¥è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å°±å®¹æ˜“å‡ºç°ç‰ˆæœ¬ä¸åŒ¹é…ï¼Œä»¥è‡³äºå¯èƒ½å¯¼è‡´ç¼–è¯‘ä¸é€šè¿‡çš„é—®é¢˜ã€‚<br>maven-compiler-pluginæ’ä»¶æ˜¯ä¸€ä¸ªMavenæ’ä»¶ï¼Œç”¨æ¥ç¼–è¯‘é¡¹ç›®ä»£ç ï¼›è‡ªä»3.0å¼€å§‹é»˜è®¤çš„ç¼–è¯‘å™¨æ˜¯javax.tools.JavaCompilerï¼Œç”¨æ¥ç¼–è¯‘Javaæºç ï¼›å¦‚æœä½ æƒ³å¼ºåˆ¶æ’ä»¶ä½¿ç”¨javacç¼–è¯‘å™¨ï¼Œä½ å¿…é¡»é…ç½®æ’ä»¶çš„å±æ€§forceJavacCompilerUseï¼›è¿˜è¦æ³¨æ„ï¼Œå½“å‰é»˜è®¤æºï¼ˆsourceï¼‰è®¾ç½®ä¸º1.6ï¼Œé»˜è®¤ç›®æ ‡(target)è®¾ç½®ä¸º1.6ã€‚ç‹¬ç«‹è¿è¡ŒMavenå’ŒJDK,å¯ä»¥é€šè¿‡sourceå’Œtargeté€‰é¡¹æ›´æ”¹ä»–ä»¬çš„é»˜è®¤å€¼ï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>maven</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ElasticSearch-Tips</title>
    <link href="/2021/04/24/ElasticSearch-Tips/"/>
    <url>/2021/04/24/ElasticSearch-Tips/</url>
    
    <content type="html"><![CDATA[<h2 id="è¿™é‡Œè®°å½•ä¸€ä¸‹esä½¿ç”¨ç»éªŒ"><a href="#è¿™é‡Œè®°å½•ä¸€ä¸‹esä½¿ç”¨ç»éªŒ" class="headerlink" title="è¿™é‡Œè®°å½•ä¸€ä¸‹esä½¿ç”¨ç»éªŒ"></a>è¿™é‡Œè®°å½•ä¸€ä¸‹esä½¿ç”¨ç»éªŒ</h2><h3 id="1-ESèµ„æºè¯„ä¼°å…¬å¼"><a href="#1-ESèµ„æºè¯„ä¼°å…¬å¼" class="headerlink" title="1.ESèµ„æºè¯„ä¼°å…¬å¼"></a>1.ESèµ„æºè¯„ä¼°å…¬å¼</h3><table><thead><tr><th>å„è§„æ ¼ä¸‹æœ€å¤§ç´¢å¼•é€Ÿåº¦å’ŒæŸ¥è¯¢é€Ÿåº¦é¢„ä¼°</th><th></th><th></th></tr></thead><tbody><tr><td>é›†ç¾¤è§„æ¨¡</td><td>3master+n data</td><td></td></tr><tr><td>è¿æ¥æ–¹å¼</td><td>ç›´è¿åŒæ­¥å†™åŠåŒæ­¥æŸ¥è¯¢</td><td></td></tr><tr><td>æ•°æ®é‡</td><td>æŸ¥è¯¢åŸºäº320Wæ•°æ®ï¼Œå•æ¡æ•°æ®1Kï¼Œç´¢å¼•1ä¸ªå‰¯æœ¬ã€åˆ·æ–°æ—¶é—´1sï¼Œå…¶ä»–ç´¢å¼•é…ç½®é»˜è®¤ã€‚</td><td></td></tr><tr><td>è¯„ä¼°ä¾æ®</td><td>åŸºäºdataèŠ‚ç‚¹æ•°çš„å½±å“ç»“æœï¼Œé¢„ä¼°ä¸åŒdataèŠ‚ç‚¹ä¸ªæ•°æ—¶çš„æœ€å¤§ç´¢å¼•é€Ÿåº¦å’ŒæŸ¥è¯¢é€Ÿåº¦ï¼Œnä¸ºæ•°æ®èŠ‚ç‚¹æ•°ã€‚</td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td>è™šæ‹Ÿæœºèµ„æºè§„æ ¼(CPU&#x2F;JVM&#x2F;ä¸»æœº)</td><td>ç´¢å¼•é€Ÿåº¦ï¼ˆ&#x2F;sï¼‰</td><td>æŸ¥è¯¢é€Ÿåº¦ï¼ˆ&#x2F;sï¼‰</td></tr><tr><td>0.5C&#x2F;1G&#x2F;2G</td><td>30_(1+n_0.2)</td><td>10_(1+n_0.2)</td></tr><tr><td>1C&#x2F;2G&#x2F;4G</td><td>100_(1+n_0.2)</td><td>55_(1+n_0.2)</td></tr><tr><td>2C&#x2F;4G&#x2F;8G</td><td>430_(1+n_0.2)</td><td>170_(1+n_0.2)</td></tr><tr><td>4C&#x2F;8G&#x2F;16G</td><td>1150_(1+n_0.2)</td><td>500_(1+n_0.2)</td></tr><tr><td>8C&#x2F;16G&#x2F;32G</td><td>2600_(1+n_0.2)</td><td>1800_(1+n_0.2)</td></tr><tr><td></td><td></td><td></td></tr><tr><td>å®¹å™¨èµ„æºè§„æ ¼(CPU&#x2F;JVM&#x2F;ä¸»æœº)</td><td>ç´¢å¼•é€Ÿåº¦ï¼ˆ&#x2F;sï¼‰</td><td>æŸ¥è¯¢é€Ÿåº¦ï¼ˆ&#x2F;sï¼‰</td></tr><tr><td>1C&#x2F;2G&#x2F;4G</td><td>110+n*20</td><td>50+n*10</td></tr><tr><td>2C&#x2F;8G&#x2F;16G</td><td>420+n*80</td><td>170+n*30</td></tr><tr><td>4C&#x2F;16G&#x2F;32G</td><td>1100+n*200</td><td>550+n*110</td></tr><tr><td>8C&#x2F;32G&#x2F;64G</td><td>2700+n*500</td><td>1900+n*300</td></tr><tr><td>12C&#x2F;32G&#x2F;64G</td><td>4600+n*900</td><td>4000+n*800</td></tr><tr><td>16C&#x2F;32G&#x2F;64G</td><td>6800+n*1400</td><td>7000+n*1400</td></tr><tr><td>24C&#x2F;32G&#x2F;64G</td><td>12300+n*2400</td><td>15300+n*3100</td></tr><tr><td></td><td></td><td></td></tr><tr><td>ä¸»åˆ†ç‰‡æ•°çš„è¯„ä¼°æ–¹å¼</td><td></td><td></td></tr><tr><td>è¦æ±‚</td><td>1ã€åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šåˆ†é…çš„ç´¢å¼•åˆ†ç‰‡æ•°ä¸è¶…è¿‡3ä¸ªã€‚</td><td></td></tr><tr><td>2ã€æ¯ä¸ªç´¢å¼•åˆ†ç‰‡æ•°å¤§å°ä¸è¶…è¿‡30Gã€‚</td><td></td><td></td></tr><tr><td>æ ¹æ®é›†ç¾¤èŠ‚ç‚¹æ•°è®¡ç®—æ‰¿è½½æœ€å¤§çš„ä¸»åˆ†ç‰‡æ•°</td><td>èŠ‚ç‚¹æ•°*3&#x2F;2</td><td></td></tr><tr><td>æ ¹æ®æ•°æ®å¤§å°è®¡ç®—æœ€å¤§çš„ä¸»åˆ†ç‰‡æ•°</td><td>XG&#x2F;èŠ‚ç‚¹æ•°&#x2F;2</td><td></td></tr></tbody></table><h3 id="2-ESé…ç½®åŸåˆ™"><a href="#2-ESé…ç½®åŸåˆ™" class="headerlink" title="2.ESé…ç½®åŸåˆ™"></a>2.ESé…ç½®åŸåˆ™</h3><p><strong>æœåŠ¡å†…å­˜åœ¨ 1-64Gä¹‹é—´çš„</strong>:</p><p>export ES_HEAP_SIZE &#x3D; ä¸€åŠæœåŠ¡å™¨çš„å†…å­˜æŠŠ50%çš„å†…å­˜ç»™elasticsearchï¼Œå‰©ä¸‹çš„50%ä¹Ÿä¸ä¼šæ²¡æœ‰ç”¨å¤„çš„ï¼ŒLuceneä¼šå¾ˆå¿«åå™¬å‰©ä¸‹çš„è¿™éƒ¨åˆ†å†…å­˜ç”¨äºæ–‡ä»¶ç¼“å­˜ã€‚</p><p><strong>æœåŠ¡å™¨å†…å­˜å¤§äº64Gçš„</strong>ï¼š</p><ul><li>æ–¹æ¡ˆä¸€ï¼šæ›´å¤šçš„å…¨æ–‡æ£€ç´¢ï¼š export ES_HEAP_SIZE &#x3D; 31Gï¼Œå‰©ä¸‹çš„ç»™Lucene</li><li>æ–¹æ¡ˆäºŒï¼šæ›´å¤šçš„æ’åºå’Œèšåˆï¼šä¸€å°æœºå™¨ä¸Šåˆ›å»ºä¸¤ä¸ªæˆ–è€…æ›´å¤šESèŠ‚ç‚¹ï¼Œè€Œä¸è¦éƒ¨ç½²ä¸€ä¸ªä½¿ç”¨32+GBå†…å­˜çš„èŠ‚ç‚¹export ES_HEAP_SIZE &#x3D; 31Gå‰©ä¸‹çš„ç»™Lucene</li><li>å¤‡æ³¨ï¼šcluster.routing.allocation.same_shard.host:trueã€‚è¿™ä¼šé˜²æ­¢åŒä¸€ä¸ªshardçš„ä¸»å‰¯æœ¬å­˜åœ¨åŒä¸€ä¸ªç‰©ç†æœºä¸Šï¼ˆå› ä¸ºå¦‚æœå­˜åœ¨ä¸€ä¸ªæœºå™¨ä¸Šï¼Œå‰¯æœ¬çš„é«˜å¯ç”¨æ€§å°±æ²¡æœ‰äº†ï¼‰ã€‚</li></ul><p><strong>ä¸ºä»€ä¹ˆ32Gæ˜¯JVMå †å†…å­˜è®¾ç½®çš„ä¸€ä¸ªåï¼Ÿ</strong></p><blockquote><p>JVM åœ¨å†…å­˜å°äº 32 GB çš„æ—¶å€™ä¼šé‡‡ç”¨ä¸€ä¸ªå†…å­˜å¯¹è±¡æŒ‡é’ˆå‹ç¼©æŠ€æœ¯ã€‚åœ¨ Java ä¸­ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½åˆ†é…åœ¨å †ä¸Šï¼Œå¹¶é€šè¿‡ä¸€ä¸ªæŒ‡é’ˆè¿›è¡Œå¼•ç”¨ã€‚ æ™®é€šå¯¹è±¡æŒ‡é’ˆï¼ˆOOPï¼‰æŒ‡å‘è¿™äº›å¯¹è±¡ï¼Œé€šå¸¸ä¸º CPU å­—é•¿ çš„å¤§å°ï¼š32 ä½æˆ– 64 ä½ï¼Œå–å†³äºä½ çš„å¤„ç†å™¨ã€‚æŒ‡é’ˆå¼•ç”¨çš„å°±æ˜¯è¿™ä¸ª OOP å€¼çš„å­—èŠ‚ä½ç½®ã€‚å¯¹äº 32 ä½çš„ç³»ç»Ÿï¼Œæ„å‘³ç€å †å†…å­˜å¤§å°æœ€å¤§ä¸º 4 GBã€‚å¯¹äº 64 ä½çš„ç³»ç»Ÿï¼Œ å¯ä»¥ä½¿ç”¨æ›´å¤§çš„å†…å­˜ï¼Œä½†æ˜¯ 64 ä½çš„æŒ‡é’ˆæ„å‘³ç€æ›´å¤§çš„æµªè´¹ï¼Œå› ä¸ºä½ çš„æŒ‡é’ˆæœ¬èº«å¤§äº†ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œ æ›´å¤§çš„æŒ‡é’ˆåœ¨ä¸»å†…å­˜å’Œå„çº§ç¼“å­˜ï¼ˆä¾‹å¦‚ LLCï¼ŒL1 ç­‰ï¼‰ä¹‹é—´ç§»åŠ¨æ•°æ®çš„æ—¶å€™ï¼Œä¼šå ç”¨æ›´å¤šçš„å¸¦å®½ã€‚Java ä½¿ç”¨ä¸€ä¸ªå«ä½œ å†…å­˜æŒ‡é’ˆå‹ç¼©ï¼ˆcompressed oopsï¼‰çš„æŠ€æœ¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å®ƒçš„æŒ‡é’ˆä¸å†è¡¨ç¤ºå¯¹è±¡åœ¨å†…å­˜ä¸­çš„ç²¾ç¡®ä½ç½®ï¼Œè€Œæ˜¯è¡¨ç¤º åç§»é‡ ã€‚è¿™æ„å‘³ç€ 32 ä½çš„æŒ‡é’ˆå¯ä»¥å¼•ç”¨ 40 äº¿ä¸ª å¯¹è±¡ ï¼Œ è€Œä¸æ˜¯ 40 äº¿ä¸ªå­—èŠ‚ã€‚æœ€ç»ˆï¼Œ ä¹Ÿå°±æ˜¯è¯´å †å†…å­˜å¢é•¿åˆ° 32 GB çš„ç‰©ç†å†…å­˜ï¼Œä¹Ÿå¯ä»¥ç”¨ 32 ä½çš„æŒ‡é’ˆè¡¨ç¤ºã€‚ä¸€æ—¦ä½ è¶Šè¿‡é‚£ä¸ªç¥å¥‡çš„ ~32 GB çš„è¾¹ç•Œï¼ŒæŒ‡é’ˆå°±ä¼šåˆ‡å›æ™®é€šå¯¹è±¡çš„æŒ‡é’ˆã€‚ æ¯ä¸ªå¯¹è±¡çš„æŒ‡é’ˆéƒ½å˜é•¿äº†ï¼Œå°±ä¼šä½¿ç”¨æ›´å¤šçš„ CPU å†…å­˜å¸¦å®½ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å®é™…ä¸Šå¤±å»äº†æ›´å¤šçš„å†…å­˜ã€‚äº‹å®ä¸Šï¼Œå½“å†…å­˜åˆ°è¾¾ 40â€“50 GB çš„æ—¶å€™ï¼Œæœ‰æ•ˆå†…å­˜æ‰ç›¸å½“äºä½¿ç”¨å†…å­˜å¯¹è±¡æŒ‡é’ˆå‹ç¼©æŠ€æœ¯æ—¶å€™çš„ 32 GB å†…å­˜ã€‚è¿™æ®µæè¿°çš„æ„æ€å°±æ˜¯è¯´ï¼šå³ä¾¿ä½ æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œä¹Ÿå°½é‡ä¸è¦ è¶…è¿‡ 32 GBã€‚å› ä¸ºå®ƒæµªè´¹äº†å†…å­˜ï¼Œé™ä½äº† CPU çš„æ€§èƒ½ï¼Œè¿˜è¦è®© GC åº”å¯¹å¤§å†…å­˜ã€‚</p></blockquote><p><strong>æŒ‡é’ˆå‹ç¼©</strong></p><blockquote><p>å› ä¸ºjavaéœ€è¦è®°å½•å¯¹è±¡åœ¨å†…å­˜ä¸­çš„ä½ç½®å•Šï¼Œè¿™ä¸ªè®°å½•åœ¨å¯¹è±¡å¤´ä¸­ï¼Œ32ä½æœºå™¨å¯¹è±¡å¤´é»˜è®¤å äº†8ä¸ªå­—èŠ‚(å†…å­˜æŒ‡é’ˆ+kclass)ï¼Œ4å­—èŠ‚&#x3D;4*8&#x3D;32ä½&#x3D;4Gï¼Œä½†æ˜¯Javaä½¿ç”¨çš„æ˜¯å‹ç¼©æŒ‡é’ˆä¸æ˜¯12345è¿™æ ·è®°å½•çš„ï¼Œæ˜¯0ï¼Œ8ï¼Œ16è¿™æ ·è®°å½•çš„ï¼Œæ‰€ä»¥8å­—èŠ‚çš„å¯¹è±¡å¤´æœ€å¤§è®°å½•å†…å­˜åœ°å€32Gå¦‚æœè¶…è¿‡32Gå°±éœ€è¦æ›´å¤§çš„å¯¹è±¡å¤´è®°å½•ä½ç½®å’Œkclassï¼Œå¯ä»¥æƒ³è±¡è¶…è¿‡32Gä¹‹åå¯¹è±¡å¤´å ç”¨å†…å­˜é‚£ä¹ˆå¤šä¸å€¼å¾—ï¼Œæ‰€ä»¥31Gæœ€ä¼˜ã€‚</p></blockquote><p><strong>å‹ç¼©æŒ‡é’ˆæ˜¯æ€ä¹ˆå®ç°çš„</strong></p><blockquote><p>ä¸å†ä¿å­˜æ‰€æœ‰å¼•ç”¨ï¼Œè€Œæ˜¯æ¯éš”8ä¸ªå­—èŠ‚ä¿å­˜ä¸€ä¸ªå¼•ç”¨ã€‚ä¾‹å¦‚ï¼ŒåŸæ¥ä¿å­˜æ¯ä¸ªå¼•ç”¨0ã€1ã€2â€¦ï¼Œç°åœ¨åªä¿å­˜0ã€8ã€16â€¦ã€‚å› æ­¤ï¼ŒæŒ‡é’ˆå‹ç¼©åï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰å¼•ç”¨éƒ½ä¿å­˜åœ¨å †ä¸­ï¼Œè€Œæ˜¯ä»¥8ä¸ªå­—èŠ‚ä¸ºé—´éš”ä¿å­˜å¼•ç”¨ã€‚åœ¨å®ç°ä¸Šï¼Œå †ä¸­çš„å¼•ç”¨å…¶å®è¿˜æ˜¯æŒ‰ç…§0x0ã€0x1ã€0x2â€¦è¿›è¡Œå­˜å‚¨ã€‚åªä¸è¿‡å½“å¼•ç”¨è¢«å­˜å…¥64ä½çš„å¯„å­˜å™¨æ—¶ï¼ŒJVMå°†å…¶å·¦ç§»3ä½ï¼ˆç›¸å½“äºæœ«å°¾æ·»åŠ 3ä¸ª0ï¼‰ï¼Œä¾‹å¦‚0x0ã€0x1ã€0x2â€¦åˆ†åˆ«è¢«è½¬æ¢ä¸º0x0ã€0x8ã€0x10ã€‚è€Œå½“ä»å¯„å­˜å™¨è¯»å‡ºæ—¶ï¼ŒJVMåˆå¯ä»¥å³ç§»3ä½ï¼Œä¸¢å¼ƒæœ«å°¾çš„0ã€‚ï¼ˆoopåœ¨å †ä¸­æ˜¯32ä½ï¼Œåœ¨å¯„å­˜å™¨ä¸­æ˜¯35ä½ï¼Œ2çš„35æ¬¡æ–¹&#x3D;32Gã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨32ä½ï¼Œæ¥è¾¾åˆ°35ä½oopæ‰€èƒ½å¼•ç”¨çš„å †å†…å­˜ç©ºé—´ï¼‰</p></blockquote><h3 id="3-ESéƒ¨ç½²åŸåˆ™"><a href="#3-ESéƒ¨ç½²åŸåˆ™" class="headerlink" title="3.ESéƒ¨ç½²åŸåˆ™"></a>3.ESéƒ¨ç½²åŸåˆ™</h3><ul><li>ã€å¼ºåˆ¶ã€‘å¼€å¯å†…å­˜é”ï¼Œç¦æ­¢swapping</li><li>ã€å¼ºåˆ¶ã€‘æ–‡ä»¶æè¿°ç¬¦æ•°é‡è°ƒæ•´è‡³65536</li><li>ã€å¼ºåˆ¶ã€‘æœ€å¤§æ˜ å°„æ•°è°ƒæ•´è‡³262144</li><li>ã€å¼ºåˆ¶ã€‘é‡è¦æ•°æ®è‡³å°‘æœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ä¸èƒ½åœ¨åŒä¸€ä¸ªç‰©ç†æœºä¸Š</li><li>ã€å¼ºåˆ¶ã€‘éƒ¨ç½²æœ€åä¸¥æ ¼åˆ’åˆ†ESèŠ‚ç‚¹è§’è‰²</li><li>ã€å¼ºåˆ¶ã€‘æ·»åŠ å¿«ç…§ä»»åŠ¡</li><li>ã€å»ºè®®ã€‘ä½¿ç”¨RestClientè¿æ¥</li><li>ã€å¼ºåˆ¶ã€‘è¯»è¿æ¥clientèŠ‚ç‚¹ï¼Œå†™è¿æ¥dataèŠ‚ç‚¹ã€‚</li><li>ã€å¼ºåˆ¶ã€‘è¿æ¥æ—¶ï¼Œå¿…é¡»é…ç½®ä¸Šæ‰€æœ‰çš„å¯¹åº”èŠ‚ç‚¹ï¼Œé¿å…å•èŠ‚ç‚¹é…ç½®ã€‚</li></ul><h3 id="4-ESç´¢å¼•æ¨¡æ¿è®¾è®¡åŸåˆ™"><a href="#4-ESç´¢å¼•æ¨¡æ¿è®¾è®¡åŸåˆ™" class="headerlink" title="4.ESç´¢å¼•æ¨¡æ¿è®¾è®¡åŸåˆ™"></a>4.ESç´¢å¼•æ¨¡æ¿è®¾è®¡åŸåˆ™</h3><ul><li>ã€å»ºè®®ã€‘è®¾ç½®ç´¢å¼•çš„refresh_intervalï¼Œé»˜è®¤1så»ºè®®è°ƒè‡³60så‡å°‘å†™å…¥å‹åŠ›</li><li>ã€å¼ºåˆ¶ã€‘ç¦æ­¢ä¸ä½¿ç”¨çš„å­—æ®µå­˜å…¥Elasticsearch</li><li>ã€å¼ºåˆ¶ã€‘ä¸ä½œä¸ºæŸ¥è¯¢å­—æ®µçš„indexå€¼è®¾ç½®ä¸ºfalse</li><li>ã€å¼ºåˆ¶ã€‘ä¸å…è®¸_allå­—æ®µï¼ˆ7.5.1ç‰ˆæœ¬ä¸å†æ”¯æŒï¼‰</li><li>ã€å¼ºåˆ¶ã€‘ç¦æ­¢esè‡ªåŠ¨åˆ›å»ºå­—æ®µï¼Œé˜²æ­¢ç´¢å¼•ç»“æ„æ··ä¹±å­—æ®µã€‚dynamicå±æ€§è®¾ç½®ä¸ºfalseé‡åˆ°é™Œç”Ÿå­—æ®µï¼Œå°±å¿½ç•¥ï¼›strictï¼šé‡åˆ°é™Œç”Ÿå­—æ®µï¼Œå°±æŠ¥é”™</li><li>ã€å¼ºåˆ¶ã€‘ç´¢å¼•çš„åˆ†ç‰‡æ•°åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¸è¶…è¿‡3ä¸ªï¼Œæ¯ä¸ªåˆ†ç‰‡æ•°é‡ä¸è¶…è¿‡30G</li><li>ã€å¼ºåˆ¶ã€‘å¯¹äºå¤§è¡¨å¿…é¡»è®¾ç½®åˆ†æœˆæˆ–åˆ†å¤©ï¼Œä¸€èˆ¬ä¸ºå•ä¸ªç´¢å¼•ä¸è¶…è¿‡100G</li><li>ã€å¼ºåˆ¶ã€‘æ•°æ®å¿…é¡»æœ‰å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸï¼Œç¦æ­¢æ°¸ä¹…ä¿å­˜ï¼Œä¸”å‘¨æœŸæ€§æ•°æ®å­˜å‚¨æœ€é•¿ä¸º6ä¸ªæœˆ</li><li>ã€å¼ºåˆ¶ã€‘å¿…é¡»å¼€å¯å‰¯æœ¬</li><li>ã€å¼ºåˆ¶ã€‘ç¦æ­¢ä¸éœ€è¦æ’åºå’Œèšåˆçš„å­—æ®µdoc_valueså±æ€§è®¾ç½®ä¸ºtrue</li><li>ã€å¼ºåˆ¶ã€‘è¡¨ç»“æ„å­—æ®µä¸è¶…è¿‡50ä¸ª</li><li>ã€å¼ºåˆ¶ã€‘ä¸å…è®¸ä½¿ç”¨typeï¼Œä¸€ä¸ªç´¢å¼•åªå­˜å‚¨ä¸€ç§ç»“æ„ï¼ˆ7.5.1ç‰ˆæœ¬ä¸å†æ”¯æŒtypeï¼‰</li><li>ã€å¼ºåˆ¶ã€‘index_patternsåªå…è®¸åŒ…å«ä¸€ç§ç´¢å¼•æ¨¡å¼</li><li>ã€å¼ºåˆ¶ã€‘ç¦æ­¢keywordç±»å‹å­—æ®µè¶…è¿‡256ä¸ªå­—ç¬¦ï¼Œé»˜è®¤è¶…è¿‡256ä¸ªå­—ç¬¦ä¸ä¼šè¢«ç´¢å¼•</li></ul><h3 id="5-ESè¯»å†™è§„èŒƒ"><a href="#5-ESè¯»å†™è§„èŒƒ" class="headerlink" title="5.ESè¯»å†™è§„èŒƒ"></a>5.ESè¯»å†™è§„èŒƒ</h3><ul><li>ã€å»ºè®®ã€‘å»ºè®®ä½¿ç”¨match_phraseæ›¿ä»£matchæé«˜æŸ¥è¯¢æ€§èƒ½</li><li>ã€å»ºè®®ã€‘å–„ç”¨filterè¿‡æ»¤å™¨ï¼Œè¿‡æ»¤é€‚åˆåœ¨å¤§èŒƒå›´ç­›é€‰æ•°æ®ï¼Œè€ŒæŸ¥è¯¢åˆ™é€‚åˆç²¾ç¡®åŒ¹é…æ•°æ®ã€‚ä¸€èˆ¬åº”ç”¨æ—¶ï¼Œåº”å…ˆä½¿ç”¨è¿‡æ»¤æ“ä½œè¿‡æ»¤æ•°æ®ï¼Œç„¶åä½¿ç”¨æŸ¥è¯¢åŒ¹é…æ•°æ®</li><li>ã€å»ºè®®ã€‘å–„ç”¨è·¯ç”±routingï¼Œæå¤§æå‡æŸ¥è¯¢æ•ˆç‡</li><li>ã€å»ºè®®ã€‘å¤§é‡æ•°æ®æäº¤æ—¶ä½¿ç”¨æ‰¹é‡æäº¤æ–¹æ³•</li><li>ã€å»ºè®®ã€‘ä¸å¾—ä¸€æ¬¡è¶…å¤§è¿”å›ç»“æœä¸Šé™ä¸º100æ¡ï¼Œåº”éœ€åˆ†é¡µæŸ¥è¯¢ã€‚å…·ä½“å®é™…é™åˆ¶æ ¹æ®é›†ç¾¤è§„æ¨¡</li><li>ã€å»ºè®®ã€‘å•ä¸ªæŸ¥è¯¢æ¡ä»¶å­—æ•°é•¿åº¦ä¸å¾—è¶…è¿‡30å­—</li><li>ã€å»ºè®®ã€‘å°½é‡å°‘ä½¿ç”¨delete_by_queryåˆ é™¤æ–‡æ¡£ï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯ç›´æ¥åˆ é™¤ç´¢å¼•</li><li>ã€å»ºè®®ã€‘ä½¿ç”¨ datastrem å’Œ ILM ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ç®¡ç†æ—¶åºæ•°æ®</li><li>ã€å»ºè®®ã€‘åˆ†ç‰‡å¤§å°æ§åˆ¶åœ¨ 10GB-50GB</li><li>ã€å»ºè®®ã€‘æ§åˆ¶åœ¨æ¯ GB å †å†…å­˜ 20 ä¸ªåˆ†ç‰‡ä»¥å†…ï¼Œé¿å…å•ä¸ªèŠ‚ç‚¹åˆ†ç‰‡è¿‡å¤šã€è´Ÿè½½è¿‡é‡</li><li>ã€å»ºè®®ã€‘å¢åŠ å­—æ®µé™åˆ¶ï¼Œé¿å…mappingçˆ†ç‚¸</li><li>ã€å¼ºåˆ¶ã€‘ä¸èƒ½ä½¿ç”¨index*çš„æ“ä½œï¼ŒåŒæ—¶è·¨å¤šä¸ªesç´¢å¼•è¿›è¡ŒæŸ¥è¯¢ï¼Œä¼šä¸¥é‡æ¶ˆè€—esæ€§èƒ½ï¼Œå»ºè®®å•æ¬¡æŸ¥è¯¢ä¸è·¨ç´¢å¼•æŸ¥è¯¢ï¼Œè·¨ç´¢å¼•æŸ¥è¯¢ä¸å¾—è¶…è¿‡3ä¸ª</li><li>ã€å¼ºåˆ¶ã€‘è®¾ç½®æŸ¥è¯¢æ‰€ä½¿ç”¨å­—æ®µå’Œè¿”å›ç»“æœåˆ—ï¼ŒæŸ¥è¯¢ç»“æœè¿”å›ä¸èƒ½è¶…è¿‡1ä¸‡æ¡ï¼Œæ•°æ®é‡è¿‡å¤§ä¼šå¯¼è‡´eså †å†…å­˜æº¢å‡º</li><li>ã€å¼ºåˆ¶ã€‘æŸ¥è¯¢æ¡ä»¶ä¸èƒ½è¶…è¿‡10Kï¼Œæ¡ä»¶è¿‡å¤§ä¼šå¯¼è‡´æŸ¥è¯¢ç¼“æ…¢å’Œesæ ˆå†…å­˜æº¢å‡º</li><li>ã€å¼ºåˆ¶ã€‘ç¦æ­¢ä½¿ç”¨å‰ç¼€wildcardsæŸ¥è¯¢ã€‚</li><li>ã€å¼ºåˆ¶ã€‘æŸ¥è¯¢æ¡ä»¶ç¦æ­¢è¶…è¿‡1024ä¸ªã€‚</li><li>ã€å¼ºåˆ¶ã€‘ESä¸æ”¯æŒäº‹åŠ¡æ€§è¯»å†™æ“ä½œã€‚</li><li>ã€å¼ºåˆ¶ã€‘é¿å…å†…åµŒæŸ¥è¯¢ã€‚</li><li>ã€å¼ºåˆ¶ï¼Œä½¿ç”¨è¯·è¿›è¡Œè¯„å®¡ã€‘é¿å…èšåˆæŸ¥è¯¢ã€‚</li><li>ã€å¼ºåˆ¶ã€‘é¿å…ä½¿ç”¨fromå’Œsizeæ·±åº¦åˆ†é¡µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨searchAfteræ¥å®ç°ã€‚</li><li>ã€å¼ºåˆ¶ã€‘ESæœ¬èº«ä¸æ”¯æŒäº‹åŠ¡ï¼ï¼ï¼ï¼</li></ul><h3 id="6-ESæ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#6-ESæ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="6.ESæ…¢æŸ¥è¯¢æ—¥å¿—"></a>6.ESæ…¢æŸ¥è¯¢æ—¥å¿—</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs json"># indexæ•°æ®çš„æ…¢æ—¥å¿—   <br>PUT /you index name/_settings<br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;index.indexing.slowlog.threshold.index.warn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10s&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.indexing.slowlog.threshold.index.info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5s&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.indexing.slowlog.threshold.index.debug&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2s&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.indexing.slowlog.threshold.index.trace&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;500ms&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.indexing.slowlog.level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;info&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.indexing.slowlog.source&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1000&quot;</span><br><span class="hljs-punctuation">&#125;</span><br># searchæ•°æ®çš„æ…¢æ—¥å¿—    æŸ¥è¯¢åˆ†ä¸ºfetchå’Œqueryï¼Œfetchå…ˆæŸ¥å‡ºæ¥idå’Œscoreï¼Œå†æ ¹æ®idæŸ¥æ‰¾å…¨æ–‡ï¼Œæ ¹æ®scoreæ’åºã€‚å°±åƒæ•°æ®åº“çš„å›è¡¨ä¸€æ ·ã€‚ç´¢å¼•fetchä¼šè¾ƒæ…¢ä¸€äº›<br>PUT /you index name/_settings<br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;index.search.slowlog.threshold.query.warn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;10s&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.search.slowlog.threshold.query.info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5s&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.search.slowlog.threshold.query.debug&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2s&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.search.slowlog.threshold.query.trace&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;500ms&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.search.slowlog.threshold.fetch.warn&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1s&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.search.slowlog.threshold.fetch.info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;800ms&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.search.slowlog.threshold.fetch.debug&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;500ms&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.search.slowlog.threshold.fetch.trace&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;200ms&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;index.search.slowlog.level&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;info&quot;</span><br><span class="hljs-punctuation">&#125;</span><br># æŸ¥çœ‹æ…¢æ—¥å¿—æ‰€åœ¨ä½ç½®<br>GET _nodes/settings?pretty=<span class="hljs-literal"><span class="hljs-keyword">true</span></span><br><br># å¯ä»¥é€šè¿‡logstashå°†æ…¢æŸ¥è¯¢æ—¥å¿—æ”¶é›†è¿›ESä¸­ï¼Œç„¶åè¿›è¡Œåˆ†æ<br># æ³¨ï¼šdockerå®‰è£…ESï¼Œä¼šå‡ºç°æ—¥å¿—åªè¾“å‡ºæ§åˆ¶å°ï¼Œä¸å†™å…¥æ–‡ä»¶çš„æƒ…å†µï¼Œè¯·è‡ªå®šä¹‰é…ç½®log4j2.propertiesæ–‡ä»¶<br></code></pre></td></tr></table></figure><h3 id="7-ESç´¢å¼•æ–°å¢å­—æ®µ"><a href="#7-ESç´¢å¼•æ–°å¢å­—æ®µ" class="headerlink" title="7.ESç´¢å¼•æ–°å¢å­—æ®µ"></a>7.ESç´¢å¼•æ–°å¢å­—æ®µ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT user_order_2010ï¼ˆè¡¨åï¼‰/_mapping<br>&#123;<br>   <span class="hljs-string">&quot;properties&quot;</span>:&#123;    //æ–°å¢å­—æ®µcombineOrderNumber<br>       <span class="hljs-string">&quot;combineOrderNumber&quot;</span>: &#123;<br>           <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br>curl -X PUT http://127.0.0.1:9200/user_order_2010/_mapping -H <span class="hljs-string">&#x27;Content-Type: application/json&#x27;</span>  -d <span class="hljs-string">&#x27;&#123;</span><br><span class="hljs-string">   &quot;properties&quot;:&#123;    //æ–°å¢å­—æ®µcombineOrderNumber</span><br><span class="hljs-string">       &quot;combineOrderNumber&quot;: &#123;</span><br><span class="hljs-string">           &quot;type&quot;: &quot;keyword&quot;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="8-Dockerå®‰è£…ESåŠç›¸å…³æŠ€æœ¯æ ˆ"><a href="#8-Dockerå®‰è£…ESåŠç›¸å…³æŠ€æœ¯æ ˆ" class="headerlink" title="8.Dockerå®‰è£…ESåŠç›¸å…³æŠ€æœ¯æ ˆ"></a>8.Dockerå®‰è£…ESåŠç›¸å…³æŠ€æœ¯æ ˆ</h3><p>æ³¨ï¼šå¦‚æœæ˜¯wslä¸­éƒ¨ç½²ï¼Œå­˜åœ¨ipåœ°å€é‡å¯ä¹‹åå˜åŠ¨çš„æƒ…å†µè¯·ä½¿ç”¨ç½‘æ¡¥æ¨¡å¼ï¼Œå°†ç›¸å…³ç»„ä»¶å…¨ä½¿ç”¨ä¸€ä¸ªç½‘æ¡¥ï¼Œé€šè¿‡docker å®¹å™¨åç§°è¿æ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ‹‰å–é•œåƒ</span><br>docker pull elasticsearch:7.6.1<br>docker pull kibana:7.6.1<br><span class="hljs-comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span><br><span class="hljs-built_in">mkdir</span> -p /mydata/elasticsearch/config<br><span class="hljs-built_in">mkdir</span> -p /mydata/elasticsearch/data<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;http.host: 0.0.0.0&quot;</span> &gt;/mydata/elasticsearch/config/elasticsearch.yml<br><span class="hljs-built_in">mkdir</span> -p /mydata/elasticsearch/kibana/config/<br>vim  /mydata/elasticsearch/kibana/config/kibana.yml<br><span class="hljs-built_in">chmod</span> -R  777 /mydata/elasticsearch/config<br><span class="hljs-built_in">chmod</span> -R  777  /mydata/elasticsearch/data<br><span class="hljs-built_in">chmod</span> -R  777  /mydata/elasticsearch/kibana/config/<br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">#kibana.yaml</span><br><span class="hljs-attr">server.name:</span> <span class="hljs-string">kibana</span><br><span class="hljs-attr">server.host:</span> <span class="hljs-string">&quot;0&quot;</span><br><span class="hljs-attr">elasticsearch.hosts:</span> [ <span class="hljs-string">&quot;http://192.168.170.132:9200&quot;</span> ]  <span class="hljs-comment"># æ ¹æ®è‡ªå·±æƒ…å†µé€‰æ‹©æ˜¯å¦ä½¿--network=es-network [[ &quot;http://eså®¹å™¨åç§°:9200&quot; ]]</span><br><span class="hljs-attr">xpack.monitoring.ui.container.elasticsearch.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">i18n.locale:</span> <span class="hljs-string">&quot;zh-CN&quot;</span><br><span class="hljs-comment">#å¯†ç </span><br><span class="hljs-attr">elasticsearch.username:</span> <span class="hljs-string">&quot;elastic&quot;</span><br><span class="hljs-attr">elasticsearch.password:</span> <span class="hljs-string">&quot;passwd&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># elasticsearch.yml é«˜ç‰ˆæœ¬å¢åŠ å¦‚ä¸‹</span><br><span class="hljs-attr">http.host:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">&quot;docker-cluster&quot;</span><br><span class="hljs-attr">network.hosts:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br><span class="hljs-comment"># è·¨åŸŸ</span><br><span class="hljs-attr">http.cors.allow-origin:</span> <span class="hljs-string">&quot;*&quot;</span><br><span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">http.cors.allow-headers:</span> <span class="hljs-string">Authorization,X-Requested-With,Content-Length,Content-Type</span><br><span class="hljs-comment"># å¯†ç </span><br><span class="hljs-attr">xpack.security.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">xpack.license.self_generated.type:</span> <span class="hljs-string">basic</span><br><span class="hljs-attr">xpack.security.transport.ssl.enabled:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># å¯åŠ¨ES æ ¹æ®è‡ªå·±æƒ…å†µé€‰æ‹©æ˜¯å¦ä½¿ç”¨ç½‘æ¡¥ --network=es-network </span><br>docker run --name elasticsearch -p <span class="hljs-number">9200</span>:<span class="hljs-number">9200</span> -p <span class="hljs-number">9300</span>:<span class="hljs-number">9300</span> -e <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> -e ES_JAVA_OPTS=<span class="hljs-string">&quot;-Xms64m -Xmx512m&quot;</span> -v <span class="hljs-regexp">/mydata/</span>elasticsearch<span class="hljs-regexp">/config/</span>elasticsearch.yml:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/elasticsearch/</span>config<span class="hljs-regexp">/elasticsearch.yml -v /my</span>data<span class="hljs-regexp">/elasticsearch/</span>data:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/elasticsearch/</span>data -v <span class="hljs-regexp">/mydata/</span>elasticsearch<span class="hljs-regexp">/plugins:/u</span>sr<span class="hljs-regexp">/share/</span>elasticsearch/plugins -d elasticsearch:<span class="hljs-number">7.6</span>.<span class="hljs-number">1</span><br><br><span class="hljs-comment"># å¯åŠ¨kibana æ ¹æ®è‡ªå·±æƒ…å†µé€‰æ‹©æ˜¯å¦ä½¿ç”¨ç½‘æ¡¥ --network=es-network </span><br>docker run -d   --name=kibana   --restart=always   -p <span class="hljs-number">5601</span>:<span class="hljs-number">5601</span>   -v <span class="hljs-regexp">/mydata/</span>elasticsearch<span class="hljs-regexp">/kibana/</span>config<span class="hljs-regexp">/kibana.yml:/u</span>sr<span class="hljs-regexp">/share/</span>kibana<span class="hljs-regexp">/config/</span>kibana.yml   kibana:<span class="hljs-number">7.6</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><strong>docker éƒ¨ç½²metricbea</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull docker.elastic.co/beats/metricbeat:7.10.1<br>vim /mydata/elasticsearch/metricbeat/metricbeat.yml   <span class="hljs-comment"># æ³¨æ„ä¸èƒ½ç»™777ï¼Œç»™755</span><br></code></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">metricbeat.config:</span><br>  <span class="hljs-attr">modules:</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">$&#123;path.config&#125;/modules.d/*.yml</span><br>    <span class="hljs-comment"># Reload module configs as they change:</span><br>    <span class="hljs-attr">reload.enabled:</span> <span class="hljs-literal">false</span><br><span class="hljs-attr">metricbeat.autodiscover:</span><br>  <span class="hljs-attr">providers:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">type:</span> <span class="hljs-string">docker</span><br>      <span class="hljs-attr">hints.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">metricbeat.modules:</span>    <br><span class="hljs-bullet">-</span> <span class="hljs-attr">module:</span> <span class="hljs-string">elasticsearch</span>       <span class="hljs-comment"># å¼€å¯elasticsearch</span><br>  <span class="hljs-attr">xpack.enabled:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">period:</span> <span class="hljs-string">10s</span><br>  <span class="hljs-attr">hosts:</span> [<span class="hljs-string">&quot;http://elasticsearch:9200&quot;</span>]  <span class="hljs-comment"># è·¨å®¹å™¨äº¤äº’ä½¿ç”¨æ¡¥æ¥</span><br><span class="hljs-bullet">-</span> <span class="hljs-attr">module:</span> <span class="hljs-string">docker</span><br>  <span class="hljs-attr">metricsets:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;container&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;cpu&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;diskio&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;healthcheck&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;info&quot;</span><br>    <span class="hljs-comment">#- &quot;image&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;memory&quot;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;network&quot;</span><br>  <span class="hljs-attr">hosts:</span> [<span class="hljs-string">&quot;unix:///var/run/docker.sock&quot;</span>] <br>  <span class="hljs-attr">period:</span> <span class="hljs-string">10s</span><br>  <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">processors:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">add_cloud_metadata:</span> <span class="hljs-string">~</span><br><span class="hljs-comment"># ç›´æ¥å‘é€elasticsearch</span><br><span class="hljs-attr">output.elasticsearch:</span><br>  <span class="hljs-attr">hosts:</span> [<span class="hljs-string">&quot;elasticsearch:9200&quot;</span>]   <span class="hljs-comment"># è·¨å®¹å™¨äº¤äº’ä½¿ç”¨æ¡¥æ¥</span><br><br><span class="hljs-comment"># è¦åŠ è½½ä»ªè¡¨æ¿ï¼Œå¯ä»¥åœ¨metricbeatè®¾ç½®ä¸­å¯ç”¨ä»ªè¡¨æ¿åŠ è½½ã€‚å½“ä»ªè¡¨æ¿åŠ è½½è¢«å¯ç”¨æ—¶ï¼ŒMetricbeatä½¿ç”¨Kibana APIæ¥åŠ è½½æ ·æœ¬ä»ªè¡¨æ¿ã€‚åªæœ‰å½“Metricbeatå¯åŠ¨æ—¶ï¼Œæ‰ä¼šå°è¯•ä»ªè¡¨æ¿åŠ è½½ã€‚</span><br><span class="hljs-comment"># è®¾ç½®kibanaæœåŠ¡åœ°å€</span><br><span class="hljs-attr">setup.kibana.host:</span> <span class="hljs-string">&quot;kibana:5601&quot;</span> <span class="hljs-comment"># è·¨å®¹å™¨äº¤äº’ä½¿ç”¨æ¡¥æ¥</span><br><span class="hljs-comment"># åŠ è½½é»˜è®¤çš„ä»ªè¡¨ç›˜æ ·å¼</span><br><span class="hljs-attr">setup.dashboards.enabled:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment"># è®¾ç½®å¦‚æœå­˜åœ¨æ¨¡æ¿ï¼Œåˆ™ä¸è¦†ç›–åŸæœ‰æ¨¡æ¿</span><br><span class="hljs-attr">setup.template.overwrite:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># æ ¹æ®è‡ªå·±æƒ…å†µé€‰æ‹©æ˜¯å¦ä½¿ç”¨ç½‘æ¡¥</span><br>docker <span class="hljs-built_in">run</span> -d <span class="hljs-attribute">--network</span>=es-network <span class="hljs-attribute">--name</span>=metricbeat \<br><span class="hljs-attribute">--user</span>=root <span class="hljs-attribute">--volume</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$(pwd)</span>/metricbeat.yml:/usr/share/metricbeat/metricbeat.yml:ro&quot;</span> \<br><span class="hljs-attribute">--volume</span>=<span class="hljs-string">&quot;/var/run/docker.sock:/var/run/docker.sock:ro&quot;</span>\<br><span class="hljs-attribute">--volume</span>=<span class="hljs-string">&quot;/sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro&quot;</span> \<br><span class="hljs-attribute">--volume</span>=<span class="hljs-string">&quot;/proc:/hostfs/proc:ro&quot;</span> <span class="hljs-attribute">--volume</span>=<span class="hljs-string">&quot;/:/hostfs:ro&quot;</span> \<br>docker.elastic.co/beats/metricbeat:7.10.1 metricbeat -e<br></code></pre></td></tr></table></figure><h3 id="9-ESä¿®å¤log4j2-bug"><a href="#9-ESä¿®å¤log4j2-bug" class="headerlink" title="9.ESä¿®å¤log4j2 bug"></a>9.ESä¿®å¤log4j2 bug</h3><ol><li>å…³é—­ESé›†ç¾¤</li><li>å¤‡ä»½ elasticsearch ç›®å½•ä¸‹libä¸‹çš„ log4j-api-2.11.1.jarå’Œlog4j-core-2.11.1.jar</li><li>cd &#x2F;xxx&#x2F;xxxx&#x2F;elasticsearch&#x2F;lib</li><li>mkdir log_bak</li><li>mv log4j* .&#x2F;log_bak</li><li>ä¸Šä¼ log4j-core-2.17.0.jar å’Œ log4j-api-2.17.0.jar åˆ° libç›®å½•ä¸‹</li><li>å¯åŠ¨ESé›†ç¾¤</li></ol><h3 id="10-ESç›‘æ§dashboard"><a href="#10-ESç›‘æ§dashboard" class="headerlink" title="10.ESç›‘æ§dashboard"></a>10.ESç›‘æ§dashboard</h3><p>1.pythonæ”¶é›†è„šæœ¬å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> urllib2<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-comment"># ElasticSearch Cluster to Monitor</span><br><span class="hljs-comment">#elasticServer = os.environ.get(&#x27;ES_METRICS_CLUSTER_URL&#x27;, &#x27;http://192.168.2.13:9200&#x27;)</span><br><span class="hljs-comment">#interval = int(os.environ.get(&#x27;ES_METRICS_INTERVAL&#x27;, &#x27;60&#x27;))</span><br><br>elasticServer = <span class="hljs-string">&#x27;http://192.168.2.13:9200&#x27;</span><br>interval = <span class="hljs-number">60</span><br><span class="hljs-comment"># ElasticSearch Cluster to Send Metrics</span><br><span class="hljs-comment">#elasticIndex = os.environ.get(&#x27;ES_METRICS_INDEX_NAME&#x27;, &#x27;elasticsearch_metrics&#x27;)</span><br><span class="hljs-comment">#elasticMonitoringCluster = os.environ.get(&#x27;ES_METRICS_MONITORING_CLUSTER_URL&#x27;, &#x27;http://192.168.2.13:9200&#x27;)</span><br><br>elasticIndex = <span class="hljs-string">&#x27;elasticsearch_metrics&#x27;</span><br>elasticMonitoringCluster = <span class="hljs-string">&#x27;http://192.168.2.13:9200&#x27;</span><br><span class="hljs-comment"># Enable Elasticsearch Security</span><br><span class="hljs-comment"># read_username and read_password for read ES cluster information</span><br><span class="hljs-comment"># write_username and write_passowrd for write monitor metric to ES.</span><br>read_es_security_enable = <span class="hljs-literal">False</span><br>read_username = <span class="hljs-string">&quot;read_username&quot;</span><br>read_password = <span class="hljs-string">&quot;read_password&quot;</span><br><br>write_es_security_enable = <span class="hljs-literal">False</span><br>write_username = <span class="hljs-string">&quot;write_username&quot;</span><br>write_password = <span class="hljs-string">&quot;write_password&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_urlopen</span>(<span class="hljs-params">urlData, read_username, read_password</span>):<br>    <span class="hljs-keyword">if</span> read_es_security_enable: <br>      <span class="hljs-keyword">try</span>:<br>password_mgr = urllib2.HTTPPasswordMgrWithDefaultRealm()<br>        password_mgr.add_password(<span class="hljs-literal">None</span>, urlData, read_username, read_password)<br>        handler = urllib2.HTTPBasicAuthHandler(password_mgr)<br>        opener = urllib2.build_opener(handler)<br>        urllib2.install_opener(opener)<br>        response = urllib2.urlopen(urlData)<br><span class="hljs-keyword">return</span> response<br>      <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Error:  &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(e))<br>    <span class="hljs-keyword">else</span>:<br>      <span class="hljs-keyword">try</span>:<br>        response = urllib2.urlopen(urlData)<br>        <span class="hljs-keyword">return</span> response<br>      <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Error:  &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(e))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_clusterhealth</span>():<br>    <span class="hljs-keyword">try</span>:<br>        utc_datetime = datetime.datetime.utcnow()<br>        endpoint = <span class="hljs-string">&quot;/_cluster/health&quot;</span><br>        urlData = elasticServer + endpoint<br>        response = handle_urlopen(urlData,read_username,read_password)<br>        jsonData = json.loads(response.read())<br>        clusterName = jsonData[<span class="hljs-string">&#x27;cluster_name&#x27;</span>]<br>        jsonData[<span class="hljs-string">&#x27;@timestamp&#x27;</span>] = <span class="hljs-built_in">str</span>(utc_datetime.strftime(<span class="hljs-string">&#x27;%Y-%m-%dT%H:%M:%S.%f&#x27;</span>)[:-<span class="hljs-number">3</span>])<br>        <span class="hljs-keyword">if</span> jsonData[<span class="hljs-string">&#x27;status&#x27;</span>] == <span class="hljs-string">&#x27;green&#x27;</span>:<br>            jsonData[<span class="hljs-string">&#x27;status_code&#x27;</span>] = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">elif</span> jsonData[<span class="hljs-string">&#x27;status&#x27;</span>] == <span class="hljs-string">&#x27;yellow&#x27;</span>:<br>            jsonData[<span class="hljs-string">&#x27;status_code&#x27;</span>] = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">elif</span> jsonData[<span class="hljs-string">&#x27;status&#x27;</span>] == <span class="hljs-string">&#x27;red&#x27;</span>:<br>            jsonData[<span class="hljs-string">&#x27;status_code&#x27;</span>] = <span class="hljs-number">2</span><br>        post_data(jsonData)<br>        <span class="hljs-keyword">return</span> clusterName<br>    <span class="hljs-keyword">except</span> IOError <span class="hljs-keyword">as</span> err:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;IOError: Maybe can&#x27;t connect to elasticsearch.&quot;</span><br>        clusterName = <span class="hljs-string">&quot;unknown&quot;</span><br>        <span class="hljs-keyword">return</span> clusterName<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_clusterstats</span>():<br>    utc_datetime = datetime.datetime.utcnow()<br>    endpoint = <span class="hljs-string">&quot;/_cluster/stats&quot;</span><br>    urlData = elasticServer + endpoint<br>    response = handle_urlopen(urlData,read_username,read_password)<br>    jsonData = json.loads(response.read())<br>    jsonData[<span class="hljs-string">&#x27;@timestamp&#x27;</span>] = <span class="hljs-built_in">str</span>(utc_datetime.strftime(<span class="hljs-string">&#x27;%Y-%m-%dT%H:%M:%S.%f&#x27;</span>)[:-<span class="hljs-number">3</span>])<br>    post_data(jsonData)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_nodestats</span>(<span class="hljs-params">clusterName</span>):<br>    utc_datetime = datetime.datetime.utcnow()<br>    endpoint = <span class="hljs-string">&quot;/_cat/nodes?v&amp;h=n&quot;</span><br>    urlData = elasticServer + endpoint<br>    response = handle_urlopen(urlData,read_username,read_password)<br>    nodes = response.read()[<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>].strip().split(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> nodes:<br>        endpoint = <span class="hljs-string">&quot;/_nodes/%s/stats&quot;</span> % node.rstrip()<br>        urlData = elasticServer + endpoint<br>        response = handle_urlopen(urlData,read_username,read_password)<br>        jsonData = json.loads(response.read())<br>        nodeID = jsonData[<span class="hljs-string">&#x27;nodes&#x27;</span>].keys()<br>        <span class="hljs-keyword">try</span>:<br>            jsonData[<span class="hljs-string">&#x27;nodes&#x27;</span>][nodeID[<span class="hljs-number">0</span>]][<span class="hljs-string">&#x27;@timestamp&#x27;</span>] = <span class="hljs-built_in">str</span>(utc_datetime.strftime(<span class="hljs-string">&#x27;%Y-%m-%dT%H:%M:%S.%f&#x27;</span>)[:-<span class="hljs-number">3</span>])<br>            jsonData[<span class="hljs-string">&#x27;nodes&#x27;</span>][nodeID[<span class="hljs-number">0</span>]][<span class="hljs-string">&#x27;cluster_name&#x27;</span>] = clusterName<br>            newJsonData = jsonData[<span class="hljs-string">&#x27;nodes&#x27;</span>][nodeID[<span class="hljs-number">0</span>]]<br>            post_data(newJsonData)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">continue</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_indexstats</span>(<span class="hljs-params">clusterName</span>):<br>    utc_datetime = datetime.datetime.utcnow()<br>    endpoint = <span class="hljs-string">&quot;/_stats&quot;</span><br>    urlData = elasticServer + endpoint<br>    response = handle_urlopen(urlData,read_username,read_password)<br>    jsonData = json.loads(response.read())<br>    jsonData[<span class="hljs-string">&#x27;_all&#x27;</span>][<span class="hljs-string">&#x27;@timestamp&#x27;</span>] = <span class="hljs-built_in">str</span>(utc_datetime.strftime(<span class="hljs-string">&#x27;%Y-%m-%dT%H:%M:%S.%f&#x27;</span>)[:-<span class="hljs-number">3</span>])<br>    jsonData[<span class="hljs-string">&#x27;_all&#x27;</span>][<span class="hljs-string">&#x27;cluster_name&#x27;</span>] = clusterName<br>    post_data(jsonData[<span class="hljs-string">&#x27;_all&#x27;</span>])<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">post_data</span>(<span class="hljs-params">data</span>):<br>    utc_datetime = datetime.datetime.utcnow()<br>    url_parameters = &#123;<span class="hljs-string">&#x27;cluster&#x27;</span>: elasticMonitoringCluster, <span class="hljs-string">&#x27;index&#x27;</span>: elasticIndex,<br>        <span class="hljs-string">&#x27;index_period&#x27;</span>: utc_datetime.strftime(<span class="hljs-string">&quot;%Y.%m.%d&quot;</span>), &#125;<br>    url = <span class="hljs-string">&quot;%(cluster)s/%(index)s-%(index_period)s/message&quot;</span> % url_parameters<br>    headers = &#123;<span class="hljs-string">&#x27;content-type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>&#125;<br>    <span class="hljs-keyword">try</span>:<br>        req = urllib2.Request(url, headers=headers, data=json.dumps(data))<br>        <span class="hljs-keyword">if</span> write_es_security_enable:<br>            password_mgr = urllib2.HTTPPasswordMgrWithDefaultRealm()<br>            password_mgr.add_password(<span class="hljs-literal">None</span>, url, write_username, write_password)<br>            handler = urllib2.HTTPBasicAuthHandler(password_mgr)<br>            opener = urllib2.build_opener(handler)<br>            urllib2.install_opener(opener)<br>            response = urllib2.urlopen(req)<br>        <span class="hljs-keyword">else</span>:<br>            response = urllib2.urlopen(req)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Error:  &#123;0&#125;&quot;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-built_in">str</span>(e))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    clusterName = fetch_clusterhealth()<br>    <span class="hljs-built_in">print</span>(clusterName)<br>    <span class="hljs-keyword">if</span> clusterName != <span class="hljs-string">&quot;unknown&quot;</span>:<br>        fetch_clusterstats()<br>        fetch_nodestats(clusterName)<br>        fetch_indexstats(clusterName)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">try</span>:<br>        nextRun = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">if</span> time.time() &gt;= nextRun:<br>                nextRun = time.time() + interval<br>                now = time.time()<br>                main()<br>                elapsed = time.time() - now<br>                <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Total Elapsed Time: %s&quot;</span> % elapsed<br>                timeDiff = nextRun - time.time()<br><br>                <span class="hljs-comment"># Check timediff , if timediff &gt;=0 sleep, if &lt; 0 send metrics to es</span><br>                <span class="hljs-keyword">if</span> timeDiff &gt;= <span class="hljs-number">0</span>:<br>                    time.sleep(timeDiff)<br><br>    <span class="hljs-keyword">except</span> KeyboardInterrupt:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Interrupted&#x27;</span><br>        <span class="hljs-keyword">try</span>:<br>            sys.exit(<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">except</span> SystemExit:<br>            os._exit(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>2.æœåŠ¡å¯åŠ¨è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>nohup python2 ./elasticsearch2elastic.py &gt; ./elastic.log 2&gt;&amp;1 &amp;<br></code></pre></td></tr></table></figure><p>3.æœåŠ¡åœæ­¢è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">! /bin/shell</span><br>appName=&#x27;elasticsearch2elastic.py&#x27;<br>pid=$(ps -ef | grep $&#123;appName&#125; | grep -v grep | awk  &#x27;&#123;print $2&#125;&#x27;)<br>echo -e $pid<br><br>kill -9 $&#123;pid&#125;<br>sleep 2<br>if [ $? -eq 0 ];then<br>    echo &quot;kill $&#123;appName&#125; success...&quot;<br>else<br>    echo &quot;kill $&#123;appName&#125; fail&quot;<br>fi<br></code></pre></td></tr></table></figure><p>4.ç´¢å¼•æ¸…ç†è„šæœ¬-shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span><br>ES_IP=10.0.0.73<br>ES_PORT=9200<br>INDEX_PREFIX=&#x27;elasticsearch_metrics-&#x27;<br>INDEX_SUFF=&#x27;*&#x27;<br>DATE_MONTH=`date -d &quot;1 month ago&quot; +%Y.%m`<br>INDEX_NAME=$&#123;INDEX_PREFIX&#125;$&#123;DATE_MONTH&#125;$&#123;INDEX_SUFF&#125;<br>ES_URL=http://$&#123;ES_IP&#125;:$&#123;ES_PORT&#125;/$&#123;INDEX_NAME&#125;<br>LOG_FILE=esindex_del-$&#123;DATE_MONTH&#125;.out<br>curl -XDELETE $&#123;ES_URL&#125; &gt;&gt; $&#123;LOG_FILE&#125;<br></code></pre></td></tr></table></figure><p>5.ç´¢å¼•æ¸…ç†è„šæœ¬-python</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding: UTF-8 -*-</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">@Project ï¼šes-monitor</span><br><span class="hljs-string">@File    ï¼šindex_clear.py</span><br><span class="hljs-string">@IDE     ï¼šPyCharm</span><br><span class="hljs-string">@Author  ï¼šSuaf</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> os<br><br>ES_PORT = <span class="hljs-string">&#x27;9200&#x27;</span><br>ES_IP = <span class="hljs-string">&#x27;10.0.0.73&#x27;</span><br>INDEX_PREFIX = <span class="hljs-string">&#x27;elasticsearch_metrics-&#x27;</span><br>INDEX_SUFF = <span class="hljs-string">&#x27;*&#x27;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getLastMonth</span>():<br>    today = datetime.date.today()<br>    first = today.replace(day=<span class="hljs-number">1</span>)<br>    last_month = first - datetime.timedelta(days=<span class="hljs-number">1</span>)<br>    month = last_month.strftime(<span class="hljs-string">&quot;%Y.%m&quot;</span>)<br>    index_name = INDEX_PREFIX + month + INDEX_SUFF<br>    log_file = <span class="hljs-string">&#x27;esindex_del-&#x27;</span> + month + <span class="hljs-string">&#x27;.out&#x27;</span><br>    command = (<span class="hljs-string">&#x27;curl -XDELETE http://%s:%s/%s &gt; %s&#x27;</span>) % (ES_IP, ES_PORT, index_name, log_file)<br>    <span class="hljs-built_in">print</span>(command)<br>    os.system(command)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    getLastMonth()<br></code></pre></td></tr></table></figure><h3 id="11-IPè½¬GeoIp"><a href="#11-IPè½¬GeoIp" class="headerlink" title="11.IPè½¬GeoIp"></a>11.IPè½¬GeoIp</h3><blockquote><p>GeoIp processor æ ¹æ®æ¥è‡ª Maxmind æ•°æ®åº“çš„æ•°æ®æ·»åŠ æœ‰å…³IPåœ°å€åœ°ç†ä½ç½®çš„ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒGeoIp processor å°†æ­¤ä¿¡æ¯æ·»åŠ åˆ° geoip å­—æ®µä¸‹ã€‚GeoIp processor å¯ä»¥è§£æ IPv4 å’Œ IPv6 åœ°å€ã€‚</p></blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs json"># åˆ›å»ºä¸€ä¸ªé¢„å¤„ç†ç®¡é“<br>PUT _ingest/pipeline/geoip_pipeline<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;description&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Add geoip info&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;processors&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;geoip&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;field&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ip&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br><br># åˆ›å»ºä¸€ä¸ªç´¢å¼•<br># è€ƒè™‘åˆ°åé¢è¦æ‰¹é‡å¯¼å…¥æ•°åƒæ¡+æ•°æ®ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†å–å·§çš„æ–¹å¼ã€‚ä½¿ç”¨äº†åœ¨åˆ›å»ºç´¢å¼•çš„æ—¶å€™æŒ‡å®šç¼ºçœç®¡é“ï¼ˆindex.default_pipelineï¼‰çš„æ–¹å¼ã€‚<br># è¿™æ ·çš„å¥½å¤„æ˜¯ï¼š<br># çµæ´»ï¼šç”¨æˆ·åªå…³å¿ƒ bulk æ‰¹é‡å†™å…¥æ•°æ®ã€‚<br># é›¶å†™å…¥ä»£ç ä¿®æ”¹ï¼šç”šè‡³å†™å…¥æ•°æ®çš„ä»£ç ä¸€è¡Œéƒ½ä¸éœ€è¦æ”¹å°±å¯ä»¥ã€‚<br>PUT ip_index<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;index.default_pipeline&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;geoip_pipeline&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;geoip&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;location&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;geo_point&quot;</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;keyword&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br># å†™å…¥ä¸€æ¡æ•°æ®<br>PUT ip_index/_doc/<span class="hljs-number">1</span><br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;ip&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;8.8.8.8&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="12-ESå­˜å‚¨æ·±å…¥äº†è§£"><a href="#12-ESå­˜å‚¨æ·±å…¥äº†è§£" class="headerlink" title="12.ESå­˜å‚¨æ·±å…¥äº†è§£"></a>12.ESå­˜å‚¨æ·±å…¥äº†è§£</h3><p><strong>ESé…ç½®çš„ç›®å½•ï¼š</strong></p><ul><li>path.homeï¼šè¿è¡ŒElasticsearchè¿›ç¨‹çš„ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚é»˜è®¤ä¸ºJavaç³»ç»Ÿå±æ€§user.dirï¼Œå®ƒæ˜¯è¿›ç¨‹æ‰€æœ‰è€…çš„é»˜è®¤ä¸»ç›®å½•</li><li>path.confï¼šåŒ…å«é…ç½®æ–‡ä»¶çš„ç›®å½•ã€‚è¿™é€šå¸¸é€šè¿‡è®¾ç½®Javaç³»ç»Ÿå±æ€§es.configæ¥è®¾ç½®ï¼Œå› ä¸ºåœ¨æ‰¾åˆ°é…ç½®æ–‡ä»¶ä¹‹å‰å®ƒå¿…ç„¶ä¼šè¢«è§£æ</li><li>path.pluginsï¼šå­æ–‡ä»¶å¤¹ä¸ºElasticsearchæ’ä»¶çš„ç›®å½•</li><li>path.logsï¼šå­˜å‚¨ç”Ÿæˆçš„æ—¥å¿—çš„ä½ç½®ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªå·çš„ç£ç›˜ç©ºé—´ä¸è¶³ï¼Œåˆ™å°†å®ƒæ”¾åœ¨ä¸æ•°æ®ç›®å½•ä¸åŒçš„å·ä¸Šå¯èƒ½æ˜¯æœ‰æ„ä¹‰çš„</li><li>path.dataï¼šåŒ…å«Elasticsearchå­˜å‚¨çš„æ•°æ®çš„æ–‡ä»¶å¤¹çš„è·¯å¾„(åªçœ‹ä»–)</li></ul><p><strong>æ–‡ä»¶ä»å“ªé‡Œæ¥ï¼š</strong></p><ul><li>Luceneè´Ÿè´£å†™å’Œç»´æŠ¤Luceneç´¢å¼•æ–‡ä»¶</li><li>è€ŒElasticsearchåœ¨Luceneä¹‹ä¸Šå†™ä¸åŠŸèƒ½ç›¸å…³çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚å­—æ®µæ˜ å°„ï¼Œç´¢å¼•è®¾ç½®å’Œå…¶ä»–é›†ç¾¤å…ƒæ•°æ®ã€‚ æœ€ç»ˆç”¨æˆ·å’Œæ”¯æŒåŠŸèƒ½</li><li>åœ¨ä½çº§Luceneä¸­ä¸å­˜åœ¨ï¼Œç”±Elasticsearchæä¾›</li></ul><p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs json">data<br>|__ elasticsearch<br>|__ nodes<br>|__ <span class="hljs-number">0</span><br>|__ _state<br>||__ global<span class="hljs-number">-0.</span>st # é›†ç¾¤çš„å…¨å±€å…ƒæ•°æ®<br>|__ node.lock  # æ–‡ä»¶ç”¨äºç¡®ä¿ä¸€æ¬¡åªèƒ½ä»ä¸€ä¸ªæ•°æ®ç›®å½•è¯»å–/å†™å…¥ä¸€ä¸ªElasticsearchç›¸å…³å®‰è£…ä¿¡æ¯<br>|__ indices<br>|__ <span class="hljs-number">45</span>aonVA8RPSlHSKGnK_yaA<br>|__ <span class="hljs-number">0</span> # <span class="hljs-number">0</span>åŒ…å«ä¸ç´¢å¼•çš„ç¬¬ä¸€ä¸ªï¼ˆä¹Ÿæ˜¯å”¯ä¸€çš„ï¼‰åˆ†ç‰‡ç›¸å…³çš„æ•°æ®ï¼ˆåˆ†ç‰‡<span class="hljs-number">0</span>ï¼‰<br>||__ _state<br>||__ index #<br>||__ translog # æ¯ä¸ªåˆ†ç‰‡çš„ äº‹åŠ¡æ—¥å¿—<span class="hljs-punctuation">,</span>ä¿å¯ä»¥å®‰å…¨åœ°å°†æ•°æ®ç´¢å¼•åˆ°Elasticsearch<br>|__ _state # å‰è€…_stateåŒ…å«æ‰€è°“çš„ç´¢å¼•çŠ¶æ€æ–‡ä»¶ï¼Œå­˜å‚¨ç´¢å¼•çš„å…ƒæ•°æ®<br><br>data/<br>â””â”€â”€ nodes<br>    â””â”€â”€ <span class="hljs-number">0</span><br>        â”œâ”€â”€ _state  # é›†ç¾¤çš„å…¨å±€å…ƒæ•°æ®<br>        â”œâ”€â”€ indices # å­˜å‚¨ç´¢å¼•çš„ç›®å½•<br>        â”‚Â Â  â”œâ”€â”€ <span class="hljs-number">45</span>aonVA8RPSlHSKGnK_yaA # ç´¢å¼•å”¯ä¸€æ ‡è¯†<br>        â”‚Â Â  â”‚Â Â  â”œâ”€â”€ <span class="hljs-number">0</span> # <span class="hljs-number">0</span>åŒ…å«ä¸ç´¢å¼•çš„ç¬¬ä¸€ä¸ªï¼ˆä¹Ÿæ˜¯å”¯ä¸€çš„ï¼‰åˆ†ç‰‡ç›¸å…³çš„æ•°æ®ï¼ˆåˆ†ç‰‡<span class="hljs-number">0</span>ï¼‰<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ _state # _stateåŒ…å«æ‰€è°“çš„ç´¢å¼•çŠ¶æ€æ–‡ä»¶ï¼Œå­˜å‚¨ç´¢å¼•çš„å…ƒæ•°æ®<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ retention-leases<span class="hljs-number">-41.</span>st<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ state<span class="hljs-number">-1.</span>st<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ index # ç´¢å¼•æ•°æ®<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ _0.cfe<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ _0.cfs<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ _0.si<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ segments_3<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ write.lock<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ translog # æ¯ä¸ªåˆ†ç‰‡çš„ äº‹åŠ¡æ—¥å¿—<span class="hljs-punctuation">,</span>ä¿å¯ä»¥å®‰å…¨åœ°å°†æ•°æ®ç´¢å¼•åˆ°Elasticsearch<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â      â”œâ”€â”€ translog<span class="hljs-number">-4.</span>tlog<br>        â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ translog.ckp<br>        â”‚Â Â  â”‚Â Â  â””â”€â”€ _state  #  ç´¢å¼•çš„å…ƒæ•°æ®ï¼Œå®ƒçš„åˆ›å»ºæ—¶é—´æˆ³ï¼Œå®ƒè¿˜åŒ…å«å”¯ä¸€æ ‡è¯†ç¬¦ä»¥åŠç´¢å¼•çš„è®¾ç½®å’Œæ˜ å°„<br>        â”‚Â Â  â”‚Â Â      â””â”€â”€ state<span class="hljs-number">-5.</span>s<br>        â””â”€â”€ node.lock  # æ–‡ä»¶ç”¨äºç¡®ä¿ä¸€æ¬¡åªèƒ½ä»ä¸€ä¸ªæ•°æ®ç›®å½•è¯»å–/å†™å…¥ä¸€ä¸ªElasticsearchç›¸å…³å®‰è£…ä¿¡æ¯<br></code></pre></td></tr></table></figure><h3 id="13-ESæŸ¥è¯¢å‡ºç°æ•°æ®é‡å€’é€€é—®é¢˜"><a href="#13-ESæŸ¥è¯¢å‡ºç°æ•°æ®é‡å€’é€€é—®é¢˜" class="headerlink" title="13.ESæŸ¥è¯¢å‡ºç°æ•°æ®é‡å€’é€€é—®é¢˜"></a>13.ESæŸ¥è¯¢å‡ºç°æ•°æ®é‡å€’é€€é—®é¢˜</h3><p>ä¸¤æ¬¡æŸ¥è¯¢æ•°æ®é‡ä¸ä¸€è‡´ï¼Œå› ä¸ºESæŸ¥è¯¢ä¸ºäº†é™ä½æŸ¥è¯¢å‹åŠ›é»˜è®¤ä¼šè½®è¯¢æŸ¥è¯¢ä¸»åˆ†ç‰‡ä¸å‰¯æœ¬åˆ†ç‰‡ï¼Œä½†æ˜¯ä¸»å‰¯æœ¬ä¹‹é—´åŒæ­¥ä¼šå­˜åœ¨åŒæ­¥æ—¶å·®ï¼Œæ‰€ä»¥é™åˆ¶åªæŸ¥è¯¢ä¸»åˆ†ç‰‡å°±ä¼šé¿å…è¯¥é—®é¢˜å‡ºç°ï¼Œå…·ä½“è§£å†³æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs json">GET /_search?preference=_primary    # preferenceæŸ¥è¯¢åå¥½è®¾ç½®<br><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;elasticsearch&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br># searchRequest.preference(<span class="hljs-string">&quot;_primary&quot;</span>);<br></code></pre></td></tr></table></figure><ul><li>_primary: æŒ‡æŸ¥è¯¢åªåœ¨ä¸»åˆ†ç‰‡ä¸­æŸ¥è¯¢</li><li>_primary_firstï¼š æŒ‡æŸ¥è¯¢ä¼šå…ˆåœ¨ä¸»åˆ†ç‰‡ä¸­æŸ¥è¯¢ï¼Œå¦‚æœä¸»åˆ†ç‰‡æ‰¾ä¸åˆ°ï¼ˆæŒ‚äº†ï¼‰ï¼Œå°±ä¼šåœ¨å‰¯æœ¬ä¸­æŸ¥è¯¢</li><li>_local:ï¼šæŒ‡æŸ¥è¯¢æ“ä½œä¼šä¼˜å…ˆåœ¨æœ¬åœ°èŠ‚ç‚¹æœ‰çš„åˆ†ç‰‡ä¸­æŸ¥è¯¢ï¼Œæ²¡æœ‰çš„è¯å†åœ¨å…¶å®ƒèŠ‚ç‚¹æŸ¥è¯¢ã€‚</li><li>__only_nodeï¼šæŒ‡åœ¨æŒ‡å®šidçš„èŠ‚ç‚¹é‡Œé¢è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹åªæœ‰è¦æŸ¥è¯¢ç´¢å¼•çš„éƒ¨åˆ†åˆ†ç‰‡ï¼Œå°±åªåœ¨è¿™éƒ¨åˆ†åˆ†ç‰‡ä¸­æŸ¥æ‰¾ï¼Œæ‰€ä»¥æŸ¥è¯¢ç»“æœå¯èƒ½ä¸å®Œæ•´ã€‚å¦‚_only_node:123åœ¨èŠ‚ç‚¹idä¸º123çš„èŠ‚ç‚¹ä¸­æŸ¥è¯¢ã€‚</li><li>_prefer_nodeï¼šnodeid ä¼˜å…ˆåœ¨æŒ‡å®šçš„èŠ‚ç‚¹ä¸Šæ‰§è¡ŒæŸ¥è¯¢</li><li>_shards:0,1,2,3,4ï¼šæŸ¥è¯¢æŒ‡å®šåˆ†ç‰‡çš„æ•°æ®</li><li>Custom (string) valueï¼šç”¨æˆ·è‡ªå®šä¹‰å€¼ï¼ŒæŒ‡åœ¨å‚æ•°cluster.routing.allocation.awareness.attributesæŒ‡å®šçš„å€¼ï¼Œå¦‚è¿™ä¸ªå€¼è®¾ç½®ä¸ºäº†zoneï¼Œé‚£ä¹ˆpreference&#x3D;zoneçš„è¯å°±åœ¨awareness.attributes&#x3D;zone*è¿™æ ·çš„èŠ‚ç‚¹æœç´¢ï¼Œå¦‚zone1ã€zone2</li></ul><h3 id="14-åŸºäºæ‹¼éŸ³å’Œä¸­æ–‡è¿›è¡Œæœç´¢"><a href="#14-åŸºäºæ‹¼éŸ³å’Œä¸­æ–‡è¿›è¡Œæœç´¢" class="headerlink" title="14.åŸºäºæ‹¼éŸ³å’Œä¸­æ–‡è¿›è¡Œæœç´¢"></a>14.åŸºäºæ‹¼éŸ³å’Œä¸­æ–‡è¿›è¡Œæœç´¢</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ‰äº›æœç´¢éœ€æ±‚æ˜¯éœ€è¦æ ¹æ®æ‹¼éŸ³å’Œä¸­æ–‡æ¥æœç´¢çš„ï¼Œé‚£ä¹ˆåœ¨elasticsearchä¸­æ˜¯å¦‚ä½•æ¥å®ç°åŸºäºæ‹¼éŸ³æ¥æœç´¢çš„ï¼Œå¯ä»¥é€šè¿‡elasticsearch-analysis-pinyinåˆ†æå™¨æ¥å®ç°ï¼Œé‚£æˆ‘ä»¬çš„éœ€æ±‚ï¼šè‡ªå®šä¹‰ä¸€ä¸ªåˆ†è¯å™¨ï¼Œå³å¯ä»¥å®ç°æ‹¼éŸ³æœç´¢ï¼Œä¹Ÿå¯ä»¥å®ç°ä¸­æ–‡æœç´¢ã€‚<a href="https://blog.csdn.net/weixin_45248492/article/details/127810051?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~AD_ESQUERY~yljh-2-127810051-blog-126437539.pc_relevant_landingrelevant&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~AD_ESQUERY~yljh-2-127810051-blog-126437539.pc_relevant_landingrelevant&utm_relevant_index=3">å‚è€ƒè¿™é‡Œ</a></p><h4 id="14-1-å®‰è£…æ‹¼éŸ³åˆ†è¯å™¨Pinyin-Analysis-for-Elasticsearch"><a href="#14-1-å®‰è£…æ‹¼éŸ³åˆ†è¯å™¨Pinyin-Analysis-for-Elasticsearch" class="headerlink" title="14.1.å®‰è£…æ‹¼éŸ³åˆ†è¯å™¨Pinyin Analysis for Elasticsearch"></a>14.1.å®‰è£…æ‹¼éŸ³åˆ†è¯å™¨<a href="https://github.com/medcl/elasticsearch-analysis-pinyin">Pinyin Analysis for Elasticsearch</a></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿›å…¥ es çš„æ’ä»¶ç›®å½•</span><br>cd /Users/suaofeng/Downloads/docker/elasticsearch/plugins<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸‹è½½</span><br>wget https://github.com/medcl/elasticsearch-analysis-pinyin/releases/tag/v7.10.1# æ–°å»ºç›®å½•<br>mkdir analysis-pinyin<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è§£å‹</span><br>mv elasticsearch-analysis-pinyin-7.10.1.zip analysis-pinyin &amp;&amp; cd analysis-pinyin &amp;&amp; unzip elasticsearch-analysis-pinyin-7.10.1.zip &amp;&amp; rm -rvf elasticsearch-analysis-pinyin-7.10.1.zip<br>cd ../ &amp;&amp; chown -R es:es analysis-pinyin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨eså¹¶æµ‹è¯•,ç»“æœå‘ç°å®ç°äº†æ‹¼éŸ³åˆ†è¯ï¼Œä½†æ˜¯è¿™ä¸ªä¸ä¸€å®šæ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œ</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¯”å¦‚æ²¡æœ‰ä¸­æ–‡äº†ï¼Œå•ä¸ªçš„æ‹¼éŸ³(æ¯”å¦‚ï¼šwo)æ˜¯æ²¡æœ‰ä»€ä¹ˆç”¨çš„ï¼Œéœ€è¦å¯¹æ‹¼éŸ³åˆ†è¯å™¨è¿›è¡Œå®šåˆ¶åŒ–ã€‚</span><br>GET _analyze<br>&#123;<br>  &quot;text&quot;: [&quot;æˆ‘æ˜¯ç¨‹åºå‘˜&quot;]<br>  , &quot;analyzer&quot;: &quot;pinyin&quot;<br>&#125;<br><br>&#123;<br>  &quot;tokens&quot; : [<br>    &#123;<br>      &quot;token&quot; : &quot;wo&quot;,<br>      &quot;start_offset&quot; : 0,<br>      &quot;end_offset&quot; : 0,<br>      &quot;type&quot; : &quot;word&quot;,<br>      &quot;position&quot; : 0<br>    &#125;,<br>    &#123;<br>      &quot;token&quot; : &quot;wscxy&quot;,<br>      &quot;start_offset&quot; : 0,<br>      &quot;end_offset&quot; : 0,<br>      &quot;type&quot; : &quot;word&quot;,<br>      &quot;position&quot; : 0<br>    &#125;,<br>    &#123;<br>      &quot;token&quot; : &quot;shi&quot;,<br>      &quot;start_offset&quot; : 0,<br>      &quot;end_offset&quot; : 0,<br>      &quot;type&quot; : &quot;word&quot;,<br>      &quot;position&quot; : 1<br>    &#125;,<br>    &#123;<br>      &quot;token&quot; : &quot;cheng&quot;,<br>      &quot;start_offset&quot; : 0,<br>      &quot;end_offset&quot; : 0,<br>      &quot;type&quot; : &quot;word&quot;,<br>      &quot;position&quot; : 2<br>    &#125;,<br>    &#123;<br>      &quot;token&quot; : &quot;xu&quot;,<br>      &quot;start_offset&quot; : 0,<br>      &quot;end_offset&quot; : 0,<br>      &quot;type&quot; : &quot;word&quot;,<br>      &quot;position&quot; : 3<br>    &#125;,<br>    &#123;<br>      &quot;token&quot; : &quot;yuan&quot;,<br>      &quot;start_offset&quot; : 0,<br>      &quot;end_offset&quot; : 0,<br>      &quot;type&quot; : &quot;word&quot;,<br>      &quot;position&quot; : 4<br>    &#125;<br>  ]<br>&#125;<br><br></code></pre></td></tr></table></figure><h4 id="14-2-è‡ªå®šä¹‰åˆ†è¯å™¨"><a href="#14-2-è‡ªå®šä¹‰åˆ†è¯å™¨" class="headerlink" title="14.2.è‡ªå®šä¹‰åˆ†è¯å™¨"></a>14.2.è‡ªå®šä¹‰åˆ†è¯å™¨</h4><p>å†æ¬¡åˆ†æesåˆ†è¯çš„ä¸‰ä¸ªè¿‡ç¨‹</p><ul><li>character filtersï¼š ç”¨äºåœ¨tokenizerä¹‹å‰å¯¹æ–‡æœ¬è¿›è¡Œå¤„ç†ã€‚æ¯”å¦‚ï¼šåˆ é™¤å­—ç¬¦ï¼Œæ›¿æ¢å­—ç¬¦ç­‰ã€‚</li><li>tokenizerï¼š å°†æ–‡æœ¬æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åˆ†æˆç‹¬ç«‹çš„tokenã€‚å³å®ç°åˆ†è¯åŠŸèƒ½ã€‚</li><li>tokenizer filterï¼š å°†tokenizerè¾“å‡ºçš„è¯æ¡åšè¿›ä¸€æ­¥çš„å¤„ç†ã€‚æ¯”å¦‚ï¼š åŒä¹‰è¯å¤„ç†ï¼Œå¤§å°å†™è½¬æ¢ã€ç§»é™¤åœç”¨è¯ï¼Œæ‹¼éŸ³å¤„ç†ç­‰ã€‚</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs json">PUT /test_pinyin<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;settings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-comment">// åˆ†æé˜¶æ®µçš„è®¾ç½®</span><br>    <span class="hljs-attr">&quot;analysis&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-comment">// åˆ†æå™¨è®¾ç½®</span><br>      <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-comment">// è‡ªå®šä¹‰åˆ†æå™¨ï¼Œåœ¨tokenizeré˜¶æ®µä½¿ç”¨ik_max_wordï¼Œåœ¨filterä¸Šä½¿ç”¨py</span><br>        <span class="hljs-attr">&quot;custom_analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;tokenizer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_max_word&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;custom_pinyin&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-comment">// ç”±äºä¸æ»¡è¶³pinyinåˆ†è¯å™¨çš„é»˜è®¤è®¾ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬åŸºäºpinyin</span><br>      <span class="hljs-comment">// è‡ªå®šä¹‰äº†ä¸€ä¸ªfilterï¼Œå«custom_pinyinï¼Œå…¶ä¸­ä¿®æ”¹äº†ä¸€äº›è®¾ç½®</span><br>      <span class="hljs-comment">// è¿™äº›è®¾ç½®å¯ä»¥åœ¨pinyinåˆ†è¯å™¨å®˜ç½‘æ‰¾åˆ°</span><br>      <span class="hljs-attr">&quot;filter&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;custom_pinyin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;pinyin&quot;</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-comment">// ä¸ä¼šè¿™æ ·åˆ†ï¼šåˆ˜å¾·å &gt; [liu, de, hua]</span><br>          <span class="hljs-attr">&quot;keep_full_pinyin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-comment">// è¿™æ ·åˆ†ï¼šåˆ˜å¾·å &gt; [liudehua]</span><br>          <span class="hljs-attr">&quot;keep_joined_full_pinyin&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-comment">// ä¿ç•™åŸå§‹tokenï¼ˆå³ä¸­æ–‡ï¼‰</span><br>          <span class="hljs-attr">&quot;keep_original&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-comment">// è®¾ç½®first_letterç»“æœçš„æœ€å¤§é•¿åº¦ï¼Œé»˜è®¤å€¼ï¼š16</span><br>          <span class="hljs-attr">&quot;limit_first_letter_length&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">16</span><span class="hljs-punctuation">,</span><br>          <span class="hljs-comment">// å½“å¯ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œå°†åˆ é™¤é‡å¤é¡¹ä»¥ä¿å­˜ç´¢å¼•ï¼Œä¾‹å¦‚ï¼šdeçš„&gt; deï¼Œé»˜è®¤å€¼ï¼šfalseï¼Œæ³¨æ„ï¼šä½ç½®ç›¸å…³æŸ¥è¯¢å¯èƒ½å—å½±å“</span><br>          <span class="hljs-attr">&quot;remove_duplicated_term&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-comment">// å¦‚æœéæ±‰è¯­å­—æ¯æ˜¯æ‹¼éŸ³ï¼Œåˆ™å°†å…¶æ‹†åˆ†ä¸ºå•ç‹¬çš„æ‹¼éŸ³æœ¯è¯­ï¼Œé»˜è®¤å€¼ï¼štrueï¼Œå¦‚ï¼šliudehuaalibaba13zhuanghan- &gt; liuï¼Œdeï¼Œhuaï¼Œaï¼Œliï¼Œbaï¼Œbaï¼Œ13ï¼Œzhuangï¼Œhanï¼Œæ³¨æ„ï¼škeep_none_chineseå’Œkeep_none_chinese_togetheråº”é¦–å…ˆå¯ç”¨</span><br>          <span class="hljs-attr">&quot;none_chinese_pinyin_tokenize&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-comment">// å®šä¹‰mapping</span><br>  <span class="hljs-attr">&quot;mappings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;properties&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;text&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-comment">// åˆ›å»ºå€’æ’ç´¢å¼•æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨</span><br>        <span class="hljs-attr">&quot;analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;custom_analyzer&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-comment">// æœç´¢æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨ï¼Œæœç´¢æ—¶ä¸ä½¿ç”¨custom_analyzeræ˜¯ä¸ºäº†é˜²æ­¢ è¯è¯­çš„æ‹¼éŸ³ä¸€æ ·ï¼Œä½†æ˜¯ä¸­æ–‡å«ä¹‰ä¸ä¸€æ ·ï¼Œå¯¼è‡´æœç´¢é”™è¯¯ã€‚ æ¯”å¦‚ï¼š ç§‘æŠ€ å’Œ å®¢æœºï¼Œæ‹¼éŸ³ä¸€æ ·ï¼Œä½†æ˜¯å«ä¹‰ä¸ä¸€æ ·</span><br>        <span class="hljs-attr">&quot;search_analyzer&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ik_smart&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong><br>å¯ä»¥çœ‹åˆ° æˆ‘ä»¬çš„ nameå­—æ®µ ä½¿ç”¨çš„åˆ†è¯å™¨æ˜¯ custom_analyzerï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥å®šä¹‰çš„ã€‚ä½†æ˜¯æœç´¢çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯ ik_smartï¼Œè¿™ä¸ªä¸ºç”šä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ<br>å‡è®¾æˆ‘ä»¬å­˜åœ¨å¦‚ä¸‹2ä¸ªæ–‡æœ¬ ç§‘æŠ€å¼ºå›½å’Œ è¿™æ˜¯ä¸€æ¶å®¢æœºï¼Œ é‚£ä¹ˆç§‘æŠ€å’Œå®¢æœºçš„æ‹¼éŸ³æ˜¯ä¸æ˜¯å°±æ˜¯ä¸€æ ·çš„ã€‚ è¿™ä¸ªæ—¶å€™å¦‚æœæœç´¢æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨ä¹Ÿæ˜¯custom_analyzeré‚£ä¹ˆï¼Œæœç´¢ç§‘æŠ€çš„æ—¶å€™å®¢æœºä¹Ÿä¼šæœç´¢å‡ºæ¥ï¼Œè¿™æ ·æ˜¯ä¸å¯¹çš„ã€‚å› æ­¤åœ¨æœç´¢çš„æ—¶å€™ä¸­æ–‡å°±ä»¥ä¸­æ–‡æœï¼Œæ‹¼éŸ³å°±ä»¥æ‹¼éŸ³æœã€‚å½“ analyzerå’Œsearch_analyzerçš„å€¼éƒ½æ˜¯custom_analyzerï¼Œæœç´¢æ—¶ä¹Ÿä¼šé€šè¿‡æ‹¼éŸ³æœç´¢ï¼Œè¿™æ ·çš„ç»“æœå¯èƒ½å°±ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p><p><strong>å…³äºæ‹¼éŸ³åˆ†è¯å™¨çš„ä¸€äº›å¯é€‰é…ç½®ï¼š</strong><br>The plugin includes analyzer: pinyin , tokenizer: pinyin and token-filter: pinyin.</p><ul><li>keep_first_letter when this option enabled, eg: åˆ˜å¾·å&gt;ldh, default: true</li><li>keep_separate_first_letter when this option enabled, will keep first letters separately, eg: åˆ˜å¾·å&gt;l,d,h, default: false, NOTE: query result maybe too fuzziness due to term too frequency</li><li>limit_first_letter_length set max length of the first_letter result, default: 16</li><li>keep_full_pinyin when this option enabled, eg: åˆ˜å¾·å&gt; [liu,de,hua], default: true</li><li>keep_joined_full_pinyin when this option enabled, eg: åˆ˜å¾·å&gt; [liudehua], default: false</li><li>keep_none_chinese keep non chinese letter or number in result, default: true</li><li>keep_none_chinese_together keep non chinese letter together, default: true, eg: DJéŸ³ä¹å®¶ -&gt; DJ,yin,yue,jia, when set to false, eg: DJéŸ³ä¹å®¶ -&gt; D,J,yin,yue,jia, NOTE: keep_none_chinese should be enabled first</li><li>keep_none_chinese_in_first_letter keep non Chinese letters in first letter, eg: åˆ˜å¾·åAT2016-&gt;ldhat2016, default: true</li><li>keep_none_chinese_in_joined_full_pinyin keep non Chinese letters in joined full pinyin, eg: åˆ˜å¾·å2016-&gt;liudehua2016, default: false</li><li>none_chinese_pinyin_tokenize break non chinese letters into separate pinyin term if they are pinyin, default: true, eg: liudehuaalibaba13zhuanghan -&gt; liu,de,hua,a,li,ba,ba,13,zhuang,han, NOTE: keep_none_chinese and keep_none_chinese_together should be enabled first</li><li>keep_original when this option enabled, will keep original input as well, default: false</li><li>lowercase lowercase non Chinese letters, default: true</li><li>trim_whitespace default: true</li><li>remove_duplicated_term when this option enabled, duplicated term will be removed to save index, eg: deçš„&gt;de, default: false, NOTE: position related query maybe influenced</li><li>ignore_pinyin_offset after 6.0, offset is strictly constrained, overlapped tokens are not allowed, with this parameter, overlapped token will allowed by ignore offset, please note, all position related query or highlight will become incorrect, you should use multi fields and specify different settings for different query purpose. if you need offset, please set it to false. default: true.</li></ul><h4 id="14-3-æ’å…¥æ•°æ®å¹¶æµ‹è¯•"><a href="#14-3-æ’å…¥æ•°æ®å¹¶æµ‹è¯•" class="headerlink" title="14.3.æ’å…¥æ•°æ®å¹¶æµ‹è¯•"></a>14.3.æ’å…¥æ•°æ®å¹¶æµ‹è¯•</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs json">#æ’å…¥æ•°æ®<br>PUT /test_pinyin/_bulk<br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;_id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">1</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç§‘æŠ€å¼ºå›½&quot;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;_id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">2</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;è¿™æ˜¯ä¸€æ¶å®¢æœº&quot;</span><span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;index&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;_id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">3</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">&#125;</span><br><br># ä¸­æ–‡query<br>GET test_pinyin/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ç§‘æŠ€&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br># æ‹¼éŸ³query<br>GET test_pinyin/_search<br><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;match&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;keji&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="15-æ•°æ®è¿ç§»"><a href="#15-æ•°æ®è¿ç§»" class="headerlink" title="15.æ•°æ®è¿ç§»"></a>15.æ•°æ®è¿ç§»</h3><p><a href="https://github.com/elasticsearch-dump/elasticsearch-dump">elasticsearch-dump</a>å¤‡ä»½æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸ä¸€å®šè¦aé›†ç¾¤åˆ°bé›†ç¾¤ï¼Œåˆ°æ–‡ä»¶åˆ°s3éƒ½è¡Œï¼Œå…·ä½“çœ‹æ–‡æ¡£è¯´æ˜</span><br> docker run --network host --rm -ti -v /data:/tmp elasticdump/elasticsearch-dump \<br>  --input=http://elastic:law2022@192.168.0.22:9200/law_event_info@1665926463 \<br>  --output=https://elastic:law2022@lvfa-v.com:8085/law_event_info@1665926463 \<br>  --type=analyzer<br>  <br><span class="hljs-meta prompt_"> # </span><span class="language-bash">å¼€å¯index</span><br> POST /law_event_info@1665926463/_open<br> <br> docker run --network host --rm -ti -v /data:/tmp elasticdump/elasticsearch-dump \<br>  --input=http://elastic:law2022@192.168.0.22:9200/law_event_info@1665926463 \<br>  --output=https://elastic:law2022@lvfa-v.com:8085/law_event_info@1665926463 \<br>  --type=mapping<br>  <br> docker run --network host --rm -ti -v /data:/tmp elasticdump/elasticsearch-dump \<br>  --input=http://elastic:law2022@192.168.0.22:9200/law_event_info@1665926463 \<br>  --output=https://elastic:law2022@lvfa-v.com:8085/law_event_info@1665926463 \<br>  --type=data<br></code></pre></td></tr></table></figure><h3 id="spring-boot-data-elasticsearch"><a href="#spring-boot-data-elasticsearch" class="headerlink" title="spring boot data elasticsearch"></a>spring boot data elasticsearch</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * &lt;br&gt;</span><br><span class="hljs-comment"> * ä¸»é¢˜ä¿¡æ¯   å¯¹æ˜ ä¸»é¢˜è¡¨</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span>: su af</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span>: v1.0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@Accessors(chain = true)</span><br><span class="hljs-meta">@Document(indexName = &quot;law_forum_theme&quot;)</span><br><span class="hljs-meta">@Setting(shards = 2, refreshInterval = &quot;10s&quot;)</span><br><span class="hljs-comment">//@Setting(settingPath = &quot;/elasticsearch_config.json&quot;)    è‡ªå®šä¹‰åˆ†è¯å™¨ä¸æ‹¼éŸ³è¿‡æ»¤å™¨ï¼Œå®ç°æ‹¼éŸ³è¡¥å…¨</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThemeEntity</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * id å…³è”æ•°æ®åº“id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * tag #è¯é¢˜#</span><br><span class="hljs-comment">     * æƒ³åšè¯äº‘ï¼Ÿfield dataéœ€è¦è®¾ç½®</span><br><span class="hljs-comment">     * mainField = <span class="hljs-doctag">@Field</span>(type = FieldType.Text, fielddata = true)</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@MultiField(</span><br><span class="hljs-meta">            mainField = @Field(type = FieldType.Text, fielddata = true),</span><br><span class="hljs-meta">            otherFields = &#123;</span><br><span class="hljs-meta">                    @InnerField(suffix = &quot;keyword&quot;,type = FieldType.Keyword)</span><br><span class="hljs-meta">            &#125;</span><br><span class="hljs-meta">    )</span><br>    <span class="hljs-keyword">private</span> String title;<br><br><br>    <span class="hljs-meta">@CompletionField(analyzer=&quot;ik_max_word&quot;,searchAnalyzer=&quot;ik_smart&quot;, maxInputLength = 20)</span><br>    <span class="hljs-keyword">private</span> Completion titleSuggest;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æè¿°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Field(type = FieldType.Text, analyzer = &quot;ik_max_word&quot;, searchAnalyzer = &quot;ik_smart&quot;)</span><br>    <span class="hljs-keyword">private</span> String description;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å®¡æ ¸çŠ¶æ€</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Field(type = FieldType.Integer)</span><br>    <span class="hljs-keyword">private</span> Integer status;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤çŠ¶æ€</span><br><span class="hljs-comment">     * é»˜è®¤å€¼: 0</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Field(type = FieldType.Integer)</span><br>    <span class="hljs-keyword">private</span> Integer isDelete;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åæ ‡  ç‚¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GeoPointField</span><br>    <span class="hljs-keyword">private</span> GeoPoint location;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç»åº¦</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Field(type = FieldType.Double)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> longitude;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * çº¬åº¦</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Field(type = FieldType.Double)</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> latitude;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åæ ‡ åŒºåŸŸ</span><br><span class="hljs-comment">     * &quot;type&quot; : &quot;polygon&quot;,</span><br><span class="hljs-comment">     * &quot;coordinates&quot; : [</span><br><span class="hljs-comment">     * [ [10.0, 0.0], [11.0, 0.0], [11.0, 1.0], [10.0, 1.0], [10.0, 0.0] ]</span><br><span class="hljs-comment">     * ]</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GeoShapeField</span><br>    <span class="hljs-keyword">private</span> GeoJson landmark;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * //<span class="hljs-doctag">@LastModifiedDate</span></span><br><span class="hljs-comment">     *     //<span class="hljs-doctag">@Field</span>(type = FieldType.Date, format = DateFormat.date_hour_minute_second,pattern = &quot;yyyy-MM-dd HH:mm:ss:SSS&quot;)</span><br><span class="hljs-comment">     * åˆ›å»ºæ—¶é—´</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Field(type = FieldType.Date, format = DateFormat.date_hour_minute_second_millis)</span><br>    <span class="hljs-meta">@JsonFormat(shape = JsonFormat.Shape.STRING, pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span><br>    <span class="hljs-keyword">private</span> LocalDateTime createTime;<br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ThemeEntityRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElasticsearchRepository</span>&lt;ThemeEntity, Long&gt; &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ¹æ®æè¿°æˆ–è€…titleæŸ¥è¯¢è´´å§</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> describe æè¿°</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> title    title</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> list</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Highlight(fields = &#123;</span><br><span class="hljs-meta">            @HighlightField(name = &quot;content&quot;),</span><br><span class="hljs-meta">            @HighlightField(name = &quot;description&quot;),</span><br><span class="hljs-meta">            @HighlightField(name = &quot;title&quot;),</span><br><span class="hljs-meta">    &#125;, parameters = @HighlightParameters(</span><br><span class="hljs-meta">            preTags = &quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;,</span><br><span class="hljs-meta">            postTags = &quot;&lt;/strong&gt;&quot;</span><br><span class="hljs-meta">    ))</span><br>    List&lt;SearchHit&lt;ThemeEntity&gt;&gt; <span class="hljs-title function_">findThemeEntityByDescriptionOrTitle</span><span class="hljs-params">(String describe, String title)</span>;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»¤äººè´¹è§£ï¼Œå¦‚æœè·å–page åˆ™ä¸èƒ½è·å–é«˜äº®æ•°æ®</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> describe</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> title</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageable</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Highlight(fields = &#123;</span><br><span class="hljs-meta">            @HighlightField(name = &quot;content&quot;),</span><br><span class="hljs-meta">            @HighlightField(name = &quot;description&quot;),</span><br><span class="hljs-meta">            @HighlightField(name = &quot;title&quot;),</span><br><span class="hljs-meta">    &#125;, parameters = @HighlightParameters(</span><br><span class="hljs-meta">            preTags = &quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;,</span><br><span class="hljs-meta">            postTags = &quot;&lt;/strong&gt;&quot;</span><br><span class="hljs-meta">    ))</span><br>    Page&lt;ThemeEntity&gt; <span class="hljs-title function_">findThemeEntityByDescriptionOrTitle</span><span class="hljs-params">(String describe, String title, Pageable pageable)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * sort query</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> describe       desc</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> title          title</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sort           sort</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span>               list</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Highlight(fields = &#123;</span><br><span class="hljs-meta">            @HighlightField(name = &quot;content&quot;),</span><br><span class="hljs-meta">            @HighlightField(name = &quot;description&quot;),</span><br><span class="hljs-meta">            @HighlightField(name = &quot;title&quot;),</span><br><span class="hljs-meta">    &#125;, parameters = @HighlightParameters(</span><br><span class="hljs-meta">            preTags = &quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;,</span><br><span class="hljs-meta">            postTags = &quot;&lt;/strong&gt;&quot;</span><br><span class="hljs-meta">    ))</span><br>    List&lt;ThemeEntity&gt; <span class="hljs-title function_">findThemeEntityByDescriptionOrTitle</span><span class="hljs-params">(String describe, String title, Sort sort)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@SneakyThrows</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCompletion</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">ThemeInfoEntity</span> <span class="hljs-variable">themeInfoEntity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThemeInfoEntity</span>();<br>    themeInfoEntity.setId(<span class="hljs-number">1L</span>);<br>    themeInfoEntity.setTitle(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€ä¸ªæœ‰æ„æ€çš„æ ‡é¢˜&quot;</span>);<br>    <span class="hljs-type">Completion</span> <span class="hljs-variable">completion</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Completion</span>(Lists.newArrayList(<span class="hljs-string">&quot;è¿™æ˜¯ä¸€ä¸ªæœ‰æ„æ€çš„æ ‡é¢˜&quot;</span>));<br>    themeInfoEntity.setTitleSuggest(completion);<br>    themeInfoEntityRepository.save(themeInfoEntity);<br><br>    <span class="hljs-type">SuggestBuilder</span> <span class="hljs-variable">suggestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuggestBuilder</span>().addSuggestion(<span class="hljs-string">&quot;simple_suggest&quot;</span>,<br>            SuggestBuilders.completionSuggestion(<span class="hljs-string">&quot;titleSuggest&quot;</span>)<br>                    .prefix(<span class="hljs-string">&quot;è¿™æ˜¯&quot;</span>)<br>                    .analyzer(<span class="hljs-string">&quot;ik_max_word&quot;</span>)<br>                    .size(<span class="hljs-number">3</span>)<br>    );<br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">suggestResp</span> <span class="hljs-operator">=</span> elasticsearchOperations.suggest(suggestBuilder, ThemeInfoEntity.class);<br>    Suggest.Suggestion&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry.Option&gt;&gt; completionSuggest = suggestResp.getSuggest().getSuggestion(<span class="hljs-string">&quot;simple_suggest&quot;</span>);<br>    List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry.Option&gt;&gt; entries = completionSuggest.getEntries();<br>    List&lt;Object&gt; collect = entries.stream().map(entry -&gt; &#123;<br>        <span class="hljs-keyword">if</span> (!entry.getOptions().isEmpty()) &#123;<br>            <span class="hljs-type">Text</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> entry.getOptions().get(<span class="hljs-number">0</span>).getText();<br>            <span class="hljs-keyword">return</span> text.string();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;).collect(Collectors.toList());<br>    collect.forEach(System.out::println);<br>&#125;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-meta">@SneakyThrows</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSuggestTerm</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * &#123;</span><br><span class="hljs-comment">     *   &quot;errorCorrection&quot; : &#123;</span><br><span class="hljs-comment">     *     &quot;text&quot; : &quot;The suggest feature suggestts&quot;,</span><br><span class="hljs-comment">     *     &quot;term&quot; : &#123;</span><br><span class="hljs-comment">     *       &quot;analyzer&quot; : &quot;ik_max_word&quot;,</span><br><span class="hljs-comment">     *       &quot;field&quot; : &quot;description&quot;,</span><br><span class="hljs-comment">     *       &quot;size&quot; : 3,</span><br><span class="hljs-comment">     *       &quot;suggest_mode&quot; : &quot;MISSING&quot;,</span><br><span class="hljs-comment">     *       &quot;accuracy&quot; : 0.5,</span><br><span class="hljs-comment">     *       &quot;sort&quot; : &quot;SCORE&quot;,</span><br><span class="hljs-comment">     *       &quot;string_distance&quot; : &quot;INTERNAL&quot;,</span><br><span class="hljs-comment">     *       &quot;max_edits&quot; : 2,</span><br><span class="hljs-comment">     *       &quot;max_inspections&quot; : 5,</span><br><span class="hljs-comment">     *       &quot;max_term_freq&quot; : 0.01,</span><br><span class="hljs-comment">     *       &quot;prefix_length&quot; : 1,</span><br><span class="hljs-comment">     *       &quot;min_word_length&quot; : 4,</span><br><span class="hljs-comment">     *       &quot;min_doc_freq&quot; : 0.0</span><br><span class="hljs-comment">     *     &#125;</span><br><span class="hljs-comment">     *   &#125;</span><br><span class="hljs-comment">     * &#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">SuggestBuilder</span> <span class="hljs-variable">suggestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuggestBuilder</span>().addSuggestion(<span class="hljs-string">&quot;errorCorrection&quot;</span>,<br>            SuggestBuilders.termSuggestion(<span class="hljs-string">&quot;description&quot;</span>)<br>                    .text(<span class="hljs-string">&quot;The suggest feature suggestts&quot;</span>)<br>                    .suggestMode(TermSuggestionBuilder.SuggestMode.MISSING)<br>                    .analyzer(<span class="hljs-string">&quot;ik_max_word&quot;</span>)<br>                    .size(<span class="hljs-number">3</span>).sort(SortBy.SCORE)<br>    );<br>    <span class="hljs-type">SearchResponse</span> <span class="hljs-variable">suggestResp</span> <span class="hljs-operator">=</span> elasticsearchOperations.suggest(suggestBuilder, ThemeEntity.class);<br>    Suggest.Suggestion&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry.Option&gt;&gt; errorCorrection = suggestResp.getSuggest().getSuggestion(<span class="hljs-string">&quot;errorCorrection&quot;</span>);<br>    List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry.Option&gt;&gt; entries = errorCorrection.getEntries();<br>    List&lt;Object&gt; collect = entries.stream().map(entry -&gt; &#123;<br>        <span class="hljs-keyword">if</span> (!entry.getOptions().isEmpty()) &#123;<br>            <span class="hljs-type">Text</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> entry.getOptions().get(<span class="hljs-number">0</span>).getText();<br>            <span class="hljs-keyword">return</span> text.string();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125;).collect(Collectors.toList());<br>    collect.forEach(System.out::println);<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">query</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-comment">//åˆ†é¡µ</span><br>     <span class="hljs-type">Pageable</span> <span class="hljs-variable">pageInfo</span> <span class="hljs-operator">=</span> PageRequest.of(<span class="hljs-number">1</span> - <span class="hljs-number">1</span>, <span class="hljs-number">10</span>);<br>     <span class="hljs-comment">//æŸ¥è¯¢æ¡ä»¶æ„å»º</span><br>     <span class="hljs-type">GeoPoint</span> <span class="hljs-variable">geoPoint</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GeoPoint</span>(<span class="hljs-number">39.927</span>, <span class="hljs-number">116.322</span>);<br>     <span class="hljs-type">NativeSearchQuery</span> <span class="hljs-variable">searchQuery</span> <span class="hljs-operator">=</span> getSearchQuery(geoPoint, pageInfo);<br>     <span class="hljs-comment">//æŸ¥è¯¢å¹¶è¿”å›ç»“æœ</span><br>     SearchHits&lt;ThemeEntity&gt; themeEntitySearchHits = elasticsearchOperations.search(searchQuery, ThemeEntity.class);<br><br>     List&lt;Integer&gt; nearbyStoreList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>     themeEntitySearchHits.forEach(hitTheme -&gt; &#123;<br>                 <span class="hljs-type">ThemeEntity</span> <span class="hljs-variable">theme</span> <span class="hljs-operator">=</span> hitTheme.getContent();<br>                 <span class="hljs-type">int</span> <span class="hljs-variable">distance</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>                 <span class="hljs-comment">//åæ ‡ä¸ä¸ºç©ºæ—¶è®¡ç®—å‡ºè·ç¦»ï¼ˆå•ä½ï¼škmï¼‰</span><br>                 <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(geoPoint.getLat() + <span class="hljs-string">&quot;&quot;</span>) &amp;&amp; !StringUtils.isEmpty(geoPoint.getLon() + <span class="hljs-string">&quot;&quot;</span>)) &#123;<br>                     <span class="hljs-comment">//LocationUtils.getDistance,é€šè¿‡ç»çº¬åº¦è·å¾—å®é™…è·ç¦»çš„æ–¹æ³•ï¼Œå¯ç™¾åº¦</span><br>                     distance = (<span class="hljs-type">int</span>) LocationUtils.getDistance(geoPoint, theme.getLocation());<br>                 &#125;<br>                 nearbyStoreList.add(distance);<br>             &#125;<br>     );<br>     nearbyStoreList.forEach(System.out::println);<br> &#125;<br><br> <span class="hljs-meta">@Test</span><br> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryShape</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-comment">//åˆ†é¡µ</span><br>     <span class="hljs-type">Pageable</span> <span class="hljs-variable">pageInfo</span> <span class="hljs-operator">=</span> PageRequest.of(<span class="hljs-number">1</span> - <span class="hljs-number">1</span>, <span class="hljs-number">10</span>);<br>     <span class="hljs-comment">//æŸ¥è¯¢æ¡ä»¶æ„å»º</span><br>     <span class="hljs-type">GeoPoint</span> <span class="hljs-variable">geoPoint1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GeoPoint</span>(<span class="hljs-number">39.927</span>, <span class="hljs-number">116.322</span>);<br>     <span class="hljs-type">GeoPoint</span> <span class="hljs-variable">geoPoint2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GeoPoint</span>(<span class="hljs-number">39.227</span>, <span class="hljs-number">116.722</span>);<br>     <span class="hljs-type">NativeSearchQuery</span> <span class="hljs-variable">searchQuery</span> <span class="hljs-operator">=</span> getSearchQuery(geoPoint1, geoPoint2, pageInfo);<br>     <span class="hljs-comment">//æŸ¥è¯¢å¹¶è¿”å›ç»“æœ</span><br>     SearchHits&lt;ThemeEntity&gt; themeEntitySearchHits = elasticsearchOperations.search(searchQuery, ThemeEntity.class);<br><br>     themeEntitySearchHits.forEach(hitTheme -&gt; &#123;<br>                 <span class="hljs-type">ThemeEntity</span> <span class="hljs-variable">theme</span> <span class="hljs-operator">=</span> hitTheme.getContent();<br>                 System.out.println(theme);<br>             &#125;<br>     );<br> &#125;<br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@description</span>: å…¥å‚æ¡ä»¶æŸ¥è¯¢æ„å»º</span><br><span class="hljs-comment">  **/</span><br> <span class="hljs-keyword">private</span> NativeSearchQuery <span class="hljs-title function_">getSearchQuery</span><span class="hljs-params">(GeoPoint locationModel, Pageable pageInfo)</span> &#123;<br>     <span class="hljs-type">BoolQueryBuilder</span> <span class="hljs-variable">boolQuery</span> <span class="hljs-operator">=</span> QueryBuilders.boolQuery();<br>     <span class="hljs-comment">//boolQuery.must(boolQuery.must(QueryBuilders.termQuery(&quot;is_delete&quot;, false)));</span><br>     <span class="hljs-comment">//ä¸ä¸ºç©ºæŸ¥è¯¢ç»åº¦ä¸çº¬åº¦</span><br>     boolQuery.must(QueryBuilders.existsQuery(<span class="hljs-string">&quot;latitude&quot;</span>));<br>     boolQuery.must(QueryBuilders.existsQuery(<span class="hljs-string">&quot;longitude&quot;</span>));<br>     <span class="hljs-comment">//æ„å»ºæŸ¥è¯¢</span><br>     <span class="hljs-type">NativeSearchQueryBuilder</span> <span class="hljs-variable">nativeBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>();<br>     <span class="hljs-comment">//è°ƒç”¨åœ°ç†ä½ç½®æŸ¥è¯¢æ„å»ºæ–¹æ³•</span><br>     <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(locationModel.getLat() + <span class="hljs-string">&quot;&quot;</span>) &amp;&amp; !StringUtils.isEmpty(locationModel.getLon() + <span class="hljs-string">&quot;&quot;</span>)) &#123;<br>         getLocation(locationModel, boolQuery, nativeBuilder);<br>     &#125;<br>     <span class="hljs-keyword">if</span> (StringUtils.isEmpty(locationModel.getLat() + <span class="hljs-string">&quot;&quot;</span>) || StringUtils.isEmpty(locationModel.getLon() + <span class="hljs-string">&quot;&quot;</span>)) &#123;<br>         nativeBuilder.withSort(SortBuilders.fieldSort(<span class="hljs-string">&quot;latitude&quot;</span>).order(SortOrder.DESC));<br>     &#125;<br>     <span class="hljs-comment">//æ„å»ºå®Œæˆ</span><br>     <span class="hljs-keyword">return</span> nativeBuilder<br>             .withQuery(boolQuery)<br>             .withPageable(pageInfo)<br>             .build();<br> &#125;<br><br> <span class="hljs-keyword">private</span> NativeSearchQuery <span class="hljs-title function_">getSearchQuery</span><span class="hljs-params">(GeoPoint locationModel1, GeoPoint locationModel2, Pageable pageInfo)</span> &#123;<br>     <span class="hljs-type">BoolQueryBuilder</span> <span class="hljs-variable">boolQuery</span> <span class="hljs-operator">=</span> QueryBuilders.boolQuery();<br>     <span class="hljs-comment">//storeBool.must(storeBool.must(QueryBuilders.termQuery(&quot;is_delete&quot;, false)));</span><br>     <span class="hljs-comment">//ä¸ä¸ºç©ºæŸ¥è¯¢ç»åº¦ä¸çº¬åº¦</span><br>     boolQuery.must(QueryBuilders.existsQuery(<span class="hljs-string">&quot;latitude&quot;</span>));<br>     boolQuery.must(QueryBuilders.existsQuery(<span class="hljs-string">&quot;longitude&quot;</span>));<br>     <span class="hljs-comment">//æ„å»ºæŸ¥è¯¢</span><br>     <span class="hljs-type">NativeSearchQueryBuilder</span> <span class="hljs-variable">nativeBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>();<br>     <span class="hljs-comment">//è°ƒç”¨åœ°ç†ä½ç½®æŸ¥è¯¢æ„å»ºæ–¹æ³•</span><br>     <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(locationModel1.getLat() + <span class="hljs-string">&quot;&quot;</span>) &amp;&amp; !StringUtils.isEmpty(locationModel2.getLon() + <span class="hljs-string">&quot;&quot;</span>)) &#123;<br>         getShape(locationModel1, locationModel2, boolQuery, nativeBuilder);<br>     &#125;<br>     <span class="hljs-keyword">if</span> (StringUtils.isEmpty(locationModel1.getLat() + <span class="hljs-string">&quot;&quot;</span>) || StringUtils.isEmpty(locationModel1.getLon() + <span class="hljs-string">&quot;&quot;</span>)) &#123;<br>         nativeBuilder.withSort(SortBuilders.fieldSort(<span class="hljs-string">&quot;latitude&quot;</span>).order(SortOrder.DESC));<br>     &#125;<br>     <span class="hljs-comment">//æ„å»ºå®Œæˆ</span><br>     <span class="hljs-keyword">return</span> nativeBuilder<br>             .withQuery(boolQuery)<br>             .withPageable(pageInfo)<br>             .build();<br> &#125;<br><br> <span class="hljs-comment">/**</span><br><span class="hljs-comment">  * <span class="hljs-doctag">@description</span>: åœ°ç†ä½ç½®æŸ¥è¯¢æ¡ä»¶æ„å»º</span><br><span class="hljs-comment">  **/</span><br> <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getLocation</span><span class="hljs-params">(GeoPoint geoPoint, BoolQueryBuilder queryBool, NativeSearchQueryBuilder searchQueryBuilder)</span> &#123;<br>     <span class="hljs-comment">// ä»¥æŸç‚¹ä¸ºä¸­å¿ƒï¼Œæœç´¢æŒ‡å®šèŒƒå›´</span><br>     <span class="hljs-type">GeoDistanceQueryBuilder</span> <span class="hljs-variable">distanceQueryBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GeoDistanceQueryBuilder</span>(<span class="hljs-string">&quot;location&quot;</span>);<br>     <span class="hljs-comment">//æŒ‡å®šä»å“ªä¸ªä½ç½®æœç´¢</span><br>     distanceQueryBuilder.point(geoPoint.getLat(), geoPoint.getLon());<br>     <span class="hljs-comment">//æŒ‡å®šæœç´¢å¤šå°‘kmï¼Œdistanceå¯ä¸ºè‡ªå®šä¹‰æ•°å€¼</span><br>     distanceQueryBuilder.distance(<span class="hljs-number">10</span>, DistanceUnit.KILOMETERS);<br>     queryBool.filter(distanceQueryBuilder);<br>     <span class="hljs-comment">// æŒ‰è·ç¦»å‡åºæ’åˆ—</span><br>     <span class="hljs-type">GeoDistanceSortBuilder</span> <span class="hljs-variable">distanceSortBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GeoDistanceSortBuilder</span>(<span class="hljs-string">&quot;location&quot;</span>, geoPoint.getLat(), geoPoint.getLon());<br>     distanceSortBuilder.unit(DistanceUnit.KILOMETERS);<br>     distanceSortBuilder.order(SortOrder.ASC);<br>     searchQueryBuilder.withSort(distanceSortBuilder);<br> &#125;<br></code></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ä¸­é—´ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitä½¿ç”¨</title>
    <link href="/2021/03/21/git%E4%BD%BF%E7%94%A8/"/>
    <url>/2021/03/21/git%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<blockquote><p>Gitæ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æºåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ—¨åœ¨å¿«é€Ÿé«˜æ•ˆåœ°å¤„ç†ä»å°åˆ°å¤§çš„é¡¹ç›®ã€‚Git æ˜“äºå­¦ä¹ ï¼Œå ç”¨ç©ºé—´å°ï¼Œæ€§èƒ½å¿«å¦‚é—ªç”µã€‚å®ƒå‡­å€Ÿå»‰ä»·çš„æœ¬åœ°åˆ†æ”¯ã€æ–¹ä¾¿çš„æš‚å­˜åŒºåŸŸå’Œå¤šä¸ªå·¥ä½œæµç¨‹ç­‰åŠŸèƒ½ã€‚</p></blockquote><h3 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1.å®‰è£…"></a>1.å®‰è£…</h3><p>ç•¥</p><h3 id="2-å‘½ä»¤"><a href="#2-å‘½ä»¤" class="headerlink" title="2.å‘½ä»¤"></a>2.å‘½ä»¤</h3><p><a href="https://learngitbranching.js.org/?locale=zh_CN">å»è¿™é‡Œç»ƒä¹ ï¼ï¼ï¼</a><br>å¦‚æœæƒ³è¦ç†Ÿç»ƒæŒæ¡å·¥ä½œç”¨çš„git flowä½¿ç”¨ï¼ŒåŠ¡å¿…ç†Ÿç»ƒæŒæ¡<code>merge</code>ã€<code>rebase(rebase -i)</code>ã€<code>reset</code>ã€<code>cherry-pick</code>ã€<code>checkout(switch)</code>ã€<code>tag</code>ã€<code>stash</code>çš„ä½¿ç”¨ï¼ï¼ï¼</p><h3 id="3-git-å·¥ä½œæµç¨‹"><a href="#3-git-å·¥ä½œæµç¨‹" class="headerlink" title="3.git å·¥ä½œæµç¨‹"></a>3.git å·¥ä½œæµç¨‹</h3><h4 id="3-1-Git-Flow"><a href="#3-1-Git-Flow" class="headerlink" title="3.1 Git Flow"></a>3.1 Git Flow</h4><ul><li>ä¸»å¹²åˆ†æ”¯</li><li>ç¨³å®šåˆ†æ”¯</li><li>å¼€å‘åˆ†æ”¯</li><li>è¡¥ä¸åˆ†æ”¯</li><li>ä¿®æ”¹åˆ†æ”¯</li></ul><h4 id="3-2-GitHub-Flow"><a href="#3-2-GitHub-Flow" class="headerlink" title="3.2 GitHub Flow"></a>3.2 GitHub Flow</h4><ul><li>åˆ›å»ºåˆ†æ”¯</li><li>æ·»åŠ æäº¤</li><li>æäº¤ PR è¯·æ±‚</li><li>è®¨è®ºå’Œè¯„ä¼°ä»£ç </li><li>éƒ¨ç½²æ£€æµ‹</li><li>åˆå¹¶ä»£ç </li></ul><h4 id="3-3-GitLab-Flow"><a href="#3-3-GitLab-Flow" class="headerlink" title="3.3 GitLab Flow"></a>3.3 GitLab Flow</h4><ul><li>å¸¦ç”Ÿäº§åˆ†æ”¯</li><li>å¸¦ç¯å¢ƒåˆ†æ”¯</li><li>å¸¦å‘å¸ƒåˆ†æ”¯</li></ul><h3 id="4-git-commitè§„èŒƒ"><a href="#4-git-commitè§„èŒƒ" class="headerlink" title="4.git commitè§„èŒƒ"></a>4.git commitè§„èŒƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç±»å‹ä¹‹åçš„ï¼æ˜¯å¯é€‰çš„ï¼Œæœ‰å®ƒæ„å‘³ç€æ˜¯äººä»¬éœ€è¦å…³æ³¨çš„é‡ç‚¹å˜æ›´</span><br>&lt;ç±»å‹&gt;[!][å¯é€‰çš„ä½œç”¨åŸŸ]: &lt;æè¿°&gt;<br></code></pre></td></tr></table></figure><h4 id="4-1-æ‰€æœ‰çš„-type-ç±»å‹å¦‚ä¸‹ï¼š"><a href="#4-1-æ‰€æœ‰çš„-type-ç±»å‹å¦‚ä¸‹ï¼š" class="headerlink" title="4.1 æ‰€æœ‰çš„ type ç±»å‹å¦‚ä¸‹ï¼š**"></a>4.1 æ‰€æœ‰çš„ type ç±»å‹å¦‚ä¸‹ï¼š**</h4><p>featï¼š æ–°å¢ feature<br>fix: ä¿®å¤ bug<br>docs: ä»…ä»…ä¿®æ”¹äº†æ–‡æ¡£ï¼Œæ¯”å¦‚ README, CHANGELOG, CONTRIBUTEç­‰ç­‰<br>style: ä»…ä»…ä¿®æ”¹äº†ç©ºæ ¼ã€æ ¼å¼ç¼©è¿›ã€é€—å·ç­‰ç­‰ï¼Œä¸æ”¹å˜ä»£ç é€»è¾‘<br>refactor: ä»£ç é‡æ„ï¼Œæ²¡æœ‰åŠ æ–°åŠŸèƒ½æˆ–è€…ä¿®å¤ bug<br>perf: ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒ<br>test: æµ‹è¯•ç”¨ä¾‹ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ç­‰<br>chore: æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰<br>revert: å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</p><h4 id="4-2-Examples"><a href="#4-2-Examples" class="headerlink" title="4.2 Examples"></a>4.2 Examples</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">feat(api)!: add send email<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">chore: modify dockerfile basice image version<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docs(api): update api docs<br></code></pre></td></tr></table></figure><h3 id="5-git-tips"><a href="#5-git-tips" class="headerlink" title="5.git tips"></a>5.git tips</h3><h4 id="5-1-git-log"><a href="#5-1-git-log" class="headerlink" title="5.1 git log"></a>5.1 git log</h4><p>å¯¹äºç å†œæ¥è¯´git logæ˜¯è‡ªç„¶ç†Ÿæ‚‰ä¸è¿‡çš„äº†ï¼Œä½†æ˜¯æ¯å¤©é¢å¯¹git logåŸå§‹çš„æ—¥å¿—æ ¼å¼ï¼Œä½ æ˜¯ä¸æ˜¯è§‰å¾—å¾ˆçƒ¦äººå•Šï¼Œå› ä¸ºä¸Šé¢çš„ç»™çš„ä¿¡æ¯å¤ªä¸äººæ€§åŒ–äº†ï¼Œè€Œä¸”æˆ‘ç›¸ä¿¡å¤§éƒ¨åˆ†çš„ç å†œçš„æäº¤æ—¥å¿—éƒ½æ˜¯éšå¿ƒæ‰€æ¬²çš„</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">log</span> --graph --pretty=format:<span class="hljs-string">&#x27;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#x27;</span> --abbrev-commit<br></code></pre></td></tr></table></figure><p>ä¸è¿‡å¾ˆæ˜¾ç„¶ä¸Šé¢çš„å‘½ä»¤æœ‰ç‚¹é•¿ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä¸Šé¢çš„å‘½ä»¤æ·»åŠ ä¸€ä¸ªåˆ«åï¼Œçš„æ—¥å¿—çš„æ—¶å€™åªéœ€è¦è¾“å…¥git lgå°±å¯ä»¥ï¼Œgit lg -p å¯æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global alias.lg <span class="hljs-string">&quot;log --color --graph --pretty=format:&#x27;%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset&#x27; --abbrev-commit&quot;</span><br></code></pre></td></tr></table></figure><h4 id="5-2-rebase-i"><a href="#5-2-rebase-i" class="headerlink" title="5.2 rebase -i"></a>5.2 rebase -i</h4><p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†å®Œæˆä¸€ä¸ªåŠŸèƒ½æˆ–è€…ç‰¹æ€§ï¼Œæäº¤å¾ˆå¤šä¸ª commit è®°å½•ã€‚ä½†æ˜¯åœ¨æœ€åï¼Œæäº¤ PR ä¹‹å‰ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯åº”è¯¥æ•´ç†ä¸‹è¿™äº›æäº¤è®°å½•çš„ã€‚æœ‰äº› commit éœ€è¦åˆå¹¶èµ·æ¥ï¼Œæˆ–è€…éœ€è¦å°†å…¶åˆ é™¤æ‰ï¼Œç­‰ç­‰ã€‚</p><table><thead><tr><th>åºå·</th><th>é€‰é¡¹åˆ—è¡¨</th><th>å¯¹åº”å«ä¹‰</th></tr></thead><tbody><tr><td>1</td><td>p&#x2F;pick</td><td>ä½¿ç”¨è¿™ä¸ªcommitè®°å½•</td></tr><tr><td>2</td><td>r&#x2F;reword</td><td>ä½¿ç”¨è¿™ä¸ªcommitè®°å½•ï¼Œå¹¶ä¸”ä¿®æ”¹æäº¤ä¿¡æ¯</td></tr><tr><td>3</td><td>e&#x2F;edit</td><td>ä½¿ç”¨è¿™ä¸ªcommitè®°å½•ï¼Œrebaseæ—¶ä¼šçŸ­æš‚çš„å…è®¸ä½ ä¿®æ”¹è¿™ä¸ªcommit</td></tr><tr><td>4</td><td>s&#x2F;squash</td><td>ä½¿ç”¨è¿™ä¸ªcommitè®°å½•ï¼Œä½†æ˜¯ä¼šä¸ä¸Šä¸€ä¸ªcommitåˆå¹¶</td></tr><tr><td>5</td><td>f&#x2F;fixup</td><td>å’Œsquashç›¸åŒï¼Œä½†æ˜¯ä¸ä¼šä¿ç•™commitæ—¶å€™æäº¤çš„ä¿¡æ¯</td></tr><tr><td>6</td><td>x&#x2F;exec</td><td>æ‰§è¡Œå…¶å®ƒshellå‘½ä»¤</td></tr><tr><td>7</td><td>d&#x2F;drop</td><td>ç§»é™¤è¿™ä¸ªcommitè®°å½•</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è°ƒæ•´æœ€è¿‘äº”æ¬¡çš„æäº¤è®°å½•</span><br>$ git rebase -i HEAD~5    <br>$ git rebase -i 5af4zd35  <span class="hljs-comment"># å¾€å‰ç¬¬å…­æ¬¡çš„commitå€¼</span><br>reword c2aeb6e 3rd commit<br>squash 25a3122 4th commit<br>pick 5d36f1d 5th commit<br>fixup bd5d32f 6th commit<br>drop 581e96d 7th commit<br><br><span class="hljs-comment"># æŸ¥çœ‹æäº¤å†å²è®°å½•</span><br>$ git <span class="hljs-built_in">log</span><br>* ce813eb - (HEAD -&gt; master) 5th commit<br>* aa2f043 - 3rd commit -&gt; modified<br>* 6c5418f - 2nd commit<br>* c8f7dea - 1st commit<br></code></pre></td></tr></table></figure><h4 id="5-3-git-commit-â€“amend"><a href="#5-3-git-commit-â€“amend" class="headerlink" title="5.3 git commit â€“amend"></a>5.3 git commit â€“amend</h4><p>æœ‰æ—¶å€™æäº¤ä¹‹åï¼Œæˆ‘ä»¬æ‰å‘ç°æäº¤çš„å†å²è®°å½•ä¸­å­˜åœ¨è¿™ä¸€äº›é—®é¢˜ï¼Œè€Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆä¸æƒ³æ–°ç”Ÿæˆä¸€ä¸ª commit è®°å½•ï¼Œä¸”è¾¾åˆ°ä¸€ä¸ªä¿®æ”¹çš„ç›®å½•ã€‚å³ï¼Œä¿®æ”¹ä¹‹å‰çš„ commit æäº¤è®°å½•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä¸ä½¿ç”¨åˆ†é¡µå™¨</span><br>$ git --no-pager <span class="hljs-built_in">log</span> --oneline -1<br>d5e96d9 (HEAD -&gt; master) say file<br><br><span class="hljs-comment"># æ”¹å˜æäº¤ä¿¡æ¯å¹¶åŠ å…¥æš‚å­˜åŒº</span><br>$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;hello&quot;</span> &gt; say.txt<br>$ git add -u<br><br><span class="hljs-comment"># æ”¹å˜å½“å‰æœ€æ–°ä¸€æ¬¡æäº¤è®°å½•</span><br>$ git commit --amend<br><span class="hljs-comment"># æ”¹å˜ä¸”æ¯ä¸æ”¹å˜æäº¤ä¿¡</span><br>$ git commit --amend --no-edit<br><span class="hljs-comment"># æ”¹å˜å½“å‰æœ€æ–°ä¸€æ¬¡æäº¤è®°å½•å¹¶ä¿®æ”¹ä¿¡æ¯</span><br>$ git commit --amend -m <span class="hljs-string">&quot;some_info&quot;</span><br><br><span class="hljs-comment"># ä¸ä½¿ç”¨åˆ†é¡µå™¨</span><br>$ git --no-pager <span class="hljs-built_in">log</span> --oneline -1<br>9e1e0eb (HEAD -&gt; master) say file<br></code></pre></td></tr></table></figure><h4 id="5-4-æ‰¾å›ä»£ç "><a href="#5-4-æ‰¾å›ä»£ç " class="headerlink" title="5.4 æ‰¾å›ä»£ç "></a>5.4 æ‰¾å›ä»£ç </h4><p>å¦‚ä½•æ‰¾å›æˆ‘ä»¬ä¸¢å¤±çš„å†…å®¹å’Œè®°å½•ï¼Ÿ</p><p>æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å›é€€å†…å®¹ã€å¼ºåˆ¶æ¨é€ä»£ç ã€åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼Œéƒ½æ˜¯éå¸¸å±é™©çš„æ“ä½œï¼Œå› ä¸ºé‡ç½®ä¹‹åæˆ‘ä»¬å°±æ²¡æœ‰åŠæ³•åœ¨æ‰¾åˆ°ä¹‹å‰çš„ä¿®æ”¹å†…å®¹äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å›é€€</span><br>$ git reset --hard &lt;commit&gt;<br><span class="hljs-comment"># æ¨é€</span><br>$ git push origin master -f<br><span class="hljs-comment"># åˆ†æ”¯</span><br>$ git branch -D &lt;branch_name&gt;<br></code></pre></td></tr></table></figure><p>å…¶å® Git ç»™æˆ‘ä»¬ç•™äº†ä¸€ä¸ªåé—¨ï¼Œå°±æ˜¯ä½¿ç”¨ relflog å‘½ä»¤æ¥æ‰¾å›ä¹‹å‰çš„å†…å®¹ï¼Œåªä¸è¿‡æ˜¯ç›¸å¯¹æ¥è¯´éº»çƒ¦ä¸€äº›ã€‚è€ŒåŸç†ä¹Ÿå¾ˆç®€ç­”ï¼Œå°±æ˜¯åœ¨æˆ‘ä»¬ä½¿ç”¨ Git å‘½ä»¤æ“ä½œä»“åº“çš„æ—¶å€™ï¼ŒGit å·å·åœ°å¸®åŠ©æˆ‘ä»¬æŠŠæ‰€æœ‰çš„æ“ä½œè®°å½•äº†ä¸‹æ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹æ—¥å¿—è®°å½•</span><br>$ git --no-pager <span class="hljs-built_in">log</span> --oneline -1<br>4bc8703 (HEAD -&gt; master) hhhh<br><br><span class="hljs-comment"># å›é€€åˆ°ä¸Šæ¬¡æäº¤</span><br>$ git reset --hard HEAD~1<br><br><span class="hljs-comment"># æŸ¥çœ‹å¼•ç”¨æ—¥å¿—è®°å½•</span><br>$ git reflog<br>6a89f1b (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to HEAD~1<br>4bc8703 HEAD@&#123;1&#125;: commit (amend): hhhh<br><br><span class="hljs-comment"># æ‰¾å›å†…å®¹</span><br>$ git cherry-pick 4bc8703<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å·¥å…·</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è§„èŒƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ—¥å¿—è§„èŒƒ</title>
    <link href="/2021/02/19/%E6%97%A5%E5%BF%97%E8%A7%84%E8%8C%83/"/>
    <url>/2021/02/19/%E6%97%A5%E5%BF%97%E8%A7%84%E8%8C%83/</url>
    
    <content type="html"><![CDATA[<h3 id="1-åŸºæœ¬åŸåˆ™"><a href="#1-åŸºæœ¬åŸåˆ™" class="headerlink" title="1.åŸºæœ¬åŸåˆ™"></a>1.åŸºæœ¬åŸåˆ™</h3><ul><li>ä¸å½±å“ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</li><li>ä¸å…è®¸å‡ºç°å®‰å…¨é—®é¢˜</li><li>æ—¥å¿—å¯ä¾›å¼€å‘äººå‘˜å®šä½é—®é¢˜çš„çœŸæ­£åŸå› </li><li>æ—¥å¿—å¯ä¾›ç›‘æ§ç³»ç»Ÿè‡ªåŠ¨ç›‘æ§ä¸åˆ†æ</li></ul><h3 id="2-æ—¥å¿—çº§åˆ«"><a href="#2-æ—¥å¿—çº§åˆ«" class="headerlink" title="2.æ—¥å¿—çº§åˆ«"></a>2.æ—¥å¿—çº§åˆ«</h3><ul><li>ERRORï¼šå½±å“ç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼Œå½±å“ä¸šåŠ¡æ­£å¸¸è¿è¡Œï¼Œæ˜ç¡®éœ€è¦äººå·¥å¹²é¢„ã€‚æ¯”å¦‚ï¼šæ•°æ®åº“ä¸å¯ç”¨ï¼Œå…³é”®ä¸šåŠ¡æµç¨‹ä¸­æ–­ç­‰ç­‰</li><li>WARNï¼šå‘ç”Ÿè¿™ä¸ªçº§åˆ«é—®é¢˜æ—¶ï¼Œå¤„ç†è¿‡ç¨‹å¯ä»¥ç»§ç»­ï¼Œä½†å¿…é¡»å¯¹è¿™ä¸ªé—®é¢˜ç»™äºˆé¢å¤–å…³æ³¨ã€‚è¿™ä¸ªé—®é¢˜åˆå¯ä»¥ç»†åˆ†æˆä¸¤ç§æƒ…å†µï¼šä¸€ç§æ˜¯å­˜åœ¨ä¸¥é‡çš„é—®é¢˜ä½†æœ‰åº”æ€¥æªæ–½ï¼ˆæ¯”å¦‚æ•°æ®åº“ä¸å¯ç”¨ï¼Œä½¿ç”¨Cacheï¼‰ï¼›ç¬¬äºŒç§æ˜¯æ½œåœ¨é—®é¢˜åŠå»ºè®®ï¼ˆATTENTIONï¼‰ï¼Œæ¯”å¦‚ç”Ÿäº§ç¯å¢ƒçš„åº”ç”¨è¿è¡Œåœ¨Developmentæ¨¡å¼ä¸‹ã€ç®¡ç†æ§åˆ¶å°æ²¡æœ‰å¯†ç ä¿æŠ¤ç­‰ã€‚ç³»ç»Ÿå¯ä»¥å…è®¸è¿™ç§é”™è¯¯çš„å­˜åœ¨ï¼Œä½†å¿…é¡»åŠæ—¶åšè·Ÿè¸ªæ£€æŸ¥</li><li>INFOï¼šé‡è¦çš„ä¸šåŠ¡å¤„ç†å·²ç»ç»“æŸã€‚åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œç³»ç»Ÿç®¡ç†å‘˜æˆ–è€…é«˜çº§ç”¨æˆ·è¦èƒ½ç†è§£INFOè¾“å‡ºçš„ä¿¡æ¯å¹¶èƒ½å¾ˆå¿«çš„äº†è§£åº”ç”¨æ­£åœ¨åšä»€ä¹ˆã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå’Œå¤„ç†æœºç¥¨é¢„è®¢çš„ç³»ç»Ÿï¼Œå¯¹æ¯ä¸€å¼ ç¥¨è¦æœ‰ä¸”åªæœ‰ä¸€æ¡INFOä¿¡æ¯æè¿° â€œ[Who] booked ticket from [Where] to [Where]â€ã€‚å¦å¤–ä¸€ç§å¯¹INFOä¿¡æ¯çš„å®šä¹‰æ˜¯ï¼šè®°å½•æ˜¾è‘—æ”¹å˜åº”ç”¨çŠ¶æ€çš„æ¯ä¸€ä¸ªactionï¼Œæ¯”å¦‚ï¼šæ•°æ®åº“æ›´æ–°ã€å¤–éƒ¨ç³»ç»Ÿè¯·æ±‚</li><li>DEBUGï¼šç”¨äºå¼€å‘äººå‘˜ä½¿ç”¨ã€‚å°†åœ¨TRACEç« èŠ‚ä¸­ä¸€èµ·è¯´æ˜è¿™ä¸ªçº§åˆ«è¯¥è¾“å‡ºä»€ä¹ˆä¿¡æ¯ã€‚</li><li>TRACEï¼šéå¸¸å…·ä½“çš„ä¿¡æ¯ï¼Œåªèƒ½ç”¨äºå¼€å‘è°ƒè¯•ä½¿ç”¨ã€‚éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒåï¼Œè¿™ä¸ªçº§åˆ«çš„ä¿¡æ¯åªèƒ½ä¿æŒå¾ˆçŸ­çš„æ—¶é—´ã€‚è¿™äº›ä¿¡æ¯åªèƒ½ä¸´æ—¶å­˜åœ¨ï¼Œå¹¶å°†æœ€ç»ˆè¢«å…³é—­ã€‚è¦åŒºåˆ†DEBUGå’ŒTRACEä¼šæ¯”è¾ƒå›°éš¾ï¼Œå¯¹ä¸€ä¸ªåœ¨å¼€å‘åŠæµ‹è¯•å®Œæˆåå°†è¢«åˆ é™¤çš„LOGè¾“å‡ºï¼Œå¯èƒ½ä¼šæ¯”è¾ƒé€‚åˆå®šä¹‰ä¸ºTRACEçº§åˆ«ã€‚</li></ul><h3 id="3-æ—¥å¿—å¯¹æ€§èƒ½çš„å½±å“"><a href="#3-æ—¥å¿—å¯¹æ€§èƒ½çš„å½±å“" class="headerlink" title="3.æ—¥å¿—å¯¹æ€§èƒ½çš„å½±å“"></a>3.æ—¥å¿—å¯¹æ€§èƒ½çš„å½±å“</h3><ul><li>å¦‚ä½•åˆ›å»ºLoggerå®ä¾‹ï¼šå¯¹äºå¯ä»¥é¢„è§çš„å¤šæ•°æƒ…å†µä¸‹å•ä¾‹è¿è¡Œçš„classï¼Œå¯ä»¥ä¸æ·»åŠ staticå‰ç¼€ï¼›å¯¹äºå¯èƒ½æ˜¯å¤šä¾‹å±…å¤šï¼Œå°¤å…¶æ˜¯éœ€è¦é¢‘ç¹åˆ›å»ºçš„classï¼Œæˆ‘ä»¬è¦æ±‚è¦æ·»åŠ staticå‰ç¼€</li><li>åˆ¤æ–­æ—¥å¿—çº§åˆ«ï¼šå¯¹äºå¯ä»¥é¢„è§çš„ä¼šé¢‘ç¹äº§ç”Ÿçš„æ—¥å¿—è¾“å‡ºï¼Œæ¯”å¦‚forã€whileå¾ªç¯ï¼Œå®šæœŸæ‰§è¡Œçš„jobç­‰ï¼Œå»ºè®®å…ˆä½¿ç”¨ifå¯¹æ—¥å¿—çº§åˆ«è¿›è¡Œåˆ¤æ–­åå†è¾“å‡ºã€‚å¯¹äºæ—¥å¿—è¾“å‡ºå†…å®¹éœ€è¦å¤æ‚çš„åºåˆ—åŒ–ï¼Œæˆ–è¾“å‡ºçš„æŸäº›ä¿¡æ¯è·å–æˆæœ¬è¾ƒé«˜æ—¶ï¼Œéœ€è¦å¯¹æ—¥å¿—çº§åˆ«è¿›è¡Œåˆ¤æ–­ã€‚æ¯”å¦‚æ—¥å¿—ä¸­éœ€è¦è¾“å‡ºç”¨æˆ·åï¼Œè€Œç”¨æˆ·åéœ€è¦åœ¨æ—¥å¿—è¾“å‡ºæ—¶ä»æ•°æ®åº“è·å–ï¼Œæ­¤æ—¶å°±éœ€è¦å…ˆåˆ¤æ–­ä¸€ä¸‹æ—¥å¿—çº§åˆ«ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰å¿…è¦è·å–è¿™äº›ä¿¡æ¯ã€‚</li><li>ä¼˜å…ˆä½¿ç”¨å‚æ•°ï¼Œå‡å°‘å­—ç¬¦ä¸²æ‹¼æ¥ï¼šä½¿ç”¨å‚æ•°çš„æ–¹å¼è¾“å‡ºæ—¥å¿—ä¿¡æ¯ï¼Œæœ‰åŠ©äºåœ¨æ€§èƒ½å’Œä»£ç ç®€æ´ä¹‹é—´å–å¾—å¹³è¡¡ã€‚å½“æ—¥å¿—çº§åˆ«é™åˆ¶è¾“å‡ºè¯¥æ—¥å¿—æ—¶ï¼Œå‚æ•°å†…å®¹å°†ä¸ä¼šèåˆåˆ°æœ€ç»ˆè¾“å‡ºä¸­ï¼Œå‡å°‘äº†å­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼Œä»è€Œæå‡æ‰§è¡Œæ•ˆç‡ã€‚</li></ul><h3 id="4-ä»€ä¹ˆæ—¶å€™åº”è¯¥æ‰“å°æ—¥å¿—"><a href="#4-ä»€ä¹ˆæ—¶å€™åº”è¯¥æ‰“å°æ—¥å¿—" class="headerlink" title="4.ä»€ä¹ˆæ—¶å€™åº”è¯¥æ‰“å°æ—¥å¿—"></a>4.ä»€ä¹ˆæ—¶å€™åº”è¯¥æ‰“å°æ—¥å¿—</h3><ul><li>ç³»ç»Ÿåˆå§‹åŒ–ï¼šç³»ç»Ÿåˆå§‹åŒ–æ—¶ä¼šä¾èµ–ä¸€äº›å…³é”®é…ç½®ï¼Œæ ¹æ®å‚æ•°ä¸åŒä¼šæä¾›ä¸ä¸€æ ·çš„æœåŠ¡ã€‚å°†ç³»ç»Ÿçš„å¯åŠ¨å‚æ•°è®°å½•INFOæ—¥å¿—ï¼Œæ‰“å°å‡ºå‚æ•°ä»¥åŠå¯åŠ¨å®Œæˆæ€æœåŠ¡è¡¨è¿°ã€‚</li><li>ä¸šåŠ¡æµç¨‹ä¸é¢„æœŸä¸ç¬¦ï¼šé¡¹ç›®ä»£ç ä¸­ç»“æœä¸æœŸæœ›ä¸ç¬¦æ—¶ä¹Ÿæ˜¯æ—¥å¿—åœºæ™¯ä¹‹ä¸€ï¼Œç®€å•æ¥è¯´æ‰€æœ‰æµç¨‹åˆ†æ”¯éƒ½å¯ä»¥åŠ å…¥è€ƒè™‘ã€‚å–å†³äºå¼€å‘äººå‘˜åˆ¤æ–­èƒ½å¦å®¹å¿æƒ…å½¢å‘ç”Ÿã€‚å¸¸è§çš„åˆé€‚åœºæ™¯åŒ…æ‹¬å¤–éƒ¨å‚æ•°ä¸æ­£ç¡®ï¼Œæ•°æ®å¤„ç†é—®é¢˜å¯¼è‡´è¿”å›ç ä¸åœ¨åˆç†èŒƒå›´å†…ç­‰ç­‰</li><li>ç³»ç»Ÿæ ¸å¿ƒçš„å…³é”®åŠ¨ä½œï¼šç³»ç»Ÿä¸­æ ¸å¿ƒè§’è‰²è§¦å‘çš„ä¸šåŠ¡åŠ¨ä½œæ˜¯éœ€è¦å¤šåŠ å…³æ³¨çš„ï¼Œæ˜¯è¡¡é‡ç³»ç»Ÿæ­£å¸¸è¿è¡Œçš„é‡è¦æŒ‡æ ‡ï¼Œå»ºè®®è®°å½•INFOçº§åˆ«æ—¥å¿—ï¼Œæ¯”å¦‚ç”µå•†ç³»ç»Ÿç”¨æˆ·ä»ç™»å½•åˆ°ä¸‹å•çš„æ•´ä¸ªæµç¨‹ï¼›å¾®æœåŠ¡å„æœåŠ¡èŠ‚ç‚¹äº¤äº’ï¼›æ ¸å¿ƒæ•°æ®è¡¨å¢åˆ æ”¹ç­‰ç­‰ã€‚</li><li>ç³»ç»Ÿå¼‚å¸¸ï¼šè¿™ç±»æ•è·çš„å¼‚å¸¸æ˜¯ç³»ç»Ÿå‘ŠçŸ¥å¼€å‘äººå‘˜éœ€è¦åŠ ä»¥å…³æ³¨çš„ï¼Œæ˜¯è´¨é‡éå¸¸é«˜çš„æŠ¥é”™ã€‚åº”å½“é€‚å½“è®°å½•æ—¥å¿—ï¼Œæ ¹æ®å®é™…ç»“åˆä¸šåŠ¡çš„æƒ…å†µä½¿ç”¨warnæˆ–è€…errorçº§åˆ«ã€‚</li></ul><h3 id="5-å»ºè®®"><a href="#5-å»ºè®®" class="headerlink" title="5.å»ºè®®"></a>5.å»ºè®®</h3><ul><li>ä½¿ç”¨å‚æ•°åŒ–ä¿¡æ¯çš„æ–¹å¼:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">logger.debug(<span class="hljs-string">&quot;Processing trade with id:[&#123;&#125;] and symbol : [&#123;&#125;] &quot;</span>, id, symbol);<br></code></pre></td></tr></table></figure></li><li>ä½¿ç”¨[]è¿›è¡Œå‚æ•°å˜é‡éš”ç¦»,å¦‚æœ‰å‚æ•°å˜é‡ï¼Œåº”è¯¥å†™æˆå¦‚ä¸‹å†™æ³•:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¯è¯»æ€§æ›´å¥½ï¼Œå¯¹äºæ’æŸ¥é—®é¢˜æ›´æœ‰å¸®åŠ©ã€‚</span><br>logger.debug(<span class="hljs-string">&quot;Processing trade with id:[&#123;&#125;] and symbol : [&#123;&#125;] &quot;</span>, id, symbol);<br></code></pre></td></tr></table></figure></li><li>ç¦ç”¨System.out.println  ä¸è¦ç›´æ¥ä½¿ç”¨System.outæˆ–System.err è¾“å‡ºæ—¥å¿—ï¼Œä¹Ÿä¸å…è®¸ä½¿ç”¨ STDOUTã€STDERR ä½œä¸ºLoggeråå­—<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é”™è¯¯</span><br>System.out.print( <span class="hljs-string">&quot;do something. . .&quot;</span>);<br>System.err.print(<span class="hljs-string">&quot;do something. . .&quot;</span>);<br><span class="hljs-comment">//é”™è¯¯</span><br>STDOUT.info( <span class="hljs-string">&quot;do something. . .&quot;</span>);<br>STDERR.info( <span class="hljs-string">&quot;do something. . . &quot;</span>);<br><span class="hljs-comment">//æ­£ç¡®</span><br>logger.info( <span class="hljs-string">&quot;do something. . . &quot;</span>);<br>logger.error( <span class="hljs-string">&quot;do something.. .&quot;</span>);<br></code></pre></td></tr></table></figure></li><li>å¯¹äºelse æ˜¯éæ­£å¸¸çš„æƒ…å†µï¼Œéœ€è¦æ ¹æ®æƒ…å†µé€‰æ‹©æ‰“å°warn æˆ– error æ—¥å¿—ã€‚å¯¹äºåªæœ‰ if æ²¡æœ‰ else çš„åœ°æ–¹ï¼Œå¦‚æœ else çš„è·¯å¾„æ˜¯ä¸å¯èƒ½çš„ï¼Œåº”å½“åŠ ä¸Š else è¯­å¥ï¼Œå¹¶æ‰“å° error æ—¥å¿—ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(<span class="hljs-literal">true</span>)&#123;<br>   <span class="hljs-comment">//do something </span><br>&#125;<span class="hljs-keyword">else</span> &#123;<br>logger.error(<span class="hljs-string">&quot;It is impossible. . .&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li>ä¸æ‰“æ— æ„ä¹‰çš„æ—¥å¿—ï¼Œä¸è®°å½•å¯¹äºæ’æŸ¥æ•…éšœæ¯«æ— æ„ä¹‰çš„æ—¥å¿—ä¿¡æ¯ï¼Œæ—¥å¿—ä¿¡æ¯ä¸€å®šè¦å¸¦æœ‰ä¸šåŠ¡ä¿¡æ¯<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é”™è¯¯</span><br>logger.error( <span class="hljs-string">&quot;Consume message failed !! ! &quot;</span>);<br><span class="hljs-comment">//æ­£ç¡®</span><br>logger.error(<span class="hljs-string">&quot;Consume message failed, msgId=, &quot;</span>, id);<br></code></pre></td></tr></table></figure></li><li>ä¸æ¨èå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¦‚æœä¿¡æ¯æœ¬èº«éœ€è¦è®¡ç®—æˆ–åˆå¹¶çš„ï¼Œæ‰“å°å‰è¦å¯¹isxxxEnable()æ–¹æ³•è¿›è¡Œåˆ¤æ–­ã€‚è¿™æ˜¯å› ä¸ºåœ¨WARNçº§åˆ«æ—¶ï¼Œå³ä½¿INFOä¿¡æ¯ä¸æ‰“å°ï¼Œä¹Ÿä¼šæ‰§è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œé€ æˆèµ„æºæµªè´¹ã€‚å®é™…ä¸Šï¼Œä¸æ¨èä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼æ‰“å°æ—¥å¿—ï¼Œå¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§éƒ½æ¯”è¾ƒå·®ã€‚å»ºè®®ä½¿ç”¨å ä½ç¬¦</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é”™è¯¯</span><br><span class="hljs-keyword">if</span> (logger.isInfoEnabled())&#123;<br>logger.info( <span class="hljs-string">&quot;Push message success,id=&quot;</span> + id + <span class="hljs-string">&quot;,msg=&quot;</span> +msg);<br>&#125;<br><span class="hljs-comment">//é”™è¯¯</span><br>logger.warn(<span class="hljs-string">&quot;Push message failedï¼Œid=&quot;</span> + id + <span class="hljs-string">&quot;,msg=&quot;</span> + msg + <span class="hljs-string">&quot; ,reason=&quot;</span>+ response.getReason());<br><span class="hljs-comment">//æ­£ç¡®</span><br>logger.warn(<span class="hljs-string">&quot;Push message failed,id=&#123;&#125;,msg=&#123;&#125;ï¼Œreason=&#123;&#125;&quot;</span>ï¼Œidï¼Œmsgï¼Œresponse.getReason()); <br></code></pre></td></tr></table></figure><ul><li>å¾ªç¯ä½“å†…ä¸è¦æ‰“å°infoæ—¥å¿—<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (Message message : messages) &#123;<br><span class="hljs-keyword">if</span> ( response.isSuccess())&#123;<br><span class="hljs-comment">//é”™è¯¯</span><br>logger.info(<span class="hljs-string">&quot;Message sends successfully,msgId=&#123;&#125;&quot;</span>, message.getId());<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>æ‰“å°æ—¥å¿—çš„ä»£ç ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸å…è®¸å¤±è´¥,ä¸€å®šè¦ç¡®ä¿ä¸ä¼šå› ä¸ºLogè¯­å¥çš„é—®é¢˜è€ŒæŠ›å‡ºå¼‚å¸¸é€ æˆä¸­æ–­ã€‚å¦‚ä¸‹ï¼Œå¦‚æœrequestä¸ºnullï¼Œå°±ä¼šæŠ›ç©ºæŒ‡é’ˆå¼‚å¸¸<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">logger.error( <span class="hljs-string">&quot;execute failed,id:&#123;&#125;&quot;</span>,request.getId());<br></code></pre></td></tr></table></figure></li><li>é‡è¦æ–¹æ³•å…¥å£å»ºè®®è®°å½•æ–¹æ³•è°ƒç”¨ã€å…¥å‚ã€è¿”å›å€¼ï¼Œå¯¹äºæ’æŸ¥é—®é¢˜ä¼šæœ‰å¾ˆå¤§å¸®åŠ©ã€‚æ³¨è§£åº”è¯¥å¯å®ç°,åç»­è°ƒç ”<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Response <span class="hljs-title function_">consume</span><span class="hljs-params">(Message msg)</span> &#123;<br>logger.debug(<span class="hljs-string">&quot;Prepare to consume a messageï¼ŒmsgId=&#123;&#125;, content=&#123;&#125;&quot;</span> , msg.getId(), msg.getContent());<br><span class="hljs-type">Response</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> messageService.send(msg);<br>logger.debug(<span class="hljs-string">&quot;Consume result:&#123;&#125;,status code:&#123;&#125;&quot;</span>, response.isSuccess(), response.getCode());<br><span class="hljs-keyword">return</span> response;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>å¼‚å¸¸æƒ…å†µï¼Œcatchä¸­çš„å¼‚å¸¸è®°å½•å¿…é¡»æ‰“å°å †æ ˆä¿¡æ¯ï¼Œä¸è¦ç”¨e.printStackTrace()<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//do something</span><br>&#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br><span class="hljs-comment">//æ­£ç¡®</span><br>logger.error( <span class="hljs-string">&quot;something wrong&quot;</span>, e);<br><span class="hljs-comment">//é”™è¯¯</span><br>e.printStackTrace();<br>&#125;<br></code></pre></td></tr></table></figure></li><li>ä¸è¦è®°å½•æ—¥å¿—ååˆæŠ›å‡ºå¼‚å¸¸ã€‚æŠ›å‡ºå»çš„å¼‚å¸¸ï¼Œä¸€èˆ¬å¤–å±‚ä¼šå¤„ç†ã€‚å¦‚æœä¸å¤„ç†ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜è¦æŠ›å‡ºå»ï¼Ÿå¦å¤–ä¸€ä¸ªåŸåˆ™æ˜¯ï¼Œæ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½ä¸è¦åœ¨ä¸åŒåœ°æ–¹é‡å¤è®°å½•é’ˆå¯¹åŒä¸€äº‹ä»¶çš„æ—¥å¿—æ¶ˆæ¯</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-comment">//do something</span><br>&#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>    logger.error( <span class="hljs-string">&quot;something wrong&quot;</span>, e);<br>    <span class="hljs-keyword">throw</span> e;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>è¾“å‡ºExceptionsçš„å…¨éƒ¨Throwableä¿¡æ¯ã€‚å¦åˆ™ä¼šä¸¢å¤±æœ€é‡è¦çš„å †æ ˆä¿¡æ¯ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//do something</span><br>&#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br><span class="hljs-comment">//é”™è¯¯</span><br>logger.error( <span class="hljs-string">&quot;Invoke causes a exception:&#123;&#125;&quot;</span>, e.getMessage());<br>    <span class="hljs-comment">//æ­£ç¡®</span><br>logger.error( <span class="hljs-string">&quot;Invoke causes a exception:&#123;&#125;&quot;</span>, e);<br>&#125;<br></code></pre></td></tr></table></figure></li><li>ç»„ä»¶é—´äº¤äº’æ¥å£ä¸Š,å»ºè®®å¢åŠ æ—¥å¿—è¾“å‡ºï¼Œä»¥æ–¹ä¾¿å¼‚å¸¸æƒ…å†µä¸‹çš„æ’æŸ¥</li></ul><h3 id="5-ç»Ÿä¸€logbacké…ç½®"><a href="#5-ç»Ÿä¸€logbacké…ç½®" class="headerlink" title="5.ç»Ÿä¸€logbacké…ç½®"></a>5.ç»Ÿä¸€logbacké…ç½®</h3><ul><li>logback.xmlâ€”-&gt;engine<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">scan</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">scanPeriod</span>=<span class="hljs-string">&quot;10 seconds&quot;</span> <span class="hljs-attr">debug</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ—¥å¿—æœ€å¤§çš„å†å² --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MAX_HISTORY&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;30&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- ç»„ä»¶åç§° --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MODULE_NAME&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;engine&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ—¥å¿—æ–‡ä»¶ç›®å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;DIR&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;logs&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ—¥å¿—æ–‡ä»¶å¤§å°ä¸Šé™ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MAX_FILE_SIZE&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;100MB&quot;</span>/&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- å¼€å¯JMXç®¡ç†æ—¥å¿— --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">jmxConfigurator</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!-- è¾“å‡ºåˆ°æ§åˆ¶å° --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;STDOUT&quot;</span></span><br><span class="hljs-tag">                          <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>                        <span class="hljs-comment">&lt;!-- è¾“å‡ºæ ¼å¼ --&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span><br>                                %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; %X&#123;traceId&#125; - %msg%n<br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- errorçº§åˆ«å•ç‹¬è®°å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;errorAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;-error.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- ä»¥dayä¸ºå•ä½è‡ªåŠ¨å›æ»š --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;-error/$&#123;MODULE_NAME&#125;-error-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>$&#123;MAX_HISTORY&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                                <span class="hljs-comment">&lt;!-- or whenever the file size reaches 100MB --&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>$&#123;MAX_FILE_SIZE&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;35&#125; %X&#123;traceId&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- errorçº§åˆ«è¿‡æ»¤å™¨ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>ERROR<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- warnçº§åˆ«å•ç‹¬è®°å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;warnAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;-warn.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- ä»¥dayä¸ºå•ä½è‡ªåŠ¨å›æ»š --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;-warn/$&#123;MODULE_NAME&#125;-warn-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>$&#123;MAX_HISTORY&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                                <span class="hljs-comment">&lt;!-- or whenever the file size reaches 100MB --&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>$&#123;MAX_FILE_SIZE&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;35&#125; %X&#123;traceId&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- errorçº§åˆ«è¿‡æ»¤å™¨ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>WARN<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- debugçº§åˆ«å•ç‹¬è®°å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;debugAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;-debug.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- ä»¥dayä¸ºå•ä½è‡ªåŠ¨å›æ»š --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;-debug/$&#123;MODULE_NAME&#125;-debug-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>$&#123;MAX_HISTORY&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                                <span class="hljs-comment">&lt;!-- or whenever the file size reaches 100MB --&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>$&#123;MAX_FILE_SIZE&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;35&#125; %X&#123;traceId&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- errorçº§åˆ«è¿‡æ»¤å™¨ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>DEBUG<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;infoAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;/$&#123;MODULE_NAME&#125;-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>$&#123;MAX_HISTORY&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                                <span class="hljs-comment">&lt;!-- or whenever the file size reaches 100MB --&gt;</span><br>                                <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>$&#123;MAX_FILE_SIZE&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;35&#125; %X&#123;traceId&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--&lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;</span><br><span class="hljs-comment">                        &lt;level&gt;INFO&lt;/level&gt;  </span><br><span class="hljs-comment">                        &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;  </span><br><span class="hljs-comment">                        &lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span><br><span class="hljs-comment">                &lt;/filter&gt;--&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;asyncSTDOUT&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“BlockingQueueè¿˜æœ‰20%å®¹é‡ï¼Œä»–å°†ä¸¢å¼ƒTRACEã€DEBUGå’ŒINFOçº§åˆ«çš„eventï¼Œåªä¿ç•™WARNå’ŒERRORçº§åˆ«çš„eventã€‚ä¸ºäº†ä¿æŒæ‰€æœ‰çš„eventsï¼Œè®¾ç½®è¯¥å€¼ä¸º0ã€‚ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">discardingThreshold</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">discardingThreshold</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">queueSize</span>&gt;</span>512<span class="hljs-tag">&lt;/<span class="hljs-name">queueSize</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;asyncErrorAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“BlockingQueueè¿˜æœ‰20%å®¹é‡ï¼Œä»–å°†ä¸¢å¼ƒTRACEã€DEBUGå’ŒINFOçº§åˆ«çš„eventï¼Œåªä¿ç•™WARNå’ŒERRORçº§åˆ«çš„eventã€‚ä¸ºäº†ä¿æŒæ‰€æœ‰çš„eventsï¼Œè®¾ç½®è¯¥å€¼ä¸º0ã€‚ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">discardingThreshold</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">discardingThreshold</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">queueSize</span>&gt;</span>512<span class="hljs-tag">&lt;/<span class="hljs-name">queueSize</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;errorAppender&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;asyncWarnAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“BlockingQueueè¿˜æœ‰20%å®¹é‡ï¼Œä»–å°†ä¸¢å¼ƒTRACEã€DEBUGå’ŒINFOçº§åˆ«çš„eventï¼Œåªä¿ç•™WARNå’ŒERRORçº§åˆ«çš„eventã€‚ä¸ºäº†ä¿æŒæ‰€æœ‰çš„eventsï¼Œè®¾ç½®è¯¥å€¼ä¸º0ã€‚ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">discardingThreshold</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">discardingThreshold</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">queueSize</span>&gt;</span>512<span class="hljs-tag">&lt;/<span class="hljs-name">queueSize</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;warnAppender&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;asyncInfoAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“BlockingQueueè¿˜æœ‰20%å®¹é‡ï¼Œä»–å°†ä¸¢å¼ƒTRACEã€DEBUGå’ŒINFOçº§åˆ«çš„eventï¼Œåªä¿ç•™WARNå’ŒERRORçº§åˆ«çš„eventã€‚ä¸ºäº†ä¿æŒæ‰€æœ‰çš„eventsï¼Œè®¾ç½®è¯¥å€¼ä¸º0ã€‚ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">discardingThreshold</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">discardingThreshold</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">queueSize</span>&gt;</span>512<span class="hljs-tag">&lt;/<span class="hljs-name">queueSize</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;infoAppender&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;asyncDebugAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“BlockingQueueè¿˜æœ‰20%å®¹é‡ï¼Œä»–å°†ä¸¢å¼ƒTRACEã€DEBUGå’ŒINFOçº§åˆ«çš„eventï¼Œåªä¿ç•™WARNå’ŒERRORçº§åˆ«çš„eventã€‚ä¸ºäº†ä¿æŒæ‰€æœ‰çš„eventsï¼Œè®¾ç½®è¯¥å€¼ä¸º0ã€‚ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">discardingThreshold</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">discardingThreshold</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">queueSize</span>&gt;</span>512<span class="hljs-tag">&lt;/<span class="hljs-name">queueSize</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;debugAppender&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- äº‹ä»¶æ„å»ºç›¸å…³ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cn.com.bsfit.engine.core.retem&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!-- ç‰¹å¾åŠ è½½ç›¸å…³ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cn.com.bsfit.engine.core.load&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!-- è§„åˆ™æ‰§è¡Œç›¸å…³ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cn.com.bsfit.engine.core.exec&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ¨¡å‹æ‰§è¡Œç›¸å…³ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cn.com.bsfit.engine.core.model&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!-- äº‹ä»¶ä¸‹å‘ç›¸å…³ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cn.com.bsfit.engine.core.mgr&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!-- restæ¥å£å¯ä»¥æ‰“å°æ¥æ”¶åˆ°çš„åŸå§‹æŠ¥æ–‡æ—¥å¿— --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cn.com.bsfit.engine.core.web&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!-- æµç«‹æ–¹å®¢æˆ·ç«¯æŸ¥è¯¢ç›¸å…³ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">logger</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;cn.com.bsfit.sc.client.command&quot;</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span> /&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- æ ¹ï¼Œæ‰€æœ‰loggerçš„ç¥–å…ˆ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;asyncSTDOUT&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;asyncErrorAppender&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;asyncWarnAppender&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;asyncInfoAppender&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;asyncDebugAppender&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li>logback.xmlâ€”-&gt;mgr<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ—¥å¿—æœ€å¤§çš„å†å² --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MAX_HISTORY&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;30&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- ç»„ä»¶åç§° --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MODULE_NAME&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;mgr&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ—¥å¿—æ–‡ä»¶ç›®å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;DIR&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;logs&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ—¥å¿—æ–‡ä»¶å¤§å°ä¸Šé™ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;MAX_FILE_SIZE&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;100MB&quot;</span>/&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- å¼€å¯JMXç®¡ç†æ—¥å¿— --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">jmxConfigurator</span> /&gt;</span><br>        <span class="hljs-comment">&lt;!-- è¾“å‡ºåˆ°æ§åˆ¶å° --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;STDOUT&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>                        <span class="hljs-comment">&lt;!-- è¾“å‡ºæ ¼å¼ --&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span><br>                                %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; %X&#123;traceId&#125; - %msg%n<br>                        <span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- errorçº§åˆ«å•ç‹¬è®°å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;errorAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;-error.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- ä»¥dayä¸ºå•ä½è‡ªåŠ¨å›æ»š --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;-error/$&#123;MODULE_NAME&#125;-error-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>$&#123;MAX_HISTORY&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                        <span class="hljs-comment">&lt;!-- or whenever the file size reaches 100MB --&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>$&#123;MAX_FILE_SIZE&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;35&#125; %X&#123;traceId&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- errorçº§åˆ«è¿‡æ»¤å™¨ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>ERROR<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- warnçº§åˆ«å•ç‹¬è®°å½• --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;warnAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;-warn.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- ä»¥dayä¸ºå•ä½è‡ªåŠ¨å›æ»š --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;-warn/$&#123;MODULE_NAME&#125;-warn-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>$&#123;MAX_HISTORY&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                        <span class="hljs-comment">&lt;!-- or whenever the file size reaches 100MB --&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>$&#123;MAX_FILE_SIZE&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;35&#125; %X&#123;traceId&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- errorçº§åˆ«è¿‡æ»¤å™¨ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">filter</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">level</span>&gt;</span>WARN<span class="hljs-tag">&lt;/<span class="hljs-name">level</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">onMatch</span>&gt;</span>ACCEPT<span class="hljs-tag">&lt;/<span class="hljs-name">onMatch</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">onMismatch</span>&gt;</span>DENY<span class="hljs-tag">&lt;/<span class="hljs-name">onMismatch</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;infoAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">file</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;.log<span class="hljs-tag">&lt;/<span class="hljs-name">file</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">rollingPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">fileNamePattern</span>&gt;</span>$&#123;DIR&#125;/$&#123;MODULE_NAME&#125;/$&#123;MODULE_NAME&#125;-%d&#123;yyyy-MM-dd&#125;.%i.log.gz<span class="hljs-tag">&lt;/<span class="hljs-name">fileNamePattern</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">maxHistory</span>&gt;</span>$&#123;MAX_HISTORY&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxHistory</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span><br>                        <span class="hljs-comment">&lt;!-- or whenever the file size reaches 100MB --&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">maxFileSize</span>&gt;</span>$&#123;MAX_FILE_SIZE&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">maxFileSize</span>&gt;</span><br>                    <span class="hljs-tag">&lt;/<span class="hljs-name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">rollingPolicy</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span>&gt;</span><br>                        <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;35&#125; %X&#123;traceId&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--&lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;</span><br><span class="hljs-comment">                        &lt;level&gt;INFO&lt;/level&gt;  </span><br><span class="hljs-comment">                        &lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;  </span><br><span class="hljs-comment">                        &lt;onMismatch&gt;DENY&lt;/onMismatch&gt;</span><br><span class="hljs-comment">                &lt;/filter&gt;--&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ASYNCSTDOUT&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“BlockingQueueè¿˜æœ‰20%å®¹é‡ï¼Œä»–å°†ä¸¢å¼ƒTRACEã€DEBUGå’ŒINFOçº§åˆ«çš„eventï¼Œåªä¿ç•™WARNå’ŒERRORçº§åˆ«çš„eventã€‚ä¸ºäº†ä¿æŒæ‰€æœ‰çš„eventsï¼Œè®¾ç½®è¯¥å€¼ä¸º0ã€‚ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">discardingThreshold</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">discardingThreshold</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">queueSize</span>&gt;</span>512<span class="hljs-tag">&lt;/<span class="hljs-name">queueSize</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;STDOUT&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ASYNCerrorAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“BlockingQueueè¿˜æœ‰20%å®¹é‡ï¼Œä»–å°†ä¸¢å¼ƒTRACEã€DEBUGå’ŒINFOçº§åˆ«çš„eventï¼Œåªä¿ç•™WARNå’ŒERRORçº§åˆ«çš„eventã€‚ä¸ºäº†ä¿æŒæ‰€æœ‰çš„eventsï¼Œè®¾ç½®è¯¥å€¼ä¸º0ã€‚ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">discardingThreshold</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">discardingThreshold</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">queueSize</span>&gt;</span>512<span class="hljs-tag">&lt;/<span class="hljs-name">queueSize</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;errorAppender&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ASYNCwarnAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“BlockingQueueè¿˜æœ‰20%å®¹é‡ï¼Œä»–å°†ä¸¢å¼ƒTRACEã€DEBUGå’ŒINFOçº§åˆ«çš„eventï¼Œåªä¿ç•™WARNå’ŒERRORçº§åˆ«çš„eventã€‚ä¸ºäº†ä¿æŒæ‰€æœ‰çš„eventsï¼Œè®¾ç½®è¯¥å€¼ä¸º0ã€‚ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">discardingThreshold</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">discardingThreshold</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">queueSize</span>&gt;</span>512<span class="hljs-tag">&lt;/<span class="hljs-name">queueSize</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;warnAppender&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ASYNCinfoAppender&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span><br>                <span class="hljs-comment">&lt;!-- é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“BlockingQueueè¿˜æœ‰20%å®¹é‡ï¼Œä»–å°†ä¸¢å¼ƒTRACEã€DEBUGå’ŒINFOçº§åˆ«çš„eventï¼Œåªä¿ç•™WARNå’ŒERRORçº§åˆ«çš„eventã€‚ä¸ºäº†ä¿æŒæ‰€æœ‰çš„eventsï¼Œè®¾ç½®è¯¥å€¼ä¸º0ã€‚ --&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">discardingThreshold</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">discardingThreshold</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">queueSize</span>&gt;</span>512<span class="hljs-tag">&lt;/<span class="hljs-name">queueSize</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;infoAppender&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span><br><span class="hljs-comment">&lt;!--    &lt;logger name=&quot;com.netflix&quot; level=&quot;INFO&quot;/&gt;--&gt;</span><br><span class="hljs-comment">&lt;!--    &lt;logger name=&quot;cn.com.bsfit.frms.engine&quot; level=&quot;INFO&quot;/&gt;--&gt;</span><br><span class="hljs-comment">&lt;!--    &lt;logger name=&quot;cn.com.bsfit.frms.pay.engine.loader.mob&quot; level=&quot;INFO&quot;/&gt;   --&gt;</span><br>        <span class="hljs-comment">&lt;!-- æ ¹ï¼Œæ‰€æœ‰loggerçš„ç¥–å…ˆ --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">&quot;INFO&quot;</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ASYNCSTDOUT&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ASYNCerrorAppender&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ASYNCwarnAppender&quot;</span> /&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;ASYNCinfoAppender&quot;</span> /&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>è¿ç»´</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è§„èŒƒ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç®€å•èŠèŠç¼“å­˜</title>
    <link href="/2020/09/23/%E7%AE%80%E5%8D%95%E8%81%8A%E8%81%8A%E7%BC%93%E5%AD%98/"/>
    <url>/2020/09/23/%E7%AE%80%E5%8D%95%E8%81%8A%E8%81%8A%E7%BC%93%E5%AD%98/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ‰ä¸€å¥è€è¯è¯´çš„å¥½ï¼šè®¡ç®—æœºç§‘å­¦æœ‰ä¸¤ä»¶éš¾äº‹ï¼Œä¸€æ˜¯ç¼“å­˜å¤±æ•ˆï¼ŒäºŒæ˜¯å–åã€‚æ—¢ç„¶å¦‚æ­¤è¿™é‡Œå°±ç€é‡è®°å½•ä¸€ä¸‹ä»€ä¹ˆæ˜¯ç¼“å­˜ã€‚</p></blockquote><p>ä½ æ˜¯ä¸æ˜¯æ›¾ç»é‡åˆ°è¿‡å¾ˆå¤šé—®é¢˜ï¼Œåˆ«äººç»™ä½ çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æ¸…é™¤æµè§ˆå™¨ç¼“å­˜æˆ–è€…dnsç¼“å­˜è¯•è¯•èƒ½ä¸èƒ½è§£å†³ï¼Ÿæˆ‘ä»¬éƒ½å¬è¯´è¿‡è¿™äº›ï¼Œä½†æ˜¯åˆ°åº•ä»€ä¹ˆæ˜¯cacheï¼Ÿ</p><p>é€šä¿—æ¥è¯´cacheå°±æ˜¯å°†ä¸œè¥¿å­˜å‚¨åˆ°ç¦»è¯·æ±‚è€…æ›´è¿‘çš„åœ°æ–¹ï¼Œè¿™æ ·å¯ä»¥æé«˜è®¿é—®é€Ÿåº¦ã€‚ç”Ÿæ´»ä¸­çš„ç®—æ³•è¿™æœ¬ä¹¦ç»™å‡ºäº†ç®€å•çš„è§£é‡Šï¼Œç°åœ¨ä½ æƒ³å†™ä¸€ç¯‡è®ºæ–‡ï¼Œä½†æ˜¯ä½ éœ€è¦å‚è€ƒå¾ˆå¤šæ–‡çŒ®èµ„æ–™ï¼Œè¿™äº›æ–‡çŒ®èµ„æ–™éƒ½åœ¨å›¾ä¹¦é¦†ä¸­å­˜å‚¨ï¼Œå›¾ä¹¦é¦†éƒ½ç›¸å½“äºä¸€ä¸ªå¤§çš„æ•°æ®åº“ï¼Œå…¶å®ä½ å¯ä»¥æŠŠå®ƒå€Ÿå›å®¶ç„¶åæ”¾åˆ°ä¹¦æ¡Œä¸Šï¼Œä»€ä¹ˆæ—¶å€™æƒ³è¦å‚è€ƒçš„æ—¶å€™ä»ä¹¦æ¡Œä¸Šæ‹¿èµ·æ¥å°±å¥½äº†ï¼Œä¸éœ€è¦å†å»å›¾ä¹¦é¦†ï¼Œè¿™æ ·å¤§å¤§å‡å°‘äº†è·å–ä¹¦çš„æ—¶é—´ã€‚æ­¤æ—¶è¿™ä¸ªä¹¦æ¡Œå°±ç›¸å½“äºç¼“å­˜ï¼Œå®ƒæŠŠä½ éœ€è¦çš„ä¸œè¥¿æ”¾åˆ°äº†ç¦»ä½ æ›´è¿‘çš„ä½ç½®ï¼Œä½†æ˜¯ä½ çš„ä¹¦æ¡Œå¤§å°æ˜¯æœ‰é™çš„ï¼Œèƒ½æ”¾çš„ä¹¦æœ¬ä¹Ÿæ˜¯æœ‰é™çš„ã€‚æ‰€ä»¥é€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘ä»¬å¾ˆç›´è§‚çš„äº†è§£åˆ°äº†ç¼“å­˜æ˜¯å¿«é€Ÿçš„ä¸”æœ‰é™çš„ç©ºé—´ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬çš„ç”µè„‘æ˜¯æ€ä¹ˆä½¿ç”¨ç¼“å­˜çš„ï¼Ÿ</p><p>å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡é€šè¿‡æµè§ˆå™¨æ‰“å¼€bilibiliæ—¶å€™ï¼Œæµè§ˆå™¨ä¼šç¼“å­˜ç½‘ç«™çš„å›¾æ ‡ï¼Œç¼©ç•¥å›¾ï¼Œå­—ä½“ï¼Œè„šæœ¬ï¼Œç„¶ååœ¨ä¹‹åçš„è®¿é—®ä¸­è¿™äº›éƒ½ä¸å†é€šè¿‡ç½‘ç»œè¯·æ±‚ï¼Œé€šè¿‡æµè§ˆå™¨ç›´æ¥åŠ è½½æ›´å¿«æ›´æµç•…ï¼Œæ­¤æ—¶åªéœ€è¦ä¸‹è½½ä»¬éœ€è¦çš„èµ„æºã€‚ä¸ºä»€ä¹ˆæœ‰æ—¶å€™æ¸…æ¥šç¼“å­˜èƒ½è§£å†³ä¸€äº›é—®é¢˜ï¼Ÿå› ä¸ºæœ‰æ—¶å€™ç½‘ç«™æ›´æ”¹äº†è‡ªå·±çš„ç¼©ç•¥å›¾ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯é€šè¿‡ç‰ˆæœ¬ç¼“å­˜è·å–çš„ï¼Œæ²¡æœ‰è·å–æœ€æ–°çš„å†…å®¹ï¼Œæ‰€ä»¥å‡ºç°äº†ç‚¹é—®é¢˜ï¼Œæ˜¾è€Œæ˜“è§æ­¤æ—¶æˆ‘ä»¬åªéœ€è¦æ¸…é™¤ç¼“å­˜å°±èƒ½å¤Ÿè§£å†³è¿™ç±»é—®é¢˜ã€‚</p><p>åœ¨ç¡¬ä»¶æ–¹é¢ï¼ŒCPUã€GPUã€SSDä¹ŸåŒæ ·éƒ½æœ‰ç¼“å­˜ï¼Œè¿™å½¢æˆäº†ä¸€ä¸ªå†…å­˜å±‚æ¬¡ç»“æ„ï¼Œä»é¡¶å±‚å¼€å§‹åˆåµŒå…¥cpuçš„å†…å­˜ï¼Œéå¸¸å°ï¼Œä½†æ˜¯éå¸¸å¿«ï¼Œå¾€ä¸‹ä¸€ç›´åˆ°æœ€åæ˜¯ssdå†…å­˜ï¼Œè¿™ä¸ªç»“æ„å°±åƒå›¾ä¹¦é¦†çš„ç»“æ„ä¸€æ ·ï¼Œä¼šæŠŠå¸¸å€Ÿç”¨çš„ä¹¦æœ¬æ”¾å…¥ä¸€ä¸ªå°æŸœå­é‡Œï¼Œæ–¹ä¾¿äººä»¬å¿«é€Ÿå€Ÿé˜…ï¼Œè€Œå…¶å®ƒçš„åˆ™åˆ†å¸ƒåœ¨ä¹¦æ¶ä¸­ï¼Œéœ€è¦æ ¹æ®ç›®å½•å»å»ºç´¢è·å–ï¼Œæœ€åä¸€äº›æ—§ä¹¦ä¼šæ”¾å…¥ä»“åº“ä¸­ã€‚</p><p>å†å›åˆ°ä¹¦æ¡Œä¸Šï¼Œä¸€ç›´å€Ÿé˜…å°±ä¼šå‡ºç°ä½ çš„ä¹¦æ¡Œä¸Šå †ç§¯æ»¡äº†ä¹¦æœ¬ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬åº”è¯¥ä½¿ç”¨è¿‡æœŸç¼“å­˜ç­–ç•¥ï¼Œå°†å€Ÿé˜…åˆ°æœŸçš„å›¾ä¹¦è¿˜å›å›¾ä¹¦é¦†ï¼Œä½†æ˜¯è¿™æ ·å°±æœ‰ä¸ªå¼Šç«¯å°±æ˜¯ä½ çš„çŸ¥é“æ¯ä¸€æœ¬ä½ å€Ÿé˜…çš„å›¾ä¹¦æ—¶é—´ï¼Œè¿™æ ·ä¼šå¾ˆéº»çƒ¦ã€‚è¿˜æœ‰ä¸€ç§å°±æ˜¯éšæœºè¿˜å›å»ä¸€æœ¬ï¼Œè¿™æ ·å¬èµ·æ¥å¾ˆç³Ÿç³•ï¼Œä½†æ˜¯æ˜¾ç„¶å®ç°èµ·æ¥æ›´ç®€å•ã€‚è¿˜æ˜¯å°±æ˜¯å°†å€Ÿé˜…çš„ä¹¦é‡Œè¾¹æœ€é•¿æ—¶é—´æ²¡ç”¨è¿‡çš„è¿˜å›å»ï¼Œæ˜¾ç„¶è¿™æ ·çš„è¯æ¯æ¬¡åªéœ€è¦è¿˜ä½ ä¹¦æ¡Œä¸Šä¸€æ‘ä¹¦ä¸­æœ€åº•å±‚çš„é‚£æœ¬å°±è¡Œï¼Œä¹Ÿæ˜¯å¾ˆeasyçš„ã€‚</p><p>æœ€åè¯´ä¸€å¥ï¼Œç¼“å­˜æ¦‚å¿µæ˜¯1965å¹´è®¡ç®—æœºç§‘å­¦å®¶æå‡ºçš„ï¼Œè‡³ä»Šè¿˜åœ¨è®¡ç®—æœºå„ä¸ªç»„ä»¶ä¸­ä½¿ç”¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Others</category>
      
    </categories>
    
    
    <tags>
      
      <tag>cache</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
